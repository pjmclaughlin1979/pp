(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/operations/PBFWorker":1465,"esri/tasks/operations/query":1466,"esri/core/HandleOwner":1503,"esri/tasks/operations/pbfQueryUtils":1515,"esri/core/pbf":1520,"esri/tasks/operations/pbfFeatureServiceParser":1535,"esri/tasks/operations/pbfDehydratedFeatureSet":1536,"esri/tasks/operations/pbfOptimizedFeatureSet":1537,"esri/tasks/operations/urlUtils":1538,"esri/layers/graphics/data/QueryEngineCapabilities":1545,"esri/views/2d/layers/features/controllers/BaseController":1639,"esri/layers/graphics/data/FeatureFilter":1640,"esri/views/2d/layers/features/controllers/StreamController":1792,"esri/views/2d/layers/features/controllers/support/DispatchQueue":2231})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{1465:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(79),r(9),r(356),r(355),r(34),r(1515),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,o,s,a,u,c){Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(){}return e.prototype._parseFeatureQuery=function(e){var t,r=u.parsePBFFeatureQuery(e.buffer,e.options);return e.options&&"dehydrated"===e.options.type&&(t=r.spatialReference.toJSON(),r.spatialReference=null),n.resolve({featureSet:r,sr:t})},e}(),l=function(t){function p(){var r=t.call(this)||this;return r._thread=void 0,s.open(o.getAbsMid("./PBFWorker",e,c),{strategy:"dedicated"}).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(p,t),p.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},p.prototype.parseFeatureQuery=function(e,t){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_parseFeatureQuery",{buffer:e,options:t},{transferList:[e]}).then(function(e){var t=e.featureSet;if(e.sr){var r=a.fromJSON(e.sr);t.spatialReference=r}for(var n=t.spatialReference,o=0,s=t.features;o<s.length;o++){var u=s[o];u.uid=i.generateUID(),u.geometry&&(u.geometry.spatialReference=n)}return e.featureSet}):n.resolve(u.parsePBFFeatureQuery(e,t)):n.resolve(null)},p}(p);t.PBFWorker=l,t.default=function(){return new p}}.apply(null,i))||(e.exports=n)},1466:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(50),r(33),r(69),r(1509),r(1515),r(1465),r(1538)],void 0===(n=function(e,t,r,i,n,o,s,a,u,c){function p(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=o.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var s=i.timeExtent,a=s.start,u=s.end;null==a&&null==u||(n.time=a===u?a:(null==a?"null":a)+","+(null==u?"null":u)),delete i.timeExtent}return n}function l(e,t,o,a,u){void 0===a&&(a={});var l="string"==typeof e?n.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return a.responseType="pbf"===o?"array-buffer":"json",s.normalizeCentralMeridian(h,null,a).then(function(e){var n=e&&e[0];n&&((t=t.clone()).geometry=n);var s=c.mapParameters(r({},l.query,{f:o},u,p(t,u)));return i(l.path+"/query",r({},a,{query:s}))})}Object.defineProperty(t,"__esModule",{value:!0});var h,d="Layer does not support extent calculation.";t.queryToQueryStringParameters=p,t.executeQuery=function(e,t,r){return l(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,i){return l(e,t,"pbf",i).then(function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?(null==h&&(h=new u.PBFWorker),h).parseFeatureQuery(e.data,r).then(function(e){return t(e)}):t(a.parsePBFFeatureQuery(e.data,r))})},t.executeQueryForIds=function(e,t,r){return l(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return l(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return l(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(d);if(t.hasOwnProperty("count"))throw new Error(d);return e})}}.apply(null,i))||(e.exports=n)},1503:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(17),r(0)],void 0===(n=function(e,t,r,i,n,o,s){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.call(this)||this;return i.handles=new o,i}return r(t,e),t.prototype.destroy=function(){this.handles.destroy()},i([s.property({readOnly:!0})],t.prototype,"handles",void 0),i([s.subclass("esri.core.HandleOwner")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1515:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1535)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var i=r.parseFeatureQuery(e,t).queryResult.featureResult;if(i&&i.features&&i.features.length&&i.objectIdFieldName)for(var n=i.objectIdFieldName,o=0,s=i.features;o<s.length;o++){var a=s[o];a.attributes&&(a.objectId=a.attributes[n])}return i}}.apply(null,i))||(e.exports=n)},1520:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t,r,i){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=i||e.byteLength}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,i=new e(this._data,this._dataView,r,r+t);return this._skip(t),i},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){var i="",n="";r=Math.min(this._end,r);for(var o=t;o<r;++o){var s=e[o];128&s?n+="%"+s.toString(16):(i+=decodeURIComponent(n)+String.fromCharCode(s),n="")}return n.length&&(i+=decodeURIComponent(n)),i},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,i))||(e.exports=n)},1535:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(13),r(10),r(1520),r(1536),r(1537)],void 0===(n=function(e,t,r,i,n,o,s){function a(e){return e>=T.length?null:T[e]}function u(e){return e>=I.length?null:I[e]}function c(e){return e>=x.length?null:x[e]}function p(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function l(e,t,r){for(var i=e.createPointGeometry(t);r.next();)switch(r.tag()){case 3:for(var n=r.getUInt32(),o=r.pos()+n,s=0;r.pos()<o;)e.addCoordinatePoint(i,r.getSInt64(),0,s++);break;case 1:case 2:default:r.skip()}return i}function h(e,t,r){for(var i=e.createGeometry(t),n=2+(t.hasZ?1:0)+(t.hasM?1:0);r.next();)switch(r.tag()){case 2:for(var o=r.getUInt32(),s=r.pos()+o,a=0;r.pos()<s;)e.addLength(i,r.getUInt32(),a++);break;case 3:for(var u=r.getUInt32(),c=(s=r.pos()+u,0),p=0;r.pos()<s;)e.addCoordinate(i,r.getSInt64(),p,c),++c===n&&(p++,c=0);break;case 1:default:r.skip()}return i}function d(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function f(e){for(var t={type:a(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=a(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=u(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function y(e,t,r,i){for(var n=e.createFeature(t),o=0;r.next();)switch(r.tag()){case 1:var s=i[o++].name;n.attributes[s]=d(r.getMessage());break;case 2:n.geometry=h(e,t,r.getMessage());break;case 4:n.centroid=l(e,t,r.getMessage());break;default:r.skip()}return n}function g(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function _(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function v(e){for(var t={originPosition:c(0)};e.next();)switch(e.tag()){case 1:t.originPosition=c(e.getEnum());break;case 2:t.scale=g(e.getMessage());break;case 3:t.translate=_(e.getMessage());break;default:e.skip()}return t}function m(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function b(e,t){for(var r=e.createSpatialReference();t.next();)switch(t.tag()){case 1:r.wkid=t.getUInt32();break;case 5:r.wkt=t.getString();break;case 2:case 3:case 4:default:t.skip()}return r}function F(e,t){var r=e.createFeatureResult();r.geometryType=p(e,0);for(var i=!1;t.next();)switch(t.tag()){case 1:r.objectIdFieldName=t.getString();break;case 3:r.globalIdFieldName=t.getString();break;case 4:r.geohashFieldName=t.getString();break;case 5:r.geometryProperties=m(t.getMessage());break;case 7:r.geometryType=p(e,t.getEnum());break;case 8:r.spatialReference=b(e,t.getMessage());break;case 10:r.hasZ=t.getBool();break;case 11:r.hasM=t.getBool();break;case 12:r.transform=v(t.getMessage());break;case 9:var n=t.getBool();r.exceededTransferLimit=n;break;case 13:e.addField(r,f(t.getMessage()));break;case 15:i||(e.prepareFeatures(r),i=!0),e.addFeature(r,y(e,r,t.getMessage(),r.fields));break;case 2:case 6:default:t.skip()}return e.finishFeatureResult(r),r}function w(e,t){for(var r={};t.next();)switch(t.tag()){case 1:r.featureResult=F(e,t.getMessage());break;default:t.skip()}return r}function S(e){return e&&"dehydrated"===e.type?new o.Context(e):new s.Context(e)}Object.defineProperty(t,"__esModule",{value:!0});var k=i.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),T=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],I=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],x=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e,t){var i=S(t);try{for(var o=new n(new Uint8Array(e),new DataView(e)),s={};o.next();)switch(o.tag()){case 2:s.queryResult=w(i,o.getMessage());break;default:o.skip()}return s}catch(e){var a=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return k.error(a),{queryResult:{featureResult:i.createFeatureResult()}}}}}.apply(null,i))||(e.exports=n)},1536:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(79),r(23),r(34),r(354)],void 0===(n=function(e,t,r,i,n,o){function s(e,t,r,i){return t}function a(e,t,r,i){switch(r){case 0:return l(e,t+i,0);case 1:return h(e,t+i,1)}}function u(e,t,r,i){switch(r){case 0:return l(e,t+i,0);case 1:return h(e,t+i,1);case 2:return l(e,t,2)}}function c(e,t,r,i){switch(r){case 0:return l(e,t+i,0);case 1:return h(e,t+i,1);case 2:return l(e,t,3)}}function p(e,t,r,i){switch(r){case 0:return l(e,t+i,0);case 1:return h(e,t+i,1);case 2:case 3:return l(e,t,3)}}function l(e,t,r){var i=e.translate,n=e.scale;return i[r]+t*n[r]}function h(e,t,r){var i=e.translate,n=e.scale;return i[r]-t*n[r]}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=s,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0}return e.prototype.createFeatureResult=function(){return{exceededTransferLimit:!1,features:[],fields:[],hasM:!1,hasZ:!1,geometryType:null,objectIdFieldName:null,globalIdFieldName:null,geometryProperties:null,geohashFieldName:null,spatialReference:null,transform:null}},e.prototype.finishFeatureResult=function(e){this.options.applyTransform&&(e.transform=null)},e.prototype.createSpatialReference=function(){return new n},e.prototype.addField=function(e,t){e.fields.push(o.fromJSON(t))},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var i in t.attributes){var n=t.attributes[i];"string"==typeof n&&n.length>r&&delete t.attributes[i]}e.features.push(t)},e.prototype.prepareFeatures=function(e){switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=this.addCoordinatePoint.bind(this),this.createGeometry=this.createPointGeometry.bind(this);break;case"polygon":this.addCoordinate=this.addCoordinatePolygon.bind(this),this.createGeometry=this.createPolygonGeometry.bind(this);break;case"polyline":this.addCoordinate=this.addCoordinatePolyline.bind(this),this.createGeometry=this.createPolylineGeometry.bind(this);break;case"multipoint":this.addCoordinate=this.addCoordinateMultipoint.bind(this),this.createGeometry=this.createMultipointGeometry.bind(this);break;default:i.neverReached(e.geometryType)}},e.prototype.createFeature=function(e){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{uid:r.generateUID(),objectId:null,attributes:{},geometry:null,visible:!0}},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.paths,t,r,i)},e.prototype.addCoordinatePolygon=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.rings,t,r,i)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r,i){if(null===this.coordinateBuffer){var n=this.lengths.reduce(function(e,t){return e+t},0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var o=this.transformPathLikeValue(t,i),s=e[e.length-1];0===i&&s.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=o},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?p:t?u:r?c:a},e}();t.Context=d}.apply(null,i))||(e.exports=n)},1537:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(550),r(564),r(553)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new i.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(){},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new r.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new n.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new n.default},e}();t.Context=o}.apply(null,i))||(e.exports=n)},1538:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var o=0;o<n.length;o++)r[i][o]=e(n[o])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},1545:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1639:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(22),r(25),r(2),r(6),r(13),r(1503),r(10),r(32),r(0),r(1640),r(1562),r(1506)],void 0===(n=function(e,t,r,i,n,o,s,a,u,c,p,l,h,d,f){Object.defineProperty(t,"__esModule",{value:!0});var y=c.getLogger("esri.views.2d.layers.features.controllers.BaseController"),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.configuration=null,t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t.filters=new Array(f.MAX_FILTERS),t}return o(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),t.prototype.setFilterBase=function(e,t){return n(this,void 0,void 0,function(){var r,n,o,s;return i(this,function(i){switch(i.label){case 0:return[4,this._getFilter(e)];case 1:return r=i.sent(),[4,d.normalizeFilter(t,null,this.spatialReference)];case 2:return n=i.sent(),this.configuration.filter=n,n?[4,r.update(n)]:[2,r.clear()];case 3:i.sent(),i.label=4;case 4:return i.trys.push([4,6,,7]),[4,this.queryObjectIds(r.createQuery().toJSON())];case 5:return o=i.sent(),[2,r.setTrue(o)];case 6:return s=i.sent(),y.error(new a("featurelayer-controller:query-filter-error","An error occurred while executing the query",{error:s})),[2,{show:[],hide:[]}];case 7:return[2]}})})},t.prototype.enableEvent=function(e){},t.prototype._getFilter=function(e){return n(this,void 0,void 0,function(){var t,r,n;return i(this,function(i){switch(i.label){case 0:return t=this.filters[e],p.isSome(t)?[2,t]:(r=new h.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1,timeInfo:this.service.timeInfo}),this.filters[e]=r,[4,this.queryObjectIds({})]);case 1:return n=i.sent(),r.setKnownIds(n),[2,r]}})})},t.prototype._getFilterFlags=function(e){for(var t=0,r=0;r<this.filters.length;r++){var i=this.filters[r];t|=(p.isNone(i)||i.check(e)?1:0)<<r}return t},t.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return p.isSome(e)&&!!e.geometry})},r([l.property()],t.prototype,"configuration",void 0),r([l.property()],t.prototype,"processor",void 0),r([l.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([l.property({constructOnly:!0})],t.prototype,"service",void 0),r([l.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([l.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([l.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([l.property()],t.prototype,"filters",void 0),r([l.subclass()],t)}(l.declared(s,u));t.default=g}.apply(null,i))||(e.exports=n)},1640:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(25),r(11),r(22),r(170),r(13),r(10),r(32),r(9),r(37),r(549),r(1554),r(1607),r(1590),r(353)],void 0===(n=function(e,t,r,i,n,o,s,a,u,c,p,l,h,d,f,y){Object.defineProperty(t,"__esModule",{value:!0});var g=a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),_=1,v=2,m=function(){function e(e){var t=this;this._geometryBounds=p.create(),this._idToVisibility=new Map,this.check=function(e){var r=e.objectId,i=t._idToVisibility,n=t._applyFilter(e);return i.set(r,n?_|v:v),!!(i.get(r)&_)},this._serviceInfo=e}return e.prototype.clear=function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}},e.prototype.invalidate=function(){var e=this;this._idToVisibility.forEach(function(t,r){e._idToVisibility.set(r,0)})},e.prototype.setKnownIds=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._idToVisibility.set(i,_)}},e.prototype.setTrue=function(e){var t=this,r=[],i=[],n=new o.default(e);return this._idToVisibility.forEach(function(e,o){var s=!!(t._idToVisibility.get(o)&_),a=n.has(o);!s&&a?r.push(o):s&&!a&&i.push(o),t._idToVisibility.set(o,a?_|v:0)}),{show:r,hide:i}},e.prototype.createQuery=function(){var e=this,t=e.geometry,r=e.spatialRel,i=e.where,n=e.distance,o=e.units,s=e.timeExtent,a=e.objectIds;return y.fromJSON({geometry:t,spatialRel:r,where:i,distance:n,units:o,timeExtent:s,objectIds:a})},e.prototype.update=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return[4,c.all([this._setGeometryFilter(e),this._setIdFilter(e),this._setAttributeFilter(e),this._setTimeFilter(e)])];case 1:return t.sent(),[2]}})})},e.prototype._setAttributeFilter=function(e){if(!e||!e.where)return this._clause=null,void(this.where=null);var t=h.getWhereClause(e.where);if(t.isStandardized())this._clause=t;else{var r=new s("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",t);g.error(r)}this.where=e.where},e.prototype._setIdFilter=function(e){this._idsToShow=e&&e.objectIds&&new o.default(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new o.default(e.hiddenIds),this.objectIds=e&&e.objectIds},e.prototype._setGeometryFilter=function(e){return r(this,void 0,void 0,function(){var t,r,i;return n(this,function(n){switch(n.label){case 0:return e&&e.geometry?(t=e.geometry,r=e.spatialRel||"esriSpatialRelIntersects",[4,d.getSpatialQueryOperator(r,t,this._serviceInfo)]):(this._spatialQueryOperator=null,this.geometry=null,this.spatialRel=null,[2]);case 1:return i=n.sent(),l.getBoundsXY(this._geometryBounds,t),this._spatialQueryOperator=i,this.geometry=t,this.spatialRel=r,[2]}})})},e.prototype._setTimeFilter=function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent){if(!this._serviceInfo.timeInfo){var t=new s("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);return void g.error(t)}this.timeExtent=e.timeExtent,this._timeOperator=f.getTimeOperator(this._serviceInfo.timeInfo,e.timeExtent)}},e.prototype._applyFilter=function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)},e.prototype._filterByExpression=function(e){return!this.where||this._clause.testFeature(e.attributes)},e.prototype._filterById=function(e){return(!this._idsToHide||!this._idsToHide.has(e.objectId))&&(!this._idsToShow||this._idsToShow.has(e.objectId))},e.prototype._filterByGeometry=function(e){return!this.geometry||!!this._earlyGeometryReject(e)&&this._spatialQueryOperator(e.geometry)},e.prototype._filterByTime=function(e){return!u.isSome(this._timeOperator)||this._timeOperator(e)},e.prototype._earlyGeometryReject=function(e){return!(!e.geometry||!e.geometry.coords.length)&&(!e.centroid||"esriSpatialRelContains"!==this.spatialRel||p.containsPoint(this._geometryBounds,e.centroid.coords))},e.prototype._resetAllHiddenIds=function(){var e=this,t=[];return this._idToVisibility.forEach(function(r,i){r&_||(e._idToVisibility.set(i,_),t.push(i))}),t},e}();t.default=m}.apply(null,i))||(e.exports=n)},1792:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(22),r(25),r(154),r(546),r(43),r(50),r(13),r(10),r(9),r(586),r(0),r(547),r(1544),r(1553),r(1466),r(353),r(1639),r(2231)],void 0===(n=function(e,t,r,i,n,o,s,a,u,c,p,l,h,d,f,y,g,_,v,m,b,F,w){function S(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}Object.defineProperty(t,"__esModule",{value:!0});var k=h.getLogger("esri.views.2d.layers.features.controllers.StreamController"),T=5e3,I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="stream",t.errorString=null,t._started=!1,t._idCounter=0,t._tileDispatchMap=new u.default,t._updateIntervalId=0,t._reconnectWebSocketT=f.throttle(t._reconnectWebSocket,T,t),t._featureIds=[],t}return r(t,e),t.prototype.initialize=function(){var e=this;this.handles.add(this.watch("processor",this._switchProcessor.bind(this))),["connectionStatus","errorString"].forEach(function(t){e.watch(t,function(r){return e.remoteClient.invoke("setProperty",{propertyName:t,value:r})})}),this._updateIntervalId=setInterval(function(){return e._checkForUpdates()},64)},t.prototype.destroy=function(){clearInterval(this._updateIntervalId),this._destroyWebSocket(),this._tileDispatchMap.forEach(function(e){return e.destroy()}),this.queryEngine&&(this.queryEngine.destroy(),this._set("queryEngine",null)),this._tempQueryEngine&&this._tempQueryEngine.destroy()},Object.defineProperty(t.prototype,"updating",{get:function(){return!this._started||this._tempQueryEngine&&!!this._tempQueryEngine.featureStore.numFeatures||this._anyUpdatesQueued()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connectionStatus",{get:function(){if(!this._websocket)return"disconnected";switch(this._websocket.readyState){case 0:case 1:return"connected";case 2:case 3:return"disconnected"}},enumerable:!0,configurable:!0}),t.prototype.onEdits=function(e){},t.prototype.queryFeatures=function(e){return this.queryEngine?this.queryEngine.executeQuery(e):d.resolve({features:[],fields:[]})},t.prototype.queryFeatureCount=function(e){return this.queryEngine?this.queryEngine.executeQueryForCount(e):d.resolve(0)},t.prototype.queryObjectIds=function(e){return this.queryEngine?this.queryEngine.executeQueryForIds(e):d.resolve([])},t.prototype.queryExtent=function(e){return this.queryEngine?this.queryEngine.executeQueryForExtent(e):d.reject({count:0,extent:null})},t.prototype.queryLatestObservations=function(e){return this.queryEngine?this.queryEngine.executeQueryForLatestObservations(e):d.resolve({features:[],fields:[]})},t.prototype.redraw=function(){},t.prototype.refresh=function(){},t.prototype.setFilter=function(e){var t=e.index,r=e.filter;return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this._flushQueues()];case 1:return e.sent(),[2,this.setFilterBase(t,r)]}})})},t.prototype.setViewState=function(e){},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,i=e.removed;this._started&&(i.forEach(function(e){return t._handleTileRemove(e)}),r.forEach(function(e){return t._handleTileAdd(e)}))},t.prototype.enableEvent=function(e){"data-received"===e.name&&(this._shouldPushDataReceived=e.value)},t.prototype._flushQueues=function(){var e=[];return this._tileDispatchMap.forEach(function(t){return e.push(t)}),e.reduce(function(e,t){return e.then(function(){return t.flush()})},d.resolve())},t.prototype._start=function(){var e=this;this._started||this._queryBuddies().then(function(){e._startWebSocket(),e.tileStore.tiles.forEach(function(t){return e._handleTileAdd(t)}),e._started=!0,e._updateActiveTiles(e.queryEngine)})},t.prototype._getService=function(){var e=n({},this.service.content,{f:"json"});return p(this.service.source,{query:e,responseType:"json"}).then(function(e){return e.data})},t.prototype._startWebSocket=function(){var e=this;this._getService().then(function(t){return e._createWebSocket(t)}).then(function(t){return e._setFilter(t)}).catch(function(e){return k.error(new l("stream-socket","Encountered an error while creating listening stream",e))})},t.prototype._destroyWebSocket=function(){this._websocket&&(this._websocket.onmessage=null,this._websocket.onerror=null,this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.close(),this.notifyChange("connectionStatus"))},t.prototype._createWebSocket=function(e){var t=this;return d.create(function(r){for(var i=e.streamUrls.filter(function(e){return"ws"===e.transport})[0],n=i.token,o=null,s=null,a=0,u=i.urls;a<u.length;a++){var c=u[a];-1!==c.indexOf("wss")?o=c:s=c}var p=(o||s)+"/subscribe?outSR="+t.spatialReference.wkid+(n?"&token="+n:""),l=new WebSocket(p);l.onopen=function(){t.notifyChange("connectionStatus"),r(l)},l.onmessage=t._handleWebSocketMessage.bind(t),l.onclose=t._handleWebSocketClose.bind(t),t._destroyWebSocket(),t._websocket=l})},t.prototype._setFilter=function(e){var t=this,r={},i=this.processor.queryInfo.outFields;return this.configuration.serviceFilter.geometry&&(r.geometry=JSON.stringify(this.configuration.serviceFilter.geometry)),this.configuration.serviceFilter.where&&(r.where=this.configuration.serviceFilter.where),i.length/this.service.fields.length>=.75&&(r.outFields=i.join(",")),r.geometry||r.where||r.outFields||d.resolve(),d.create(function(i,n){var o=e.onmessage;e.onmessage=function(r){var s=JSON.parse(r.data);s.filter&&(e.onmessage=o,s.error?(t.set("errorString","Could not set service filter - "+s.error),n(new l("stream-socket-service-filter",t.errorString,{activeServiceFilter:s.filter}))):i())},e.send(JSON.stringify({filter:r}))})},t.prototype._reconnectWebSocket=function(e){this.set("errorString","Lost websocket connection - "+e+", attempting to reconnect"),k.error(new l("stream-socket",this.errorString)),this._startWebSocket()},t.prototype._handleWebSocketClose=function(e){var t=e.code;if(this.notifyChange("connectionStatus"),1001===t||t>=4e3){var r=this._getErrorMessage(t);this.set("errorString","Encountered a service error "+t+" - "+r+", terminating websocket connection"),k.error(new l("stream-socket",this.errorString))}else{if(1e3===t)return;this._reconnectWebSocketT(t)}},t.prototype._getErrorMessage=function(e){switch(e){case 1001:return"Service is going away";case 4400:return"Invalid URL parameters. Check filter properties.";case 4401:case 4403:return"Not authorized";case 4404:return"Service not found";default:return"Encountered error code "+e}},t.prototype._handleWebSocketMessage=function(e){try{var t=JSON.parse(e.data);if(this._normalizeFeatureId(t),this._enrichFeature(t),!t.geometry&&!t.centroid)return void k.error(new l("stream-socket","Found malformed feature"));this._shouldPushDataReceived&&this.remoteClient.invoke("emitEvent",{name:"data-received",event:t});var r=g.convertFromFeature(t,this.service.geometryType,!1,!1,this.service.objectIdField);this._featureIds.push(r.attributes[this.service.objectIdField]),this._tempQueryEngine.featureStore.add(r)}catch(e){k.error(new l("stream-socket","Encountered an error when parsing socket message",e))}},t.prototype._handleTileAdd=function(e){if(this._tileDispatchMap.has(e.id)){(t=this._tileDispatchMap.get(e.id)).up()}else{var t=new w.default;this._tileDispatchMap.set(e.id,t)}this._queryTileFeatures(e,!0,this.queryEngine)},t.prototype._handleTileRemove=function(e){this._tileDispatchMap.get(e.id).destroy(),this._tileDispatchMap.delete(e.id)},t.prototype._checkForUpdates=function(){if(this._started){var e=this._getFeaturesToAdd(),t=this._getFeaturesToRemove(),r=[];e.featureStore.forEach(function(e){return r.push(e)}),t.featureStore.addMany(r),this.processor.supportsTileUpdates?(this._updateActiveTiles(e,t),e.featureStore.transferAll(this.queryEngine.featureStore)):(e.featureStore.transferAll(this.queryEngine.featureStore),this._repushActiveTiles(e,t)),t.destroy()}},t.prototype._anyUpdatesQueued=function(){return a.from(this._tileDispatchMap).some(function(e){return e[0],e[1].hasAction()})},t.prototype._updateActiveTiles=function(e,t){for(var r=0,i=this.tileStore.tiles;r<i.length;r++){var n=i[r];this._queryTileFeatures(n,!1,e,t)}},t.prototype._repushActiveTiles=function(e,t){for(var r=0,i=this.tileStore.tiles;r<i.length;r++){var n=i[r];this._queryTileFeatures(n,!0,this.queryEngine)}},t.prototype._getFeaturesToAdd=function(){return this._tempQueryEngine},t.prototype._getFeaturesToRemove=function(){var e=this.configuration.purgeOptions,t=e.displayCount,r=e.age,i=this._createQueryEngine();return this._purgeByDisplayCount(t,i),this._purgeByAge(r,i),i},t.prototype._purgeByDisplayCount=function(e,t){if(null!=e){var r=this.queryEngine.featureStore.numFeatures;if(r>e){var i=r-e,n=this._featureIds.splice(0,i);this.queryEngine.featureStore.transferIds(t.featureStore,n)}}},t.prototype._purgeByAge=function(e,t){if(null==e)return d.resolve();var r=60*e*1e3,i=Date.now()-r,n=this.service.timeInfo.startTimeField;this.queryEngine.featureStore.transferIf(t.featureStore,function(e){return e.attributes[n]<i})},t.prototype._queryTileFeatures=function(e,t,r,i){var n=this,o={hasZ:!1,hasM:!1,transform:{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}},s=this.processor.queryInfo,a=s.returnCentroid,u=s.returnGeometry,c=s.pixelBuffer,p=this._getFilterFlags.bind(this),l={returnCentroid:a,returnGeometry:u,pixelBuffer:c},h=this._tileDispatchMap.get(e.id),d=r&&r.executeTileQuery(e,l,p),f=d&&d.features,y=i&&i.executeTileQueryForIds(e,l);h.enqueue(function(){return n.processor.onTileData(e,{addOrUpdate:f,remove:y,clear:t,transformParams:o})})},t.prototype._queryBuddies=function(){var e=this,t=this.service.buddyLayers,r=t.relatedFeatures,i=t.keepLatestArchive,n=this._queryBuddy(r),o=this._queryBuddy(i);return d.all([n,o]).then(function(t){var r=t[0],i=t[1];return e._addBuddyFeatures(r,i)})},t.prototype._queryBuddy=function(e){if(!e)return d.resolve();var t=this._createQuery(this.processor.queryInfo);return m.executeQuery(e.source,t).then(function(e){return e.data})},t.prototype._addBuddyFeatures=function(e,t){e&&this._setEnrichmentData(e),t&&this._addFeatures(t)},t.prototype._setEnrichmentData=function(e){for(var t=e.features,r=new u.default,i=this.service.buddyLayers.relatedFeatures.joinField,n=0,o=t;n<o.length;n++){var s=o[n];i===this.service.objectIdField&&"string"==typeof i&&(s.attributes[i]=S(s.attributes[i])),r.set(s.attributes[i],s)}this._enrichmentData=r},t.prototype._enrichFeature=function(e){if(!this._enrichmentData)return e;var t=this.service.buddyLayers.relatedFeatures.joinField,r=e.attributes[t];if(this._enrichmentData.has(r)){var i=this._enrichmentData.get(r),n=i.attributes,o=i.geometry;for(var s in n)e.attributes[s]=n[s];o&&(e.geometry=o)}return e},t.prototype._normalizeFeatureId=function(e){var t;t="__OBJECTID"===this.service.objectIdField?this._idCounter++:"string"==typeof e.attributes[this.service.objectIdField]?S(e.attributes[this.service.objectIdField]):e.attributes[this.service.objectIdField],e.attributes[this.service.objectIdField]=t},t.prototype._addFeatures=function(e){e.objectIdFieldName=this.service.objectIdField;for(var t=0,r=e.features;t<r.length;t++){var i=r[t];this._normalizeFeatureId(i),this._enrichFeature(i)}var n=g.convertFromFeatureSet(e).features;this.queryEngine.featureStore.addMany(n)},t.prototype._createQuery=function(e){var t=new b,r=e.historicMoment,i=e.outFields;return t.historicMoment=null!=r?new Date(r):null,t.outFields=i.length/this.service.fields.length>=.75?["*"]:i,t.returnExceededLimitFeatures=!0,t.returnGeometry=!0,t.gdbVersion=e.gdbVersion,t.returnCentroid=e.returnCentroid,t.orderByFields=e.orderByFields,t.outSpatialReference=this.spatialReference,t.where=this.configuration.filter.where||"1=1",this.configuration.filter.geometry&&(t.geometry=c.Extent.fromJSON(this.configuration.filter.geometry)),t},t.prototype._createQueryEngine=function(){var e=this.processor.queryInfo,t=e.definitionExpression,r=e.gdbVersion,i=e.historicMoment;return new v.default({definitionExpression:t,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,gdbVersion:r,historicMoment:null!=i&&new Date(i),featureStore:new _.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1}),timeInfo:this.service.timeInfo})},t.prototype._resetTempStore=function(){this._tempQueryEngine&&this._tempQueryEngine.destroy(),this._tempQueryEngine=this._createQueryEngine()},t.prototype._switchProcessor=function(e,t){this.queryEngine&&this.queryEngine.destroy(),this._set("queryEngine",this._createQueryEngine()),this._resetTempStore(),this._start(),this.notifyChange("updating")},i([y.property()],t.prototype,"service",void 0),i([y.property({readOnly:!0})],t.prototype,"queryEngine",void 0),i([y.property()],t.prototype,"updating",null),i([y.property()],t.prototype,"connectionStatus",null),i([y.property()],t.prototype,"errorString",void 0),i([y.subclass()],t)}(y.declared(F.default));t.default=I}.apply(null,i))||(e.exports=n)},2231:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._action=null,this._queue=[],this._refs=1}return e.prototype.up=function(){this._refs++},e.prototype.down=function(){return 0==--this._refs},e.prototype.destroy=function(){this._queue.length=0,this._action&&(this._action.cancel(),this._action=null)},e.prototype.enqueue=function(e){this._action?this._queue.push(e):this._setAction(e)},e.prototype.flush=function(){var e=this._action;if(!e)return r.resolve();var t=this._queue.reduce(function(e,t){return e.then(t)},e);return this._action=t.then(this._handleNext.bind(this)),this._queue.length=0,t},e.prototype.hasAction=function(){return!!this._action},e.prototype._setAction=function(e){this._action=e().then(this._handleNext.bind(this))},e.prototype._handleNext=function(){this._queue.length?this._setAction(this._queue.shift()):this._action=null},e}();t.default=i}.apply(null,i))||(e.exports=n)}}]);