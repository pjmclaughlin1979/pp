(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/interactive/editingTools":409,"esri/renderers/support/clickToleranceUtils":1525,"esri/views/draw/support/drawUtils":1547,"esri/views/3d/layers/support/popupUtils3D":1634,"esri/views/interactive/InteractiveToolBase":1690,"esri/views/interactive/Manipulator3D":1691,"esri/views/3d/interactive/editingTools/graphicReshape3D/reshapeUtils":1785,"esri/views/interactive/manipulatorUtils":1786,"esri/views/3d/interactive/editingTools/graphicMove3D/GraphicMove3DTool":2206,"esri/views/interactive/GraphicManipulator":2207,"esri/views/3d/interactive/editingTools/graphicReshape3D/GraphicReshape3DTool":2208,"esri/views/3d/interactive/editingTools/graphicReshape3D/ReshapeOperation":2209,"esri/views/3d/interactive/editingTools/graphicReshape3D/ReshapeMoveManipulator":2210,"esri/views/3d/interactive/editingTools/graphicTransform3D/GraphicTransform3DTool":2211,"esri/views/3d/interactive/editingTools/graphicTransform3D/graphicTransform3DToolConfig":2212})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1525:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):t&&t.yoffset?Math.max(e,Math.abs(t.yoffset)):e}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=function(e){if(!e)return 6;if("simple"===e.type)return r(6,e.symbol);if("unique-value"===e.type){var t=6;return e.uniqueValueInfos.forEach(function(e){t=r(t,e.symbol)}),t}if("class-breaks"===e.type){var i=6;return e.classBreakInfos.forEach(function(e){i=r(i,e.symbol)}),i}return e.type,6}}.apply(null,i))||(e.exports=n)},1547:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(37),r(549),r(104)],void 0===(n=function(e,t,r,i,n){function a(e,t,r){if("point"===e.type)return e.x=e.x+t,e.y=e.y+r,e;if("multipoint"===e.type){var i=e.points;for(var a in i){var o=i[a],s=o[0],c=o[1];i[a]=[s+t,c+r]}return e}if("extent"===e.type)return e.xmin=e.xmin+t,e.xmax=e.xmax+t,e.ymin=e.ymin+r,e.ymax=e.ymax+r,e;var p=n.geometryToCoordinates(e),l="polyline"===e.type?e.paths:e.rings;for(var u in p){var h=p[u];for(var a in h){var d=h[a];s=d[0],c=d[1];l[u][a]=[s+t,c+r]}}return"paths"in e?e.paths=l:e.rings=l,e}Object.defineProperty(t,"__esModule",{value:!0}),t.move=a,t.cloneMove=function(e,t,r,i,o){var s=e.clone(),c=i.resolution;if("point"===s.type){if(o)a(s,t*c,-r*c);else{var p=i.state.transform,l=i.state.inverseTransform,u=p[0]*s.x+p[2]*s.y+p[4],h=p[1]*s.x+p[3]*s.y+p[5];s.x=l[0]*(u+t)+l[2]*(h+r)+l[4],s.y=l[1]*(u+t)+l[3]*(h+r)+l[5]}return s}if("multipoint"===s.type){if(o)a(s,t*c,-r*c);else{var d=s.points;for(var v in p=i.state.transform,l=i.state.inverseTransform,d){var f=d[v],g=p[0]*f[0]+p[2]*f[1]+p[4],m=p[1]*f[0]+p[3]*f[1]+p[5];u=l[0]*(g+t)+l[2]*(m+r)+l[4],h=l[1]*(g+t)+l[3]*(m+r)+l[5],d[v]=[u,h]}}return s}if("extent"===s.type){if(o)a(s,t*c,-r*c);else{p=i.state.transform,l=i.state.inverseTransform;var y=p[0]*s.xmin+p[2]*s.ymin+p[4],_=p[1]*s.xmin+p[3]*s.ymin+p[5],M=p[0]*s.xmax+p[2]*s.ymax+p[4],b=p[1]*s.xmax+p[3]*s.ymax+p[5];s.xmin=l[0]*(y+t)+l[2]*(_+r)+l[4],s.ymin=l[1]*(y+t)+l[3]*(_+r)+l[5],s.xmax=l[0]*(M+t)+l[2]*(b+r)+l[4],s.ymax=l[1]*(M+t)+l[3]*(b+r)+l[5]}return s}if(o)a(s,t*c,-r*c);else{var R=n.geometryToCoordinates(s);for(var T in d="polyline"===s.type?s.paths:s.rings,p=i.state.transform,l=i.state.inverseTransform,R){var S=R[T];for(var v in S)f=S[v],g=p[0]*f[0]+p[2]*f[1]+p[4],m=p[1]*f[0]+p[3]*f[1]+p[5],u=l[0]*(g+t)+l[2]*(m+r)+l[4],h=l[1]*(g+t)+l[3]*(m+r)+l[5],d[T][v]=[u,h]}"paths"in s?s.paths=d:s.rings=d}return s},t.scale=function(e,t,a,o,s){if("point"===e.type){var c=e.x,p=e.y,l=s?s[0]:c,u=s?s[1]:p,h=e.clone(),d=(c-l)*t+l,v=(p-u)*a+u;return h.x=d,h.y=v,h}if("multipoint"===e.type){var f=n.geometryToCoordinates(e),g=r.create(),m=i.getRingsOrPathsBounds(g,[f]),y=m[0],_=m[1],M=m[2],b=m[3],R=s?s[0]:(y+M)/2,T=s?s[1]:(b+_)/2,S=e.clone(),w=S.points;for(var O in w){var D=w[O];d=((c=D[0])-R)*t+R,v=((p=D[1])-T)*a+T,w[O]=[d,v]}return S}if("extent"===e.type){var P=e.xmin,A=e.xmax,E=e.ymin,I=e.ymax,x=s?s[0]:(P+A)/2,C=s?s[1]:(I+E)/2,N=e.clone();if(N.xmin=(P-x)*t+x,N.ymax=(I-C)*a+C,N.xmax=(A-x)*t+x,N.ymin=(E-C)*a+C,N.xmin>N.xmax){var G=N.xmin,j=N.xmax;N.xmin=j,N.xmax=G}if(N.ymin>N.ymax){var k=N.ymin,F=N.ymax;N.ymin=F,N.ymax=k}return N}var H=n.geometryToCoordinates(e),L=r.create(),U=i.getRingsOrPathsBounds(L,H),V=U[0],z=U[1],B=U[2],W=U[3],K=s?s[0]:(V+B)/2,q=s?s[1]:(W+z)/2,Y=e.clone(),Z="polyline"===Y.type?Y.paths:Y.rings;for(var J in H){var X=H[J];for(var O in X){var Q=X[O];d=((c=Q[0])-K)*t+K,v=((p=Q[1])-q)*a+q,Z[J][O]=[d,v]}}return"paths"in Y?Y.paths=Z:Y.rings=Z,Y},t.getScaleRatio=function(e,t,r,i,n,a){var o=Math.sqrt((r-e)*(r-e)+(i-t)*(i-t));return Math.sqrt((n-e)*(n-e)+(a-t)*(a-t))/o},t.getRotationAngle=function(e,t,r,i,n,a){var o=180*Math.atan2(t-i,e-r)/Math.PI;return 180*Math.atan2(t-a,e-n)/Math.PI-o}}.apply(null,i))||(e.exports=n)},1634:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(1),r(43),r(32),r(82),r(1525)],void 0===(n=function(e,t,r,i,n,a,o,s){function c(e,t,r){var i=r.get("basemapTerrain"),a=r.get("basemapTerrain.overlayManager"),s=a?a.overlayPixelSizeInMapUnits(e):1,c=i&&!i.spatialReference.equals(r.spatialReference)?o.getMetersPerUnitForSR(i.spatialReference)/o.getMetersPerUnitForSR(r.spatialReference):t*s,p=e.x-c,l=e.y-c,u=e.x+c,h=e.y+c,d=r.spatialReference;return new n.Extent({xmin:Math.min(p,u),ymin:Math.min(l,h),xmax:Math.max(p,u),ymax:Math.max(l,h),spatialReference:d})}Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryGeometry=c,t.intersectsDrapedGeometry=function(e,t,r){var i=r.toMap(e);return a.isNone(i)?null:c(i,s.calculateTolerance(),r).intersects(t)?i:null}}.apply(null,i))||(e.exports=n)},1690:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(0),r(599)],void 0===(n=function(e,t,r,i,n,a,o){return function(e){function t(t){var r=e.call(this)||this;return r._attached=!1,r}return r(t,e),Object.defineProperty(t.prototype,"active",{get:function(){return this.view.activeTool===this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSupported",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(e){this._attached&&(e?this.show():(this.hide(),o.setActive(this,!1))),this._set("visible",e)},enumerable:!0,configurable:!0}),t.prototype.attach=function(e){!this._attached&&this.isSupported&&(this._set("toolViewManager",e),this.onAttach(e),this.visible&&this.show(),this._attached=!0)},t.prototype.detach=function(){this._attached&&(this.hide(),this.onDetach(),this._set("toolViewManager",null),this._attached=!1)},t.prototype.handleInputEvent=function(e){if(this._attached){var t=this.toolViewManager;this.onInputEvent(e,t)}},t.prototype.show=function(){},t.prototype.hide=function(){},t.prototype.onAttach=function(e){},t.prototype.onDetach=function(){},t.prototype.onInputEvent=function(e,t){},i([a.property({constructOnly:!0})],t.prototype,"view",void 0),i([a.property({dependsOn:["view.activeTool"],readOnly:!0})],t.prototype,"active",null),i([a.property({value:!0})],t.prototype,"visible",null),i([a.property({readOnly:!0})],t.prototype,"toolViewManager",void 0),i([a.subclass("esri.views.interactive.InteractiveToolBase")],t)}(a.declared(n))}.apply(null,i))||(e.exports=n)},1691:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(6),r(26),r(23),r(32),r(14),r(0),r(91),r(83),r(18),r(15),r(40),r(212),r(4),r(3),r(37),r(128),r(29),r(73),r(184),r(140),r(368),r(120),r(283)],void 0===(n=function(e,t,r,i,n,a,o,s,c,p,l,u,h,d,v,f,g,m,y,_,M,b,R,T,S,w,O){function D(e){return 0!==e[12]||0!==e[13]||0!==e[14]}Object.defineProperty(t,"__esModule",{value:!0});var P=function(e){function t(t){var r=e.call(this)||this;return r.hideOnGrab=!1,r.moveOnDrag=!0,r.snapToPointer=!0,r.allowOverlap=!1,r.collisionType={type:"point"},r.renderObjects=[],r.autoScaleRenderObjects=!0,r._radius=10,r._focusMultiplier=2,r._touchMultiplier=2.5,r.interactive=!0,r.selectable=!1,r.dragging=!1,r._position=m.vec3f64.create(),r._modelTransform=d.mat4f64.create(),r._dragOffset=null,r._dirtyScreenPoint=c.createScreenPoint(),r._dirtyScreenPointArray=c.createScreenPointArray(),r._dirtyRenderScreenPointArray=c.createRenderScreenPointArray3(),r._dirtyOriginScreenPointArray=c.createScreenPointArray(),r._screenPositionDirty=!0,r._engineResourcesAddedToStage=!1,r._engineResources=null,r._engineLayerId=null,r._materialIdReferences=null,r._hitResult={onSurface:!1,surfaceType:"ground"},r._handlers=new a,r}var n;return i(t,e),n=t,t.prototype.initialize=function(){this._intersector=new R(this.view.viewingMode),this._mapPoint=_.makeDehydratedPoint(0,0,0,this.view.spatialReference)},t.prototype.destroy=function(){this._handlers.removeAll(),this._handlers=null,this._removeResourcesFromStage(),this._engineResources=null,this._set("view",null),this._camera=null},Object.defineProperty(t.prototype,"alignment",{get:function(){return this._get("alignment")},set:function(e){this._set("alignment",e),this.constructed&&this._refreshMapPoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(e){e!==this._get("visible")&&(this._set("visible",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusMultiplier",{get:function(){return this._focusMultiplier},set:function(e){this._focusMultiplier=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchMultiplier",{get:function(){return this._touchMultiplier},set:function(e){this._touchMultiplier=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"modelTransform",{get:function(){return this._modelTransform},set:function(e){D(e)&&(this._screenPositionDirty=!0),h.mat4.copy(this._modelTransform,e),this._updateEngineObject()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._mapPoint,this._mapPoint.spatialReference),this._refreshMapPoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapPoint",{get:function(){return this._mapPoint},set:function(e){_.clonePoint(e,this._mapPoint),this._refreshMapPoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grabbing",{set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateEngineObject()),e||(this._dragOffset=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hovering",{set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{set:function(e){e!==this._get("active")&&(this._set("active",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{set:function(e){e!==this._get("state")&&(this._set("state",e),this._updateEngineObject())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"surfaceType",{get:function(){return this._hitResult.onSurface?this._hitResult.surfaceType:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenPoint",{get:function(){return this._updateScreenPositions(),this._dirtyScreenPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_screenPointArray",{get:function(){return this._updateScreenPositions(),this._dirtyScreenPointArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_renderScreenPointArray",{get:function(){return this._updateScreenPositions(),this._dirtyRenderScreenPointArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_originScreenPointArray",{get:function(){return this._updateScreenPositions(),this._dirtyOriginScreenPointArray},enumerable:!0,configurable:!0}),t.prototype._updateScreenPositions=function(e){if(void 0===e&&(e=!1),this._screenPositionDirty){var t,r=D(this._modelTransform);if(r){var i=this._calculateModelTransformOffset(z);t=g.vec3.add(i,i,this._position)}else t=this._position;this._screenPositionDirty=!1,this._camera.projectPoint(t,this._dirtyRenderScreenPointArray),this._camera.renderToScreen(this._dirtyRenderScreenPointArray,this._dirtyScreenPointArray),c.screenPointArrayToObject(this._dirtyScreenPointArray,this._dirtyScreenPoint),r?(this._camera.projectPoint(this._position,I),this._camera.renderToScreen(I,this._dirtyOriginScreenPointArray)):v.vec2.copy(this._dirtyOriginScreenPointArray,this._dirtyScreenPointArray)}},t.prototype.intersectionDistance=function(e,t){if(!this._get("visible")||!this._get("active"))return null;var r=c.screenPointObjectToArray(e,E),i=this._getCollisionRadius(t);switch(this.collisionType.type){case"point":if(v.vec2.squaredDistance(this._screenPointArray,r)<i*i)return this._renderScreenPointArray[2];break;case"line":for(var n=this.collisionType.paths,a=this._camera.computeScreenPixelSizeAt(this._position),s=this._calculateObjectTransform(a,j),p=i*this._camera.computeScreenPixelSizeAt(this._position),u=M.ray.fromScreen(this._camera,r,C),h=0,d=n;h<d.length;h++){if(0!==(G=d[h]).length)for(var f=g.vec3.transformMat4(F,G[0],s),m=1;m<G.length;m++){var y=g.vec3.transformMat4(H,G[m],s);if(null!=(z=M.lineSegment.closestRayDistance2(M.lineSegment.fromPoints(f,y,x),u))&&z<p*p){var _=g.vec3.add(b.sv3d.get(),f,y);g.vec3.scale(_,_,.5);var R=c.castRenderScreenPointArray(b.sv3d.get());return this._camera.projectPoint(_,R),R[2]}g.vec3.copy(f,y)}}break;case"disc":var T=this.collisionType.direction,S=(a=this._camera.computeScreenPixelSizeAt(this._position),s=this._calculateObjectTransform(a,j),p=i*this._camera.computeScreenPixelSizeAt(this._position),u=M.ray.fromScreen(this._camera,r,C),l.mat3.fromMat4(N,s)),w=g.vec3.transformMat3(U,T,S),O=this._calculateModelTransformPosition(V);M.plane.fromPositionAndNormal(O,w,k);var D=L;if(M.plane.intersectRay(k,u,D)&&g.vec3.squaredDistance(D,O)<p*p)return this._renderScreenPointArray[2];break;case"ribbon":var P=this.collisionType;n=P.paths,T=P.direction,a=this._camera.computeScreenPixelSizeAt(this._position),s=this._calculateObjectTransform(a,j),p=i*this._camera.computeScreenPixelSizeAt(this._position),u=M.ray.fromScreen(this._camera,r,C),S=l.mat3.fromMat4(N,s),w=g.vec3.transformMat3(U,T,S),O=this._calculateModelTransformPosition(V);M.plane.fromPositionAndNormal(O,w,k);D=L;if(!M.plane.intersectRay(k,u,D))break;for(var A=0,I=n;A<I.length;A++){var G;if(0!==(G=I[A]).length)for(f=g.vec3.transformMat4(F,G[0],s),m=1;m<G.length;m++){var z;y=g.vec3.transformMat4(H,G[m],s);if(null!=(z=M.lineSegment.distance2(M.lineSegment.fromPoints(f,y,x),D))&&z<p*p){_=g.vec3.add(b.sv3d.get(),f,y);g.vec3.scale(_,_,.5);R=c.castRenderScreenPointArray(b.sv3d.get());return this._camera.projectPoint(_,R),R[2]}g.vec3.copy(f,y)}}break;default:o.neverReached(this.collisionType)}return null},t.prototype.attemptDragTo=function(e){if(!this.moveOnDrag)return this._handlers.forEach(function(t){var r=t.type,i=t.handler;"drag"===r&&i(e)}),!1;var t=c.screenPointObjectToArray(e.screenPoint,E);s.isNone(this._dragOffset)&&this.grabbing&&!this.snapToPointer&&(this._dragOffset=v.vec2.subtract(f.vec2f32.create(),t,this._originScreenPointArray)),s.isSome(this._dragOffset)&&v.vec2.subtract(t,t,this._dragOffset);var r=this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector,"on-the-ground"===this.alignment?A:null).results.min,i=L;return r.getIntersectionPoint(i)?(this.position=i,this._hitResult.onSurface=!0,this._hitResult.surfaceType="TerrainRenderer"===r.intersector?"ground":"feature",this._handlers.forEach(function(t){var r=t.type,i=t.handler;"drag"===r&&i(e)})):this._hitResult.onSurface=!1,this._hitResult.onSurface},t.prototype.click=function(e){this._handlers.forEach(function(t){var r=t.type,i=t.handler;"click"===r&&i(e)})},t.prototype.on=function(e,t){this._handlers.push({type:e,handler:t})},t.prototype.addToEngineLayer=function(e,t){if(!s.isSome(this._engineLayerId)){if(s.isSome(e))this._engineLayerId=e;else{var r=new S("manipulator-3d",{isPickable:!1});this.view._stage.add(O.ContentType.LAYER,r),this.view._stage.addToViewContent([r.id]),this._engineLayerId=r.id}s.isSome(t)?this._materialIdReferences=t:this._materialIdReferences=new Map,this._updateEngineObject()}},t.prototype.installRenderHandles=function(e,t){var r=null,i=null;t(function(e){return!(e instanceof n&&(r=e._engineLayerId,i=e._materialIdReferences,1))}),this.addToEngineLayer(r,i),this._camera=this.view.state.camera;var a="render-manipulator-3d";if(!e.has(a)){e.add([this.view.state.watch("camera",function(e){t(function(t){t instanceof n&&(t._camera=e,t._screenPositionDirty=!0,t._updateEngineObject())})}),this.view.elevationProvider.on("elevation-change",function(e){return function(e){t(function(t){t instanceof n&&t.view.renderCoordsHelper.fromRenderCoords(t.position,B,e.spatialReference)&&y.containsPoint(e.extent,B)&&t._refreshMapPoint(!0)})}(e)})],a)}},t.prototype._refreshMapPoint=function(e){switch(void 0===e&&(e=!1),this.alignment){case"none":break;case"on-the-ground":var t=this.view.elevationProvider.getElevation(this.mapPoint,"ground");if(t===this._mapPoint.z&&e)return;this._mapPoint.z=t;break;default:o.neverReached(this.alignment)}this._screenPositionDirty=!0,this._hitResult.onSurface=!1,this.view.renderCoordsHelper.toRenderCoords(this._mapPoint,this._position),this._updateEngineObject()},t.prototype._updateEngineObject=function(){if(!s.isNone(this._engineLayerId)){if(!1===this._get("visible")||!1===this._get("active"))return void this._removeResourcesFromStage();var e=this._get("view").state.camera.computeScreenPixelSizeAt(this._position),t=j;if(!0===this._get("autoScaleRenderObjects")){var r=this._getFocusedSize(this._radius,this._focused)*e;this._calculateObjectTransform(r,t)}else this._calculateObjectTransform(e,t);for(var i=this._ensureEngineResources().objectsByState,n=(this._focused?2:1)|(this._get("selected")?8:4),a=this._get("hideOnGrab")&&this._get("grabbing"),o=0,c=i;o<c.length;o++){var p=c[o],l=p.stateMask,u=p.objects;if(a)for(var h=0,d=u;h<d.length;h++){(M=d[h]).object3D.hideAllComponents(),M.startTimeMs=0}else{var v=!(0!=(15&l))||(n&l)==(15&l),f=!(0!=(32752&l))||(this._get("state")&l)==(32752&l);if(v&&f)for(var g=0,m=u;g<m.length;g++){(M=m[g]).object3D.unhideAllComponents(),M.object3D.objectTransformation=t}else for(var y=0,_=u;y<_.length;y++){var M;(M=_[y]).object3D.hideAllComponents(),M.startTimeMs=0}}}}},t.prototype._ensureEngineResources=function(){if(s.isNone(this._engineResources)){var e=this.view._stage.get(O.ContentType.LAYER,s.expect(this._engineLayerId)),t=[],r=new Set;this.renderObjects.forEach(function(e){var i=e.material;r.has(i)||(t.push(i),r.add(i))});var i=new Map;this.renderObjects.forEach(function(e){var t=new w({idHint:"manipulator"});!function(e,t){var r=t.geometry,i=t.material,n=t.transform;Array.isArray(r)?r.forEach(function(t){return e.addGeometry(t,i,n)}):e.addGeometry(r,i,n)}(t,e);var r=e.stateMask||0,n=i.get(r)||[],a={object3D:t,startTimeMs:0,delayMs:e.delayMs};n.push(a),i.set(r,n)});var n=[];i.forEach(function(e,t){n.push({stateMask:t,objects:e})}),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources},t.prototype._addResourcesToStage=function(){var e=this;if(!this._engineResourcesAddedToStage&&!s.isNone(this._engineResources)){var t=this._engineResources,r=t.objectsByState,i=t.layer;t.materials.forEach(function(t){var r=s.expect(e._materialIdReferences),i=r.get(t.id)||0;0===i&&e.view._stage.add(O.ContentType.MATERIAL,t),r.set(t.id,i+1)}),r.forEach(function(t){t.objects.forEach(function(t){var r=t.object3D;i.addObject(r),e.view._stage.add(O.ContentType.OBJECT,r)})}),this._engineResourcesAddedToStage=!0}},t.prototype._removeResourcesFromStage=function(){var e=this;if(this._engineResourcesAddedToStage&&!s.isNone(this._engineResources)){var t=this._engineResources,r=t.objectsByState,i=t.layer,n=t.materials;r.forEach(function(t){t.objects.forEach(function(t){var r=t.object3D;i.removeObject(r),e.view._stage.remove(O.ContentType.OBJECT,r.id)})}),n.forEach(function(t){var r=s.expect(e._materialIdReferences),i=r.get(t.id);1===i?(e.view._stage.remove(O.ContentType.MATERIAL,t.id),r.delete(t.id)):r.set(t.id,i-1)}),this._engineResourcesAddedToStage=!1}},t.prototype._getCollisionRadius=function(e){return this._getFocusedSize(this._radius,!0)*("touch"===e?this._touchMultiplier:1)},t.prototype._getFocusedSize=function(e,t){return e*(t?this._focusMultiplier:1)},t.prototype._calculateModelTransformPosition=function(e){var t=this._camera.computeScreenPixelSizeAt(this._position),r=this._calculateObjectTransform(t,G);return g.vec3.set(e,r[12],r[13],r[14])},t.prototype._calculateModelTransformOffset=function(e){var t=this._calculateModelTransformPosition(e);return g.vec3.subtract(e,t,this._position)},t.prototype._calculateObjectTransform=function(e,t){return h.mat4.set(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),h.mat4.multiply(t,t,this._modelTransform),t[12]+=this._position[0],t[13]+=this._position[1],t[14]+=this._position[2],t[15]=1,t},r([p.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r([p.property({value:"none",nonNullable:!0})],t.prototype,"alignment",null),r([p.property()],t.prototype,"hideOnGrab",void 0),r([p.property()],t.prototype,"moveOnDrag",void 0),r([p.property()],t.prototype,"snapToPointer",void 0),r([p.property()],t.prototype,"allowOverlap",void 0),r([p.property()],t.prototype,"collisionType",void 0),r([p.property({constructOnly:!0})],t.prototype,"renderObjects",void 0),r([p.property()],t.prototype,"autoScaleRenderObjects",void 0),r([p.property({value:!0})],t.prototype,"visible",null),r([p.property()],t.prototype,"radius",null),r([p.property()],t.prototype,"focusMultiplier",null),r([p.property()],t.prototype,"touchMultiplier",null),r([p.property()],t.prototype,"interactive",void 0),r([p.property()],t.prototype,"selectable",void 0),r([p.property({value:!1})],t.prototype,"grabbing",null),r([p.property()],t.prototype,"dragging",void 0),r([p.property({value:!1})],t.prototype,"hovering",null),r([p.property({value:!1})],t.prototype,"selected",null),r([p.property({value:!0})],t.prototype,"active",null),r([p.property({value:0})],t.prototype,"state",null),r([p.property({dependsOn:["hovering","grabbing"]})],t.prototype,"focused",null),n=r([p.subclass("esri.views.interactive.Manipulator3D")],t)}(p.declared(n));t.Manipulator3D=P;var A={include:new Set};A.include.add(T.TERRAIN_ID);var E=c.createScreenPointArray(),I=c.createRenderScreenPointArray3(),x=M.lineSegment.create(),C=M.ray.create(),N=u.mat3f64.create(),G=d.mat4f64.create(),j=d.mat4f64.create(),k=M.plane.create(),F=m.vec3f64.create(),H=m.vec3f64.create(),L=m.vec3f64.create(),U=m.vec3f64.create(),V=m.vec3f64.create(),z=m.vec3f64.create(),B=m.vec3f64.create()}.apply(null,i))||(e.exports=n)},1785:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(5),r(32),r(40),r(39),r(104),r(96)],void 0===(n=function(e,t,r,i,n,a,o,s,c){function p(){return new u}function l(e,t,r){return void 0===r&&(r=o.vec2f64.create()),a.vec2.set(r,e,t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(){this.vertices=[],this.edges=[]}return e.prototype.makeVertex=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var i={pos:e,unnormalizedPos:e,left:t,right:r,type:"vertex",component:this};return this.vertices.push(i),i},e.prototype.makeEdge=function(e,t){var r={v0:e,v1:t,type:"edge",component:this};return e.right=r,t.left=r,this.edges.push(r),r},e.prototype.removeVertex=function(e){this.vertices.splice(this.vertices.indexOf(e),1),e.left&&this.removeEdge(e.left),e.right&&this.removeEdge(e.right)},e.prototype.removeEdge=function(e){this.edges.splice(this.edges.indexOf(e),1),e.v0.right=null,e.v1.left=null},e}();t.Component=u,t.makeMapPoint=l;var h=function(){function e(e,t){this.geometry=e,this.doUnnormalization=t,this.components=[];var r=c.getInfo(this.geometry.spatialReference);r?(this._spanMin=r.valid[0],this._spanMax=r.valid[1],this._span=this._spanMax-this._spanMin):this.doUnnormalization=!1}return e.prototype.getVertexPositionAsPoint=function(e,t){return t.x=e.pos[0],t.y=e.pos[1],t.z=null,t.spatialReference=this.geometry.spatialReference,t},e.prototype.getEdgePosition=function(e,t,r){return void 0===r&&(r=o.vec2f64.create()),l((e.v1.unnormalizedPos[0]-e.v0.unnormalizedPos[0])*t+e.v0.unnormalizedPos[0],(e.v1.unnormalizedPos[1]-e.v0.unnormalizedPos[1])*t+e.v0.unnormalizedPos[1],r)},e.prototype.getEdgePositionAsPoint=function(e,t,r){var i=this.getEdgePosition(e,t,f);return r.x=i[0],r.y=i[1],r.z=null,r.spatialReference=this.geometry.spatialReference,r},e.prototype.canRemoveVertex=function(e){return!0},e.prototype.removeVertex=function(e){var t=e.component,r=e.left,i=e.right;return t.removeVertex(e),r&&i?t.makeEdge(r.v0,i.v1):null},e.prototype.splitEdge=function(e,t){var r=e.component,i=r.makeVertex(this.getEdgePosition(e,t)),n=e.v0,a=e.v1;return r.removeEdge(e),r.makeEdge(n,i),r.makeEdge(i,a),i},e}();t.ReshapeHelper=h;var d=function(e){function t(t,r){var i=e.call(this,t,r)||this;i.geometry=t;for(var n=i.geometry.rings,a=0;a<n.length;++a){for(var o=n[a],c=p(),u=o.length-1,h=0;h<u;++h){var d=l(o[h][0],o[h][1]);c.makeVertex(d)}for(var v=c.vertices.length-1,f=0;f<v;++f){var g=c.vertices[f],m=c.vertices[f+1];c.makeEdge(g,m)}c.makeEdge(c.vertices[c.vertices.length-1],c.vertices[0]),i.doUnnormalization&&s.computeUnnormalizedVertexPositionsOnDateLineCrossing(c.vertices,i._spanMin,i._spanMax,i._span),i.components.push(c)}return i}return i(t,e),t.prototype.canRemoveVertex=function(e){return e.component.vertices.length>3},t.prototype.commit=function(){var e=this,t=[];return this.components.forEach(function(r){var i=[];e.doUnnormalization&&s.computeUnnormalizedVertexPositionsOnDateLineCrossing(r.vertices,e._spanMin,e._spanMax,e._span);var n=r.vertices[0],a=n;do{i.push(n.unnormalizedPos),n=n.right.v1}while(n&&n!==a);i.push(r.vertices[0].unnormalizedPos),t.push(i)}),this.geometry.rings=t,this.geometry},t}(h),v=function(e){function t(t,r){var i=e.call(this,t,r)||this;i.geometry=t;for(var n=i.geometry.paths,a=0;a<n.length;++a){for(var o=n[a],c=p(),u=o.length,h=0;h<u;++h){var d=l(o[h][0],o[h][1]);c.makeVertex(d)}for(var v=c.vertices.length-1,f=0;f<v;++f){var g=c.vertices[f],m=c.vertices[f+1];c.makeEdge(g,m)}i.doUnnormalization&&s.computeUnnormalizedVertexPositionsOnDateLineCrossing(c.vertices,i._spanMin,i._spanMax,i._span),i.components.push(c)}return i}return i(t,e),t.prototype.canRemoveVertex=function(e){return e.component.vertices.length>2},t.prototype.commit=function(){var e=this,t=[];return this.components.forEach(function(r){var i=[];e.doUnnormalization&&s.computeUnnormalizedVertexPositionsOnDateLineCrossing(r.vertices,e._spanMin,e._spanMax,e._span);var n=r.vertices[0],a=n;do{i.push(n.unnormalizedPos),n=n.right?n.right.v1:null}while(n&&n!==a);t.push(i)}),this.geometry.paths=t,this.geometry},t}(h);t.isReshapeGeometry=function(e){return n.isSome(e)&&("polygon"===e.type||"polyline"===e.type)},t.createReshapeHelper=function(e,t){return e?"polygon"===e.type?new d(e,t):new v(e,t):null};var f=o.vec2f64.create()}.apply(null,i))||(e.exports=n)},1786:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(18),r(4),r(73),r(86),r(177),r(135),r(1691)],void 0===(n=function(e,t,r,i,n,a,o,s,c){function p(e,t){var r=1!==t,i=new s({diffuse:e,transparent:r,writeDepth:!r,cullFace:"back",opacity:t,castShadows:!1,instanced:["transformation"]},"manipulator");return i.renderOccluded=4,i}function l(e,t,r,a){var o=i.vec3.normalize(n.sv3d.get(),e),s=i.vec3.normalize(n.sv3d.get(),t),c=i.vec3.cross(n.sv3d.get(),o,s);return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=0,a[4]=s[0],a[5]=s[1],a[6]=s[2],a[7]=0,a[8]=c[0],a[9]=c[1],a[10]=c[2],a[11]=0,a[12]=r[0],a[13]=r[1],a[14]=r[2],a[15]=1,a}Object.defineProperty(t,"__esModule",{value:!0}),t.createManipulatorMaterial=p,t.createSphereManipulator=function(e,t,r){return new c.Manipulator3D({view:e,renderObjects:[{geometry:new a(o.createSphereGeometry(1,32,32),"manipulator"),material:p(t,r)}]})},t.calculateInputRotationTransform=function(e,t,a,o){var s=i.vec3.subtract(n.sv3d.get(),e,a),c=l(s,i.vec3.cross(n.sv3d.get(),o,s),a,n.sm4d.get());r.mat4.invert(c,c);var p=i.vec3.transformMat4(n.sv3d.get(),t,c);return Math.atan2(p[1],p[0])},t.calculateTranslateRotateFromBases=l}.apply(null,i))||(e.exports=n)},2206:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(26),r(48),r(17),r(0),r(1547),r(2207),r(1690)],void 0===(n=function(e,t,r,i,n,a,o,s,c,p,l){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){return function(e){this.allGraphics=e,this.type="graphic-move-start"}}();t.GraphicMoveStartEvent=u;var h=function(){return function(e,t,r){this.dx=e,this.dy=t,this.allGraphics=r,this.type="graphic-move"}}();t.GraphicMoveEvent=h;var d=function(){return function(e){this.allGraphics=e,this.type="graphic-move-stop"}}();t.GraphicMoveStopEvent=d;var v=function(e){function t(t){var r=e.call(this,t)||this;return r.graphics=new n,r.type="move-3d",r._handles=new o,r}return i(t,e),t.prototype.initialize=function(){},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.graphics.removeAll(),this._set("view",null)},t.prototype.reset=function(){this.graphics.removeAll()},t.prototype.onAttach=function(e){var t=this;this._handles.add(this.graphics.on("change",function(){t._refreshGraphicManipulators(e)})),this._refreshGraphicManipulators(e)},t.prototype.onDetach=function(){this._handles.removeAll()},t.prototype._refreshGraphicManipulators=function(e){var t=this;this._handles.remove("graphics"),e.removeManipulators();var r=this.graphics.toArray().map(function(r){var i=new p.GraphicManipulator({graphic:r,view:t.view,selectable:!0});return e.addManipulator(i),i}),i=0;r.forEach(function(e){e.on("drag",function(i){r.forEach(function(t){if("mesh"===t.graphic.geometry.type)return!1;t!==e&&(t.graphic.geometry=c.move(t.graphic.geometry.clone(),i.dxMap,i.dyMap))}),t.emit("graphic-move",new h(i.dx,i.dy,t.graphics.toArray()))}),e.on("click",function(){return t.emit("click")});var n=e.watch("dragging",function(n){n?1==++i&&(t.emit("graphic-move-start",new u(t.graphics.toArray())),r.forEach(function(t){t!==e&&(t.interactive=!1)})):0==--i&&(t.emit("graphic-move-stop",new d(t.graphics.toArray())),r.forEach(function(e){e.interactive=!0}))},!0),a=e.watch("hovering",function(e){t.cursor=e?"move":null},!0);t._handles.add(n,"graphics"),t._handles.add(a,"graphics")})},r([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r([s.property({readOnly:!0})],t.prototype,"graphics",void 0),r([s.property({value:null})],t.prototype,"cursor",void 0),r([s.property({readOnly:!0})],t.prototype,"type",void 0),r([s.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMove3DTool")],t)}(s.declared(l,a));t.GraphicMove3DTool=v}.apply(null,i))||(e.exports=n)},2207:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(6),r(26),r(10),r(0),r(4),r(51),r(73),r(1547)],void 0===(n=function(e,t,r,i,n,a,o,s,c,p,l,u){Object.defineProperty(t,"__esModule",{value:!0});var h=o.getLogger("esri.views.interactive.GraphicManipulator"),d=function(e){function t(t){var r=e.call(this)||this;return r.interactive=!0,r.selectable=!1,r.allowOverlap=!0,r.grabbing=!1,r.dragging=!1,r.hovering=!1,r.selected=!1,r.active=!0,r._handlers=new a,r}return i(t,e),Object.defineProperty(t.prototype,"graphic",{get:function(){return this._get("graphic")},set:function(e){e.geometry&&"mesh"===e.geometry.type?h.error("Mesh geometries are not supported"):this._set("graphic",e)},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._handlers.removeAll(),this._handlers=null,this._set("view",null)},t.prototype.intersectionDistance=function(e){if(!this.active)return null;var t=this.view.toMap(e,{include:[this.graphic]});if(!t)return null;var r=l.sv3d.get();return this.view.renderCoordsHelper.toRenderCoords(t,r)?c.vec3.distance(r,this.view.state.camera.eye):null},t.prototype.attemptDragTo=function(e,t){if(null==this.graphic.geometry)return!1;if("mesh"===this.graphic.geometry.type)return!1;var r,i,n=this.view.toMap(t.previous),a=this.view.toMap(e.screenPoint),o=e.screenPoint.x-t.previous.x,s=e.screenPoint.y-t.previous.y;if(!n||!a)return!1;var c=[0,0,0,0,0,0];if(p.bufferToBuffer([n.x,n.y,0,a.x,a.y,0],n.spatialReference,0,c,this.graphic.geometry.spatialReference,0,2),i=c[4]-c[1],0===(r=c[3]-c[0])&&0===i)return!0;this.graphic.geometry=u.move(this.graphic.geometry.clone(),r,i);var l={screenPoint:e.screenPoint,dxMap:r,dyMap:i,dx:o,dy:s};return this._handlers.forEach(function(e){var t=e.type,r=e.handler;"drag"===t&&r(l)}),!0},t.prototype.click=function(e){this._handlers.forEach(function(t){"click"===t.type&&t.handler(e)})},t.prototype.on=function(e,t){this._handlers.push({type:e,handler:t})},r([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"graphic",null),r([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r([s.property()],t.prototype,"interactive",void 0),r([s.property()],t.prototype,"selectable",void 0),r([s.property()],t.prototype,"allowOverlap",void 0),r([s.property()],t.prototype,"grabbing",void 0),r([s.property()],t.prototype,"dragging",void 0),r([s.property()],t.prototype,"hovering",void 0),r([s.property()],t.prototype,"selected",void 0),r([s.property()],t.prototype,"active",void 0),r([s.subclass("esri.views.interactive.GraphicManipulator")],t)}(s.declared(n));t.GraphicManipulator=d}.apply(null,i))||(e.exports=n)},2208:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(48),r(17),r(10),r(32),r(21),r(0),r(616),r(2209),r(1785),r(1690)],void 0===(n=function(e,t,r,i,n,a,o,s,c,p,l,u,h,d){Object.defineProperty(t,"__esModule",{value:!0});var v=o.getLogger("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshape3DTool"),f=function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new a,r._reshapeOperation=null,r._internalGeometryUpdate=!1,r.type="reshape-3d",r}return i(t,e),t.prototype.destroy=function(){this._handles.removeAll(),this._set("view",null),this._set("graphic",null)},Object.defineProperty(t.prototype,"graphic",{set:function(e){!s.isSome(e)||l.isSupportedGraphic(e)?this._set("graphic",e):v.error("Only polyline and polygon geometries are supported")},enumerable:!0,configurable:!0}),t.prototype._updateGeometry=function(){s.isSome(this.graphic)&&h.isReshapeGeometry(this.graphic.geometry)?this._reshapeOperation.inputGeometry=this.graphic.geometry.clone():this._reshapeOperation.inputGeometry=null},t.prototype._updateGraphic=function(e){var t=this;this._handles.remove("onGraphicGeometryChange"),this._updateGeometry();var r=this.watch("graphic.geometry",function(){!1===t._internalGeometryUpdate&&t._updateGeometry()},!0);this._handles.add(r,"onGraphicGeometryChange")},t.prototype._onReshapeGeometryChanged=function(){s.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)},t.prototype.onAttach=function(e){var t=this;this._reshapeOperation=new u.ReshapeOperation({toolViewManager:e,view:this.view}),this._handles.add([this._reshapeOperation.watch("cursor",function(){t.cursor=t._reshapeOperation.cursor}),this._reshapeOperation.on("reshape-operation-start",function(e){s.isNone(t.graphic)||(e.graphic=t.graphic,t.emit("reshape-start",e))}),this._reshapeOperation.on("vertex-move",function(e){t._onReshapeGeometryChanged(),s.isSome(t.graphic)&&(e.graphic=t.graphic,t.emit("vertex-move",e))}),this._reshapeOperation.on("translate",function(e){t._onReshapeGeometryChanged(),s.isSome(t.graphic)&&(e.graphic=t.graphic,t.emit("translate",e))}),this._reshapeOperation.on("vertex-add",function(e){t._onReshapeGeometryChanged(),s.isSome(t.graphic)&&(e.graphic=t.graphic,t.emit("vertex-add",e))}),this._reshapeOperation.on("vertex-remove",function(e){t._onReshapeGeometryChanged(),s.isSome(t.graphic)&&(e.graphic=t.graphic,t.emit("vertex-remove",e))}),this._reshapeOperation.on("reshape-operation-stop",function(e){s.isNone(t.graphic)||(e.graphic=t.graphic,t.emit("reshape-stop",e))}),this._reshapeOperation.on("click",function(){return t.emit("click")}),c.init(this,"graphic",function(){t._updateGraphic(e)},!0)])},t.prototype.onDetach=function(){this._handles.removeAll(),this._reshapeOperation.destroy()},t.prototype.handleInputEvent=function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()},t.prototype.show=function(){},t.prototype.hide=function(){},t.prototype.reset=function(){this.graphic=null},r([p.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r([p.property({value:null})],t.prototype,"graphic",null),r([p.property({readOnly:!0})],t.prototype,"type",void 0),r([p.property({value:null})],t.prototype,"cursor",void 0),r([p.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshape3DTool")],t)}(p.declared(d,n));t.GraphicReshape3DTool=f}.apply(null,i))||(e.exports=n)},2209:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(6),r(48),r(17),r(0),r(128),r(2210),r(1785),r(86),r(177),r(1691),r(1786)],void 0===(n=function(e,t,r,i,n,a,o,s,c,p,l,u,h,d,v){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){return function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.isDragging=e,this.fromTranslation=t,this.graphic=null,this.type="reshape-start"}}();t.ReshapeStartEvent=f;var g=function(){return function(e){this.coords=e,this.graphic=null,this.type="vertex-move"}}();t.VertexMoveEvent=g;var m=function(){return function(e,t){this.dxScreen=e,this.dyScreen=t,this.graphic=null,this.type="translate"}}();t.TranslateEvent=m;var y=function(){return function(e){this.coords=e,this.graphic=null,this.type="vertex-add"}}();t.VertexAddEvent=y;var _=function(){return function(e){this.coords=e,this.graphic=null,this.type="vertex-remove"}}();t.VertexRemoveEvent=_;var M=function(){return function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.isDragging=e,this.fromTranslation=t,this.graphic=null,this.type="reshape-stop"}}();t.ReshapeStopEvent=M;var b=function(e){function t(t){var r=e.call(this,t)||this;return r._vertexManipulatorMaterial=v.createManipulatorMaterial([1,.5,0],1),r._edgeManipulatorMaterial=v.createManipulatorMaterial([.5,.5,.5],1),r._selectedManipulatorMaterial=v.createManipulatorMaterial([1,1,1],1),r._manipulatorGeometry=new u(h.createSphereGeometry(1,16,16),"reshape-manipulator"),r._handles=new o,r._manipulators=[],r._reshapeHelper=null,r._moveManipulator=null,r._numDragging=0,r}return i(t,e),t.prototype.destroy=function(){this._clear(null)},Object.defineProperty(t.prototype,"inputGeometry",{get:function(){return this._reshapeHelper?this._reshapeHelper.geometry:null},set:function(e){this._recreateManipulators(this.toolViewManager,e)},enumerable:!0,configurable:!0}),t.prototype.removeSelectedVertices=function(){var e=this._manipulators.filter(function(e){return e.manipulator.selected&&"vertex"===e.handle.type});this._removeVertices(e)},t.prototype._clear=function(e){this._handles.removeAll(),e&&(this._manipulators.forEach(function(t){e.removeManipulator(t.manipulator)}),e.removeManipulator(this._moveManipulator)),this._manipulators=[],this._moveManipulator=null,this._reshapeHelper=null,this._numDragging=0},t.prototype._recreateManipulators=function(e,t){var r=this;if(this._clear(this.toolViewManager),this._reshapeHelper=l.createReshapeHelper(t,"global"===this.view.viewingMode),!this._reshapeHelper)return null;this._reshapeHelper.components.forEach(function(e){e.vertices.forEach(function(e){return r._createManipulator(e)}),e.edges.forEach(function(e){return r._createManipulator(e)})}),this._moveManipulator=new p.ReshapeMoveManipulator({view:this.view,reshapeHelper:this._reshapeHelper,selectable:!1}),this._handles.add(this._moveManipulator.watch("grabbing",function(e){r._manipulators.forEach(function(t){t.manipulator.interactive=!e})},!0),this._moveManipulator),this._handles.add(this._moveManipulator.watch("dragging",function(e){!0===e?1==++r._numDragging&&r.emit("reshape-operation-start",new f(!0,!0)):0==--r._numDragging&&r.emit("reshape-operation-stop",new M(!0,!0))},!0),this._moveManipulator),this._handles.add(this._moveManipulator.watch("hovering",function(e){r.cursor=e?"move":null},!0),this._moveManipulator),this._moveManipulator.on("drag",function(e){return r._moveManipulatorDragCallback(e)}),this._moveManipulator.on("click",function(){return r.emit("click")}),this.toolViewManager.addManipulator(this._moveManipulator)},t.prototype._clearManipulatorSelection=function(){this._manipulators.forEach(function(e){return e.manipulator.selected=!1})},t.prototype._createManipulator=function(e){var t=this,r=new d.Manipulator3D({view:this.view,renderObjects:[{geometry:this._manipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|R.Vertex},{geometry:this._manipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:4|R.Edge},{geometry:this._manipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8}],radius:5});r.alignment="on-the-ground",r.allowOverlap=!0,"vertex"===e.type?(r.state=R.Vertex,r.selectable=!0):(r.state=R.Edge,r.selectable=!1);var i={manipulator:r,handle:e};return this._manipulators.push(i),this.toolViewManager.addManipulator(r),this._setManipulatorPosition(i),this._handles.add(r.watch("grabbing",function(e){t._moveManipulator.interactive=!e},!0),r),this._handles.add(r.watch("dragging",function(e){!0===e?1==++t._numDragging&&t.emit("reshape-operation-start",new f(!0)):0==--t._numDragging&&t.emit("reshape-operation-stop",new M(!0))},!0),r),this._handles.add(r.watch("hovering",function(e){t.cursor=e?"vertex"===i.handle.type?"move":"copy":null},!0),r),r.on("drag",function(){return t._manipulatorMoveCallback(i)}),r.on("click",function(e){return t._manipulatorClickCallback(e,i)}),r},t.prototype._removeManipulator=function(e){e&&(this._handles.remove(e.manipulator),this._manipulators.splice(this._manipulators.indexOf(e),1),this.toolViewManager.removeManipulator(e.manipulator))},t.prototype._getManipulatorInfoFromHandle=function(e){if(e)for(var t=0,r=this._manipulators;t<r.length;t++){var i=r[t];if(e===i.handle)return i}return null},t.prototype._setManipulatorPosition=function(e){e&&("vertex"===e.handle.type?e.manipulator.mapPoint=this._reshapeHelper.getVertexPositionAsPoint(e.handle,T):"edge"===e.handle.type&&(e.manipulator.mapPoint=this._reshapeHelper.getEdgePositionAsPoint(e.handle,.5,T)))},t.prototype._splitEdgeManipulator=function(e){if("edge"===e.handle.type){var t=this._reshapeHelper.splitEdge(e.handle,.5);return e.handle=t,e.manipulator.state=R.Vertex,e.manipulator.selectable=!0,t.left&&this.toolViewManager&&this._createManipulator(t.left),t.right&&this.toolViewManager&&this._createManipulator(t.right),t}return null},t.prototype._manipulatorMoveCallback=function(e){var t=this;if("edge"===e.handle.type&&this._splitEdgeManipulator(e),e.handle&&"vertex"===e.handle.type){!1===e.manipulator.selected&&(this._clearManipulatorSelection(),e.manipulator.selected=!0);var r=e.handle.pos,i=e.manipulator.mapPoint.x-r[0],n=e.manipulator.mapPoint.y-r[1],a=this._manipulators.filter(function(e){return e.manipulator.selected&&"vertex"===e.handle.type});a.forEach(function(r){var a=r.handle;a.pos[0]+=i,a.pos[1]+=n,e!==r&&(T.x=a.pos[0],T.y=a.pos[1],T.spatialReference=t._reshapeHelper.geometry.spatialReference,r.manipulator.mapPoint=T)}),this.outputGeometry=this._reshapeHelper.commit(),a.forEach(function(e){var r=e.handle;t._setManipulatorPosition(t._getManipulatorInfoFromHandle(r.left)),t._setManipulatorPosition(t._getManipulatorInfoFromHandle(r.right))});var o=a.map(function(e){return e.handle.unnormalizedPos}),s=new g(o);this.emit("vertex-move",s)}},t.prototype._removeVertices=function(e){var t=this,r=[];if(e.forEach(function(e){if("vertex"===e.handle.type&&t._reshapeHelper.canRemoveVertex(e.handle)){0===r.length&&t.emit("reshape-operation-start",new f),r.push(e.handle.unnormalizedPos),t._removeManipulator(e),t._removeManipulator(t._getManipulatorInfoFromHandle(e.handle.left)),t._removeManipulator(t._getManipulatorInfoFromHandle(e.handle.right));var i=t._reshapeHelper.removeVertex(e.handle);i&&t._createManipulator(i)}}),r.length>0){this.outputGeometry=this._reshapeHelper.commit();var i=new _(r);this.emit("vertex-remove",i),this.emit("reshape-operation-stop",new M)}},t.prototype._manipulatorClickCallback=function(e,t){if("vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),"edge"===t.handle.type&&0===e.button){this.emit("reshape-operation-start",new f);var r=this._splitEdgeManipulator(t);this.outputGeometry=this._reshapeHelper.commit();var i=new y([r.unnormalizedPos]);this.emit("vertex-add",i),this.emit("reshape-operation-stop",new M)}},t.prototype._moveManipulatorDragCallback=function(e){var t=this,r=[],i=!0;if(this._manipulators.forEach(function(n){"vertex"===n.handle.type&&(n.manipulator.grabbing?i=!1:"vertex"===n.handle.type&&(n.handle.pos[0]+=e.dxGeometry,n.handle.pos[1]+=e.dyGeometry,r.push(n.handle.pos),t._setManipulatorPosition(n)))}),this._manipulators.forEach(function(e){"vertex"!==e.handle.type&&t._setManipulatorPosition(e)}),this.outputGeometry=this._reshapeHelper.commit(),i)this.emit("translate",new m(e.dxScreen,e.dyScreen));else{var n=new g(r);this.emit("vertex-move",n)}},r([s.property({value:null})],t.prototype,"toolViewManager",void 0),r([s.property({value:null,nonNullable:!0})],t.prototype,"view",void 0),r([s.property({value:null})],t.prototype,"inputGeometry",null),r([s.property({value:null})],t.prototype,"cursor",void 0),r([s.property({value:null})],t.prototype,"outputGeometry",void 0),r([s.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.ReshapeOperation")],t)}(s.declared(n,a));t.ReshapeOperation=b;var R,T=c.makeDehydratedPoint(0,0,null,null);!function(e){e.Vertex=16,e.Edge=32}(R||(R={}))}.apply(null,i))||(e.exports=n)},2210:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(6),r(26),r(32),r(0),r(4),r(3),r(1634),r(51),r(73)],void 0===(n=function(e,t,r,i,n,a,o,s,c,p,l,u,h){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t){var r=e.call(this)||this;return r._handlers=new a,r.interactive=!0,r.selectable=!1,r.allowOverlap=!0,r.grabbing=!1,r.dragging=!1,r.hovering=!1,r.selected=!1,r.active=!0,r}return i(t,e),t.prototype.initialize=function(){},t.prototype.destroy=function(){this._handlers.removeAll(),this._handlers=null,this._set("view",null)},t.prototype.intersectionDistance=function(e){if(!this.active||!this.reshapeHelper.geometry)return null;var t=l.intersectsDrapedGeometry(e,this.reshapeHelper.geometry,this.view);if(o.isNone(t))return null;var r=h.sv3d.get();return this.view.renderCoordsHelper.toRenderCoords(t,r)?c.vec3.distance(v,this.view.state.camera.eye):null},t.prototype.attemptDragTo=function(e,t){if(null==this.reshapeHelper.geometry)return!1;var r=this.view.toMap(t.previous),i=this.view.toMap(e.screenPoint),n=0,a=0,o=0,s=0,c=0,p=0;if(r&&i){var l=[0,0,0,0,0,0];u.bufferToBuffer([r.x,r.y,0,i.x,i.y,0],r.spatialReference,0,l,this.reshapeHelper.geometry.spatialReference,0,2),o=l[3]-l[0],s=l[4]-l[1],n=i.x-r.x,a=i.y-r.y,c=e.screenPoint.x-t.previous.x,p=e.screenPoint.y-t.previous.y}var h={screenPoint:e.screenPoint,dxMap:n,dyMap:a,dxGeometry:o,dyGeometry:s,dxScreen:c,dyScreen:p,toMS:i};return this._handlers.forEach(function(e){"drag"===e.type&&e.handler(h)}),!0},t.prototype.click=function(e){this._handlers.forEach(function(t){"click"===t.type&&t.handler(e)})},t.prototype.on=function(e,t){this._handlers.push({type:e,handler:t})},r([s.property()],t.prototype,"reshapeHelper",void 0),r([s.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r([s.property()],t.prototype,"interactive",void 0),r([s.property()],t.prototype,"selectable",void 0),r([s.property()],t.prototype,"allowOverlap",void 0),r([s.property()],t.prototype,"grabbing",void 0),r([s.property()],t.prototype,"dragging",void 0),r([s.property()],t.prototype,"hovering",void 0),r([s.property()],t.prototype,"selected",void 0),r([s.property()],t.prototype,"active",void 0),r([s.subclass("esri.views.interactive.GeometryManipulator")],t)}(s.declared(n));t.ReshapeMoveManipulator=d;var v=p.vec3f64.create()}.apply(null,i))||(e.exports=n)},2211:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(22),r(25),r(48),r(17),r(10),r(32),r(9),r(57),r(14),r(21),r(0),r(18),r(15),r(4),r(3),r(121),r(31),r(128),r(2212),r(617),r(29),r(12),r(51),r(73),r(86),r(177),r(404),r(1690),r(1691),r(1786)],void 0===(n=function(e,t,r,i,n,a,o,s,c,p,l,u,h,d,v,f,g,m,y,_,M,b,R,T,S,w,O,D,P,A,E,I,x,C){function N(e){for(var t=function(e,t,r){for(var i=[],n=Math.ceil(R.GEOMETRY_SEGMENTS*(t-e)/(2*Math.PI)),a=0;a<n+1;a++){var o=e+a*(t-e)/n;i.push(y.vec3f64.fromValues(r*Math.cos(o),r*Math.sin(o),0))}return i},r=function(e){return t(0,2*Math.PI,e)},i=function(e,t){return new P(A.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,R.RING_HEIGHT/2],[-e/2,R.RING_HEIGHT/2]]}(t),e,[],[],!1),"graphic-transform-ring")},n=r(R.RING_RADIUS),a=i(n,R.RING_THICKNESS),o={left:[],right:[]},s=[],c=0;c<2;c++){var p=(T=c*Math.PI-Math.PI/4)+(S=Math.PI/2-R.ROTATE_INDICATOR_ARC_LENGTH),l=T+Math.PI/2-S,u=i(w=t(p,l,R.INNER_INDICATOR_RADIUS),R.INDICATOR_THICKNESS);s.push(w),o.left.push(u),o.right.push(u);for(var h=0;h<2;h++){var d=0===h,v=g.mat4f64.create();if(d){f.mat4.scale(v,v,[1,-1,1]),f.mat4.rotate(v,v,-p,[0,0,1]);var m=Math.round(R.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE*(w.length-1));v[12]=w[m][0],v[13]=w[m][1],v[14]=w[m][2]}else{f.mat4.rotate(v,v,l,[0,0,1]);m=Math.round((1-R.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE)*(w.length-1));v[12]=w[m][0],v[13]=w[m][1],v[14]=w[m][2]}var _=A.createExtrudedTriangle(R.ROTATE_INDICATOR_ARROW_TIP_LENGTH,0,R.ROTATE_INDICATOR_ARROW_TIP_RADIUS,R.RING_HEIGHT);A.transformInPlace(_,v);var M=new P(_,"graphic-transform-ring-rotate");(d?o.left:o.right).push(M)}}var b=[];for(c=0;c<2;c++){p=(T=c*Math.PI-Math.PI/4)+(S=Math.PI/2-R.SCALE_INDICATOR_ARC_LENGTH),l=T+Math.PI/2-S;var T,S,w=t(p,l,R.OUTER_INDICATOR_RADIUS);b.push(i(w,R.INDICATOR_THICKNESS))}var O=r(R.RING_RADIUS+R.SCALE_INDICATOR_OFFSET1),D=r(R.RING_RADIUS+R.SCALE_INDICATOR_OFFSET2),E=i(O,R.INDICATOR_THICKNESS),I=i(D,R.INDICATOR_THICKNESS),C=r(R.RING_RADIUS-R.SCALE_INDICATOR_OFFSET1),N=r(R.RING_RADIUS-R.SCALE_INDICATOR_OFFSET2),G=i(C,R.INDICATOR_THICKNESS),j=i(N,R.INDICATOR_THICKNESS),k=F(),H=F(.66),L=F(.5),U=F(.33),V=[{geometry:a,material:k,stateMask:Q.DiscUnfocused|Q.ArrowUnfocused},{geometry:a,material:L},{geometry:b,material:k,stateMask:Q.Unlocked|Q.RingFocused},{geometry:E,material:H,stateMask:2|Q.ScaleIn},{geometry:I,material:U,stateMask:2|Q.ScaleIn},{geometry:G,material:H,stateMask:2|Q.ScaleOut},{geometry:j,material:U,stateMask:2|Q.ScaleOut},{geometry:o.left,material:k,stateMask:Q.Unlocked|Q.RingFocused},{geometry:o.left,material:k,stateMask:2|Q.RotateLeft},{geometry:o.right,material:k,stateMask:2|Q.RotateRight}],z=[n].concat(s);return new x.Manipulator3D({view:e,renderObjects:V,autoScaleRenderObjects:!1,radius:R.RING_THICKNESS,focusMultiplier:1,moveOnDrag:!1,allowOverlap:!0,alignment:"on-the-ground",collisionType:{type:"ribbon",paths:z,direction:y.vec3f64.fromValues(0,0,1)}})}function G(e){var t=Math.sqrt(R.DISC_TRANSLATE_ARROW_SIZE*R.DISC_TRANSLATE_ARROW_SIZE*3/4),r=A.createExtrudedTriangle(t,R.DISC_TRANSLATE_ARROW_SIZE/2,R.DISC_TRANSLATE_ARROW_SIZE/2,R.DISC_HEIGHT);A.transformInPlace(r,f.mat4.fromTranslation(D.sm4d.get(),m.vec3.set(D.sv3d.get(),0,-t/3,0)));var i=new P(r,"graphic-transform-disc-arrow"),n=F(),a=F(.5),o=new x.Manipulator3D({view:e,renderObjects:[{geometry:i,material:a,stateMask:1|Q.DiscFocused},{geometry:i,material:a,stateMask:1|Q.ArrowFocused},{geometry:i,material:n,stateMask:2}],autoScaleRenderObjects:!1,radius:t,focusMultiplier:1,allowOverlap:!0,snapToPointer:!1,alignment:"on-the-ground",collisionType:{type:"disc",direction:y.vec3f64.fromValues(0,0,1)}});return o.visible=!1,o}function j(e,t){var r=this,i=e.allLayerViews.find(function(e){return e.layer===t.layer}),o=t.symbol;return l.all(o.symbolLayers.map(function(e){return a(r,void 0,void 0,function(){var t,r;return n(this,function(n){switch(n.label){case 0:t=null,r=null,"object"===e.type&&(t=e.heading),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,i.whenSymbolLayerSize(o,e)];case 2:return r=n.sent(),[3,4];case 3:return n.sent(),r=null,[3,4];case 4:return[2,{heading:t,size:r}]}})})}).toArray()).then(function(e){return{symbolLayers:e}})}function k(e){var t=m.vec3.subtract(D.sv3d.get(),e.startPoint,e.origin),r=m.vec3.subtract(D.sv3d.get(),e.endPoint,e.origin),i=m.vec3.length(t),n=m.vec3.length(r);return 0===i?0:n/i}function F(e){void 0===e&&(e=1);var t=R.HANDLE_COLOR.concat([e]),r=new E({color:t,transparent:1!==e,cullFace:"back"},"graphic-transform");return r.renderOccluded=2,r}function H(e,t,r){var i=t.projectPoint(e,h.castRenderScreenPointArray($)),n=t.renderToScreen(i,ee);return m.vec3.set(r,n[0],n[1],0)}function L(e){var t=e.spatialReference;return"local"===e.viewingMode||(t.isWGS84||t.isWebMercator)&&e.scale<R.ALIGN_ARROWS_SCALE_THRESHOLD}Object.defineProperty(t,"__esModule",{value:!0});var U=c.getLogger("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool"),V=function(){return function(e){this.graphic=e}}();t.GraphicTranslateStartEvent=V;var z=function(){return function(e){this.graphic=e}}();t.GraphicTranslateStopEvent=z;var B=function(){return function(e){this.graphic=e}}();t.GraphicRotateStartEvent=B;var W=function(){return function(e){this.graphic=e}}();t.GraphicRotateStopEvent=W;var K=function(){return function(e){this.graphic=e}}();t.GraphicScaleStartEvent=K;var q=function(){return function(e){this.graphic=e}}();t.GraphicScaleStopEvent=q;var Y=function(){return function(e,t,r){this.graphic=e,this.dx=t,this.dy=r,this.type="translate"}}();t.GraphicTranslateEvent=Y;var Z=function(){return function(e,t){this.graphic=e,this.angle=t,this.type="rotate"}}();t.GraphicRotateEvent=Z;var J=function(){return function(e,t){this.graphic=e,this.scale=t,this.type="scale"}}();t.GraphicScaleEvent=J;var X=function(e){function t(t){var r=e.call(this,t)||this;return r.enableRotation=!0,r.enableScaling=!0,r.discManipulator=null,r.ringManipulator=null,r.arrowManipulators=null,r.type="transform-3d",r._handles=new s,r._arrowDragData=null,r._ringDragData=null,r._startSymbolDataPromise=null,r._startSymbolData=null,r._ringDelayedFocusFrameTask=null,r._ringManipulatorHasDelayedFocused=!1,r._scaleAnimationFrameTask=null,r}return i(t,e),t.prototype.destroy=function(){this._removeFrameTasks(),this.graphic=null,this._handles.destroy(),this._handles=null,this._set("view",null)},Object.defineProperty(t.prototype,"graphic",{set:function(e){!p.isSome(e)||T.isSupportedGraphic(e)?this._set("graphic",e):U.error("Only graphics from a graphics layer with point geometries and object symbology are supported")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_ringMode",{get:function(){return p.isSome(this._ringDragData)&&this._ringDragData.mode||this._ringModeFromOptions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_ringModeFromOptions",{get:function(){var e=this._shouldAllowModeType("scale"),t=this._shouldAllowModeType("rotate");return e||t?t?e?null:{type:"rotate",startAngle:0}:{type:"scale"}:{type:"disabled"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_manipulatorState",{get:function(){var e=this._ringMode,t=0;return t=p.isNone(e)?Q.Unlocked:"rotate"===e.type?p.isSome(this._ringDragData)&&this._ringDragData.angleDir<0?Q.RotateLeft:Q.RotateRight:p.isSome(this._ringDragData)&&this._ringDragData.scaleDir<0?Q.ScaleIn:Q.ScaleOut,t|=this.discManipulator.focused?Q.DiscFocused:Q.DiscUnfocused,(t|=this._ringManipulatorHasDelayedFocused?Q.RingFocused:Q.RingUnfocused)|(this.arrowManipulators.some(function(e){return e.manipulator.focused})?Q.ArrowFocused:Q.ArrowUnfocused)},enumerable:!0,configurable:!0}),t.prototype.hide=function(){this._removeFrameTasks()},t.prototype.reset=function(){this.graphic=null},t.prototype.onAttach=function(e){for(var t=this,r=function(e){var t=new P(A.createCylinderGeometry(R.DISC_HEIGHT,1,R.GEOMETRY_SEGMENTS,y.vec3f64.fromValues(0,0,1),y.vec3f64.fromValues(0,0,0)),"graphic-transform-disc"),r=F(),i=F(.5),n=f.mat4.fromScaling(g.mat4f64.create(),y.vec3f64.fromValues(R.DISC_RADIUS,R.DISC_RADIUS,R.DISC_RADIUS)),a=new x.Manipulator3D({view:e,renderObjects:[{geometry:t,material:r,stateMask:Q.RingUnfocused|Q.ArrowUnfocused,transform:n},{geometry:t,material:i,transform:n}],autoScaleRenderObjects:!1,radius:R.DISC_COLLISION_RADIUS,focusMultiplier:1,allowOverlap:!0,snapToPointer:!1,alignment:"on-the-ground",collisionType:{type:"disc",direction:y.vec3f64.fromValues(0,0,1)}});return a.visible=!1,a}(this.view),i=N(this.view),n=[],a=0;a<4;a++){var o=G(this.view),s=g.mat4f64.create();this._calculateArrowManipulatorTransform(a,s),n.push({manipulator:o,transform:s})}this.discManipulator=r,this.ringManipulator=i,this.arrowManipulators=n,this._handles.add([r.watch("grabbing",function(e){t._setSingleManipulatorInteractive(r,e)},!0),r.watch("dragging",function(e){p.isSome(t.graphic)&&(e?t.emit("graphic-translate-start",new V(t.graphic)):t.emit("graphic-translate-stop",new z(t.graphic)))},!0),d.watch(r,"focused",function(){p.isNone(t._scaleAnimationFrameTask)&&t._updateManipulators()}),d.init(this,"graphic.geometry",function(){p.isSome(t.graphic)&&t.graphic.geometry&&"point"===t.graphic.geometry.type&&(r.mapPoint=b.clonePoint(t.graphic.geometry,re)),t._updateManipulators()},!0)]),n.forEach(function(e,r){var i=e.manipulator;i.on("drag",function(e){t._handleArrowDrag(r)}),t._handles.add([d.watch(i,"focused",function(){t._updateManipulators()}),d.watch(i,"grabbing",function(e){t._setSingleManipulatorInteractive(i,e)}),d.watch(i,"dragging",function(e){p.isNone(t.graphic)||(e?t.emit("graphic-translate-start",new V(t.graphic)):(t._arrowDragData=null,t.emit("graphic-translate-stop",new z(t.graphic))))})])}),r.on("drag",function(e){if(!p.isNone(t.graphic)&&t.graphic.geometry&&"point"===t.graphic.geometry.type){var i=t.graphic.geometry.z,n=t.graphic.geometry,a=b.clonePoint(r.mapPoint,new M);a.z=i,t.graphic.geometry=a;var o=a.x-n.x,s=a.y-n.y;t.emit("graphic-translate",new Y(t.graphic,o,s))}}),this._handles.add([i.watch("grabbing",function(e){t._setSingleManipulatorInteractive(i,e)},!0),i.watch("dragging",function(e){if(!1===e){var r=t._ringDragData;if(t._ringDragData=null,t._startSymbolDataPromise=null,t._startSymbolData=null,p.isSome(r)){var i=r.mode;if(p.isNone(i)||p.isSome(i)&&"scale"===i.type){var n=k(r);t._startScaleResetAnimation(n)}else t._updateManipulators();if(p.isSome(t.graphic)&&p.isSome(r.mode))switch(r.mode.type){case"rotate":t.emit("graphic-rotate-stop",new W(t.graphic));break;case"scale":t.emit("graphic-scale-stop",new q(t.graphic))}}}else if(p.isSome(t.graphic)&&p.isSome(t._ringMode)&&"disabled"!==t._ringMode.type)switch(t._ringMode.type){case"rotate":t.emit("graphic-rotate-start",new B(t.graphic));break;case"scale":t.emit("graphic-scale-start",new K(t.graphic))}},!0),d.watch(i,"focused",function(){p.isNone(t._scaleAnimationFrameTask)&&t._startRingFocusFrameTask()})]),i.on("drag",function(e){t._handleRingDrag(e.screenPoint)}),e.addManipulator(r),e.addManipulator(i),n.forEach(function(t){var r=t.manipulator;return e.addManipulator(r)})},t.prototype.onDetach=function(){this._handles.removeAll(),this.discManipulator=null,this.ringManipulator=null,this.arrowManipulators=[]},t.prototype._handleArrowDrag=function(e){if(!p.isNone(this.graphic)&&this.graphic.geometry&&"point"===this.graphic.geometry.type){var t=this.arrowManipulators[e].manipulator,r=this.graphic.geometry,i=this.graphic.geometry.spatialReference,n=new M,a=L(this.view);if(a){var o=this._calculateArrowManipulatorDirection(e,D.sv3d.get()),s=m.vec3.subtract(D.sv3d.get(),t.position,this.discManipulator.position);S.vector.projectPoint(o,s,s);var c=m.vec3.add(s,s,this.discManipulator.position);if(!this.view.renderCoordsHelper.fromRenderCoords(c,n,i))return}else{var l=t.mapPoint;O.vectorToPoint(m.vec3.set(D.sv3d.get(),l.x,l.y,l.z),l.spatialReference,n,i)}var u=!function(e,t){var r=e.longitude,i=t.longitude;if(null==r||null==i)return!1;var n=w.cyclicalDeg.shortestSignedDiff(r,i);return Math.abs(n)<90}(r,n);if(u&&(n.x=r.x,n.y=r.y),a||u||(0===e||2===e?n.x=r.x:n.y=r.y),p.isNone(this._arrowDragData)){var h=b.clonePoint(r,new M),d=n.x-r.x,v=n.y-r.y;(Math.abs(d)>1e-5||Math.abs(v)>1e-5)&&(this._arrowDragData={startPoint:h,dxMapConstrained:d,dyMapConstrained:v})}else if(a&&!u){var f=this._arrowDragData,g=f.dxMapConstrained,y=f.dyMapConstrained;h=f.startPoint;if(Math.abs(g)<1e-5)n.x=h.x;else if(Math.abs(y)<1e-5)n.y=h.y;else{var _=n.x-h.x;n.y=h.y+_*y/g}}var R=n.x-r.x,T=n.y-r.y;n.z=r.z,this.graphic.geometry=n,this.emit("graphic-translate",new Y(this.graphic,R,T))}},t.prototype._handleRingDrag=function(e){var t=this;if(!p.isNone(this.graphic)&&!p.isSome(this._startSymbolDataPromise)){var r=this._ringDragData,i=this._startSymbolData,n=this.graphic,a=h.screenPointObjectToArray(e,h.castScreenPointArray(D.sv2d.get())),o=S.ray.fromScreen(this.view.state.camera,a,te),s=this.discManipulator.modelTransform;if(p.isNone(r)||p.isNone(i)){var c=y.vec3f64.fromValues(0,0,1);m.vec3.transformMat4(c,c,s);var l=y.vec3f64.clone(this.ringManipulator.position),u=S.plane.fromPositionAndNormal(l,c),d=y.vec3f64.create();S.plane.intersectRay(u,o,d)&&(this._ringDragData={origin:l,plane:u,angle:0,angleDir:0,scale:1,scaleDir:0,startPoint:d,endPoint:y.vec3f64.clone(d),mode:null},this._startSymbolDataPromise=j(this.view,n),this._startSymbolDataPromise.then(function(e){t._startSymbolData=e,t._startSymbolDataPromise=null},function(){t._startSymbolDataPromise=null}))}else{u=r.plane;if(S.plane.intersectRay(u,o,r.endPoint)){var v=k(r),g=(c=u,C.calculateInputRotationTransform(r.startPoint,r.endPoint,r.origin,c)),M=w.cyclicalPI.shortestSignedDiff(r.angle,g);r.angleDir=w.clamp(r.angleDir+M,-R.ROTATE_INDICATOR_DIRECTION_BUFFER,R.ROTATE_INDICATOR_DIRECTION_BUFFER),r.angle=g;var b=v-r.scale;r.scaleDir=w.clamp(r.scaleDir+b,-R.SCALE_INDICATOR_DIRECTION_BUFFER,R.SCALE_INDICATOR_DIRECTION_BUFFER),r.scale=v;var T=null,O=this._ringMode;if(p.isSome(O))T=O;else{var P=function(e,t){var r=e.origin,i=e.startPoint,n=e.endPoint,a=e.plane,o=H(i,t,D.sv3d.get()),s=H(n,t,D.sv3d.get());if(m.vec3.squaredDistance(o,s)<R.DRAG_THRESHOLD_PX*R.DRAG_THRESHOLD_PX)return null;var c=m.vec3.subtract(D.sv3d.get(),i,r),p=m.vec3.cross(D.sv3d.get(),c,a),l=i,u=m.vec3.add(D.sv3d.get(),l,p),h=H(r,t,D.sv3d.get()),d=o,v=H(u,t,D.sv3d.get()),f=m.vec3.subtract(D.sv3d.get(),v,d),g=m.vec3.subtract(D.sv3d.get(),o,h),y=S.ray.wrap(d,f),_=S.ray.wrap(h,g);return S.ray.distance2(y,s)<S.ray.distance2(_,s)?"rotate":"scale"}(r,this.view.state.camera);if(p.isSome(P)){switch(P){case"rotate":this.emit("graphic-rotate-start",new B(this.graphic));break;case"scale":this.emit("graphic-scale-start",new K(this.graphic))}T="scale"===P?{type:"scale"}:{type:"rotate",startAngle:g}}}r.mode=T,p.isSome(T)&&("rotate"===T.type?v=1:"scale"===T.type&&(g=0));var A=f.mat4.fromScaling(D.sm4d.get(),m.vec3.set(D.sv3d.get(),v,v,1));if(this._updateManipulators(A),p.isSome(T)&&"disabled"!==T.type){"rotate"===T.type&&(g-=T.startAngle);var E=n.symbol.clone();switch(function(e,t,r,i){e.symbolLayers.forEach(function(e,n){var a=t.symbolLayers[n],o=a.heading,s=a.size;"object"===e.type&&(e.heading=(p.isSome(o)?o:0)-_.toDegree(r),p.isSome(s)&&"width"in s&&(e.width=s.width*i,e.depth=s.depth*i,e.height=s.height*i))})}(E,i,g,v),this.graphic.symbol=E,T.type){case"rotate":this.emit("graphic-rotate",new Z(this.graphic,_.toDegree(g)));break;case"scale":this.emit("graphic-scale",new J(this.graphic,v))}}}}}},t.prototype._shouldAllowModeType=function(e){return"scale"===e?this.enableScaling:!(p.isNone(this.graphic)||!this.enableRotation)&&this.graphic.symbol.symbolLayers.some(function(e){return"object"===e.type})},t.prototype._updateManipulators=function(e){var t=this._manipulatorState,r=this._getManipulatorRotationAngle(),i=f.mat4.identity(D.sm4d.get());0!==r&&f.mat4.rotate(i,i,r,y.vec3f64.fromValues(0,0,1));var n=this.discManipulator.position,a=this.view.renderCoordsHelper.basisMatrixAtPosition(n,D.sm4d.get()),o=e?f.mat4.multiply(D.sm4d.get(),a,e):a,s=p.isSome(this.graphic)&&null!=this.graphic.geometry,c=L(this.view)?f.mat4.multiply(D.sm4d.get(),o,i):o;this.discManipulator.state=t,this.discManipulator.modelTransform=c,this.discManipulator.visible=s,this.arrowManipulators.forEach(function(e){var r=e.manipulator,i=e.transform,a=f.mat4.multiply(D.sm4d.get(),c,i);r.state=t,r.position=n,r.modelTransform=a,r.visible=s});var l=f.mat4.multiply(D.sm4d.get(),o,i);this.ringManipulator.state=t,this.ringManipulator.position=this.discManipulator.position,this.ringManipulator.modelTransform=l;var u=this._ringMode,h=p.isSome(u)&&"disabled"===u.type;this.ringManipulator.visible=s&&!h},t.prototype._setSingleManipulatorInteractive=function(e,t){if(!t)return this.discManipulator.interactive=!0,this.ringManipulator.interactive=!0,void this.arrowManipulators.forEach(function(e){e.manipulator.interactive=!0});this.discManipulator.interactive=this.discManipulator===e,this.ringManipulator.interactive=this.ringManipulator===e,this.arrowManipulators.forEach(function(t){var r=t.manipulator;r.interactive=r===e})},t.prototype._startRingFocusFrameTask=function(){var e=this;this._removeFrameTasks();var t=0;this._ringDelayedFocusFrameTask=u.addFrameTask({update:function(r){var i=r.deltaTime;if(t+=i,!e.ringManipulator.focused)return e._ringManipulatorHasDelayedFocused=!1,e._updateManipulators(),void e._removeFrameTasks();t>R.RING_INDICATOR_DELAY_MS&&(e._ringManipulatorHasDelayedFocused=!0,e._updateManipulators(),e._removeFrameTasks())}})},t.prototype._startScaleResetAnimation=function(e){var t=this;this._removeFrameTasks();var r=e;this._scaleAnimationFrameTask=u.addFrameTask({update:function(e){var i=e.deltaTime;if(r+=((r+1)/2-r)*Math.min(i*R.RING_RESET_ANIMATION_SPEED_FACTOR,1),Math.abs(r-1)<.01)return t._updateManipulators(),void t._removeFrameTasks();var n=f.mat4.fromScaling(D.sm4d.get(),m.vec3.set(D.sv3d.get(),r,r,1));t._updateManipulators(n)}})},t.prototype._getManipulatorRotationAngle=function(){var e=p.isSome(this.graphic)?function(e){var t=e.symbol.symbolLayers.find(function(e){return"object"===e.type});return t&&t.heading||0}(this.graphic):0,t=_.toRadian(-e);if(p.isNone(this._ringDragData)||p.isSome(this._ringDragData.mode))return t;var r=this._ringDragData,i=r.origin,n=r.plane,a=r.startPoint,o=r.endPoint,s=n;return t+C.calculateInputRotationTransform(a,o,i,s)},t.prototype._calculateArrowManipulatorTransform=function(e,t){var r=f.mat4.identity(D.sm4d.get());f.mat4.fromZRotation(r,e*Math.PI/2);var i=f.mat4.identity(D.sm4d.get());return f.mat4.fromTranslation(i,m.vec3.set(D.sv3d.get(),0,R.DISC_TRANSLATE_ARROW_OFFSET,0)),f.mat4.multiply(t,r,i)},t.prototype._calculateArrowManipulatorDirection=function(e,t){var r=this.discManipulator.modelTransform;return 0===e||2===e?m.vec3.set(t,r[4],r[5],r[6]):m.vec3.set(t,r[0],r[1],r[2])},t.prototype._removeFrameTasks=function(){this.ringManipulator&&(this._ringManipulatorHasDelayedFocused=this.ringManipulator.focused),p.isSome(this._ringDelayedFocusFrameTask)&&(this._ringDelayedFocusFrameTask.remove(),this._ringDelayedFocusFrameTask=null),p.isSome(this._scaleAnimationFrameTask)&&(this._scaleAnimationFrameTask.remove(),this._scaleAnimationFrameTask=null)},r([v.property({constructOnly:!0,nonNullable:!0})],t.prototype,"view",void 0),r([v.property({value:null})],t.prototype,"graphic",null),r([v.property()],t.prototype,"enableRotation",void 0),r([v.property()],t.prototype,"enableScaling",void 0),r([v.property({readOnly:!0})],t.prototype,"type",void 0),r([v.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransform3DTool")],t)}(v.declared(I,o));t.GraphicTransform3DTool=X;var Q,$=y.vec3f64.create(),ee=h.createScreenPointArray();!function(e){e.Unlocked=16,e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.DiscFocused=512,e.DiscUnfocused=1024,e.RingFocused=2048,e.RingUnfocused=4096,e.ArrowFocused=8192,e.ArrowUnfocused=16384}(Q||(Q={}));var te=S.ray.create(),re=b.makeDehydratedPoint(0,0,0,null)}.apply(null,i))||(e.exports=n)},2212:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HANDLE_COLOR=[1,.5,0],t.GEOMETRY_SEGMENTS=128,t.DISC_RADIUS=70,t.DISC_COLLISION_RADIUS=80,t.DISC_HEIGHT=.02,t.DISC_TRANSLATE_ARROW_SIZE=54,t.DISC_TRANSLATE_ARROW_OFFSET=100,t.RING_RADIUS=160,t.RING_HEIGHT=.5,t.RING_THICKNESS=24,t.INDICATOR_THICKNESS=9,t.INNER_INDICATOR_RADIUS=t.RING_RADIUS+30,t.OUTER_INDICATOR_RADIUS=t.RING_RADIUS+53,t.ROTATE_INDICATOR_ARROW_TIP_LENGTH=60,t.ROTATE_INDICATOR_ARROW_TIP_RADIUS=23,t.ROTATE_INDICATOR_ARC_LENGTH=5*Math.PI/12,t.SCALE_INDICATOR_ARC_LENGTH=1*Math.PI/3,t.DRAG_THRESHOLD_PX=10,t.ROTATE_INDICATOR_ARROW_PLACEMENT_PERCENTAGE=.2,t.SCALE_INDICATOR_OFFSET1=30,t.SCALE_INDICATOR_OFFSET2=53,t.SCALE_INDICATOR_DIRECTION_BUFFER=.2,t.ROTATE_INDICATOR_DIRECTION_BUFFER=.3,t.RING_INDICATOR_DELAY_MS=200,t.RING_RESET_ANIMATION_SPEED_FACTOR=3,t.ALIGN_ARROWS_SCALE_THRESHOLD=1e6}.apply(null,i))||(e.exports=n)},409:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2206),r(2208),r(2211)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicMove3DTool=r.GraphicMove3DTool,t.GraphicReshape3DTool=i.GraphicReshape3DTool,t.GraphicTransform3DTool=n.GraphicTransform3DTool}.apply(null,i))||(e.exports=n)}}]);