(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/operations/PBFWorker":1465,"esri/tasks/operations/query":1466,"esri/core/HandleOwner":1503,"esri/views/layers/LayerView":1504,"esri/views/3d/layers/LayerView3D":1507,"esri/views/layers/RefreshableLayerView":1508,"esri/views/3d/layers/support/layerViewUpdatingProperties":1514,"esri/tasks/operations/pbfQueryUtils":1515,"esri/core/pbf":1520,"esri/views/layers/support/popupUtils":1526,"esri/views/3d/layers/support/projectExtentUtils":1534,"esri/tasks/operations/pbfFeatureServiceParser":1535,"esri/tasks/operations/pbfDehydratedFeatureSet":1536,"esri/tasks/operations/pbfOptimizedFeatureSet":1537,"esri/tasks/operations/urlUtils":1538,"esri/layers/graphics/data/QueryEngineCapabilities":1545,"esri/views/support/QueueProcessor":1546,"esri/views/3d/webgl-engine/lib/HighlightSet":1551,"esri/core/Queue":1556,"esri/core/libs/rbush/PooledRBush":1558,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":1574,"esri/views/3d/layers/graphics/constants":1575,"esri/views/3d/layers/graphics/Graphics3DCore":1576,"esri/renderers/support/rendererConversion":1577,"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":1578,"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":1579,"esri/views/3d/layers/graphics/Graphics3DPointSymbol":1580,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":1581,"esri/views/3d/layers/graphics/Graphics3DHighlights":1582,"esri/views/3d/layers/graphics/Graphics3DHighlightSet":1583,"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":1584,"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":1585,"esri/views/3d/layers/support/attributeUtils":1596,"esri/renderers/support/renderingInfoUtils":1636,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":1637,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":1638,"esri/views/layers/support/FeatureEffect":1654,"esri/views/layers/FeatureLayerView":1692,"esri/views/layers/support/ParsedFeatureEffect":1693,"esri/views/layers/support/cssFilterParser":1694,"esri/views/layers/support/Transition":1695,"esri/views/3d/layers/graphics/Graphics3DVerticalScale":1696,"esri/views/3d/layers/FeatureLikeLayerView3D":1697,"esri/layers/graphics/QueryEngine":1698,"esri/views/3d/layers/support/FeatureTileFetcher3D":1789,"esri/views/3d/layers/FeatureLayerView3D":2219,"esri/layers/graphics/controllers/FeatureTileController3D":2220,"esri/views/3d/layers/support/featureReference":2221,"esri/views/3d/layers/support/FeatureTile":2222,"esri/views/3d/layers/support/featureTileQuery3D":2223,"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":2224,"esri/layers/graphics/controllers/support/controllerUtils":2225,"esri/views/3d/support/EventedSet":2226})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{1465:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(79),r(9),r(356),r(355),r(34),r(1515),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(){}return e.prototype._parseFeatureQuery=function(e){var t,r=u.parsePBFFeatureQuery(e.buffer,e.options);return e.options&&"dehydrated"===e.options.type&&(t=r.spatialReference.toJSON(),r.spatialReference=null),n.resolve({featureSet:r,sr:t})},e}(),c=function(t){function p(){var r=t.call(this)||this;return r._thread=void 0,a.open(s.getAbsMid("./PBFWorker",e,l),{strategy:"dedicated"}).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(p,t),p.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},p.prototype.parseFeatureQuery=function(e,t){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_parseFeatureQuery",{buffer:e,options:t},{transferList:[e]}).then(function(e){var t=e.featureSet;if(e.sr){var r=o.fromJSON(e.sr);t.spatialReference=r}for(var n=t.spatialReference,s=0,a=t.features;s<a.length;s++){var u=a[s];u.uid=i.generateUID(),u.geometry&&(u.geometry.spatialReference=n)}return e.featureSet}):n.resolve(u.parsePBFFeatureQuery(e,t)):n.resolve(null)},p}(p);t.PBFWorker=c,t.default=function(){return new p}}.apply(null,i))||(e.exports=n)},1466:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(50),r(33),r(69),r(1509),r(1515),r(1465),r(1538)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){function p(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=s.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var a=i.timeExtent,o=a.start,u=a.end;null==o&&null==u||(n.time=o===u?o:(null==o?"null":o)+","+(null==u?"null":u)),delete i.timeExtent}return n}function c(e,t,s,o,u){void 0===o&&(o={});var c="string"==typeof e?n.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return o.responseType="pbf"===s?"array-buffer":"json",a.normalizeCentralMeridian(h,null,o).then(function(e){var n=e&&e[0];n&&((t=t.clone()).geometry=n);var a=l.mapParameters(r({},c.query,{f:s},u,p(t,u)));return i(c.path+"/query",r({},o,{query:a}))})}Object.defineProperty(t,"__esModule",{value:!0});var h,d="Layer does not support extent calculation.";t.queryToQueryStringParameters=p,t.executeQuery=function(e,t,r){return c(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,i){return c(e,t,"pbf",i).then(function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?(null==h&&(h=new u.PBFWorker),h).parseFeatureQuery(e.data,r).then(function(e){return t(e)}):t(o.parsePBFFeatureQuery(e.data,r))})},t.executeQueryForIds=function(e,t,r){return c(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return c(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return c(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(d);if(t.hasOwnProperty("count"))throw new Error(d);return e})}}.apply(null,i))||(e.exports=n)},1503:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(17),r(0)],void 0===(n=function(e,t,r,i,n,s,a){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.call(this)||this;return i.handles=new s,i}return r(t,e),t.prototype.destroy=function(){this.handles.destroy()},i([a.property({readOnly:!0})],t.prototype,"handles",void 0),i([a.subclass("esri.core.HandleOwner")],t)}(a.declared(n))}.apply(null,i))||(e.exports=n)},1504:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(48),r(1503),r(210),r(10),r(209),r(9),r(0)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";return o.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+i+"', id: '"+r+"')",t),l.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},i([p.property()],t.prototype,"layer",void 0),i([p.property()],t.prototype,"parent",void 0),i([p.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),i([p.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),i([p.property()],t.prototype,"view",void 0),i([p.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),i([p.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),i([p.subclass("esri.views.layers.LayerView")],t)}(p.declared(s,n,a.Identifiable,u))}.apply(null,i))||(e.exports=n)},1507:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(9),r(21),r(0),r(357),r(1504)],void 0===(n=function(e,t,r,i,n,s,a,o,u){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),o.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create(function(t,r){s.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var i=o.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);i?r(i):t()})})},i([a.property()],t.prototype,"view",void 0),i([a.property()],t.prototype,"slicePlaneEnabled",void 0),i([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(u))}.apply(null,i))||(e.exports=n)},1508:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(0)],void 0===(n=function(e,t,r,i,n,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t}return r(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},i([s.property()],t.prototype,"layer",void 0),i([s.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),i([s.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),i([s.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1514:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,i))||(e.exports=n)},1515:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1535)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var i=r.parseFeatureQuery(e,t).queryResult.featureResult;if(i&&i.features&&i.features.length&&i.objectIdFieldName)for(var n=i.objectIdFieldName,s=0,a=i.features;s<a.length;s++){var o=a[s];o.attributes&&(o.objectId=o.attributes[n])}return i}}.apply(null,i))||(e.exports=n)},1520:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t,r,i){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=i||e.byteLength}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,i=new e(this._data,this._dataView,r,r+t);return this._skip(t),i},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){var i="",n="";r=Math.min(this._end,r);for(var s=t;s<r;++s){var a=e[s];128&a?n+="%"+a.toString(16):(i+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(i+=decodeURIComponent(n)),i},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,i))||(e.exports=n)},1526:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(22),r(25),r(154),r(32),r(127)],void 0===(n=function(e,t,r,i,n,s,a){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),i(this,void 0,void 0,function(){var i,o,u,l,p,c,h,d,y,f,g;return r(this,function(r){switch(r.label){case 0:return s.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return i=r.sent(),o=t.lastEditInfoEnabled,u=e.objectIdField,l=e.typeIdField,n.includes(i,"*")?[2,["*"]]:(c=a.fixFields,h=[e.fields],y=(d=i).concat,f=[[l]],(g=o)?[4,a.getFeatureEditFields(e)]:[3,3]);case 2:g=r.sent(),r.label=3;case 3:return(p=c.apply(void 0,h.concat([y.apply(d,f.concat([g||null]))])))&&u&&a.hasField(e.fields,u)&&-1===p.indexOf(u)&&p.push(u),[2,p]}})})},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:s.isSome(t)&&t.defaultPopupTemplateEnabled&&s.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,i))||(e.exports=n)},1534:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(44),r(366)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,s=e.layer.fullExtent,a=s&&s.spatialReference;return a?a.equals(t)?r.resolve(s.clone()):i.canProject(a,t)?r.resolve(i.project(s,t)):e.view.state.isLocal?n.projectGeometry(s,t,e.layer.portalItem).then(function(t){if(!e.destroyed&&t)return t}).catch(function(){return null}):r.resolve(null):r.resolve(null)}}.apply(null,i))||(e.exports=n)},1535:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(13),r(10),r(1520),r(1536),r(1537)],void 0===(n=function(e,t,r,i,n,s,a){function o(e){return e>=C.length?null:C[e]}function u(e){return e>=E.length?null:E[e]}function l(e){return e>=O.length?null:O[e]}function p(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function c(e,t,r){for(var i=e.createPointGeometry(t);r.next();)switch(r.tag()){case 3:for(var n=r.getUInt32(),s=r.pos()+n,a=0;r.pos()<s;)e.addCoordinatePoint(i,r.getSInt64(),0,a++);break;case 1:case 2:default:r.skip()}return i}function h(e,t,r){for(var i=e.createGeometry(t),n=2+(t.hasZ?1:0)+(t.hasM?1:0);r.next();)switch(r.tag()){case 2:for(var s=r.getUInt32(),a=r.pos()+s,o=0;r.pos()<a;)e.addLength(i,r.getUInt32(),o++);break;case 3:for(var u=r.getUInt32(),l=(a=r.pos()+u,0),p=0;r.pos()<a;)e.addCoordinate(i,r.getSInt64(),p,l),++l===n&&(p++,l=0);break;case 1:default:r.skip()}return i}function d(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function y(e){for(var t={type:o(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=o(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=u(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function f(e,t,r,i){for(var n=e.createFeature(t),s=0;r.next();)switch(r.tag()){case 1:var a=i[s++].name;n.attributes[a]=d(r.getMessage());break;case 2:n.geometry=h(e,t,r.getMessage());break;case 4:n.centroid=c(e,t,r.getMessage());break;default:r.skip()}return n}function g(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function m(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function v(e){for(var t={originPosition:l(0)};e.next();)switch(e.tag()){case 1:t.originPosition=l(e.getEnum());break;case 2:t.scale=g(e.getMessage());break;case 3:t.translate=m(e.getMessage());break;default:e.skip()}return t}function b(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function x(e,t){for(var r=e.createSpatialReference();t.next();)switch(t.tag()){case 1:r.wkid=t.getUInt32();break;case 5:r.wkt=t.getString();break;case 2:case 3:case 4:default:t.skip()}return r}function _(e,t){var r=e.createFeatureResult();r.geometryType=p(e,0);for(var i=!1;t.next();)switch(t.tag()){case 1:r.objectIdFieldName=t.getString();break;case 3:r.globalIdFieldName=t.getString();break;case 4:r.geohashFieldName=t.getString();break;case 5:r.geometryProperties=b(t.getMessage());break;case 7:r.geometryType=p(e,t.getEnum());break;case 8:r.spatialReference=x(e,t.getMessage());break;case 10:r.hasZ=t.getBool();break;case 11:r.hasM=t.getBool();break;case 12:r.transform=v(t.getMessage());break;case 9:var n=t.getBool();r.exceededTransferLimit=n;break;case 13:e.addField(r,y(t.getMessage()));break;case 15:i||(e.prepareFeatures(r),i=!0),e.addFeature(r,f(e,r,t.getMessage(),r.fields));break;case 2:case 6:default:t.skip()}return e.finishFeatureResult(r),r}function w(e,t){for(var r={};t.next();)switch(t.tag()){case 1:r.featureResult=_(e,t.getMessage());break;default:t.skip()}return r}function F(e){return e&&"dehydrated"===e.type?new s.Context(e):new a.Context(e)}Object.defineProperty(t,"__esModule",{value:!0});var S=i.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),C=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],E=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],O=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e,t){var i=F(t);try{for(var s=new n(new Uint8Array(e),new DataView(e)),a={};s.next();)switch(s.tag()){case 2:a.queryResult=w(i,s.getMessage());break;default:s.skip()}return a}catch(e){var o=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return S.error(o),{queryResult:{featureResult:i.createFeatureResult()}}}}}.apply(null,i))||(e.exports=n)},1536:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(79),r(23),r(34),r(354)],void 0===(n=function(e,t,r,i,n,s){function a(e,t,r,i){return t}function o(e,t,r,i){switch(r){case 0:return c(e,t+i,0);case 1:return h(e,t+i,1)}}function u(e,t,r,i){switch(r){case 0:return c(e,t+i,0);case 1:return h(e,t+i,1);case 2:return c(e,t,2)}}function l(e,t,r,i){switch(r){case 0:return c(e,t+i,0);case 1:return h(e,t+i,1);case 2:return c(e,t,3)}}function p(e,t,r,i){switch(r){case 0:return c(e,t+i,0);case 1:return h(e,t+i,1);case 2:case 3:return c(e,t,3)}}function c(e,t,r){var i=e.translate,n=e.scale;return i[r]+t*n[r]}function h(e,t,r){var i=e.translate,n=e.scale;return i[r]-t*n[r]}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=a,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0}return e.prototype.createFeatureResult=function(){return{exceededTransferLimit:!1,features:[],fields:[],hasM:!1,hasZ:!1,geometryType:null,objectIdFieldName:null,globalIdFieldName:null,geometryProperties:null,geohashFieldName:null,spatialReference:null,transform:null}},e.prototype.finishFeatureResult=function(e){this.options.applyTransform&&(e.transform=null)},e.prototype.createSpatialReference=function(){return new n},e.prototype.addField=function(e,t){e.fields.push(s.fromJSON(t))},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var i in t.attributes){var n=t.attributes[i];"string"==typeof n&&n.length>r&&delete t.attributes[i]}e.features.push(t)},e.prototype.prepareFeatures=function(e){switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=this.addCoordinatePoint.bind(this),this.createGeometry=this.createPointGeometry.bind(this);break;case"polygon":this.addCoordinate=this.addCoordinatePolygon.bind(this),this.createGeometry=this.createPolygonGeometry.bind(this);break;case"polyline":this.addCoordinate=this.addCoordinatePolyline.bind(this),this.createGeometry=this.createPolylineGeometry.bind(this);break;case"multipoint":this.addCoordinate=this.addCoordinateMultipoint.bind(this),this.createGeometry=this.createMultipointGeometry.bind(this);break;default:i.neverReached(e.geometryType)}},e.prototype.createFeature=function(e){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{uid:r.generateUID(),objectId:null,attributes:{},geometry:null,visible:!0}},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.paths,t,r,i)},e.prototype.addCoordinatePolygon=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.rings,t,r,i)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r,i){if(null===this.coordinateBuffer){var n=this.lengths.reduce(function(e,t){return e+t},0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var s=this.transformPathLikeValue(t,i),a=e[e.length-1];0===i&&a.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=s},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?p:t?u:r?l:o},e}();t.Context=d}.apply(null,i))||(e.exports=n)},1537:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(550),r(564),r(553)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new i.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(){},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new r.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new n.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new n.default},e}();t.Context=s}.apply(null,i))||(e.exports=n)},1538:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var s=0;s<n.length;s++)r[i][s]=e(n[s])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},1545:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1546:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(32),r(9),r(1556),r(57)],void 0===(n=function(e,t,r,i,n,s){return function(){function e(e){var t=this;this._apiPromises=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this._pendingProcessing=0,this.concurrency=1,this.ordered=!1,e.concurrency&&(this.concurrency=e.concurrency),e.ordered&&(this.ordered=!0,this._itemsToProcess=[]),this._queue=new n({peeker:e.peeker}),this.process=e.process;var r=e.scheduler;e.priority&&r&&(this._task=r.registerTask(e.priority,function(e){return t.update(e)},function(){return t.needsUpdate()}))}return e.prototype.destroy=function(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)},Object.defineProperty(e.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length+this._pendingProcessing},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._queue.clear();var e=[];this._processingItems.forEach(function(t){return e.push(t.resultPromise)}),this._processingItems.clear(),e.forEach(function(e){return e.cancel()}),e.length=0,this._apiPromises.forEach(function(t){return e.push(t)}),this._apiPromises.clear(),e.forEach(function(e){return e.cancel()}),this._cancelNext()},e.prototype.find=function(e,t){var r=this,i=void 0;return this._apiPromises.forEach(function(n,s){e.call(t,s)&&(i=r._apiPromises.get(s).promise)}),i},e.prototype.get=function(e){var t=this._apiPromises.get(e);return t&&t.promise||void 0},e.prototype.isOngoing=function(e){return this._processingItems.has(e)},e.prototype.has=function(e){return this._apiPromises.has(e)},e.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},e.prototype.push=function(e){var t=this;if(this._apiPromises.has(e))return this._apiPromises.get(e).promise;var r=i.createDeferred(function(r){var i=t._processingItems.get(e);i?i.resultPromise.cancel(r):(t._remove(e),t._scheduleNext())});return this._add(e,r),this._scheduleNext(),r.promise},e.prototype.reset=function(){var e=[];this._processingItems.forEach(function(t){return e.push(t)}),this._processingItems.clear();for(var t=0,r=e;t<r.length;t++){var i=r[t];i.resultPromise.isFulfilled()?this._processReset(i):(i.isReset=!0,i.resultPromise.cancel())}},e.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())},e.prototype.needsUpdate=function(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency},e.prototype.update=function(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()},e.prototype._scheduleNext=function(){var e=this;this._task||this._isPaused||this._schedule||(this._schedule=s.schedule(function(){e._schedule=null,e._next()}))},e.prototype._next=function(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())},e.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)},e.prototype._processResult=function(e,t){this._remove(e.item),this._scheduleNext(),e.dfd.resolve(t)},e.prototype._processError=function(e,t){e.isReset?this._processReset(e):(this._remove(e.item),this._scheduleNext(),e.dfd.reject(t))},e.prototype._processReset=function(e){this._remove(e.item),this._add(e.item,e.dfd),this._scheduleNext()},e.prototype._processOrdered=function(e,t){var r=this;if(e.isReset)this._processReset(e);else{e.result=t;var i=!1;this._processingItems.forEach(function(e){i||(e.result?r._itemsToProcess.push(e):i=!0)});for(var n=0,s=this._itemsToProcess;n<s.length;n++){var a=s[n];!1===a.result.ok?this._processError(a,a.result.error):this._processResult(a,a.result.value)}this._itemsToProcess.length=0}},e.prototype._process=function(e){var t=this;if(!r.isNone(e)){var i=this._apiPromises.get(e);this._pendingProcessing++;var n=this.process(e);if(this._pendingProcessing--,function(e){return e&&"function"==typeof e.then}(n)){var s={item:e,resultPromise:n,result:null,dfd:i,isReset:!1};this._processingItems.set(e,s),this.ordered?n.then(function(e){return t._processOrdered(s,{ok:!0,value:e})},function(e){return t._processOrdered(s,{ok:!1,error:e})}):n.then(function(e){return t._processResult(s,e)},function(e){return t._processError(s,e)})}else i.resolve(n),this._remove(e)}},e.prototype._add=function(e,t){this._apiPromises.set(e,t),this._queue.push(e)},e.prototype._remove=function(e){this._queue.remove(e),this._apiPromises.delete(e),this._processingItems.delete(e)},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{update:function(t){return e.update(t)}}},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},1551:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:t,renderGeometry:e,owner:r})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.owner.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,i))||(e.exports=n)},1556:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e){this._items=[],this._itemSet=new Set,this._peeker=function(e){return e[0]},this._length=0,e&&e.peeker&&(this._peeker=e.peeker)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._itemSet.clear(),this._items.length=0,this._length=0},e.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)},e.prototype.push=function(e){this.contains(e)||this._add(e)},e.prototype.contains=function(e){return this._length>0&&this._itemSet.has(e)},e.prototype.pop=function(){if(0!==this._length){var e=this.peek();return this._remove(e),e}},e.prototype.remove=function(e){this.contains(e)&&this._remove(e)},e.prototype._add=function(e){this._items.push(e),this._itemSet.add(e),this._length++},e.prototype._remove=function(e){this._itemSet.delete(e),this._items.splice(this._items.indexOf(e),1),this._length--},e}()}.apply(null,i))||(e.exports=n)},1558:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(88),r(1603)],void 0===(n=function(e,t,r,i){function n(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function s(e,t){a(e,0,e.children.length,t,e)}function a(e,t,r,i,n){n||(n=g(null,!0)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s=t,a=void 0;s<r;s++)a=e.children[s],o(n,e.leaf?i(a):a);return n}function o(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function l(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function c(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function d(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,s-i)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e,t){return{children:e,height:1,leaf:t,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,t,r,n,s){for(var a=[t,r];a.length;)if(!((r=a.pop())-(t=a.pop())<=n)){var o=t+Math.ceil((r-t)/n/2)*n;i(e,o,t,r,s),a.push(t,o,o,r)}}Object.defineProperty(t,"__esModule",{value:!0});var v=function(){function e(e,t){void 0===e&&(e=9),this.compareMinX=u,this.compareMinY=l,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}return e.prototype.destroy=function(){this.clear(),b.prune(),x.prune(),_.prune(),w.prune()},e.prototype.all=function(e){this._all(this.data,e)},e.prototype.search=function(e,t){var r=this.data,i=this.toBBox;if(f(e,r))for(b.clear();r;){for(var n=0,s=r.children.length;n<s;n++){var a=r.children[n],o=r.leaf?i(a):a;f(e,o)&&(r.leaf?t(a):y(e,o)?this._all(a,t):b.push(a))}r=b.pop()}},e.prototype.collides=function(e){var t=this.data,r=this.toBBox;if(!f(e,t))return!1;for(b.clear();t;){for(var i=0,n=t.children.length;i<n;i++){var s=t.children[i],a=t.leaf?r(s):s;if(f(e,a)){if(t.leaf||y(e,a))return!0;b.push(s)}}t=b.pop()}return!1},e.prototype.load=function(e,t){if(void 0===t&&(t=e.length),!t)return this;if(t<this._minEntries){for(var r=0,i=t;r<i;r++)this.insert(e[r]);return this}var n=this._build(e.slice(0,t),0,t-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var s=this.data;this.data=n,n=s}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data=g([],!0),this},e.prototype.remove=function(e,t){if(!e)return this;var r,i,s,a,o=this.data,u=this.toBBox(e);for(_.clear(),w.clear();o||_.length;){if(o||(o=_.pop(),r=_.data[_.length-1],i=w.pop(),s=!0),o.leaf&&-1!==(a=n(e,o.children,t)))return o.children.splice(a,1),_.push(o),this._condense(_),this;s||o.leaf||!y(o,u)?r?(i++,o=r.children[i],s=!1):o=null:(_.push(o),w.push(i),i=0,r=o,o=o.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return this.data=e,this},e.prototype._all=function(e,t){for(x.clear();e;){if(!0===e.leaf)for(var r=0,i=e.children;r<i.length;r++){t(i[r])}else x.pushArray(e.children);e=x.pop()}},e.prototype._build=function(e,t,r,i){var n,a=r-t+1,o=this._maxEntries;if(a<=o)return s(n=g(e.slice(t,r+1),!0),this.toBBox),n;i||(i=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,i-1))),(n=g([],!1)).height=i;var u=Math.ceil(a/o),l=u*Math.ceil(Math.sqrt(o));m(e,t,r,l,this.compareMinX);for(var p=t;p<=r;p+=l){var c=Math.min(p+l-1,r);m(e,p,c,u,this.compareMinY);for(var h=p;h<=c;h+=u){var d=Math.min(h+u-1,c);n.children.push(this._build(e,h,d,i-1))}}return s(n,this.toBBox),n},e.prototype._chooseSubtree=function(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){for(var n=1/0,s=1/0,a=void 0,o=0,u=t.children.length;o<u;o++){var l=t.children[o],c=p(l),d=h(e,l)-c;d<s?(s=d,n=c<n?c:n,a=l):d===s&&c<n&&(n=c,a=l)}t=a||t.children[0]}return t},e.prototype._insert=function(e,t,r){var i=this.toBBox,n=r?e:i(e);_.clear();var s=this._chooseSubtree(n,this.data,t,_);for(s.children.push(e),o(s,n);t>=0&&_.data[t].children.length>this._maxEntries;)this._split(_,t),t--;this._adjustParentBBoxes(n,_,t)},e.prototype._split=function(e,t){var r=e.data[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var a=this._chooseSplitIndex(r,n,i),o=g(r.children.splice(a,r.children.length-a),r.leaf);o.height=r.height,s(r,this.toBBox),s(o,this.toBBox),t?e.data[t-1].children.push(o):this._splitRoot(r,o)},e.prototype._splitRoot=function(e,t){this.data=g([e,t],!1),this.data.height=e.height+1,s(this.data,this.toBBox)},e.prototype._chooseSplitIndex=function(e,t,r){var i,n,s;i=n=1/0;for(var o=t;o<=r-t;o++){var u=a(e,0,o,this.toBBox),l=a(e,o,r,this.toBBox),c=d(u,l),h=p(u)+p(l);c<i?(i=c,s=o,n=h<n?h:n):c===i&&h<n&&(n=h,s=o)}return s},e.prototype._chooseSplitAxis=function(e,t,r){var i=e.leaf?this.compareMinX:u,n=e.leaf?this.compareMinY:l;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)},e.prototype._allDistMargin=function(e,t,r,i){e.children.sort(i);for(var n=this.toBBox,s=a(e,0,t,n),u=a(e,r-t,r,n),l=c(s)+c(u),p=t;p<r-t;p++){var h=e.children[p];o(s,e.leaf?n(h):h),l+=c(s)}for(p=r-t-1;p>=t;p--){h=e.children[p];o(u,e.leaf?n(h):h),l+=c(u)}return l},e.prototype._adjustParentBBoxes=function(e,t,r){for(var i=r;i>=0;i--)o(t.data[i],e)},e.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e.data[t].children.length?t>0?(r=e.data[t-1].children).splice(r.indexOf(e.data[t]),1):this.clear():s(e.data[t],this.toBBox)},e.prototype._initFormat=function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")},e}();t.PooledRBush=v;var b=new r,x=new r,_=new r,w=new r({deallocator:null});t.default=v}.apply(null,i))||(e.exports=n)},1574:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(17),r(21),r(0),r(49),r(572)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){var p=-.3*u.earthRadius;return function(e){function t(){var t=e.call(this)||this;return t.suspended=!0,t._frustumVisibilityDirty=!0,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new s,t.layerView=null,t}return r(t,e),Object.defineProperty(t.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(e){e!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new l.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,i=r.basemapTerrain,n=r.resourceController.scheduler;this.handles.add([r.on("resize",function(){return t.viewChange()}),r.state.watch("camera",function(){return t.viewChange()},!0),n.registerTask(6,function(){return t.update()},function(){return t.needsUpdate()}),i.on("elevation-bounds-change",function(){return t.elevationBoundsChange()})]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(a.init(i,["opacity","wireframe"],function(){return t.isVisibleBelowSurface=!i.isOpaque()}))},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this.frustumVisibilityDirty=!0},t.prototype.viewChange=function(){this.frustumVisibilityDirty=!0},t.prototype.elevationBoundsChange=function(){this.frustumVisibilityDirty=!0,this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this.frustumVisibilityDirty=!0,this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.frustumVisibilityDirty},t.prototype.update=function(){this.updateSuspendFrustumVisible(),this.frustumVisibilityDirty=!1},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=p;else{var r=t.basemapTerrain.getElevationBounds(),i=r[0],n=r[1];e=i-Math.max(1,(n-i)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.updateSuspendFrustumVisible=function(){if(this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},i([o.property({readOnly:!0})],t.prototype,"suspended",void 0),i([o.property({readOnly:!0})],t.prototype,"updating",null),i([o.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(o.declared(n))}.apply(null,i))||(e.exports=n)},1575:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2}.apply(null,i))||(e.exports=n)},1576:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(22),r(25),r(43),r(359),r(62),r(6),r(52),r(23),r(13),r(17),r(179),r(10),r(92),r(32),r(132),r(80),r(88),r(9),r(21),r(0),r(3),r(45),r(37),r(126),r(128),r(555),r(1577),r(81),r(560),r(573),r(178),r(570),r(1578),r(1579),r(571),r(72),r(181),r(51),r(137),r(85),r(375),r(368)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c,h,d,y,f,g,m,v,b,x,_,w,F,S,C,E,O,R,T,P,V,I,D,G,j,M,U,A,q,L,k,N,B,z,Q){var H=new a.Point,X=S.vec3f64.create(),Y=C.create(),W=f.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),J=function(e){function t(t){var r=e.call(this)||this;return r.propertiesPool=new N.PropertiesPool({computedExtent:a.Extent},r),r.computedExtent=null,r.currentRenderer=null,r.rendererHasGeometryOperations=!1,r.symbolCreationContext=new M.Graphics3DSymbolCreationContext,r.graphics=new Map,r.stageLayer=null,r.stage=null,r.graphicsDrapedUids=new Set,r.graphicsBySymbol=new Map,r.symbolConversionCache=new Map,r.symbols=new Map,r.graphicsWithoutSymbol={},r.graphicsWaitingForSymbol=new Set,r.lastFastUpdate=null,r.handles=new d,r.viewSR=null,r.elevationAlignment=null,r.scaleVisibility=null,r.filterVisibility=null,r.spatialIndex=null,r.deconfliction=null,r.labeling=null,r.highlights=null,r.viewElevationProvider=null,r.sharedSymbolResourcesOwnerHandle=null,r.whenGraphics3DGraphicRequests={},r.pendingUpdates=new Map,r.pendingAdds=0,r.pendingRemoves=0,r.pendingUpdatesPool=new x({allocator:function(e){return e||{add:null,remove:null}},deallocator:function(e){return e.add=null,e.remove=null,e}}),r.symbolWarningLogged=!1,r.geometryWarningLogged=!1,r.objectIdInvisibleSet=new Set,r._whenSymbolRemoved=new x,r.asyncUpdates=!1,r.elevationFeatureExpressionEnabled=!0,r.owner=null,r.layer=null,r.hasDraped=!1,r.graphicSymbolSupported=!0,r._usedMemory=0,r.numberOfGraphics=0,r._visible=void 0,r._startCreateGraphics=!1,r.maxPendingUpdates=0,r}var l;return r(t,e),l=t,Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsWaitingForSymbol.size>0||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayFeatureLimit",{get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfPrimitives:0,n=this.maxSymbolComplexity,s=Math.max(t,Math.min(r,Math.ceil(i/Math.max(1,n?n.primitivesPerFeature:1)))),a=this._get("displayFeatureLimit");return a&&a.minimumTotalNumberOfFeatures===t&&a.maximumTotalNumberOfFeatures===r&&a.maximumTotalNumberOfPrimitives===i&&a.maximumSymbolComplexity===n&&a.maximumNumberOfFeatures===s?a:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:r,maximumTotalNumberOfPrimitives:i,maximumSymbolComplexity:n,maximumNumberOfFeatures:s}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSymbolComplexity",{get:function(){for(var e=null,t=0,r=this.getSymbolComplexities();t<r.length;t++){var i=r[t];e?0===e.primitivesPerCoordinate&&i.primitivesPerFeature>e.primitivesPerFeature?e=i:0!==e.primitivesPerCoordinate&&i.primitivesPerCoordinate>e.primitivesPerCoordinate&&(e=i):e=i}var n=this._get("maxSymbolComplexity");return!e||n&&n.primitivesPerFeature===e.primitivesPerFeature&&n.primitivesPerCoordinate===e.primitivesPerCoordinate?n:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0}),t.prototype.getSymbolComplexities=function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},t.prototype.getConvertedSymbol=function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var r=I.to3D(e,!0,!1,this.hasLabelingContext(e)),i=r.symbol||null;return i||r.error&&W.error(r.error.message),this.symbolConversionCache.set(e.id,i),i},t.prototype.getSymbolComplexitiesUsedOrRenderer=function(e){var t=e.getSymbols();if(!t||!t.length)return[];for(var r=[],i=0,n=t;i<n.length;i++){var s=n[i],a=this.symbols.get(s.id);if(a)r.push(a.complexity);else{var o=this.getConvertedSymbol(s);o&&r.push(L.defaultSymbolComplexity(o))}}return r},t.prototype.getSymbolComplexitiesUsed=function(){var e=[];return this.symbols.forEach(function(t){t&&e.push(t.complexity)}),e},t.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference},t.prototype.setup=function(e){var t=this;this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("filterVisibility",e.filterVisibility),this._set("spatialIndex",e.spatialIndex),this._set("deconfliction",e.deconfliction),this._set("labeling",e.labeling),this._set("highlights",e.highlights);var r=this.owner.view;this.viewElevationProvider=new D.ViewElevationProvider(this.viewSR,r),this.initializeStage(r,this.layer.uid),this.symbolCreationContext.sharedResources=r.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=r.sharedSymbolResources.addGraphicsOwner(this.owner),this.symbolCreationContext.renderer=this.currentRenderer,this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataSupplier=r.sharedSymbolResources.streamDataSupplier,this.symbolCreationContext.renderSpatialReference=r.renderSpatialReference,this.symbolCreationContext.renderCoordsHelper=r.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.layerOrder=0,this.symbolCreationContext.localOriginFactory=new z,this.symbolCreationContext.elevationProvider=r.elevationProvider,this.symbolCreationContext.isAsync=this.asyncUpdates;var i=G.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=G.createContext(i,this.viewSR,W),this.symbolCreationContext.screenSizePerspectiveEnabled=r.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.handles.add(this.owner.watch("suspended",function(){return t.updateLayerVisibility()}));var n="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this.handles.add([this.owner.watch(n,function(){var e=r.screenSizePerspectiveEnabled&&t.layer.screenSizePerspectiveEnabled;e!==t.symbolCreationContext.screenSizePerspectiveEnabled&&(t.symbolCreationContext.screenSizePerspectiveEnabled=e,t.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",function(e){return t.slicePlaneEnabledChange(!!e)}),this.owner.view.watch("pixelRatio",function(e){return t.pixelRatioChange(e)}),w.when(r.basemapTerrain,"tilingScheme",function(e){e.spatialReference.equals(t.symbolCreationContext.overlaySR)||(t.symbolCreationContext.overlaySR=r.basemapTerrain.spatialReference),t.handles.has("loaded-graphics")?t.recreateAllGraphics():t.handles.add(w.on(t.owner,"loadedGraphics","change",function(e){return t.graphicsCollectionChanged(e)},function(){return t.recreateAllGraphics()}),"loaded-graphics")}),r.resourceController.scheduler.registerTask(3,function(e){return t.update(e)},function(){return t.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return t.deconfliction.featureReductionChange()})),this.rendererChange(this.layer.renderer),this.notifyChange("maxSymbolComplexity")},t.prototype.destroy=function(){for(var e in this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this.clear(),this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(B.ModelContentType.LAYER,this.stageLayer.id),this.stageLayer=null,this.stage=null),this.handles.destroy(),this.handles=null,this.viewSR=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new h("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear()},t.prototype.clear=function(){this.graphics.forEach(function(e){return e.destroy()}),this.spatialIndex&&this.spatialIndex.clear(),this.graphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach(function(e){e&&e.destroy()}),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol={},this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this.pendingAdds=0,this.pendingRemoves=0,this._set("hasDraped",!1),this.notifyChange("updating"),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.initializeStage=function(e,t){this.stage=e._stage,this.stageLayer=new Q(t,{isPickable:!this.owner.suspended},t),this.stage.add(B.ModelContentType.LAYER,this.stageLayer),this.stage.addToViewContent([this.stageLayer.id])},t.prototype.setDrawingOrder=function(e){this.symbolCreationContext.layerOrder=e;var t=new Set;this.symbols.forEach(function(r){r&&r.setDrawOrder(e,t)}),t.size>0&&this.stage.getDrapedRenderer().updateRenderOrder(t)},t.prototype.updateLayerVisibility=function(){var e=!!this.owner.suspended,t=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*ee,r=!e&&!t;r!==this._visible&&(this._visible=r,r?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())},t.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0}),t.prototype.getGraphics3DGraphicById=function(e){return this.graphics.get(e)},t.prototype._getGraphicObjectID=function(e,t){return void 0===t&&(t=this.owner.layer&&this.owner.layer.objectIdField),null!=e.objectId?e.objectId:t&&e.attributes[t]},Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){var e=this,t=this.owner.layer&&this.owner.layer.objectIdField;if(!t)return null;var r=new Map;return this.graphics.forEach(function(i){if(i){var n=i.graphic,s=e._getGraphicObjectID(n,t);m.isSome(s)&&r.set(s,i)}}),r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0}),t.prototype.updateLabelingInfo=function(e){var t=this.deconfliction&&this.deconfliction.labelingInfoChange(e),r=this.labeling&&this.labeling.labelingInfoChange(e);return _.all([t,r]).then()},t.prototype.updateVisibilityInfo=function(){this.deconfliction&&this.deconfliction.labelingInfoChange(),this.labeling&&this.labeling.visibilityInfoChange()},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,r=0;return y.everyMap(this.symbols,function(i,n){if(i){var s=i.getFastUpdateStatus();if(s.loading>0)return!1;e.graphicsBySymbol.has(n)&&(r+=s.fast,t+=s.slow)}})?r>=0&&0===t?"fast":t>=0&&0===r?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.pendingUpdates.size>0||!!this.lastFastUpdate&&v()-this.lastFastUpdate>500},t.prototype.update=function(e){var t=this.needsUpdate();this._applyPendingUpdates(e),!e.done&&this.lastFastUpdate&&(this.lastFastUpdate=null),t!==this.needsUpdate()&&this.notifyChange("updating")},t.prototype.setObjectIdVisibility=function(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);var r=this._findGraphics3DGraphicByObjectId(e);m.isSome(r)&&this._updateUserVisibility(r)},t.prototype._findGraphics3DGraphicByObjectId=function(e){var t,r=this;return y.everyMap(this.graphics,function(i){return r._getGraphicObjectID(i.graphic)!==e||(t=i,!1)}),t},t.prototype._updateUserVisibility=function(e){if(m.isNone(e))return!1;var t=e.graphic,r=this._getGraphicObjectID(t),i=t.visible&&!this.owner.suspended&&(m.isNone(r)||!this.objectIdInvisibleSet.has(r));return e.setVisibilityFlag(0,i,0)},t.prototype.whenGraphics3DGraphic=function(e){var t=this.graphics.get(e.uid);if(t)return _.resolve(t);var r=this.whenGraphics3DGraphicRequests[e.uid];if(r)return r.promise;var i=_.createDeferred();return this.whenGraphics3DGraphicRequests[e.uid]=i,i.promise},t.prototype.boundsForGraphics3DGraphic=function(e,t){return s(this,void 0,void 0,function(){var r,i,s,a,o,u,l,p,c,h;return n(this,function(n){switch(n.label){case 0:return r=this.owner.view.spatialReference,i=this.owner.view.renderSpatialReference,s=this.owner.view.basemapTerrain.spatialReference,a=function(e,t,n){return k.bufferToBuffer(e,i,t,e,r,t,n)},o=function(e,t,i){return k.bufferToBuffer(e,s,t,e,r,t,i)},u=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:t&&t.useViewElevation,minDemResolution:t&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,e.getProjectedBoundingBox(a,o,u)];case 1:return(l=n.sent())?(p=l.boundingBox,l.requiresDrapedElevation&&(c=this.symbolCreationContext.elevationProvider)&&(C.center(p,X),H.x=X[0],H.y=X[1],H.z=void 0,H.spatialReference=r,h=c.getElevation(H)||0,p[2]=Math.min(p[2],h),p[5]=Math.max(p[5],h)),[2,{boundingBox:p,screenSpaceObjects:l.screenSpaceObjects}]):[2,null]}})})},t.prototype.whenGraphicBounds=function(e,t){var r=this;return w.whenOnce(this.owner,"loadedGraphics").then(function(){var t=r.owner.layer&&r.owner.layer.objectIdField,i=r.owner.loadedGraphics.find(function(r){return r===e||t&&r.attributes&&e.attributes&&r.attributes[t]===e.attributes[t]});if(i)return r.whenGraphics3DGraphic(i);throw new h("internal:graphic-not-part-of-view","Graphic is not part of this view")}).then(function(e){return r.boundsForGraphics3DGraphic(e,t)})},t.prototype.whenSymbolLayerSize=function(e,t){return s(this,void 0,void 0,function(){var r,i,s;return n(this,function(n){if(null==(r=this.symbols.get(e.id)))throw new h("internal:symbol-not-part-of-view","Symbol is not part of this view");if(-1===(i=e.symbolLayers.indexOf(t)))throw new h("internal:missing-symbol-layer","Symbol layer is not in symbol");return s=_.createResolver(),r.getSymbolLayerSize(i,function(e){null==e?s.reject(new h("internal:missing-size","Symbol layer has no valid size")):s(e)}),[2,s.promise]})})},t.prototype.graphicsCollectionChanged=function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))},t.prototype.graphicUpdateHandler=function(e){var t=e.graphic.uid,r=this.graphics.get(t),i=this.graphicsWithoutSymbol[t];if(r||i)switch(e.property){case"visible":this.graphicUpdateVisibleHandler(r,e);break;case"geometry":this.graphicUpdateGeometryHandler(r,e);break;case"symbol":this.graphicUpdateSymbolHandler(r,e);break;case"attributes":break;default:c.neverReached(e)}},t.prototype.graphicUpdateGeometryHandler=function(e,t){var r=t.graphic.geometry;if(r)if(m.isNone(e)){var i=t.graphic.symbol&&t.graphic.symbol.id;if(i){var n=this.symbols.get(i);if(n&&!n.isFulfilled())return}this.recreateGraphic(t.graphic)}else e.graphics3DSymbol.updateGeometry(e,t.newValue)||this.recreateGraphic(e.graphic),this.expandComputedExtent(r);else this.recreateGraphic(t.graphic)},t.prototype.graphicUpdateSymbolHandler=function(e,t){var r=t.graphic,i=m.isSome(e)?e.graphics3DSymbol:t.oldValue&&this.symbols.get(t.oldValue.id);if(i){var n=i.symbol,s=this.getConvertedSymbol(t.newValue);if(s.type===n.type&&"web-style"!==s.type&&"web-style"!==n.type){var a=this.graphicsBySymbol.get(n.id);if(a&&1!==a.size)this.recreateGraphic(r);else{var o=T.diff(n,s);if(m.isNone(o))this.updateSymbolMapping(n.id,s);else{var u={diff:o,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(i.prepareSymbolPatch(u),T.isEmpty(u.diff)){for(var l=0,p=u.symbolStatePatches;l<p.length;l++){(0,p[l])()}var c=this._getRenderingInfo(r);if(m.isSome(e))for(var h=0,d=u.graphics3DGraphicPatches;h<d.length;h++){(0,d[h])(e,c)}this.updateSymbolMapping(n.id,s)}else this.recreateGraphic(r)}}}else this.recreateGraphic(r)}else this.recreateGraphic(r)},t.prototype.graphicUpdateVisibleHandler=function(e,t){var r=this._updateUserVisibility(e);r&&this.labeling&&(this.lastFastUpdate=v(),this.owner.view.labeler.setDirty()),r&&this.owner.view.deconflictor.setDirty()},t.prototype.recreateGraphic=function(e){var t=[e];this.remove(t),this.add(t)},t.prototype._beginGraphicUpdate=function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)},t.prototype._endGraphicUpdate=function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))},t.prototype.expandComputedExtent=function(e){var t=Y,r=e.spatialReference;R.computeAABB(e,t);var i=this.viewSR,n=l.tmpVec;if(r.equals(i)||k.xyzToVector(t[0],t[1],0,r,n,i)&&(t[0]=n[0],t[1]=n[1],k.xyzToVector(t[3],t[4],0,r,n,i),t[3]=n[0],t[4]=n[1]),g.isFinite(t[0])&&g.isFinite(t[3])&&g.isFinite(t[1])&&g.isFinite(t[4])){var s=this.computedExtent,a=null,o=g.isFinite(t[2])&&g.isFinite(t[5]),u=o&&(!s||null==s.zmin||t[2]<s.zmin),p=o&&(!s||null==s.zmax||t[5]>s.zmax);s?(t[0]<s.xmin||t[1]<s.ymin||t[3]>s.xmax||t[4]>s.ymax||u||p)&&((a=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],s.xmin),a.ymin=Math.min(t[1],s.ymin),a.xmax=Math.max(t[3],s.xmax),a.ymax=Math.max(t[4],s.ymax),a.spatialReference=i):((a=this.propertiesPool.get("computedExtent")).xmin=t[0],a.ymin=t[1],a.xmax=t[3],a.ymax=t[4],a.spatialReference=i),a&&(u&&(a.zmin=t[2]),p&&(a.zmax=t[5]),this._set("computedExtent",a))}},t.prototype.updateHasDraped=function(){var e=this.graphicsDrapedUids.size>0;this._set("hasDraped",e)},t.prototype.elevationInfoChange=function(){var e=this,t=G.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=G.createContext(t,this.viewSR,W),this.labeling&&this.labeling.elevationInfoChange(),this.forEachGraphics3DSymbol(function(t,r,i){t.globalPropertyChanged("elevationInfo",r)?r.forEach(function(e){for(var t=e.graphic,r=e._labelGraphics,i=0;i<r.length;i++){var n=r[i];n.graphics3DSymbolLayer.updateGraphicElevationContext(t,n)}}):e._recreateSymbol(i)}),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()},t.prototype.clearSymbolsAndGraphics=function(){this.clear(),this.filterVisibility&&this.filterVisibility.clear(),this.labeling&&this.labeling.reset(),this.deconfliction&&this.deconfliction.clear(),this.elevationAlignment&&this.elevationAlignment.clear(),this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()},t.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0,this.recreateAllGraphics()},t.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))},t.prototype._recreateSymbol=function(e){var t=this,r=[];this.graphicsBySymbol.get(e).forEach(function(e,i){var n=e.usedMemory;t._conditionalRemove(e,i),t.spatialIndex&&t.spatialIndex.remove(e),r.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(i,n),t.updateLayerVisibility()}),this.graphicsBySymbol.set(e,new Map);var i=this.symbols.get(e);i&&i.destroy(),this.symbols.delete(e),this.updateHasDraped(),this.add(r)},t.prototype._conditionalRemove=function(e,t){e.isDraped()&&this.graphicsDrapedUids.delete(t),this.highlights&&this.highlights.removeGraphic(e),this.labeling&&this.labeling.removeGraphic(e),this.deconfliction&&this.deconfliction.removeGraphic(e)},t.prototype.add=function(e){if(e&&0!==e.length){if(!this.owner.view.basemapTerrain||!this.owner.view.basemapTerrain.tilingScheme)return void W.error("#add()","Cannot add graphics before terrain surface has been initialized");this.asyncUpdates?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")}},t.prototype._addImmediate=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,Z.clear();for(var r=0,i=e;r<i.length;r++){var n=i[r];this._startAddGraphic(n,Z)}Z.forEach(function(e){return t._finishAddGraphics(e)}),Z.clear(),this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty(),this._cleanupSymbols()},t.prototype._addDelayed=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=i.uid,s=this.pendingUpdates.get(n);if(s)s.add||this.pendingAdds++,s.add=i;else{var a=this.pendingUpdatesPool.pushNew();a.add=i,this.pendingAdds++,this.pendingUpdates.set(n,a)}}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.remove=function(e){this.asyncUpdates?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")},t.prototype._removeImmediate=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._removeGraphic(i)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype._removeDelayed=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=i.uid,s=this.pendingUpdates.get(n);if(s)s.add&&(s.remove?s.add=null:this.pendingUpdates.delete(n),this.pendingAdds--);else{var a=this.pendingUpdatesPool.pushNew();a.remove=i,this.pendingUpdates.set(n,a),this.pendingRemoves++}}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&W.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0},t.prototype._applyPendingUpdates=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var r=e.idleFrame?1e3:100,i=0;Z.clear(),y.everyMap(this.pendingUpdates,function(n,s){if(n.remove&&(t.pendingRemoves--,t._removeGraphic(n.remove)),n.add&&(t.pendingAdds--,t._startAddGraphic(n.add,Z)&&i++),t.pendingUpdates.delete(s),i>r&&(Z.forEach(function(e){return t._finishAddGraphics(e)}),Z.clear(),i=0),e.madeProgress(),e.done)return!1}),Z.forEach(function(e){return t._finishAddGraphics(e)}),Z.clear(),0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.updateHasDraped()},t.prototype._startAddGraphic=function(e,t){this.graphicsWithoutSymbol[e.uid]=e;var r=this._getRenderingInfo(e,W);if(!r)return!1;var i=r.symbol,n=this.getOrCreateGraphics3DSymbol(i,r.renderer);if(!n)return!1;this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var s={graphic:e,renderingInfo:r,layer:this.layer},a=n.symbol.id,o=t.get(a);if(o)o.graphics.push(s);else{var u=$.acquire();u.clear(),u.push(s),t.set(a,{asyncSymbol:n,graphics:u})}return!0},t.prototype._finishAddGraphics=function(e){var t=this,r=!1,i=function(t){t===e.asyncSymbol.symbol.id&&(r=!0)};this._whenSymbolRemoved.push(i),e.asyncSymbol.then(function(){t._whenSymbolRemoved.removeUnordered(i),K.clear();for(var n=0;n<e.graphics.length;n++){var s=e.graphics.data[n],a=s.graphic;if(!(r||e.asyncSymbol.destroyed||t.graphicSymbolSupported&&a.symbol&&a.symbol.id!==e.asyncSymbol.symbol.id)){if(t.graphicsWaitingForSymbol.has(a.uid)){var o=t.createGraphics3DGraphic(e.asyncSymbol,s);t.spatialIndex&&o&&K.push(o)}t._endGraphicUpdate(a)}--e.asyncSymbol.referenced}K.length>0&&(t.spatialIndex.addMany(K.data,K.length),K.clear()),e.graphics.clear(),$.release(e.graphics),t.labeling&&(t.lastFastUpdate=v(),t.owner.view.labeler.setDirty())},function(){if(t._whenSymbolRemoved.removeUnordered(i),!r&&!e.asyncSymbol.destroyed)for(var n=0;n<e.graphics.length;n++)t._endGraphicUpdate(e.graphics.data[n].graphic);e.graphics.clear(),$.release(e.graphics)})},t.prototype._removeGraphic=function(e){var t=e.uid,r=this.graphics.get(t);if(r){var i=r.usedMemory;this._conditionalRemove(r,t),this.spatialIndex&&this.spatialIndex.remove(r);var n=r.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(n).delete(t),delete this.graphicsWithoutSymbol[t],this.removeGraphics3DGraphic(t,i),r.destroy()}else delete this.graphicsWithoutSymbol[t],this.graphicsWaitingForSymbol.delete(t)},t.prototype.hasLabelingContext=function(e){if(e instanceof u.LabelSymbol3D||e instanceof u.TextSymbol){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(function(t){return t.symbol===e})}return!1},t.prototype.hasValidSymbolCreationContext=function(e){return!(e instanceof u.LabelSymbol3D&&!this.hasLabelingContext(e)&&(W.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),1))},t.prototype._getRenderingInfo=function(e,t){if(!e.geometry)return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&e.symbol)return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;var r=this.rendererHasGeometryOperations?R.hydrateGraphic(e,this.layer):e,i=this.owner.getRenderingInfo(r,this.currentRenderer);return i&&i.symbol?i:(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null)},t.prototype.createGraphics3DSymbol=function(e,t){var r=this;if(!this.hasValidSymbolCreationContext(e))return null;var i,n=this.getConvertedSymbol(e);if(!n)return null;if(t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var s=I.to3D(t.backgroundFillSymbol,!1,!0);s.symbol&&"web-style"!==s.symbol.type&&(i=s.symbol.symbolLayers)}var a=U.make(n,this.symbolCreationContext,i);return a.then(function(){return r.notifyChange("maxSymbolComplexity")}),a},t.prototype.getOrCreateGraphics3DSymbol=function(e,t){var r=this,i=this.symbols.get(e.id);return void 0===i&&(i=e instanceof u.WebStyleSymbol?new A(e,function(e){return r.createGraphics3DSymbol(e,t)}):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,i)),i&&++i.referenced,i},t.prototype.addGraphics3DGraphic=function(e){this._usedMemory+=e.usedMemory,this.graphics.set(e.graphic.uid,e),this.numberOfGraphics++,this.updateLayerVisibility()},t.prototype.removeGraphics3DGraphic=function(e,t){this._usedMemory-=t,this.graphics.delete(e),this.numberOfGraphics--,this.updateLayerVisibility()},t.prototype.createGraphics3DGraphic=function(e,t){var r=t.graphic;if(delete this.graphicsWithoutSymbol[r.uid],this.symbols.has(e.symbol.id)){if(!this.graphics.has(r.uid)){var i=e.createGraphics3DGraphic(t),n=e.symbol.id;this.addGraphics3DGraphic(i),this.graphicsBySymbol.has(n)||this.graphicsBySymbol.set(n,new Map),this.graphicsBySymbol.get(n).set(r.uid,i),i.initialize(this.stageLayer,this.stage),i.isDraped()&&(this.graphicsDrapedUids.add(r.uid),this._set("hasDraped",!0)),i.centroid=null,"point"!==r.geometry.type&&i instanceof j&&(i.centroid=q.computeCentroid(r.geometry,this.viewSR)),this._updateUserVisibility(i),this.deconfliction&&this.deconfliction.addGraphic(i),this.labeling&&this.labeling.addGraphic(i),this.scaleVisibility&&this.scaleVisibility.updateVisibility(i),this.filterVisibility&&this.filterVisibility.updateVisibility(i),this.highlights&&this.highlights.addGraphic(i),this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,i);var s=this.whenGraphics3DGraphicRequests[r.uid];return s&&(delete this.whenGraphics3DGraphicRequests[r.uid],s.resolve(i)),i}}else this.add([r])},t.prototype.rendererChange=function(e){var t=this;e!==this.currentRenderer&&(this.validateRenderer(e),V.hasGeometryOperations(e)?V.enableGeometryOperations().then(function(){t.layer.renderer===e&&t.currentRendererChange(e,!0)}):this.currentRendererChange(e,!1))},t.prototype.currentRendererChange=function(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t;var r=this.symbolCreationContext.renderer;if(e!==r){this.symbolConversionCache.clear();var i=T.diff(r,e);this.updateUnchangedSymbolMappings(i,e,r),this.symbolCreationContext.renderer=e,m.isNone(i)||("complete"===i.type?this.recreateAllGraphics():"partial"===i.type&&(this.applyRendererDiff(i,e,r)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}},t.prototype.diffHasSymbolChange=function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1},t.prototype.applySymbolSetDiff=function(e,t,r,i){var n=this;e=e||[];for(var s=[],a=this,o=0,u=t=t||[];o<u.length;o++){!function(t){var i=a.graphicsBySymbol.get(t.id);i&&i.forEach(function(a,o){var u=a.graphic,l=n.layer instanceof O?n.layer:null;if(t!==r.defaultSymbol||r.getSymbol(R.hydrateGraphic(u,l))!==r.defaultSymbol){var p=a.usedMemory;e.length||r.defaultSymbol?s.push(u):n.graphicsWithoutSymbol[o]=u;var c=n.graphics.get(o);n._conditionalRemove(c,o),a.destroy(),i.delete(o),n.removeGraphics3DGraphic(o,p),n.updateLayerVisibility()}}),a._whenSymbolRemoved.forEach(function(e){return e(t.id)})}(u[o])}if(e.length||s.length){for(var l in this.graphicsWithoutSymbol)s.push(this.graphicsWithoutSymbol[l]);this.graphicsWithoutSymbol={},this.add(s)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype.applyUniqueValueRendererDiff=function(e,t,r){var i=e.diff.defaultSymbol,n=e.diff.uniqueValueInfos;if(i||n){var s=n?n.added.map(function(e){return e.symbol}):[],a=n?n.removed.map(function(e){return e.symbol}):[];if(n)for(var o=0;o<n.changed.length;o++)s.push(n.changed[o].newValue.symbol),a.push(n.changed[o].oldValue.symbol);return i?(r.defaultSymbol&&a.push(r.defaultSymbol),t.defaultSymbol&&s.push(t.defaultSymbol)):r.defaultSymbol&&s.length&&a.push(t.defaultSymbol),this.applySymbolSetDiff(s,a,t,r),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1},t.prototype.calculateUnchangedSymbolMapping=function(e,t,r){if(t instanceof o.UniqueValueRenderer&&r instanceof o.UniqueValueRenderer&&(m.isNone(e)||"partial"===e.type)){var i=e&&e.diff,n=i&&i.defaultSymbol,s=i&&i.uniqueValueInfos,a=void 0;return a=s?s.unchanged.map(function(e){return{oldId:e.oldValue.symbol.id,newId:e.newValue.symbol.id}}):r.uniqueValueInfos.map(function(e,r){return{oldId:e.symbol.id,newId:t.uniqueValueInfos[r].symbol.id}}),!n&&r.defaultSymbol&&a.push({oldId:r.defaultSymbol.id,newId:t.defaultSymbol.id}),a}return[]},t.prototype.updateSymbolMapping=function(e,t){var r="string"==typeof t?t:t.id,i="string"==typeof t?null:t;if(e&&e!==r){var n=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==n&&this.graphicsBySymbol.set(r,n);var s=this.symbols.get(e);this.symbols.delete(e),void 0!==s&&(this.symbols.set(r,s),i?s.symbol=i:s.symbol.id=r)}},t.prototype.updateUnchangedSymbolMappings=function(e,t,r){for(var i=0,n=this.calculateUnchangedSymbolMapping(e,t,r);i<n.length;i++){var s=n[i],a=s.oldId,o=s.newId;this.updateSymbolMapping(a,o)}},t.prototype.applyRendererDiff=function(e,t,r){var i=this;return!this.diffHasSymbolChange(e)&&(!!(t instanceof o.UniqueValueRenderer&&r instanceof o.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(e,t,r)&&0===Object.keys(e.diff).length)||y.everyMap(this.graphicsBySymbol,function(r,n){var s=i.symbols.get(n);if(s&&!s.applyRendererDiff(e,t))return!1}))},t.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(e){return e.globalPropertyChanged("opacity")}),this.updateStageLayerVisibility()},t.prototype.slicePlaneEnabledChange=function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol(function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)}),this.deconfliction&&this.deconfliction.slicePlaneEnabledChange(),this.labeling&&this.labeling.slicePlaneEnabledChange())},t.prototype.pixelRatioChange=function(e){var t=this;this.forEachGraphics3DSymbol(function(e,r,i){e.globalPropertyChanged("pixelRatio",r)||t._recreateSymbol(i)})},t.prototype.setClippingExtent=function(e,t){var r=this.symbolCreationContext.clippingExtent,i=E.create();return k.extentToBoundingRect(e,i,t)?this.symbolCreationContext.clippingExtent=[i[0],i[1],-1/0,i[2],i[3],1/0]:this.symbolCreationContext.clippingExtent=null,!p.equals(this.symbolCreationContext.clippingExtent,r)},t.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype.forEachGraphics3DGraphic=function(e){var t=this;if(this.owner.loadedGraphics){var r=!1;this.owner.loadedGraphics.forEach(function(i){var n=t.getGraphics3DGraphicById(i.uid);n&&e(n,i)&&(r=!0)}),r&&this.notifyVisibilityChanged()}},t.prototype.forEachGraphics3DSymbol=function(e){var t=this;this.graphicsBySymbol.forEach(function(r,i){var n=t.symbols.get(i);n&&e(n,r,i)})},t.prototype.updateAllGraphicsVisibility=function(){var e=this;this.filterVisibility&&(this.filterVisibility.dirty=!0),this.forEachGraphics3DGraphic(function(t){var r=e._updateUserVisibility(t),i=e.scaleVisibility&&e.scaleVisibility.updateVisibility(t);return r||i})},t.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(e){return e.setVisibilityFlag(0,!1,0)})},t.prototype.validateRenderer=function(e){var t=P.validateTo3D(e);if(t){var r="Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView";W.warn(r,t.message)}},t.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=v(),this.labeling.reset()),this.stageLayer.invalidateSpatialQueryAccelerator(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")},t.prototype._cleanupSymbols=function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0)){var t=!1;this.symbols.forEach(function(r,i){if(r&&!(r.referenced>0)){var n=e.graphicsBySymbol.get(i);n&&0!==n.size||(e.graphicsBySymbol.delete(i),e.symbols.delete(i),r&&r.destroy(),t=!0)}}),t&&this.notifyChange("maxSymbolComplexity")}},t.prototype.snapshotInternals=function(){var e=this;return{graphics:p.keysOfMap(this.graphics).sort(),symbols:p.keysOfMap(this.symbols).sort(),graphicsBySymbol:p.keysOfMap(this.graphicsBySymbol).sort().map(function(t){return{symbolId:t,graphics:p.keysOfMap(e.graphicsBySymbol.get(t)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:p.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}},Object.defineProperty(t.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility}},enumerable:!0,configurable:!0}),t.prototype.getStats=function(){return{coreVisible:this.graphics.size,coreMissing:Object.keys(this.graphicsWithoutSymbol).length,corePending:this.pendingUpdates.size}},t.tmpVec=S.vec3f64.create(),i([F.property({readOnly:!0})],t.prototype,"computedExtent",void 0),i([F.property()],t.prototype,"currentRenderer",void 0),i([F.property()],t.prototype,"rendererHasGeometryOperations",void 0),i([F.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),i([F.property({readOnly:!0})],t.prototype,"scaleVisibility",void 0),i([F.property({readOnly:!0})],t.prototype,"filterVisibility",void 0),i([F.property({readOnly:!0})],t.prototype,"spatialIndex",void 0),i([F.property({readOnly:!0})],t.prototype,"deconfliction",void 0),i([F.property({readOnly:!0})],t.prototype,"labeling",void 0),i([F.property({readOnly:!0})],t.prototype,"highlights",void 0),i([F.property()],t.prototype,"asyncUpdates",void 0),i([F.property({constructOnly:!0})],t.prototype,"elevationFeatureExpressionEnabled",void 0),i([F.property({constructOnly:!0})],t.prototype,"owner",void 0),i([F.property({constructOnly:!0})],t.prototype,"layer",void 0),i([F.property({readOnly:!0})],t.prototype,"hasDraped",void 0),i([F.property({readOnly:!0})],t.prototype,"symbolsUpdating",void 0),i([F.property({constructOnly:!0})],t.prototype,"graphicSymbolSupported",void 0),i([F.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating"]})],t.prototype,"updating",null),i([F.property({readOnly:!0})],t.prototype,"updatingRemaining",null),i([F.property({readOnly:!0})],t.prototype,"updatingTotal",null),i([F.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],t.prototype,"displayFeatureLimit",null),i([F.property({readOnly:!0})],t.prototype,"maxSymbolComplexity",null),l=i([F.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],t)}(F.declared(l)),Z=new Map,K=new x,$=new b(x),ee=10;return J}.apply(null,i))||(e.exports=n)},1577:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(13),r(560)],void 0===(n=function(e,t,r,i){function n(e,t){if(!t)return null;var i;if((i=Array.isArray(t)?t:[t]).length>0){var n=i.map(function(e){return e.details.symbol.type||e.details.symbol.declaredClass}).filter(function(e){return!!e});n.sort();var s=[];return n.forEach(function(e,t){0!==t&&e===n[t-1]||s.push(e)}),new r("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+s.join(", ")+") which are not supported in 3D",{renderer:e,symbolErrors:i})}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.validateTo3D=function(e){return e?function(e){return"simple"===e.type}(e)?function(e){return n(e,i.to3D(e.symbol).error)}(e):function(e){return"unique-value"===e.type}(e)?function(e){var t=e.uniqueValueInfos.map(function(e){return i.to3D(e.symbol).error}).filter(function(e){return!!e}),r=i.to3D(e.defaultSymbol);return r.error&&t.unshift(r.error),n(e,t)}(e):function(e){return"class-breaks"===e.type}(e)?function(e){var t=e.classBreakInfos.map(function(e){return i.to3D(e.symbol).error}).filter(function(e){return!!e}),r=i.to3D(e.defaultSymbol);return r.error&&t.unshift(r.error),n(e,t)}(e):new r("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(e.type||e.declaredClass)+"'",{renderer:e}):null}}.apply(null,i))||(e.exports=n)},1578:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.sharedResources=null,this.streamDataSupplier=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.layerOrder=null,this.layerOrderDelta=null,this.clippingExtent=null,this.renderSpatialReference=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.isAsync=!1}}();t.Graphics3DSymbolCreationContext=r}.apply(null,i))||(e.exports=n)},1579:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1580),r(561)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.make=function(e,t,n){var s;switch(e.type){case"point-3d":s=r;break;default:s=i}return new s(e,t,n)}}.apply(null,i))||(e.exports=n)},1580:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(569),r(561)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t,r,n){var s=e.call(this,t,r,n)||this;return s.calloutSymbolLayer=null,s.symbol.hasVisibleCallout()&&(s.calloutSymbolLayer=i.make(s.symbol,r)),s}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.createGraphics3DGraphic=function(t,r,i){var n=e.prototype.createGraphics3DGraphic.call(this,t,i);if(this.calloutSymbolLayer){var s=this.createCalloutGraphic(t);s&&n.addAuxiliaryGraphic(s)}return n},t.prototype.globalPropertyChanged=function(t,r){var i=this;if(!e.prototype.globalPropertyChanged.call(this,t,r))return!1;if(this.calloutSymbolLayer){return this.calloutSymbolLayer.globalPropertyChanged(t,r,function(e){for(var t=0,r=e._auxiliaryGraphics;t<r.length;t++){var n=r[t];if(n.graphics3DSymbolLayer===i.calloutSymbolLayer)return n}})}return!0},t.prototype.createCalloutGraphic=function(e){var t=e.renderingInfo,r={renderer:t.renderer,symbol:t.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return e.renderingInfo=r,this.calloutSymbolLayer.createGraphics3DGraphic(e)},t}(n)}.apply(null,i))||(e.exports=n)},1581:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(17),r(88),r(0),r(37)],void 0===(n=function(e,t,r,i,n,s,a,o,u){var l=function(){function e(){this.extents=new a({allocator:function(e){return e||u.create()}}),this.tempExtent=u.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"length",{get:function(){return this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),u.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&(this.mergeTight(),this.dirty=!1),this.extents.pop()},e.prototype.mergeTight=function(){for(var e=this.extents,t=this.tempExtent,r=!1;!r;){r=!0;for(var i=0;i<e.length;++i)if(function(r){for(var i=e.data[r],n=u.area(i),s=!1,a=e.length-1;a>r;--a){var o=e.data[a],l=u.area(o);u.expand(i,o,t);var p=n+l;(u.area(t)-p)/p<.05&&(u.set(i,t),n=u.area(i),e.swapElements(a,e.length-1),e.pop(),s=!0)}return s}(i)){r=!1;break}}},e.prototype.contains=function(e){return this.extents.some(function(t){return u.contains(t,e)})},e.prototype.removeContained=function(e){for(var t=this.extents.length-1;t>=0;--t)u.contains(e,this.extents.data[t])&&this.extents.removeUnorderedIndex(t)},e}();return function(e){function t(){var t=e.call(this)||this;return t.dirtyExtents=new l,t.globalDirty=!1,t.dirtyGraphicsQueue=new a({deallocator:null}),t.handles=new s,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t}return r(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=r,this.elevationProvider=i;var s=this.layerView.view.resourceController.scheduler;this.handles.add([i.on("elevation-change",function(e){return n.elevationUpdateHandler(e)}),this.layerView.watch("suspended",function(){return n.suspendedChange()}),s.registerTask(12,function(e){return n.update(e)},function(){return n.needsUpdate()})])},t.prototype.destroy=function(){this.dirtyGraphicsQueue=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsQueue.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsQueue.length>0||this.dirtyExtents.length>0||this.globalDirty},t.prototype.update=function(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress());this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this.layerView.view,r=this.graphicsCore.stageLayer.id,i=this.layerView.labeling;this.dirtyGraphicsQueue.length>0&&!e.done;){for(var n=Math.min(this.dirtyGraphicsQueue.length,100);n--&&!e.done;){var s=this.dirtyGraphicsQueue.pop(),a=this.graphicsCore.getGraphics3DGraphicById(s);a&&a.alignWithElevation(this.elevationProvider,t.renderCoordsHelper),e.madeProgress()}t._stage.processDirtyLayer(r),i&&i.processStageDirty()}},t.prototype._updateDirtyExtents=function(e){for(var t=this;this.dirtyExtents.length>0&&this.dirtyGraphicsQueue.length<100&&!e.done;){var r=this.dirtyExtents.pop();this.queryGraphicUIDsInExtent(r,this.spatialReference,function(e){var r=t.graphicsCore.getGraphics3DGraphicById(e);r&&r.needsElevationUpdates()&&t.dirtyGraphicsQueue.push(e)}),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsQueue.clear(),this.graphicsCore.graphics3DGraphics.forEach(function(t,r){return e.dirtyGraphicsQueue.push(r)})},t.prototype.elevationUpdateHandler=function(e){var t=e.extent;if(this.layerView.suspended){if(!this.updateElevation){var r=this.graphicsCore.computedExtent;r&&t[2]>r.xmin&&t[0]<r.xmax&&t[3]>r.ymin&&t[1]<r.ymax&&(this.updateElevation=!0)}}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.spatialReference=e.spatialReference,this.notifyChange("updating")},i([o.property({readOnly:!0})],t.prototype,"updating",null),i([o.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(o.declared(n))}.apply(null,i))||(e.exports=n)},1582:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1583)],void 0===(n=function(e,t,r){return function(){function e(){this.graphicsCore=null,this.highlights=[]}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.setup=function(e){this.graphicsCore=e},e.prototype.acquireSet=function(e,t){var i=this,n=new r(e,t);return this.highlights.push(n),{set:n,handle:{remove:function(){return i.releaseSet(n)},pause:function(){n.highlightSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,i.initializeSet(n)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setUids=function(e,t){for(var r=this.graphicsCore.graphics3DGraphics,i=0,n=t;i<n.length;i++){var s=n[i];e.ids.add(s);var a=r.get(s);a&&a.addHighlight(e.highlightSet,e.options)}},e.prototype.setObjectIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.initializeSet(e)},e.prototype.addGraphic=function(e){this.highlights.forEach(function(t){!t.paused&&t.hasGraphic(e)&&e.addHighlight(t.highlightSet,t.options)})},e.prototype.removeGraphic=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.removeHighlight(t.highlightSet)})},e.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e.prototype.initializeSet=function(e){var t=this.graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(function(t){t&&e.hasGraphic(t)&&t.addHighlight(e.highlightSet,e.options)}):e.ids.forEach(function(r){var i=t.get(r);i&&i.addHighlight(e.highlightSet,e.options)})},e}()}.apply(null,i))||(e.exports=n)},1583:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1551)],void 0===(n=function(e,t,r){return function(){function e(e,t){this.highlightSet=new r,this.ids=new Set,this.paused=!1,this.options=e,this.objectIdField=t}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}()}.apply(null,i))||(e.exports=n)},1584:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(17),r(0)],void 0===(n=function(e,t,r,i,n,s,a){function o(e,t){return null!==e&&e>0&&e<8e7||t>50}return function(e){function t(){var t=e.call(this)||this;return t._scaleRangeActive=!1,t._layerScaleRangeVisibilityDirty=!0,t.layerScaleRangeVisibilityQuery=!1,t.scaleChangeEventHandle=null,t.handles=new s,t.layerView=null,t.layer=null,t.queryGraphicUIDsInExtent=null,t.extent=null,t.graphicsCore=null,t.basemapTerrain=null,t.suspended=!1,t}return r(t,e),Object.defineProperty(t.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},set:function(e){this._layerScaleRangeVisibilityDirty!==e&&(this._layerScaleRangeVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i,n){var s=this;this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=r,this.graphicsCore=i,this.basemapTerrain=n,this.updateScaleRangeActive();var a=this.layerView.view.resourceController.scheduler;this.handles.add(a.registerTask(6,function(){return s.update()},function(){return s.needsUpdate()}))},t.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),this.handles.destroy(),this.handles=null,this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null},t.prototype.needsUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.layerScaleRangeVisibilityDirty=!0},t.prototype.update=function(){this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1},t.prototype.scaleRangeActive=function(){return this._scaleRangeActive},t.prototype.updateScaleRangeActive=function(){var e=this,t=this.layer,r=o(t.minScale,t.maxScale);t.labelingInfo&&!r&&(r=t.labelingInfo.some(function(e){return e&&o(e.minScale,e.maxScale)}));var i=this._scaleRangeActive!==r;return this._scaleRangeActive=r,r&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(t){return e.scaleUpdateHandler(t)}):!r&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),i},t.prototype.updateSuspendScaleVisibleFinish=function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e)},t.prototype.updateSuspendScaleVisible=function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(t){return e.updateSuspendScaleVisibleFinish(t)})):this.updateSuspendScaleVisibleFinish(!0)},t.prototype.visibleAtScale=function(e,t,r){return null==e||e>r&&(!t||e<t)},t.prototype.visibleAtLayerScale=function(e){return this.visibleAtScale(e,this.layer.minScale,this.layer.maxScale)},t.prototype.visibleAtLabelScale=function(e,t){return this.visibleAtScale(e,t.minScale,t.maxScale)},t.prototype.graphicScale=function(e){var t;return e.centroid?t=e.centroid:"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null},t.prototype.graphicVisible=function(e){var t=this.graphicScale(e);return this.visibleAtLayerScale(t)},t.prototype.updateVisibility=function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t,0)}return!1},t.prototype.updateGraphicLabelScaleVisibility=function(e){if(!this._scaleRangeActive)return!1;if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var t=this.graphicScale(e),r=this.updateLabelScaleVisibility(e,t);return r&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),r},t.prototype.updateLabelScaleVisibility=function(e,t){if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var r=e._labelGraphics[0]._labelClass;if(r&&null!=r.minScale&&null!=r.maxScale){var i=this.visibleAtLabelScale(t,r);if(e.setVisibilityFlag(1,i,1))return!0}return!1},t.prototype.scaleUpdateHandler=function(e){var t=this;if(!this.layerView.suspended){var r=e.extent,i=e.scale,n=this.visibleAtLayerScale(i),s=!1;this.queryGraphicUIDsInExtent(r,e.spatialReference,function(e){var a=t.graphicsCore.getGraphics3DGraphicById(e);if(a){var o=a.centroid;if(o&&(r[0]>o.x||r[1]>o.y||r[2]<o.x||r[3]<o.y))return;var u=!1;a.setVisibilityFlag(1,n,0)&&(u=!0),t.updateLabelScaleVisibility(a,i)&&(u=!0),u&&(s=!0)}}),s&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=!0},t.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(e){return e.clearVisibilityFlag(1)})),this.layerScaleRangeVisibilityDirty=!0},i([a.property({readOnly:!0})],t.prototype,"suspended",void 0),i([a.property({readOnly:!0})],t.prototype,"updating",null),i([a.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],t)}(a.declared(n))}.apply(null,i))||(e.exports=n)},1585:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(19),r(88),r(0),r(1558)],void 0===(n=function(e,t,r,i,n,s,a,o,u){var l=function(e){function t(t){var r=e.call(this)||this;return r.index=new u.default(9,s("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),r.spatialReference=null,r}return r(t,e),t.prototype.destroy=function(){this.index.destroy(),this.index=null,p.prune()},t.prototype.queryGraphicUIDsInExtent=function(e,t,r){t.equals(this.spatialReference)&&(c.minX=e[0],c.minY=e[1],c.maxX=e[2],c.maxY=e[3],this.index.search(c,function(e){return r(e.graphic.uid)}))},t.prototype.add=function(e){!e.addedToSpatialIndex&&e.computeExtent(this.spatialReference)&&(this.index.insert(e),e.addedToSpatialIndex=!0)},t.prototype.addMany=function(e,t){void 0===t&&(t=e.length),p.clear();for(var r=0;r<t;r++){var i=e[r];!i.addedToSpatialIndex&&i.computeExtent(this.spatialReference)&&(p.push(i),i.addedToSpatialIndex=!0)}this.index.load(p.data,p.length)},t.prototype.remove=function(e){e.addedToSpatialIndex&&(e.addedToSpatialIndex=!1,this.index.remove(e))},t.prototype.clear=function(){this.index.clear()},i([o.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),i([o.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],t)}(o.declared(n)),p=new a,c={minX:0,minY:0,maxX:0,maxY:0};return l}.apply(null,i))||(e.exports=n)},1596:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];if(s.toLowerCase()===r)return e[s]}return null}}.apply(null,i))||(e.exports=n)},1636:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){if(!e||e.symbol)return null;var r=t.renderer;return e&&r&&r.getObservationRenderer?r.getObservationRenderer(e):r}function i(e,t){if(e.symbol)return e.symbol;var i=r(e,t);return i&&i.getSymbol(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderer=r,t.getSymbol=i,t.getRenderingInfo=function(e,t){var n=r(e,t),s=i(e,t);if(!s)return null;var a={renderer:n,symbol:s};if(!(n&&"visualVariables"in n&&n.visualVariables))return a;for(var o=["proportional","proportional","proportional"],u=0,l=n.getVisualVariableValues(e,t);u<l.length;u++){var p=l[u],c=p.variable,h=p.value;if("color"===c.type)a.color=h.toRgba();else if("size"===c.type)if("outline"===c.target)a.outlineSize=h;else{var d=c.axis,y=c.useSymbolValue?"symbolValue":h;"width"===d?o[0]=y:"depth"===d?o[1]=y:"height"===d?o[2]=y:o[0]=o[1]="width-and-depth"===d?y:o[2]=y}else"opacity"===c.type?a.opacity=h:"rotation"===c.type&&"tilt"===c.axis?a.tilt=h:"rotation"===c.type&&"roll"===c.axis?a.roll=h:"rotation"===c.type&&(a.heading=h)}return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(a.size=o),a}}.apply(null,i))||(e.exports=n)},1637:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(79),r(6),r(23),r(17),r(9),r(21),r(0),r(44),r(555),r(353),r(1575),r(1576),r(1581),r(1638),r(1574),r(1582),r(1584),r(1585),r(72),r(1596)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c,h,d,y,f,g,m,v,b,x,_,w,F){var S=function(e){function t(t){var r=e.call(this)||this;return r._handles=new o,r.highlights=new b,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return r(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=!e.queryGraphicUIDsInExtent&&(e.scaleVisibilityEnabled||e.elevationAlignmentEnabled)?new _({spatialReference:e.owner.view.spatialReference}):null,r=e.frustumVisibilityEnabled?new v:null,i=e.scaleVisibilityEnabled?new x:null,n=e.filterVisibilityEnabled&&"multipatch"!==e.layer.geometryType?new m.Graphics3DFilterVisibility({geometryType:e.layer.geometryType}):null,s=e.elevationAlignmentEnabled?new g:null,a=new f({owner:e.owner,layer:e.layer,asyncUpdates:e.asyncGraphicsUpdates,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1}),o=e.updateClippingExtent,u=e.queryGraphicUIDsInExtent,l=e.suspendResumeExtentMode,p=e.dataExtent;return{graphicsCore:a,frustumVisibility:r,scaleVisibility:i,filterVisibility:n,elevationAlignment:s,spatialIndex:t,updateClippingExtent:o,suspendResumeExtentMode:l,dataExtent:p,queryGraphicUIDsInExtent:u||function(e,r,i){return t.queryGraphicUIDsInExtent(e,r,i)}}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&this._handles.add(this.owner.watch("filter",function(){return e.filterVisibility.filterChanged()})),this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(t,r){h.diff(t,r)&&e.graphicsCore.elevationInfoChange()})),this._handles.add(this.layer.watch("labelsVisible",function(){return e.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(t,r){h.diff(t,r)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){var e=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var t=this.owner,r=this.owner.view.basemapTerrain;if(this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,r),this.filterVisibility&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment){var i=t.view.elevationProvider;this.elevationAlignment.setup(t,this.queryGraphicUIDsInExtent,this.graphicsCore,i)}return this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex)),this._set("deconfliction",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,spatialIndex:this.spatialIndex,deconfliction:this.deconfliction,labeling:this.labeling,highlights:this.highlights}),this._handles.add([this.layer.watch("renderer",function(t){return e.graphicsCore.rendererChange(t)}),t.watch("fullOpacity",function(){return e.graphicsCore.opacityChange()})]),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this._handles.add(t.view.watch("clippingArea",function(){return e._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():u.resolve()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","highlights","graphicsCore","spatialIndex"];e<t.length;e++){var r=t[e],i=this[r];i&&(i.destroy(),this._set(r,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t,r){var i=this;if(e instanceof d){var s=this.highlights.acquireSet(t,r),a=s.set,o=s.handle;return this.owner.queryObjectIds(e).then(function(e){return i.highlights.setObjectIds(a,e)}),o}if("number"==typeof e)return this.highlight([e],t,r);if(e instanceof n)return this.highlight([e],t,r);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof n){var u=e;if(!r||!u[0].attributes||null===F.attributeLookup(u[0].attributes,r)){var l=u.map(function(e){return e.uid}),p=this.highlights.acquireSet(t,null),c=p.set;o=p.handle;return this.highlights.setUids(c,l),o}e=u.map(function(e){return F.attributeLookup(e.attributes,r)})}if("number"==typeof e[0]){var h=e,y=this.highlights.acquireSet(t,r);c=y.set,o=y.handle;return this.highlights.setObjectIds(c,h),o}}return E},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(l.init(this,"suspendResumeExtentMode",function(){switch(e._handles.remove(C),e.suspendResumeExtentMode){case"computed":e._handles.add(l.init(e.graphicsCore,"computedExtent",function(t){return e.updateSuspendResumeExtent(t)}),C);break;case"data":e._handles.add(l.init(e,"dataExtent",function(t){return e.updateSuspendResumeExtent(t)}),C);break;default:a.neverReached(e.suspendResumeExtentMode)}}))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var r=this.owner.view.spatialReference;if(!e.spatialReference.equals(r)){if(!c.canProject(e,r))return;e=c.project(e,r)}return w.enlargeExtent(e,t,y.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},i([p.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),i([p.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),i([p.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),i([p.property({constructOnly:!0})],t.prototype,"queryGraphicUIDsInExtent",void 0),i([p.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),i([p.property({constructOnly:!0})],t.prototype,"spatialIndex",void 0),i([p.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),i([p.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),i([p.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),i([p.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),i([p.property({readOnly:!0})],t.prototype,"deconfliction",void 0),i([p.property({readOnly:!0})],t.prototype,"labeling",void 0),i([p.property({readOnly:!0})],t.prototype,"highlights",void 0),i([p.property()],t.prototype,"suspendResumeExtentMode",void 0),i([p.property()],t.prototype,"dataExtent",void 0),i([p.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),i([p.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating"]})],t.prototype,"updating",null),i([p.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(p.declared(s)),C="suspendResumeExtentMode",E={remove:function(){},pause:function(){},resume:function(){}};return S}.apply(null,i))||(e.exports=n)},1638:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(43),r(6),r(17),r(10),r(21),r(0),r(65),r(69),r(547),r(550),r(1544),r(1553)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c,h,d,y,f){Object.defineProperty(t,"__esModule",{value:!0});var g=o.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),m=function(e){function t(t){var r=e.call(this)||this;return r._dirty=!1,r._querying=!1,r._handles=new a,r}return r(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureGeometryType",{get:function(){switch(this.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.geometryType;case"mesh":case"extent":return"polygon"}},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var r=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,e.layer.timeInfo&&(this._timeInfo=e.layer.timeInfo.toJSON()),this._scheduler=this._layerView.view.resourceController.scheduler,this._handles.add(this._scheduler.registerTask(4,function(e){return r._update(e)},function(){return r._needsUpdate()})),this._handles.add(u.on(t.owner,"loadedGraphics","change",function(e){return r._graphicsChanged(e)},function(){return r.dirty=!0}))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine&&(this._queryEngine.destroy(),this._queryEngine=null,this._queryResult=null,this._store=null,this._querying=!1,this._core.forEachGraphics3DGraphic(function(e){return e.clearVisibilityFlag(2)})),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){if(this._queryEngine){if(e.removed&&e.removed.length>0){for(var t=new Array(e.removed.length),r=0;r<e.removed.length;++r)t[r]=e.removed[r].uid;this._store.removeManyById(t)}if(e.added&&e.added.length>0){var i=new Array(e.added.length);for(r=0;r<e.added.length;++r)i[r]=this._convertToOptimizedFeature(e.added[r]);this._store.addMany(i),this.dirty=!0}}else this.dirty=!0},t.prototype.updateVisibility=function(e){this._queryEngine&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){this.dirty=!0},Object.defineProperty(t.prototype,"active",{get:function(){return this._layerView.filter&&this._core.owner.loadedGraphics.length>0},enumerable:!0,configurable:!0}),t.prototype._ensureQueryEngine=function(e){var t=this;if(!this.active)return this.clear(),!1;if(this._queryEngine)return!0;var r,i=this._core.owner.loadedGraphics,s=n.featureGeometryTypeKebabDictionary.toJSON(this.featureGeometryType),a=new Array(i.length),o=0;return i.forEach(function(e){a[++o]=t._convertToOptimizedFeature(e),r=r||e.geometry.spatialReference}),this._store=new y.default({geometryType:s,hasM:!1,hasZ:!1}),this._store.addMany(a),this._queryEngine=new f.default({hasZ:!1,hasM:!1,geometryType:s,fields:[],timeInfo:this._timeInfo,spatialReference:r,objectIdField:this._objectIdField,featureStore:this._store,scheduler:this._scheduler,priority:4}),e.madeProgress(),!0},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;if(this._ensureQueryEngine(e)){if(this._dirty&&!this._querying&&!e.done){this._querying=!0,this.dirty=!1;var r=this._layerView.filter?this._layerView.filter.toJSON():{};this._queryEngine.executeQueryForIdSet(r).then(function(e){t._queryResult=e,t._querying=!1}).catch(function(e){g.warn("FeatureFilter query failed: "+e),t._queryResult=new Set,t._core.forEachGraphics3DGraphic(function(e){return t._queryResult.add(t._getFeatureId(e.graphic)),!1}),t._querying=!1}),e.madeProgress()}this._queryResult&&!e.done&&(this._core.forEachGraphics3DGraphic(function(r){if(e.done)return!1;var i=t._queryResult.has(t._getFeatureId(r.graphic));return!!r.setVisibilityFlag(2,i,0)&&(e.madeProgress(),!0)}),e.done||(this._queryResult=null)),this.notifyChange("updating")}else this.dirty=!1},t.prototype._convertToOptimizedFeature=function(e){var t=e.geometry;if("mesh"===t.type||"extent"===t.type){var r=p.fromExtent("mesh"===t.type?t.extent:t);return r.hasZ=!1,r.hasM=!1,new d.default(h.convertFromGeometry(r),e.attributes,null,this._getFeatureId(e))}return h.convertFromFeature(e,c.getJsonType(e.geometry),!1,!1,this._objectIdField)},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),i([l.property({readOnly:!0})],t.prototype,"updating",null),i([l.property({constructOnly:!0})],t.prototype,"geometryType",void 0),i([l.property({readOnly:!0,dependsOn:["geometryType"]})],t.prototype,"featureGeometryType",null),i([l.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(l.declared(s));t.Graphics3DFilterVisibility=m}.apply(null,i))||(e.exports=n)},1654:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(6),r(10),r(32),r(0),r(556),r(1693),r(1695)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p){var c=s.getLogger("esri.views.layers.support.FeatureEffect");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.filter=null,t.includedEffect=null,t.excludedEffect=null,t.excludedLabelsVisible=!1,t}var n;return i(t,e),n=t,Object.defineProperty(t.prototype,"insideEffect",{get:function(){return c.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead"),this.includedEffect},set:function(e){c.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead"),this.includedEffect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outsideEffect",{get:function(){return c.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead"),this.excludedEffect},set:function(e){c.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead"),this.excludedEffect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedIncludedEffect",{get:function(){return a.isSome(this.includedEffect)?"string"==typeof this.includedEffect?l.fromString(this.includedEffect):new p({from:l.fromString(this.includedEffect.from),to:l.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedExcludedEffect",{get:function(){return a.isSome(this.excludedEffect)?"string"==typeof this.excludedEffect?l.fromString(this.excludedEffect):new p({from:l.fromString(this.excludedEffect.from),to:l.fromString(this.excludedEffect.to),duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"done",{get:function(){return(!a.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!a.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})},r([o.property({type:u})],t.prototype,"filter",void 0),r([o.property({type:String})],t.prototype,"includedEffect",void 0),r([o.property({type:String})],t.prototype,"excludedEffect",void 0),r([o.property({type:Boolean})],t.prototype,"excludedLabelsVisible",void 0),r([o.property({dependsOn:["includedEffect"]})],t.prototype,"parsedIncludedEffect",null),r([o.property({dependsOn:["excludedEffect"]})],t.prototype,"parsedExcludedEffect",null),r([o.property({dependsOn:["includedEffect","excludedEffect"]})],t.prototype,"renderingHash",null),n=r([o.subclass("esri.views.layers.support.FeatureEffect")],t)}(o.declared(n))}.apply(null,i))||(e.exports=n)},1692:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(22),r(25),r(154),r(170),r(13),r(10),r(32),r(9),r(21),r(0),r(127),r(81),r(1508),r(1654),r(556),r(1526)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c,h,d,y,f,g,m,v,b,x){var _=p.getLogger("esri.views.layers.FeatureLayerView");return function(e){function t(t){var r=e.call(this,t)||this;return r.effect=null,r.filter=null,r.layer=null,r.requiredFields=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;d.init(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","filter","effect"],function(){return e._updateRequiredFields()})},Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=e.layer,r=e.layer.fields,i=e.requiredFields;return"outFields"in t&&t.outFields?f.fixFields(r,f.unpackFieldNames(r,t.outFields).concat(i)):f.fixFields(r,i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(e){_.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.highlight=function(e,t){return void 0===t&&(t={}),this.inherited(arguments)},t.prototype.queryFeatures=function(e){return this.inherited(arguments)},t.prototype.queryObjectIds=function(e){return this.inherited(arguments)},t.prototype.queryFeatureCount=function(e){return this.inherited(arguments)},t.prototype.queryExtent=function(e){return this.inherited(arguments)},t.prototype._updateRequiredFields=function(){return a(this,void 0,void 0,function(){var e,t,r,i,n,a,l,p,c,d,y,g,m;return s(this,function(s){switch(s.label){case 0:return this.layer&&this.view?(e="3d"===this.view.type,r=(t=this).layer,i=t.layer,n=i.fields,a=i.objectIdField,l=i.renderer,p=new u.default,[4,h.eachAlways([l?l.collectRequiredFields(p,n):null,f.collectLabelingFields(p,r),e?f.collectElevationFields(p,r):null,this.filter?f.collectFilterFields(p,r,this.filter):null,this.effect?f.collectFilterFields(p,r,this.effect.filter):null])]):[2];case 1:for(c=s.sent(),d=0,y=c;d<y.length;d++)(g=y[d]).error&&_.error(g.error);return f.collectField(p,n,a),m=o.from(p).sort(),this._set("requiredFields",m),[2]}})})},t.prototype.validateFetchPopupFeatures=function(e){var t=this.layer;return this.layer.popupEnabled?x.getFetchPopupTemplate(this.layer,e)?void 0:new l("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new l("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})},t.prototype.fetchClientPopupFeatures=function(e){return a(this,void 0,void 0,function(){var t,r,i,n,a,o,u,l,p,d,y;return s(this,function(s){switch(s.label){case 0:return(t=c.isSome(e)?e.clientGraphics:null)&&0!==t.length?(r=[],i=[],n=this.layer,a=x.getFetchPopupTemplate(n,e),c.isSome(a)?(o=g.hasGeometryOperations(a),[4,this.createPopupQuery(e)]):[2,h.resolve([])]):[2,h.resolve([])];case 1:for(u=s.sent(),l=f.unpackFieldNames(n.fields,u.outFields),p=0,d=t;p<d.length;p++)y=d[p],o||!f.featureHasFields(l,y)?i.push(y):r.push(y);return 0===i.length?[2,h.resolve(r)]:(u.objectIds=i.map(function(e){return e.attributes[n.objectIdField]}),[2,n.queryFeatures(u).then(function(e){return r.concat(e.features)}).catch(function(){return i})])}})})},t.prototype.createPopupQuery=function(e){return a(this,void 0,void 0,function(){var t,r,i;return s(this,function(n){switch(n.label){case 0:return t=this.layer,(r=t.createQuery()).returnGeometry=!0,r.returnZ=!0,r.returnM=!0,i=r,[4,x.getRequiredFields(this.layer,x.getFetchPopupTemplate(this.layer,e))];case 1:return i.outFields=n.sent(),r.outSpatialReference=this.view.spatialReference,[2,r]}})})},i([y.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],t.prototype,"availableFields",null),i([y.property({type:v})],t.prototype,"effect",void 0),i([y.property({type:b})],t.prototype,"filter",void 0),i([y.property()],t.prototype,"layer",void 0),i([y.property({type:Number})],t.prototype,"maximumNumberOfFeatures",null),i([y.property({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([y.property({readOnly:!0})],t.prototype,"requiredFields",void 0),i([y.property()],t.prototype,"view",void 0),i([y.subclass("esri.views.layers.FeatureLayerView")],t)}(y.declared(m))}.apply(null,i))||(e.exports=n)},1693:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(11),r(13),r(8),r(10),r(0),r(18),r(264),r(1694)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c){var h=o.getLogger("esri.views.layers.support.ParsedFeatureEffect"),d={grayscale:function(e){var t=1-e.amount,r=p.mat4f32.fromValues(.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,1);return l.mat4.transpose(r,r)},sepia:function(e){var t=1-e.amount,r=p.mat4f32.fromValues(.393+.607*t,.769-.769*t,.189-.189*t,0,.349-.349*t,.686+.314*t,.168-.168*t,0,.272-.272*t,.534-.534*t,.131+.869*t,0,0,0,0,1);return l.mat4.transpose(r,r)},saturate:function(e){var t=e.amount,r=p.mat4f32.fromValues(.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return l.mat4.transpose(r,r)},"hue-rotate":function(e){var t=Math.sin(e.angle*Math.PI/180),r=Math.cos(e.angle*Math.PI/180),i=p.mat4f32.fromValues(.213+.787*r-.213*t,.715-.715*r-.715*t,.072-.072*r+.928*t,0,.213-.213*r+.143*t,.715+.285*r+.14*t,.072-.072*r-.283*t,0,.213-.213*r-.787*t,.715-.715*r+.715*t,.072+.928*r+.072*t,0,0,0,0,1);return l.mat4.transpose(i,i)},invert:function(e){var t=e.amount,r=p.mat4f32.fromValues(-t,0,0,1,0,-t,0,1,0,0,-t,1,0,0,0,1);return l.mat4.transpose(r,r)},opacity:function(e){var t=e.amount,r=p.mat4f32.fromValues(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,t);return l.mat4.transpose(r,r)},brightness:function(e){var t=e.amount,r=p.mat4f32.fromValues(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return l.mat4.transpose(r,r)},contrast:function(e){var t=e.amount,r=p.mat4f32.fromValues(t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return l.mat4.transpose(r,r)}};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.customTransforms=null,t.done=!0,t}var a;return i(t,e),a=t,t.fromString=function(e){var t;try{t=c.parse(e)}catch(e){h.error(new s("invalid-type","Encountered an error when parsing css",e))}return new a({transforms:t})},t.prototype.getColorMatrix=function(){var e=this;return(this.transforms||[]).map(function(e){return n({},e)}).reverse().reduce(function(t,r){return l.mat4.multiply(t,t,e._getFactory(r)(r))},p.mat4f32.create())},t.prototype.clone=function(){return new a({transforms:this.transforms&&this.transforms.map(function(e){return n({},e)}),customTransforms:this.customTransforms&&this.customTransforms.map(function(e){return n({},e)})})},t.prototype._getFactory=function(e){var t=d[e.type];if(!t){if(this.customTransforms)for(var r=0,i=this.customTransforms;r<i.length;r++){var n=function(t){if(t.type===e.type){var r=p.mat4f32.fromValues.apply(p.mat4f32,t.matrix),i=l.mat4.transpose(r,r);return{value:function(e){return i}}}}(i[r]);if("object"==typeof n)return n.value}return h.error("invalid-type","No effect "+e.type+" exists"),function(e){return p.mat4f32.create()}}return t},r([u.property()],t.prototype,"transforms",void 0),r([u.property()],t.prototype,"customTransforms",void 0),a=r([u.subclass("esri.views.layers.support.ParsedFeatureEffect")],t)}(u.declared(a))}.apply(null,i))||(e.exports=n)},1694:function(e,t,r){var i;void 0===(i=function(){"use strict";function e(t,r,i,n){this.message=t,this.expected=r,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function s(e){return a[e.type](e)}var a={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?n(e.parts[t][0])+"-"+n(e.parts[t][1]):n(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,r,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=s(e[t]);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+(t?'"'+i(t)+'"':"end of input")+" found."},{SyntaxError:e,parse:function(t,r){function i(){return t.substring(kt,Lt)}function n(e,t){return{type:"literal",text:e,ignoreCase:t}}function s(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function a(e){return{type:"other",description:e}}function o(e){var r,i=Nt[e];if(i)return i;for(r=e-1;!Nt[r];)r--;for(i={line:(i=Nt[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return Nt[e]=i,i}function u(e,t){var r=o(e),i=o(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function l(e){Lt<Bt||(Lt>Bt&&(Bt=Lt,zt=[]),zt.push(e))}function p(t,r){return new e(t,null,null,r)}function c(){var e;return(e=function(){var e,r,i;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,4)===E?(i=E,Lt+=4):(i=w,0===Qt&&l(O)),i!==w&&x()!==w?(kt=e,r=R(),e=r):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(C)),e}())===w&&(e=function(){var e,t;if(e=[],(t=h())!==w)for(;t!==w;)e.push(t),t=h();else e=w;return e}()),e}function h(){var e;return(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,5)===P?(i=P,Lt+=5):(i=w,0===Qt&&l(V)),i!==w&&x()!==w&&(n=m())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=G(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(T)),e}())===w&&(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,11)===M?(i=M,Lt+=11):(i=w,0===Qt&&l(U)),i!==w&&x()!==w&&(n=d())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=A(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(j)),e}())===w&&(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,9)===L?(i=L,Lt+=9):(i=w,0===Qt&&l(k)),i!==w&&x()!==w&&(n=d())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=N(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(q)),e}())===w&&(e=function(){var e,r,i,n,s,a,o,u;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,12)===z?(i=z,Lt+=12):(i=w,0===Qt&&l(Q)),i!==w&&x()!==w&&(n=m())!==w&&x()!==w&&(s=m())!==w&&x()!==w?((a=m())===w&&(a=null),a!==w&&x()!==w?((o=function(){var e,r,i,n,s,a,o,u,p,c,h,g,m,v,_;return e=Lt,35===t.charCodeAt(Lt)?(r=mt,Lt++):(r=w,0===Qt&&l(vt)),r!==w?(i=Lt,(n=b())!==w&&(s=b())!==w?i=n=[n,s]:(Lt=i,i=w),i!==w?(n=Lt,(s=b())!==w&&(a=b())!==w?n=s=[s,a]:(Lt=n,n=w),n!==w?(s=Lt,(a=b())!==w&&(o=b())!==w?s=a=[a,o]:(Lt=s,s=w),s!==w?(kt=e,r=bt(i,n,s),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),e===w&&(e=Lt,35===t.charCodeAt(Lt)?(r=mt,Lt++):(r=w,0===Qt&&l(vt)),r!==w&&(i=b())!==w&&(n=b())!==w&&(s=b())!==w?(kt=e,r=xt(i,n,s),e=r):(Lt=e,e=w),e===w&&(e=Lt,t.substr(Lt,5)===_t?(r=_t,Lt+=5):(r=w,0===Qt&&l(wt)),r!==w&&(i=x())!==w&&(n=f())!==w&&(s=x())!==w?(44===t.charCodeAt(Lt)?(a=Ft,Lt++):(a=w,0===Qt&&l(St)),a!==w&&(o=x())!==w&&(u=f())!==w&&x()!==w?(44===t.charCodeAt(Lt)?(p=Ft,Lt++):(p=w,0===Qt&&l(St)),p!==w&&x()!==w&&(c=f())!==w&&(h=x())!==w?(44===t.charCodeAt(Lt)?(g=Ft,Lt++):(g=w,0===Qt&&l(St)),g!==w&&(m=x())!==w&&(v=d())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(_=I,Lt++):(_=w,0===Qt&&l(D)),_!==w?(kt=e,r=Ct(n,u,c,v),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),e===w&&(e=Lt,t.substr(Lt,5)===_t?(r=_t,Lt+=5):(r=w,0===Qt&&l(wt)),r!==w&&(i=x())!==w&&(n=y())!==w&&(s=x())!==w?(44===t.charCodeAt(Lt)?(a=Ft,Lt++):(a=w,0===Qt&&l(St)),a!==w&&(o=x())!==w&&(u=y())!==w&&x()!==w?(44===t.charCodeAt(Lt)?(p=Ft,Lt++):(p=w,0===Qt&&l(St)),p!==w&&x()!==w&&(c=y())!==w?(44===t.charCodeAt(Lt)?(h=Ft,Lt++):(h=w,0===Qt&&l(St)),h!==w&&(g=x())!==w&&(m=d())!==w?(41===t.charCodeAt(Lt)?(v=I,Lt++):(v=w,0===Qt&&l(D)),v!==w?(kt=e,r=Et(n,u,c,m),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),e===w&&(e=Lt,t.substr(Lt,5)===_t?(r=_t,Lt+=5):(r=w,0===Qt&&l(wt)),r!==w&&(i=x())!==w&&(n=f())!==w&&(s=x())!==w?(44===t.charCodeAt(Lt)?(a=Ft,Lt++):(a=w,0===Qt&&l(St)),a!==w&&(o=x())!==w&&(u=f())!==w&&x()!==w?(44===t.charCodeAt(Lt)?(p=Ft,Lt++):(p=w,0===Qt&&l(St)),p!==w&&x()!==w&&(c=f())!==w&&(h=x())!==w?(41===t.charCodeAt(Lt)?(g=I,Lt++):(g=w,0===Qt&&l(D)),g!==w?(kt=e,r=Ot(n,u,c),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),e===w&&(e=Lt,t.substr(Lt,5)===_t?(r=_t,Lt+=5):(r=w,0===Qt&&l(wt)),r!==w&&(i=x())!==w&&(n=y())!==w&&(s=x())!==w?(44===t.charCodeAt(Lt)?(a=Ft,Lt++):(a=w,0===Qt&&l(St)),a!==w&&(o=x())!==w&&(u=y())!==w&&x()!==w?(44===t.charCodeAt(Lt)?(p=Ft,Lt++):(p=w,0===Qt&&l(St)),p!==w&&x()!==w&&(c=y())!==w?(41===t.charCodeAt(Lt)?(h=I,Lt++):(h=w,0===Qt&&l(D)),h!==w?(kt=e,r=Rt(n,u,c),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),e===w&&(e=Lt,t.substr(Lt,4)===Tt?(r=Tt,Lt+=4):(r=w,0===Qt&&l(Pt)),r!==w&&(i=x())!==w&&(n=f())!==w&&(s=x())!==w?(44===t.charCodeAt(Lt)?(a=Ft,Lt++):(a=w,0===Qt&&l(St)),a!==w&&(o=x())!==w&&(u=f())!==w&&x()!==w?(44===t.charCodeAt(Lt)?(p=Ft,Lt++):(p=w,0===Qt&&l(St)),p!==w&&x()!==w&&(c=f())!==w&&(h=x())!==w?(41===t.charCodeAt(Lt)?(g=I,Lt++):(g=w,0===Qt&&l(D)),g!==w?(kt=e,r=Ot(n,u,c),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),e===w&&(e=Lt,t.substr(Lt,4)===Tt?(r=Tt,Lt+=4):(r=w,0===Qt&&l(Pt)),r!==w&&(i=x())!==w&&(n=y())!==w&&(s=x())!==w?(44===t.charCodeAt(Lt)?(a=Ft,Lt++):(a=w,0===Qt&&l(St)),a!==w&&(o=x())!==w&&(u=y())!==w&&x()!==w?(44===t.charCodeAt(Lt)?(p=Ft,Lt++):(p=w,0===Qt&&l(St)),p!==w&&x()!==w&&(c=y())!==w&&(h=x())!==w?(41===t.charCodeAt(Lt)?(g=I,Lt++):(g=w,0===Qt&&l(D)),g!==w?(kt=e,r=Rt(n,u,c),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),e===w&&(e=function(){var e,r,i;if(Qt++,e=Lt,r=[],Ut.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=w,0===Qt&&l(At)),i!==w)for(;i!==w;)r.push(i),Ut.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=w,0===Qt&&l(At));else r=w;return r!==w&&(kt=e,r=qt()),Qt--,(e=r)===w&&(r=w,0===Qt&&l(Mt)),e}())))))))),e}())===w&&(o=null),o!==w&&x()!==w?(41===t.charCodeAt(Lt)?(u=I,Lt++):(u=w,0===Qt&&l(D)),u!==w&&x()!==w?(kt=e,r=H(n,s,a,o),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(B)),e}())===w&&(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,10)===Y?(i=Y,Lt+=10):(i=w,0===Qt&&l(W)),i!==w&&x()!==w&&(n=d())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=J(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(X)),e}())===w&&(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,11)===K?(i=K,Lt+=11):(i=w,0===Qt&&l($)),i!==w&&x()!==w&&(n=function(){var e,r,i;return Qt++,e=Lt,(r=function(){var e,r;return Qt++,e=Lt,Oe.test(t.charAt(Lt))?(r=t.charAt(Lt),Lt++):(r=w,0===Qt&&l(Re)),r===w&&(r=null),r!==w&&y()!==w?(kt=e,r=Ce(),e=r):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(Ee)),e}())!==w&&(i=g())!==w?(kt=e,r=De(r,i),e=r):(Lt=e,e=w),e===w&&(e=Lt,48===t.charCodeAt(Lt)?(r=Ge,Lt++):(r=w,0===Qt&&l(je)),r!==w?((i=g())===w&&(i=null),i!==w?(kt=e,r=Me(),e=r):(Lt=e,e=w)):(Lt=e,e=w)),Qt--,e===w&&(r=w,0===Qt&&l(Ie)),e}())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=ee(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(Z)),e}())===w&&(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,7)===re?(i=re,Lt+=7):(i=w,0===Qt&&l(ie)),i!==w&&x()!==w&&(n=d())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=ne(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(te)),e}())===w&&(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,8)===ae?(i=ae,Lt+=8):(i=w,0===Qt&&l(oe)),i!==w&&x()!==w&&(n=d())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=ue(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(se)),e}())===w&&(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,9)===pe?(i=pe,Lt+=9):(i=w,0===Qt&&l(ce)),i!==w&&x()!==w&&(n=d())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=he(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(le)),e}())===w&&(e=function(){var e,r,i,n,s;return Qt++,e=Lt,(r=x())!==w?(t.substr(Lt,6)===ye?(i=ye,Lt+=6):(i=w,0===Qt&&l(fe)),i!==w&&x()!==w&&(n=d())!==w&&x()!==w?(41===t.charCodeAt(Lt)?(s=I,Lt++):(s=w,0===Qt&&l(D)),s!==w&&x()!==w?(kt=e,r=ge(n),e=r):(Lt=e,e=w)):(Lt=e,e=w)):(Lt=e,e=w),Qt--,e===w&&(r=w,0===Qt&&l(de)),e}()),e}function d(){var e;return Qt++,(e=f())===w&&(e=y()),Qt--,e===w&&0===Qt&&l(me),e}function y(){var e,r,i,n,s;if(Qt++,e=Lt,r=[],be.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=w,0===Qt&&l(xe)),i!==w)for(;i!==w;)r.push(i),be.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=w,0===Qt&&l(xe));else r=w;if(r!==w)if(46===t.charCodeAt(Lt)?(i=Fe,Lt++):(i=w,0===Qt&&l(Se)),i!==w){if(n=[],be.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=w,0===Qt&&l(xe)),s!==w)for(;s!==w;)n.push(s),be.test(t.charAt(Lt))?(s=t.charAt(Lt),Lt++):(s=w,0===Qt&&l(xe));else n=w;n!==w?(kt=e,e=r=Ce()):(Lt=e,e=w)}else Lt=e,e=w;else Lt=e,e=w;return e===w&&(e=function(){var e,r,i;if(Qt++,e=Lt,r=[],be.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=w,0===Qt&&l(xe)),i!==w)for(;i!==w;)r.push(i),be.test(t.charAt(Lt))?(i=t.charAt(Lt),Lt++):(i=w,0===Qt&&l(xe));else r=w;return r!==w&&(kt=e,r=_e()),Qt--,(e=r)===w&&(r=w,0===Qt&&l(ve)),e}()),Qt--,e===w&&(r=w,0===Qt&&l(we)),e}function f(){var e,r,i;return e=Lt,(r=y())!==w?(37===t.charCodeAt(Lt)?(i=Te,Lt++):(i=w,0===Qt&&l(Pe)),i!==w?(kt=e,e=r=Ve(r)):(Lt=e,e=w)):(Lt=e,e=w),e}function g(){var e,r;return Qt++,e=Lt,t.substr(Lt,3)===Ae?(r=Ae,Lt+=3):(r=w,0===Qt&&l(qe)),r!==w&&(kt=e,r=Le()),(e=r)===w&&(e=Lt,t.substr(Lt,4)===ke?(r=ke,Lt+=4):(r=w,0===Qt&&l(Ne)),r!==w&&(kt=e,r=Be()),(e=r)===w&&(e=Lt,t.substr(Lt,3)===ze?(r=ze,Lt+=3):(r=w,0===Qt&&l(Qe)),r!==w&&(kt=e,r=He()),(e=r)===w&&(e=Lt,t.substr(Lt,4)===Xe?(r=Xe,Lt+=4):(r=w,0===Qt&&l(Ye)),r!==w&&(kt=e,r=We()),e=r))),Qt--,e===w&&(r=w,0===Qt&&l(Ue)),e}function m(){var e,r,i;return Qt++,e=Lt,(r=y())!==w&&(i=v())!==w?(kt=e,e=r=De(r,i)):(Lt=e,e=w),e===w&&(e=Lt,48===t.charCodeAt(Lt)?(r=Ge,Lt++):(r=w,0===Qt&&l(je)),r!==w?((i=v())===w&&(i=null),i!==w?(kt=e,e=r=Me()):(Lt=e,e=w)):(Lt=e,e=w)),Qt--,e===w&&(r=w,0===Qt&&l(Je)),e}function v(){var e,r;return e=Lt,t.substr(Lt,2)===Ze?(r=Ze,Lt+=2):(r=w,0===Qt&&l(Ke)),r!==w&&(kt=e,r=Le()),(e=r)===w&&(e=Lt,t.substr(Lt,2)===$e?(r=$e,Lt+=2):(r=w,0===Qt&&l(et)),r!==w&&(kt=e,r=tt()),(e=r)===w&&(e=Lt,t.substr(Lt,2)===rt?(r=rt,Lt+=2):(r=w,0===Qt&&l(it)),r!==w&&(kt=e,r=nt()),(e=r)===w&&(e=Lt,81===t.charCodeAt(Lt)?(r=st,Lt++):(r=w,0===Qt&&l(at)),r!==w&&(kt=e,r=ot()),(e=r)===w&&(e=Lt,t.substr(Lt,2)===ut?(r=ut,Lt+=2):(r=w,0===Qt&&l(lt)),r!==w&&(kt=e,r=pt()),(e=r)===w&&(e=Lt,t.substr(Lt,2)===ct?(r=ct,Lt+=2):(r=w,0===Qt&&l(ht)),r!==w&&(kt=e,r=dt()),(e=r)===w&&(e=Lt,t.substr(Lt,2)===yt?(r=yt,Lt+=2):(r=w,0===Qt&&l(ft)),r!==w&&(kt=e,r=gt()),e=r)))))),e}function b(){var e;return Vt.test(t.charAt(Lt))?(e=t.charAt(Lt),Lt++):(e=w,0===Qt&&l(It)),e}function x(){var e,r;for(Qt++,e=[],Gt.test(t.charAt(Lt))?(r=t.charAt(Lt),Lt++):(r=w,0===Qt&&l(jt));r!==w;)e.push(r),Gt.test(t.charAt(Lt))?(r=t.charAt(Lt),Lt++):(r=w,0===Qt&&l(jt));return Qt--,e===w&&(r=w,0===Qt&&l(Dt)),e}r=void 0!==r?r:{};var _,w={},F={start:c},S=c,C=a("none"),E="none",O=n("none",!1),R=function(){return null},T=a("blur()"),P="blur(",V=n("blur(",!1),I=")",D=n(")",!1),G=function(e){return{type:"blur",radius:e}},j=a("brightness()"),M="brightness(",U=n("brightness(",!1),A=function(e){return{type:"brightness",amount:e}},q=a("contrast()"),L="contrast(",k=n("contrast(",!1),N=function(e){return{type:"contrast",amount:e}},B=a("drop-shadow()"),z="drop-shadow(",Q=n("drop-shadow(",!1),H=function(e,t,r,i){return{type:"drop-shadow",offsetX:e,offsetY:t,blurRadius:r,color:i}},X=a("grayscale()"),Y="grayscale(",W=n("grayscale(",!1),J=function(e){return{type:"grayscale",amount:e}},Z=a("hue-rotate()"),K="hue-rotate(",$=n("hue-rotate(",!1),ee=function(e){return{type:"hue-rotate",angle:e}},te=a("invert()"),re="invert(",ie=n("invert(",!1),ne=function(e){return{type:"invert",amount:e}},se=a("opacity()"),ae="opacity(",oe=n("opacity(",!1),ue=function(e){return{type:"opacity",amount:e}},le=a("saturate()"),pe="saturate(",ce=n("saturate(",!1),he=function(e){return{type:"saturate",amount:e}},de=a("sepia()"),ye="sepia(",fe=n("sepia(",!1),ge=function(e){return{type:"sepia",amount:e}},me=a("<number-percentage>"),ve=a("<integer>"),be=/^[0-9]/,xe=s([["0","9"]],!1,!1),_e=function(){return parseInt(i(),10)},we=a("<number>"),Fe=".",Se=n(".",!1),Ce=function(){return parseFloat(i())},Ee=a("<signedNumber>"),Oe=/^[+\-]/,Re=s(["+","-"],!1,!1),Te="%",Pe=n("%",!1),Ve=function(e){return e/100},Ie=a("<angle>"),De=function(e,t){return e*t},Ge="0",je=n("0",!1),Me=function(){return 0},Ue=a("<unit>"),Ae="deg",qe=n("deg",!1),Le=function(){return 1},ke="grad",Ne=n("grad",!1),Be=function(){return.9},ze="rad",Qe=n("rad",!1),He=function(){return 180/Math.PI},Xe="turn",Ye=n("turn",!1),We=function(){return 1/360},Je=a("<length>"),Ze="px",Ke=n("px",!1),$e="cm",et=n("cm",!1),tt=function(){return 96/2.54},rt="mm",it=n("mm",!1),nt=function(){return 96/2.54/10},st="Q",at=n("Q",!1),ot=function(){return 96/2.54/40},ut="in",lt=n("in",!1),pt=function(){return 96},ct="pc",ht=n("pc",!1),dt=function(){return 16},yt="pt",ft=n("pt",!1),gt=function(){return 96/73},mt="#",vt=n("#",!1),bt=function(e,t,r){return[parseInt(e.join(""),16),parseInt(t.join(""),16),parseInt(r.join(""),16)]},xt=function(e,t,r){return[parseInt([e,e].join(""),16),parseInt([t,t].join(""),16),parseInt([r,r].join(""),16)]},_t="rgba(",wt=n("rgba(",!1),Ft=",",St=n(",",!1),Ct=function(e,t,r,i){return[255*e,255*t,255*r,i]},Et=function(e,t,r,i){return[e,t,r,i]},Ot=function(e,t,r){return[255*e,255*t,255*r,1]},Rt=function(e,t,r){return[e,t,r,1]},Tt="rgb(",Pt=n("rgb(",!1),Vt=/^[0-9a-fA-F]/,It=s([["0","9"],["a","f"],["A","F"]],!1,!1),Dt=a("whitespace"),Gt=/^[ \t\n\r]/,jt=s([" ","\t","\n","\r"],!1,!1),Mt=a("<named-color>"),Ut=/^[a-z]/,At=s([["a","z"]],!1,!1),qt=function(){var e=i();return Xt.has(e)||function(e,t){throw p(e,t=void 0!==t?t:u(kt,Lt))}('unknown color "'+e+'"'),Ht[e].concat(1)},Lt=0,kt=0,Nt=[{line:1,column:1}],Bt=0,zt=[],Qt=0;if("startRule"in r){if(!(r.startRule in F))throw new Error("Can't start parsing from rule \""+r.startRule+'".');S=F[r.startRule]}var Ht={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},Xt=new Set(Object.keys(Ht));if((_=S())!==w&&Lt===t.length)return _;throw _!==w&&Lt<t.length&&l({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(zt,Bt<t.length?t.charAt(Bt):null,Bt<t.length?u(Bt,Bt+1):u(Bt,Bt))}}}.apply(null,[]))||(e.exports=i)},1695:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(6),r(0),r(18)],void 0===(n=function(e,t,r,i,n,s,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.from=null,t.to=null,t.duration=4e3,t.repeat=!0,t.done=!1,t}var n;return i(t,e),n=t,t.prototype.getColorMatrix=function(){if(this.done=!1,null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var e=this._lastTime,t=Date.now(),r=t-e;this._currentStep=this._currentStep+r,this._currentStep>=2147483647&&(this._currentStep=0),this._lastTime=t}var i=this._currentStep%this.duration/(this.duration/2),n=i<=1?i:2-i,s=this.from.getColorMatrix(),o=this.to.getColorMatrix();return a.mat4.multiplyScalar(s,s,1-n),a.mat4.multiplyScalar(o,o,n),!this.repeat&&this._currentStep>=this.duration&&(this.done=!0),a.mat4.add(s,s,o)},t.prototype.clone=function(){var e=new n({from:this.from.clone(),to:this.to.clone(),duration:this.duration});return e._lastTime=this._lastTime,e._currentStep=this._currentStep,e},r([s.property()],t.prototype,"from",void 0),r([s.property()],t.prototype,"to",void 0),r([s.property({type:Number})],t.prototype,"duration",void 0),r([s.property({type:Boolean})],t.prototype,"repeat",void 0),n=r([s.subclass("esri.views.layers.support.Transition")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1696:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(82)],void 0===(n=function(e,t,r){return function(){function e(e){this.sourceSpatialReference=e.sourceSpatialReference,this.destSpatialReference=e.destSpatialReference}return e.prototype.adjust=function(e){var t=this._getVerticalUnitScale();1!==t&&this._scaleVerticalUnits(e,t)},e.prototype._getVerticalUnitScale=function(){return this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)?r.getMetersPerVerticalUnitForSR(this.sourceSpatialReference)/r.getMetersPerVerticalUnitForSR(this.destSpatialReference):1},e.prototype._vertexListsScaleZ=function(e,t){for(var r=0;r<e.length;++r)for(var i=e[r],n=0;n<i.length;++n){i[n][2]*=t}},e.prototype._scaleVerticalUnits=function(e,t){for(var r=0;r<e.length;++r){var i=e[r].geometry;i&&i.hasZ&&(this._geometryIsPoint(i)?null!==i.z&&(i.z*=t):this._geometryIsPolyline(i)?this._vertexListsScaleZ(i.paths,t):this._geometryIsPolygon(i)&&this._vertexListsScaleZ(i.rings,t))}},e.prototype._geometryIsPoint=function(e){return"point"===e.type},e.prototype._geometryIsPolygon=function(e){return"polygon"===e.type},e.prototype._geometryIsPolyline=function(e){return"polyline"===e.type},e}()}.apply(null,i))||(e.exports=n)},1697:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(22),r(25),r(97),r(13),r(9),r(21),r(0),r(128),r(1698),r(1636),r(1507),r(1637),r(1534)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c,h,d,y,f,g){return function(e){function t(t){var r=e.call(this)||this;return r.controller=null,r.asyncGraphicsUpdates=!1,r.suspendResumeExtentMode="computed",r.slicePlaneEnabled=!1,r.supportsDraping=!0,r.overlayUpdating=!1,r.fullExtentInLocalViewSpatialReference=null,r.suspendResumeExtent=null,r._queryEngine=null,r._controllerCreated=!1,r.clippingExtent=null,r.supportsHeightUnitConversion=!0,r.pendingController=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.layer.isTable?this.addResolvingPromise(u.reject(new o("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer}))):(this._set("graphics3d",new f({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.handles.add([this.watch("asyncGraphicsUpdates",function(t){e.graphics3d.graphicsCore.asyncUpdates=t}),this.watch("suspendResumeExtentMode",function(t){e.graphics3d.suspendResumeExtentMode=t})]),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(this.graphics3d.setup().then(function(){return e.validateGeometryType()}).then(function(){return g.toViewIfLocal(e)}).then(function(t){return e.fullExtentInLocalViewSpatialReference=t}).then(function(){return e.initializeController()})),this.notifyChange("updating"))},t.prototype.destroy=function(){this.destroyPendingController(),this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.loadedGraphics=null,this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=null},t.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)},Object.defineProperty(t.prototype,"drawingOrder",{set:function(e){this.graphics3d.graphicsCore.setDrawingOrder(e),this._set("drawingOrder",e)},enumerable:!0,configurable:!0}),t.prototype.getRenderingInfo=function(e,t){var r=d.getRenderingInfo(e,{renderer:t});if(r&&r.color){var i=r.color;i[0]=i[0]/255,i[1]=i[1]/255,i[2]=i[2]/255}return r},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,r=null;return this.loadedGraphics&&this.loadedGraphics.forEach(function(i){i.uid===e&&(r=c.hydrateGraphic(i,t.layer))}),r},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.whenSymbolLayerSize=function(e,t){return this.graphics3d?a.safeCast(this.graphics3d.graphicsCore.whenSymbolLayerSize(e,t)):null},t.prototype.queryFeatures=function(e){return this._queryEngine?this._queryEngine.queryFeatures(e):this._rejectQuery()},t.prototype.queryObjectIds=function(e){return this._queryEngine?this._queryEngine.queryObjectIds(e):this._rejectQuery()},t.prototype.queryFeatureCount=function(e){return this._queryEngine?this._queryEngine.queryFeatureCount(e):this._rejectQuery()},t.prototype.queryExtent=function(e){return this._queryEngine?this._queryEngine.queryExtent(e):this._rejectQuery()},t.prototype.highlight=function(e,t){return void 0===t&&(t={}),this.graphics3d.highlight(e,t,this.layer.objectIdField)},t.prototype.getStats=function(){var e=this.graphics3d.graphicsCore.getStats();return e.features=this.loadedGraphics.length,e.updating=this.updating,e.elevationUpdating=this.graphics3d.elevationAlignment.updating,e.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended,e.visibilityScale=!this.graphics3d.scaleVisibility.suspended,e},t.prototype.canResume=function(){return!(!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed)&&(!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!this.view.basemapTerrain||!this.view.basemapTerrain.ready||this.graphics3d.updating)},t.prototype.initializeController=function(){return s(this,void 0,void 0,function(){var e;return n(this,function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return e=t.sent(),this.pendingController=e,[4,e.when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}})})},t.prototype.setControllerWhenInitialized=function(e){return s(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:return t.sent(),[3,3];case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,l.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return t.sent(),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this._queryEngine=new h({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField,dataSpatialReference:this.view.spatialReference}),this.notifyChange("updating"),[2]}})})},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){var e=this.layer;switch(e.geometryType){case"multipatch":case"multipoint":return u.reject(new o("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:e.geometryType}))}},t.prototype._rejectQuery=function(){return u.reject(new o("featurelayerview3d:query","Not ready to execute query"))},i([p.property()],t.prototype,"loadedGraphics",void 0),i([p.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),i([p.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],t.prototype,"updating",void 0),i([p.property()],t.prototype,"controller",void 0),i([p.property()],t.prototype,"graphics3d",void 0),i([p.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),i([p.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),i([p.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),i([p.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),i([p.property({readOnly:!0,type:Boolean})],t.prototype,"supportsDraping",void 0),i([p.property({type:Boolean})],t.prototype,"overlayUpdating",void 0),i([p.property()],t.prototype,"drawingOrder",null),i([p.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(p.declared(y))}.apply(null,i))||(e.exports=n)},1698:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(43),r(6),r(13),r(9),r(0),r(37),r(128),r(1464)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c){var h=function(e){function t(t){var r=e.call(this)||this;return r.features=null,r.layer=null,r.objectIdField=null,r.dataSpatialReference=null,r}return r(t,e),t.prototype.queryFeatures=function(e){var t=this;return this._queryFeatures(e).then(function(e){var r=e.map(function(e){return p.hydrateGraphic(e,t.layer)});return new c({features:r,fields:t.layer?t.layer.fields.slice():null,geometryType:t.layer?t.layer.geometryType:null,spatialReference:t.dataSpatialReference?t.dataSpatialReference.clone():null})})},t.prototype.queryObjectIds=function(e){var t=this;return this.objectIdField?this.queryFeatures(e).then(function(e){return t._getObjectIds(e.features)}):this._rejectQuery("Unsupported query")},t.prototype.queryFeatureCount=function(e){return this.features&&!e?o.resolve(this.features.length):this._queryFeatures(e).then(function(e){return e.length})},t.prototype.queryExtent=function(e){var t=this;return this.queryFeatures(e).then(function(e){return{count:e.features.length,extent:t._getExtent(e.features)}})},t.prototype._queryFeatures=function(e){if(this.features){if(e){if(this._isSupportedQuery(e)){var t=this._createFilters(e);return t.length?this._executeQuery(e,t):this._rejectQuery("Invalid query")}return this._rejectQuery("Unsupported query")}return this._returnAllFeatures()}return this._rejectQuery("Engine not initialized")},t.prototype._returnAllFeatures=function(){return o.resolve(this.features.toArray())},t.prototype._executeQuery=function(e,t){var r=this,i=[];return this.features.forEach(function(n){t.every(function(t){return t.call(r,n,e)})&&i.push(n)}),o.resolve(i)},t.prototype._isSupportedQuery=function(e){var t=!0;return(null!=e.distance||null!=e.geometryPrecision||e.groupByFieldsForStatistics&&e.groupByFieldsForStatistics.length||null!=e.maxAllowableOffset||e.multipatchOption||null!=e.num||e.orderByFields&&e.orderByFields.length||e.outFields&&e.outFields.length||e.outSpatialReference||e.outStatistics&&e.outStatistics.length||e.pixelSize||e.quantizationParameters||e.relationParameter||e.returnDistinctValues||null!=e.start||e.text||e.timeExtent||e.where||e.objectIds&&e.objectIds.length&&!this.objectIdField)&&(t=!1),t},t.prototype._createFilters=function(e){var t=[];return e.objectIds&&e.objectIds.length&&t.push(this._createObjectIdFilter()),e.geometry&&"extent"===e.geometry.type&&"intersects"===e.spatialRelationship&&t.push(this._createExtentFilter()),t},t.prototype._createExtentFilter=function(){return function(e,t){var r=e.geometry;if(!r)return!1;var i=t.geometry;return l.fromExtent(i,d),p.computeAABR(r,y),l.intersects(d,y)}},t.prototype._createObjectIdFilter=function(){var e=this;return function(t,r){var i=t.attributes,n=i&&i[e.objectIdField];return r.objectIds.indexOf(n)>-1}},t.prototype._rejectQuery=function(e){return o.reject(new a(this.declaredClass,e))},t.prototype._getObjectIds=function(e){var t=this.objectIdField,r=[];return e.forEach(function(e){var i=e.attributes,n=i&&i[t];null!=n&&r.push(n)}),r},t.prototype._getExtent=function(e){if(0===e.length)return null;l.empty(d);for(var t=0;t<e.length;t++){var r=e[t].geometry;p.computeAABR(r,y),l.expand(d,y,d)}return new n.Extent({xmin:d[0],ymin:d[1],xmax:d[2],ymax:d[3],spatialReference:e[0].geometry.spatialReference})},i([u.property()],t.prototype,"features",void 0),i([u.property({constructOnly:!0})],t.prototype,"layer",void 0),i([u.property()],t.prototype,"objectIdField",void 0),i([u.property()],t.prototype,"dataSpatialReference",void 0),i([u.subclass("esri.layers.graphics.QueryEngine")],t)}(u.declared(s)),d=l.create(),y=l.create();return h}.apply(null,i))||(e.exports=n)},1789:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(25),r(22),r(6),r(97),r(17),r(10),r(132),r(9),r(57),r(21),r(0),r(37),r(128),r(557),r(353),r(2221),r(2222),r(2223),r(1546)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c,h,d,y,f,g,m,v,b,x,_,w,F){function S(e,t){return null!=e.objectId?e.objectId:e.attributes[t]}function C(e){return"dummy-tile-full-extent"===e.id}Object.defineProperty(t,"__esModule",{value:!0});var E=x.SingleFeatureReference,O=x.MultiFeatureReference,R=p.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),T=function(e){function t(t){var r=e.call(this,t)||this;return r.useTileCount=!1,r.updating=!1,r.updatingTotal=0,r.updatingRemaining=0,r.expectedFeatureDiff=0,r.maximumNumberOfFeaturesExceeded=!1,r.maximumNumberOfFeaturesExceededThrottle=1e3,r.maximumNumberOfFeaturesExceededNext=0,r._fullRatio=1,r._farRatio=1,r.changes={updates:{adds:[],removes:[]},adds:[],removes:[]},r.handles=new l,r._dirty=!1,r.idToFeatureTile=new Map,r.displayingFeatureReferences=new Map,r.numDisplayingFeatureReferences=0,r.suspended=!0,r.pendingEdits=null,r}return r(t,e),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this.maximumFeaturesUpdated(t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.estimatedUnusedSize}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalVertices",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.numVertices}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFeatures",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.numFeatures}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(e&&this.tilingScheme&&!e.spatialReference.equals(this.tilingScheme.spatialReference))R.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this.reclip(r,t)}}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.capabilities=this.calculateCapabilities(),this.fetchQueue=this.createFetchQueue();var t=this.layerView.layer;this.handles.add(y.on(this,"tileDescriptors","change",function(){return e.setDirty()},function(){return e.setDirty()})),this.handles.add(t.watch("hasService",function(){return e._initMemCache()})),y.init(t,"hasService",function(){return e._initMemCache()}),this.objectIdField=t.objectIdField,this.FeatureReferenceClass=this.capabilities.supportsMultipleResolutions?O:E,this.featureTileQuery=w.createFeatureTileQuery3D(t);var r=this.layerView.view.resourceController.scheduler;this.handles.add([r.registerTask(2,function(t){return e.update(t)},function(){return e._dirty||e.maximumNumberOfFeaturesExceededNext>0}),r.registerIdleStateCallbacks(function(){return e.unpause()},function(){return e.pause()})]),this.setDirty()},t.prototype.destroy=function(){var e=this;this.handles&&(this.handles.destroy(),this.handles=null),this.forEachFeatureTile(function(t){e.cancelFetchTile(t),e.removeTile(t)}),this.idToFeatureTile.clear(),this.displayingFeatureReferences.clear(),this.fetchQueue.destroy(),this.fetchQueue=null,this.featureTileQuery=null,this.pendingEdits&&(this.pendingEdits.edits.cancel(D),this.pendingEdits=null),this._memCache&&this._memCache.destroy(),this._memCache=null},Object.defineProperty(t.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0}),t.prototype.filtersChanged=function(){var e=this;this.fetchQueue.clear(),this._memCache&&this._memCache.clear(),this.forEachFeatureTile(function(t){e.resetFetchTile(t),e.queueFetchTile(t)}),this.setDirty()},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())},t.prototype.pause=function(){this.paused&&(this.fetchQueue.pause(),this.fetchQueue.reset(),this.updated())},t.prototype.unpause=function(){this.paused||(this.setDirty(),this.fetchQueue.resume(),this.updated())},t.prototype.getFeatureTileById=function(e){return this.idToFeatureTile.get(e)||null},t.prototype.forEachFeatureTile=function(e){this.idToFeatureTile.forEach(e)},t.prototype.applyEdits=function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:h.resolve(),count:0},this.pause()),this.pendingEdits.count++;var r=this.pendingEdits.edits.then(function(){return e.result.catch(function(e){if(e===D)throw e;return null}).then(function(e){return e?(t.applyEditsDeleteFeatures(e.deletedFeatures),u.safeCast(t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures).then(function(){return e}))):e}).then(function(e){return 0==--t.pendingEdits.count&&(t.pendingEdits=null,t._memCache&&t._memCache.clear(),t.unpause()),e})});return this.pendingEdits.edits=r,r},t.prototype.applyEditsDeleteFeatures=function(e){var t=this;if(0!==e.length){var r=new Set;e.forEach(function(e){return r.add(e.objectId)}),this.forEachFeatureTile(function(e){if(e.features){var i=e.features.filter(function(e){return!r.has(S(e,t.objectIdField))});i.length!==e.features.length&&(e.setFeatures(i,0),t.invalidateCounts())}})}},t.prototype.applyEditsAddUpdateFeatures=function(e,t){return s(this,void 0,void 0,function(){var r,i,n,s=this;return a(this,function(a){switch(a.label){case 0:return r=[],i=new Set,e.forEach(function(e){return r.push(e.objectId)}),t.forEach(function(e){r.push(e.objectId),i.add(e.objectId)}),0===r.length?[2]:(n=[],this.forEachFeatureTile(function(e){var t=u.safeCast(s.applyEditsAddUpdateTile(e,r,i));t&&n.push(t)}),[4,h.eachAlways(n)]);case 1:return a.sent(),[2]}})})},t.prototype.applyEditsAddUpdateTile=function(e,t,r){return s(this,void 0,void 0,function(){var i,n,s,o,u,l,p,c=this;return a(this,function(a){switch(a.label){case 0:return e.features?((i=this.createQuery(e)).resultType=void 0,i.objectIds=t,[4,this.queryFeatures(i)]):[2];case 1:if(n=a.sent(),s=null,r.size>0&&((o=e.features.filter(function(e){return!r.has(S(e,c.objectIdField))})).length!==e.features.length&&(s=o)),n.features.length>0)for(s||(s=e.features.slice()),this.verticalScale.adjust(n.features),u=0,l=n.features;u<l.length;u++)p=l[u],s.push(p);return s&&(e.setFeatures(s,0),this.invalidateCounts()),[2]}})})},t.prototype.queryFeatures=function(e){return this.featureTileQuery.queryFeaturesDehydrated(e,{timeout:G})},t.prototype.calculateCapabilities=function(){var e=this.layerView.layer,t=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsPagination),r=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsResultType),i=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization),n=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantizationEditMode),s=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsMaxRecordCountFactor),a=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsFormatPBF);return{supportsMultipleResolutions:this.calculateSupportsMultipleResolutions(),supportsPagination:t,supportsResultType:r,supportsQuantization:i,supportsQuantizationEditMode:n,supportsMaxRecordCountFactor:s,supportsFormatPBF:a}},t.prototype.calculateSupportsMultipleResolutions=function(){var e=this.layerView.layer;switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}},t.prototype.createFetchQueue=function(){var e=this;return new F({concurrency:6,priority:2,scheduler:this.layerView.view.resourceController.scheduler,peeker:function(t){return e.highestPriorityTile(t)},process:function(t){return u.safeCast(e.fetchTile(t))}})},t.prototype.highestPriorityTile=function(e){return e.reduce(function(e,t){return e&&e.descriptor.loadPriority<=t.descriptor.loadPriority?e:t},null)},t.prototype._initMemCache=function(){var e=this.layerView.layer;"hasService"in e&&e.hasService?this._memCache||(this._memCache=this.layerView.view.resourceController.memoryController.getMemCache(e.uid)):this._memCache&&(this._memCache.destroy(),this._memCache=null)},t.prototype.setDirty=function(){this._dirty=!0,this.forEachFeatureTile(function(e){e.featureLimit=0}),this.updated()},t.prototype.update=function(e){var t=this;if(this.maximumNumberOfFeaturesExceededNext&&c()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded(),this._dirty&&this.constructed){this._dirty=!1;var r=this.getListOfTiles();this.markTilesNotAlive(r),this.addTiles(r),this.filterExtentTiles(r),this.removeTiles(r);var i=this.sortTiles(r);e.run(function(){return t.displayTiles(i,e)})&&e.run(function(){return t.queueFetchTiles(i,e)})||this.setDirty(),this.updated()}},t.prototype.markTilesNotAlive=function(e){for(var t=0,r=e;t<r.length;t++)r[t].alive=!1},t.prototype.addTiles=function(e){var t=this;this.suspended||this.tileDescriptors.forEach(function(r){var i=t.getFeatureTileById(r.id);i?i.alive=!0:e.push(t.addTile(r))})},t.prototype.filterExtentTiles=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];i.alive&&(i.filtered=!i.intersects(this.filterExtent),i.filtered&&this.clearTile(i))}},t.prototype.removeTiles=function(e){for(var t=e.length-1;t>=0;t--){var r=e[t];r.alive||(this.removeTile(r),t!==e.length-1&&(e[t]=e[e.length-1]),e.pop())}},t.prototype.sortTiles=function(e){return e.sort(function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority}),e},t.prototype.displayTiles=function(e,t){for(var r=this,i=this.updateRatio(e),n=function(e){var t=r._fullRatio<1?i(e)*r._farRatio:1;return e.reduceFeatures(t,r.objectIdField)&&r.setDirty(),r.showTile(e)},s=this,a=0,o=e;a<o.length;a++){if("break"===function(e){if(!t.run(function(){return n(e)}))return s.setDirty(),"break"}(o[a]))break}return!0},t.prototype.queueFetchTiles=function(e,t){for(var r=this,i=this,n=0,s=e;n<s.length;n++){var a=function(e){if(!t.run(function(){return r.queueFetchTile(e)}))return i.setDirty(),{value:!0}}(s[n]);if("object"==typeof a)return a.value}return!0},t.prototype.reclip=function(e,t){var r=this;this.constructed&&(this.forEachFeatureTile(function(i){i.displayingFeatures&&0!==i.displayingFeatures.length&&(i.intersection(t,V),i.intersection(e,I),g.equals(V,I)||r.hideTileFeatures(i))}),this.forEachFeatureTile(function(e){return r.showTile(e)}),this.updated())},t.prototype.updated=function(){var e=this,t=this._dirty||this.fetchQueue.length>0;if(this._set("updating",t),t){var r=0,i=0,n=0,s=0,a=0,o=0,u=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.forEachFeatureTile(function(t){if(++n,t.isFetching&&t.hasPreciseFeatureCount){var r=e.maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),l=t.displayingFeatures?t.displayingFeatures.length*u:0;o+=r-l}t.needsFetching?++a:t.numFeatures>0&&(++s,i+=t.numFeatures)});var l=a+=this.fetchQueue?this.fetchQueue.length:0;i?r=i+(l=a*i/s):r=n,o=Math.min(this.maximumNumberOfFeatures-this.features.length,o),this._set("updatingTotal",r),this._set("updatingRemaining",l),this._set("expectedFeatureDiff",o)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update(),this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||c()+this.maximumNumberOfFeaturesExceededThrottle)},t.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var e=!1;this.forEachFeatureTile(function(t){e=e||t.perTileMaximumNumberOfFeaturesExceeded}),this.maximumNumberOfFeaturesExceededNext=0,this._set("maximumNumberOfFeaturesExceeded",e)}},t.prototype.updateRatio=function(e){for(var t=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var n=i[r];n.features&&n.features.length>0&&n.alive&&(t=Math.max(t,n.descriptor.lij[0]))}return t}(e),r=function(e){return 1/(1<<t-e.descriptor.lij[0])},i=0,n=0,s=0,a=e;s<a.length;s++){var o=a[s],u=o.numFeatures;i+=u,n+=u*r(o)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/i),this._farRatio=this.maximumNumberOfFeatures/n,this.scheduleUpdated(),r},t.prototype.maximumFeaturesUpdated=function(e,t){var r=this;e!==t&&(t>e&&this.forEachFeatureTile(function(e){if(e.featuresMissing){var t=r.maximumFeaturesForTile(e);e.features&&(e.features.length>=t||5===e.fetchStatus)||(r.cancelFetchTile(e),r.resetFetchTile(e))}}),this.setDirty())},t.prototype.addTile=function(e){var t=new _(e);return this.idToFeatureTile.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t},t.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(e){var t=this,r=e.descriptor.resolution;this.forEachFeatureTile(function(i){if(i.displayingFeatures&&t.tilesAreRelated(e,i)){e.displayingFeatures=e.displayingFeatures||[];for(var n=0,s=i.displayingFeatures;n<s.length;n++){var a=s[n];e.displayingFeatures.push(a);var o=t.displayingFeatureReferences.get(S(a,t.objectIdField));o.ref(r,o.feature),t.numDisplayingFeatureReferences++}}}),e.featureLimit=e.displayingFeatures?e.displayingFeatures.length:0},t.prototype.tilesAreRelated=function(e,t){if(e===t)return!1;var r=e.descriptor.lij,i=t.descriptor.lij;if(!r||!i)return!0;var n=r[0]<i[0],s=n?r:i,a=n?i:r,o=a[0]-s[0];if(0===o)return!1;var u=1<<o;return Math.floor(a[1]/u)===s[1]&&Math.floor(a[2]/u)===s[2]},t.prototype.removeTile=function(e){this.clearTile(e),this.idToFeatureTile.delete(e.id)},t.prototype.resetFetchTile=function(e){e.intersects(this.filterExtent)?(e.fetchStatus=0,e.filtered=!1):(e.needsFetching&&(e.fetchStatus=4),e.filtered=!0)},t.prototype.cancelFetchTile=function(e){var t=e.fetchRequest;t&&(e.fetchRequest=null,e.fetchStatus=0,t.cancel())},t.prototype.fetchTile=function(e){return s(this,void 0,void 0,function(){var t,r,i,n,s,o,u,l,p,c,h;return a(this,function(a){switch(a.label){case 0:if(!this.needsNumFeatures(e))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),t=e,[4,this.fetchCount(e)];case 2:return t.numFeatures=a.sent(),this.updateRatio(this.getListOfTiles()),[3,4];case 3:return(r=a.sent())&&"cancel"===r.dojoType?[2]:[3,4];case 4:return i=this.maximumFeaturesForTile(e),n=Math.ceil(i/this.maxRecordCount),C(e)||!this.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=i&&n>b.MAX_MAX_RECORD_COUNT_FACTOR?[2,this.fetchPagedTile(e)]:((s=this.createQuery(e)).maxRecordCountFactor=Math.ceil(i/this.maxRecordCount),e.isRefetching&&e.features&&e.features.length>0&&(o=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/this.maxRecordCount),s.maxRecordCountFactor=Math.max(o+1,s.maxRecordCountFactor)),[4,this.queryFeatures(s)]);case 5:return u=a.sent(),l=u.features,p=u.exceededTransferLimit,c=p?s.maxRecordCountFactor>=b.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,e.featuresMissing=l.length<e.numFeatures||p,h=this._removeEmptyFeatures(l),this.verticalScale.adjust(l),e.setFeatures(l,h),this.invalidateCounts(),[2,c]}})})},t.prototype.fetchCount=function(e){return s(this,void 0,void 0,function(){return a(this,function(t){return[2,this.layerView.layer.queryFeatureCount(this.createQuery(e))]})})},t.prototype.fetchPagedTile=function(e){return s(this,void 0,void 0,function(){var t,r,i,n,s,o,u,l,p,c;return a(this,function(a){switch(a.label){case 0:t=0,r=0,n=0,s=this.maximumFeaturesForTile(e)-n,a.label=1;case 1:return o=this.createQuery(e),u=this.setPagingParameters(o,t,s),[4,this.queryFeatures(o)];case 2:return l=a.sent(),p=l.features,c=l.exceededTransferLimit,t+=o.num,n+=p.length,r+=this._removeEmptyFeatures(p),this.verticalScale.adjust(p),e.featuresMissing=t<e.numFeatures||c,i=i?i.concat(p):p,e.setFeatures(i,r),this.invalidateCounts(),this.setDirty(),s=this.maximumFeaturesForTile(e)-n,!u||!c||s<=0?[2,c?4:5]:[3,1];case 3:return[2]}})})},t.prototype.createQuery=function(e){var t=this.layerView.layer.createQuery();t.outFields=this.layerView.availableFields;var r=this.layerView.layer.capabilities&&this.layerView.layer.capabilities.data;r&&r.supportsZ&&null==t.returnZ&&(t.returnZ=!0);var i=this.tilingScheme.spatialReference;t.outSpatialReference=i;var n=e.descriptor.extent;return n&&(t.geometry=g.toExtent(n,i)),this.setResolutionParams(t,e),this.capabilities.supportsResultType&&(t.resultType="tile"),t},t.prototype.setPagingParameters=function(e,t,r){return!!this.capabilities.supportsPagination&&(e.start=t,r>0&&this.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/this.maxRecordCount),e.num=Math.min(e.maxRecordCountFactor*this.maxRecordCount,r)):e.num=Math.min(this.maxRecordCount),!0)},t.prototype.getEffectiveTileResolution=function(e){if(null==e.descriptor.resolution)return null;var t="global"===this.viewingMode?this.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)*M},t.prototype.setResolutionParams=function(e,t){if(this.capabilities.supportsMultipleResolutions){var r=this.layerView.layer;if("point"!==r.geometryType){var i=this.getEffectiveTileResolution(t);null!=i&&(this.capabilities.supportsQuantization?e.quantizationParameters=new v.default({mode:"view",originPosition:"upper-left",tolerance:i,extent:r.fullExtent}):"polyline"===r.geometryType&&(e.maxAllowableOffset=i))}}},t.prototype._removeEmptyFeatures=function(e){for(var t=e.length,r=0;r<e.length;){var i=e[r];m.hasVertices(i.geometry)?++r:(e[r]=e[e.length-1],--e.length)}return t-e.length},t.prototype.needsNumFeatures=function(e){return this.useTileCount&&!e.hasPreciseFeatureCount&&!C(e)},Object.defineProperty(t.prototype,"maxRecordCount",{get:function(){var e=this.layerView.layer;if("tileMaxRecordCount"in e){if(this.capabilities.supportsResultType)return e.tileMaxRecordCount;if(e.maxRecordCount)return e.maxRecordCount}return P},enumerable:!0,configurable:!0}),t.prototype.queueFetchTile=function(e){var t=this;if(!e.needsFetching)return!1;var r=this._memCache&&this._memCache.pop(e.id);if(r)return e.loadCache(r),this.setDirty(),this.scheduleUpdated(),!0;e.fetchStatus=e.needsRefetching?3:2;var i=!1,n=this.fetchQueue.push(e).then(function(t){e.fetchRequest=null,e.fetchStatus=t}).catch(function(r){e.fetchRequest===n&&(e.fetchRequest=null,e.fetchStatus=4),r&&"cancel"===r.dojoType?i=!0:(e.setFeatures([],0),t.invalidateCounts(),e.featuresMissing=!1,R.error("#fetchTile()",t.layerView.layer,r&&r.message?r.message:r))}).then(function(){i||t.setDirty(),t.scheduleUpdated()});return n.isFulfilled()||(e.fetchRequest=n),!0},t.prototype.scheduleUpdated=function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(d.schedule(function(){e.handles.remove("scheduleUpdated"),e.updated()}),"scheduleUpdated")},t.prototype.showTile=function(e){if(e.displayingFeatures&&!e.needsDisplayUpdate)return!1;if(0===e.featureLimit||!e.features){var t=e.displayingFeatures&&e.displayingFeatures.length>0;return this.hideTileFeatures(e),e.displayingFeatures=[],t}for(var r=e.descriptor.resolution,i=this.changes.updates,n=this.changes.adds,s=0;s<e.featureLimit;++s){var a=e.features[s],o=S(a,this.objectIdField),u=this.displayingFeatureReferences.get(o);if(u){var l=u.ref(r,a);l.oldVersion!==l.newVersion&&(i.removes.push(l.oldVersion),i.adds.push(l.newVersion))}else this.displayingFeatureReferences.set(o,new this.FeatureReferenceClass(r,a)),n.push(a);this.numDisplayingFeatureReferences++}return this.hideTileFeatures(e),this.applyChanges(),e.displayingFeatures=e.features.slice(0,e.featureLimit),!0},t.prototype.hideTile=function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)},t.prototype.hideTileFeatures=function(e){if(e.displayingFeatures){for(var t=this.changes.updates,r=this.changes.removes,i=0,n=e.displayingFeatures;i<n.length;i++){var s=S(n[i],this.objectIdField),a=this.displayingFeatureReferences.get(s);if(a){var o=a.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,o?o.oldVersion!==o.newVersion&&(null==o.newVersion?(this.displayingFeatureReferences.delete(s),r.push(o.oldVersion)):(t.adds.push(o.newVersion),t.removes.push(o.oldVersion))):console.error("Hiding unreferenced feature")}}this.applyChanges(),e.displayingFeatures=null}},t.prototype.applyChanges=function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,r=this.changes.removes,i=Math.min(t.length,r.length),n=0;n<i;){var s=Math.min(n+j,i);this.features.addMany(t.slice(n,s)),this.features.removeMany(r.slice(n,s)),n=s}t.length>i&&this.features.addMany(0===n?t:t.slice(n)),r.length>i&&this.features.removeMany(0===n?r:r.slice(n)),t.length=0,r.length=0},t.prototype.clearTile=function(e){if(this.hideTile(e),e.features&&this._memCache){var t=16+e.estimatedSize;this._memCache.put(e.id,e.cacheItem,t)}e.setFeatures(null,0),this.invalidateCounts()},t.prototype.invalidateCounts=function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")},t.prototype.getListOfTiles=function(){var e=new Array(this.idToFeatureTile.size),t=0;return this.forEachFeatureTile(function(r){return e[t++]=r}),e},Object.defineProperty(t.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(e,t){return e+(t.features?t.features.length:0)},0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{update:function(t){e.fetchQueue.test.update(t),e.update(t)}}},enumerable:!0,configurable:!0}),t.prototype.maximumFeaturesForTile=function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:this.maximumNumberOfFeatures,r=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(t*r/(1-e.emptyFeatureRatio)),t)},i([f.property({constructOnly:!0})],t.prototype,"features",void 0),i([f.property()],t.prototype,"tileDescriptors",void 0),i([f.property({constructOnly:!0})],t.prototype,"tilingScheme",void 0),i([f.property({value:1/0})],t.prototype,"maximumNumberOfFeatures",null),i([f.property()],t.prototype,"useTileCount",void 0),i([f.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([f.property({readOnly:!0})],t.prototype,"updating",void 0),i([f.property({readOnly:!0})],t.prototype,"updatingTotal",void 0),i([f.property({readOnly:!0})],t.prototype,"updatingRemaining",void 0),i([f.property({readOnly:!0})],t.prototype,"expectedFeatureDiff",void 0),i([f.property({readOnly:!0})],t.prototype,"memoryForUnusedFeatures",null),i([f.property({readOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceeded",void 0),i([f.property({constructOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),i([f.property({readOnly:!0})],t.prototype,"totalVertices",null),i([f.property({readOnly:!0})],t.prototype,"totalFeatures",null),i([f.property()],t.prototype,"filterExtent",null),i([f.property({constructOnly:!0})],t.prototype,"verticalScale",void 0),i([f.property({constructOnly:!0})],t.prototype,"viewingMode",void 0),i([f.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],t)}(f.declared(o));t.FeatureTileFetcher3D=T,t.getFeatureId=S;var P=2e3,V=g.create(),I=g.create(),D={},G=6e5,j=200,M=1/3;t.default=T}.apply(null,i))||(e.exports=n)},2219:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(22),r(25),r(23),r(9),r(21),r(0),r(2220),r(2225),r(1697),r(1514),r(2226),r(1692)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c,h,d,y,f,g){return function(e){function t(t){var r=e.call(this)||this;return r._controllerTotal=0,r._graphicsCoreTotal=0,r.suspendResumeExtentMode="data",r}return r(t,e),Object.defineProperty(t.prototype,"updatingPercentageValue",{get:function(){var e=0,t=0;this.controller&&this.controller.updating&&(e+=this.controller.updatingRemaining,t=this.controller.updatingTotal);var r=0;this.graphics3d&&this.graphics3d.graphicsCore&&(e+=this.graphics3d.graphicsCore.updatingRemaining,r=this.graphics3d.graphicsCore.updatingTotal),0===t&&0===r?(this._controllerTotal=0,this._graphicsCoreTotal=0):(this._controllerTotal=Math.max(t,this._controllerTotal),this._graphicsCoreTotal=Math.max(r,this._graphicsCoreTotal));var i=this._controllerTotal+this._graphicsCoreTotal;return i?(i-e)/i*100:100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case"snapshot":return this.controller.serviceDataCount>5e3;case"tiles":return!0;default:o.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0}),t.prototype.fetchPopupFeatures=function(e,t){return a(this,void 0,void 0,function(){var e;return s(this,function(r){return(e=this.validateFetchPopupFeatures(t))?[2,u.reject(e)]:[2,this.fetchClientPopupFeatures(t)]})})},t.prototype.setVisibility=function(e,t){this.graphics3d.graphicsCore.setObjectIdVisibility(e,t)},t.prototype.createController=function(){return a(this,void 0,void 0,function(){var e,t=this;return s(this,function(r){return e=new c({layerView:this,graphics:new f.EventedSet,extent:this.clippingExtent}),this.handles.add(l.init(e,"serviceDataExtent",function(e){t.graphics3d&&(t.graphics3d.dataExtent=e)})),this.handles.add(l.init(this,"suspended",function(t){t?e.suspend():e.resume()},!0)),this.handles.add(l.init(this.graphics3d.graphicsCore,"displayFeatureLimit",function(){return t.updateDisplayFeatureLimit(e)})),this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",function(){return t.updateDisplayFeatureLimit()})),[2,e]})})},t.prototype.doRefresh=function(){!this.suspended&&h.isRefreshable(this.controller)&&this.controller.refresh()},t.prototype.getStats=function(){var e=this.inherited(arguments);if(this.controller&&e.features){var t=this.controller.debug;e.features+="/"+t.storedFeatures+"/"+t.totalFeatures,e.totalVertices=t.totalVertices}var r=this.controller&&this.controller.displayFeatureLimit,i=r&&r.maximumSymbolComplexity;e.numTiles=this.controller?this.controller.tileDescriptors.length:0,e.partial=this.maximumNumberOfFeaturesExceeded,e.mode=this.controller?this.controller.mode:"n/a",e.symbolComplexity=i?"f:"+i.primitivesPerFeature+",v:"+i.primitivesPerCoordinate:"n/a";var n=this.graphics3d&&this.graphics3d.graphicsCore,s=n?n.unprocessedMemoryEstimate:0,a=this.controller?this.controller.expectedFeatureDiff*n.usedMemoryPerGraphic:0,o=function(e){return""+(e/1024/1024).toFixed(1)};return e.memory="u:"+o(this.getUsedMemory())+", pc:"+o(s)+", pf:"+o(a)+" MB",e},t.prototype.getUsedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)},t.prototype.getUnloadedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*e.usedMemoryPerGraphic:0)},t.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride},t.prototype.updateDisplayFeatureLimit=function(e){if(void 0===e&&(e=this.controller),e&&this.graphics3d&&this.graphics3d.graphicsCore){var t=this.graphics3d.graphicsCore.displayFeatureLimit,r=this.view.resourceController.memoryController.memoryFactor;if(1===r)e.displayFeatureLimit=t;else{var i=Math.ceil(t.maximumNumberOfFeatures*r),s=Math.ceil(t.maximumTotalNumberOfFeatures*r),a=Math.ceil(t.minimumTotalNumberOfFeatures*r);e.displayFeatureLimit=n({},t,{maximumNumberOfFeatures:i,maximumTotalNumberOfFeatures:s,minimumTotalNumberOfFeatures:a})}}},i([p.property()],t.prototype,"layer",void 0),i([p.property()],t.prototype,"controller",void 0),i([p.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],t.prototype,"updatingPercentageValue",null),i([p.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],t.prototype,"maximumNumberOfFeatures",void 0),i([p.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([p.property(y.updatingPercentage)],t.prototype,"updatingPercentage",void 0),i([p.property({readOnly:!0,dependsOn:["controller.mode"]})],t.prototype,"asyncGraphicsUpdates",null),i([p.property()],t.prototype,"suspendResumeExtentMode",void 0),i([p.subclass("esri.views.3d.layers.FeatureLayerView3D")],t)}(p.declared(d,g))}.apply(null,i))||(e.exports=n)},2220:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(6),r(26),r(23),r(13),r(17),r(7),r(10),r(209),r(9),r(21),r(0),r(172),r(366),r(576),r(1696),r(1789),r(2224),r(63)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,p,c,h,d,y,f,g,m,v,b,x,_,w){var F=c.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),S=function(e){function t(t){var r=e.call(this)||this;return r.type="feature-tile-3d",r.serviceDataExtent=null,r.serviceDataCount=n.constants.NO_SERVICE_DATA_COUNT,r.vertexLimitExceeded=!1,r.displayFeatureLimit=null,r.suspended=!1,r.tileFetcher=null,r.handles=new l,r.fetchDataInfoPromise=null,r}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"extent",{set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("extent",r)}}else F.error("#extent=","extent needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||this.fetchDataInfoPromise)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){if(this.serviceDataCount===n.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var e=this.layerView,t=e.layer,r=e.view,i=r&&r.featureTiles,s=i&&i.tilingScheme;if(t&&t.minScale&&this.serviceDataExtent&&s){var a=this.approximateExtentSizeAtScale(t.minScale,s);if((this.serviceDataExtent.width/a+this.serviceDataExtent.height/a)/2>n.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTotalSnapshotVertices",{get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0;return Math.max(e,t)},enumerable:!0,configurable:!0}),t.prototype.approximateExtentSizeAtScale=function(e,t){var r=this.layerView.view,i=Math.ceil((r.width/t.pixelSize[0]+r.height/t.pixelSize[1])/2),n=t.levels[0];return i*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)},Object.defineProperty(t.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new a([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new a},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.handles.add(this.watch("vertexLimitInfo",function(){return e.updateVertexLimitExceeded()}));var t=d.resolve().then(function(){return e.verifyCapabilities()}).then(function(){return e.fetchServiceDataInfo()}).then(function(){return e.initializeTileFetcher()});this.addResolvingPromise(t)},t.prototype.verifyCapabilities=function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery"))throw new u("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})},t.prototype.destroy=function(){this.cancelFetchServiceDataInfo(),this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null),this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())},t.prototype.refresh=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.filtersChanged()};this.fetchServiceDataInfo().then(t,t)},t.prototype.initializeTileFetcher=function(){var e=this,t=this.layerView.view;this.handles.add(y.whenOnce(t.featureTiles,"tilingScheme",function(){e.handles.add(t.featureTiles.addClient());var r=e,i=r.layerView,n=r.tileDescriptors,s=i.layer,a=new b({sourceSpatialReference:s.spatialReference,destSpatialReference:t.spatialReference});e.tileFetcher=new x.FeatureTileFetcher3D({layerView:i,filterExtent:e.filteredDataExtent,tilingScheme:t.featureTiles.tilingScheme,tileDescriptors:n,features:e.graphics,verticalScale:a,viewingMode:t.viewingMode}),e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();e.handles.add([s.watch("definitionExpression",function(){return e.definitionExpressionChanged()}),i.watch("availableFields",function(t,r){return e.attributesChanged(r,t)}),s.on("apply-edits",function(t){return e.applyEdits(t)}),e.watch("filteredDataExtent",function(t){return e.tileFetcher.filterExtent=t},!0),e.watch("tileDescriptors",function(t){return e.tileFetcher.tileDescriptors=t},!0),y.init(e,"maximumNumberOfFeatures",function(t){e.tileFetcher.maximumNumberOfFeatures=t,e.tileFetcher.useTileCount=e.serviceDataCount>t},!0),y.init(e,"serviceDataCount",function(t){return e.tileFetcher.useTileCount=t>e.maximumNumberOfFeatures},!0),y.init(w,"FEATURE_TILE_FETCH_SHOW_TILES",function(r){r&&e.tileFetcher&&!e.tileFetcher.debugger?(e.tileFetcher.debugger=new _.FeatureTileFetcher3DDebugger(e.tileFetcher,t.featureTiles.tilingScheme.toTileInfo(),t),e.tileFetcher.debugger.update()):!r&&e.tileFetcher&&e.tileFetcher.debugger&&(e.tileFetcher.debugger.destroy(),e.tileFetcher.debugger=null)})]),e.supportsExceedsLimitQuery||e.watch("maxTotalSnapshotVertices",function(){return e.updateVertexLimitExceeded()})}))},t.prototype.definitionExpressionChanged=function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refresh()},t.prototype.applyEdits=function(e){var t=this;this.tileFetcher.applyEdits(e).then(function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.updateServiceDataExtent()})},t.prototype.attributesChanged=function(e,t){if(!e||-1===e.indexOf("*"))if(e&&t){for(var r=new Set,i=0,n=e;i<n.length;i++){var s=n[i];r.add(s)}for(var a=0,o=t;a<o.length;a++){s=o[a];if(!r.has(s))return void this.refresh()}}else this.refresh()},t.prototype.createVertexLimitExceededQuery=function(e){var t=this.layerView.layer.createQuery();return t.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t},t.prototype.createDataInfoQuery=function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsResultType&&(t.resultType="tile"),t},t.prototype.fullExtentIsAccurate=function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":case"stream":return g.isHostedAgolService(e.url);case"csv":case"geojson":return!0;default:o.neverReached(e)}},t.prototype.updateServiceDataExtent=function(){var e=this,t=this.layerView,r=t.layer,i=r.capabilities.query.supportsExtent,s=p.clone(t.fullExtentInLocalViewSpatialReference),a=r.fullExtent,o=this.fullExtentIsAccurate(),u=this.serviceDataCount,l=null;if(i&&u<=n.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!s||!o)){var c=this.createDataInfoQuery();l=r.queryExtent(c,{timeout:n.constants.QUERY_EXTENT_TIMEOUT}).then(function(t){e._set("serviceDataExtent",t.extent)})}else if(s)this._set("serviceDataExtent",s);else if(a){var h="portalItem"in r?r.portalItem:null;l=m.projectGeometry(a,t.view.spatialReference,h).then(function(t){e._set("serviceDataExtent",t)})}else this._set("serviceDataExtent",null);return l&&(l=l.catch(function(t){t&&"cancel"===t.dojoType||e._set("serviceDataExtent",s)})),l},t.prototype.updateServiceDataCount=function(){var e=this;return this.layerView.layer.queryFeatureCount(this.createDataInfoQuery(),{timeout:n.constants.QUERY_STATISTICS_TIMEOUT}).then(function(t){e._set("serviceDataCount",t)}).catch(function(t){if(t&&"cancel"===t.dojoType)throw t;var r=n.constants.NO_SERVICE_DATA_COUNT;e._set("serviceDataCount",r)})},Object.defineProperty(t.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var e=this.displayFeatureLimit,t=e.maximumSymbolComplexity,r=e.maximumTotalNumberOfPrimitives,i=t.primitivesPerCoordinate,n=t.primitivesPerFeature,s=this._get("vertexLimitInfo");return s&&s.maximumTotalNumberOfPrimitives===r&&s.primitivesPerCoordinate===i&&s.primitivesPerFeature===n?s:{primitivesPerCoordinate:i,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:r}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsExceedsLimitQuery",{get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var e=this.layerView.layer.geometryType;switch(e){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return o.neverReached(e),0}},enumerable:!0,configurable:!0}),t.prototype.updateVertexLimitExceeded=function(e){var t=this,r=this.vertexLimitInfo&&this.vertexLimitInfo.primitivesPerFeature<=0,i=this.layerView.layer,s=this.supportsExceedsLimitQuery;if(!r)return this._set("vertexLimitExceeded",!1),d.resolve();var a=this.vertexLimitInfo,o=a.primitivesPerFeature,u=a.primitivesPerCoordinate,l=a.maximumTotalNumberOfPrimitives,p=0!==o;return d.when(p?e:null).then(function(){var e,r=t.serviceDataCount,a=r!==n.constants.NO_SERVICE_DATA_COUNT;return e=a?Math.ceil((l-r*o)/(u||1)):Math.ceil(l/(u||1)),a&&t.minimumNumberOfVerticesForGeometry*r>e?void t._set("vertexLimitExceeded",!0):s?i.queryFeatures(t.createVertexLimitExceededQuery(e),{timeout:n.constants.QUERY_STATISTICS_TIMEOUT}).then(function(e){var r=e.features[0];r&&r.attributes?t._set("vertexLimitExceeded",!!r.attributes.exceedslimit):t._set("vertexLimitExceeded",!1)}).catch(function(e){if(e&&"cancel"===e.dojoType)throw e;t._set("vertexLimitExceeded",!1)}):void t._set("vertexLimitExceeded",t.maxTotalSnapshotVertices>e)})},t.prototype.fetchServiceDataInfo=function(){var e=this;this.cancelFetchServiceDataInfo();var t=d.eachAlways([this.updateServiceDataCount(),this.updateVertexLimitExceeded()]),r=t.then(function(){return e.updateServiceDataExtent()}).catch(function(e){e&&"AbortError"===e.name||F.error("#fetchServiceDataInfo()",e)}).then(function(){r===e.fetchDataInfoPromise&&(e.fetchDataInfoPromise=null)});return r.isFulfilled()||(this.fetchDataInfoPromise=r),t.catch(function(){})},t.prototype.cancelFetchServiceDataInfo=function(){var e=this.fetchDataInfoPromise;e&&(this.fetchDataInfoPromise=null,e.cancel())},Object.defineProperty(t.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0}),i([f.property({readOnly:!0})],t.prototype,"type",void 0),i([f.property({constructOnly:!0})],t.prototype,"graphics",void 0),i([f.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([f.property()],t.prototype,"extent",null),i([f.property({dependsOn:["tileFetcher.updating","fetchDataInfoPromise"]})],t.prototype,"updating",null),i([f.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],t.prototype,"updatingTotal",null),i([f.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],t.prototype,"updatingRemaining",null),i([f.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],t.prototype,"expectedFeatureDiff",null),i([f.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],t.prototype,"memoryForUnusedFeatures",null),i([f.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([f.property({readOnly:!0})],t.prototype,"serviceDataExtent",void 0),i([f.property({readOnly:!0})],t.prototype,"serviceDataCount",void 0),i([f.property({readOnly:!0})],t.prototype,"vertexLimitExceeded",void 0),i([f.property({readOnly:!0,dependsOn:["extent"]})],t.prototype,"filteredDataExtent",null),i([f.property()],t.prototype,"displayFeatureLimit",void 0),i([f.property({type:Number,dependsOn:["displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),i([f.property({readOnly:!0,dependsOn:["serviceDataCount","displayFeatureLimit","maximumNumberOfFeatures","vertexLimitExceeded","serviceDataExtent","layerView.layer.minScale","layerView.view.featureTiles.tilingScheme"]})],t.prototype,"mode",null),i([f.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],t.prototype,"maxTotalSnapshotVertices",null),i([f.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"tileDescriptors",null),i([f.property()],t.prototype,"tileFetcher",void 0),i([f.property()],t.prototype,"fetchDataInfoPromise",void 0),i([f.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],t.prototype,"vertexLimitInfo",null),n=i([f.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],t)}(f.declared(s,h));return function(e){!function(e){e.NO_SERVICE_DATA_COUNT=1/0,e.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,e.reset=function(){e.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,e.QUERY_STATISTICS_TIMEOUT=12e3,e.QUERY_EXTENT_TIMEOUT=1e4}}(e.constants||(e.constants={}))}(S||(S={})),S.constants.reset(),S}.apply(null,i))||(e.exports=n)},2221:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(128)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.highestResolutionVersion=null,this.versions=[],this.markedTile=null,this.ref(e,t)}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){var i=this.feature;s.oldVersion=i,this.feature&&(t.uid=this.feature.uid);for(var n=0,a=this.versions;n<a.length;n++){var o=a[n];if(o.resolution===e){o.refCount++;var u=this.highestResolutionVersion===o&&!r.equals(t,o.feature);return(u||this.highestResolutionVersion!==o)&&(o.feature=t),s.newVersion=u?t:i,s}}var l={feature:t,resolution:e,refCount:1};return this.versions.push(l),!this.highestResolutionVersion||e<this.highestResolutionVersion.resolution?(s.newVersion=t,this.highestResolutionVersion=l):s.newVersion=i,s},e.prototype.unref=function(e){for(var t=0;t<this.versions.length;t++){var r=this.versions[t];if(r.resolution===e)return r.refCount--,s.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r&&(this.recalculateHighestResolutionVersion(),s.oldVersion=r.feature)),s.newVersion=this.feature,s}return null},Object.defineProperty(e.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0}),e.prototype.recalculateHighestResolutionVersion=function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var r=this.versions[t];r.resolution<e.resolution&&(e=r)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null},e}();t.MultiFeatureReference=i;var n=function(){function e(e,t){this._feature=t,this.refCount=1,this.markedTile=null}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){return++this.refCount,s.oldVersion=this._feature,this.feature&&(t.uid=this.feature.uid),r.equals(this._feature,t)||(this._feature=t),s.newVersion=this._feature,s},e.prototype.unref=function(e){return s.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(s.newVersion=null,s):(s.newVersion=this._feature,s)},Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0}),e}();t.SingleFeatureReference=n;var s={oldVersion:null,newVersion:null}}.apply(null,i))||(e.exports=n)},2222:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(52),r(37),r(128),r(1789)],void 0===(n=function(e,t,r,i,n,s){var a=function(){function e(t){this.descriptor=t,this.fetchRequest=null,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=e.UNKNOWN_COUNT,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=-1,this.displayingFeatures=null,this.alive=!0,this.filtered=!1}return Object.defineProperty(e.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedSize=-1,this._estimatedUnusedSize=-1)},enumerable:!0,configurable:!0}),e.prototype.setFeatures=function(e,t){this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSize=-1,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce(function(e,t){return e+n.numVertices(t.geometry)},0)):(this._emptyFeatureRatio=0,this._numVertices=0)},Object.defineProperty(e.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._numFeatures!==e.UNKNOWN_COUNT?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures!==e.UNKNOWN_COUNT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedSize",{get:function(){if(this._estimatedSize<0&&(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features))for(var e=0;e<this._features.length;++e){var t=n.estimateSize(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return this._estimatedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedUnusedSize",{get:function(){if(this._estimatedUnusedSize<0&&(this._estimatedUnusedSize=0,this._features))for(var e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=n.estimateSize(this._features[e]);return this._estimatedUnusedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsDisplayUpdate",{get:function(){return!!this._features&&!function(e,t,r){if(!t||!e||r!==t.length||r>e.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)},enumerable:!0,configurable:!0}),e.prototype.intersects=function(e){return!e||!this.descriptor.extent||(i.fromExtent(e,o),i.intersects(this.descriptor.extent,o))},e.prototype.intersection=function(e,t){return e||this.descriptor.extent?(e?(i.fromExtent(e,t),this.descriptor.extent&&i.intersection(t,this.descriptor.extent,t)):i.set(t,this.descriptor.extent),t):(i.set(t,i.POSITIVE_INFINITY),t)},e.prototype._shuffle=function(e){this._features.sort(function(t,r){return s.getFeatureId(t,e)-s.getFeatureId(r,e)}),r.shuffle(this._features,16438),this._shuffled=!0,this._estimatedUnusedSize=-1},e.prototype.reduceFeatures=function(e,t){if(e<=0)return!1;var r=!1;return this._features?(this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,r=!0)),!this._shuffled&&e<1&&this._shuffle(t)):this.featureLimit=0,r},Object.defineProperty(e.prototype,"cacheItem",{get:function(){return{features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},enumerable:!0,configurable:!0}),e.prototype.loadCache=function(e){this.fetchRequest=null,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSize=-1},e}();(a||(a={})).UNKNOWN_COUNT=-1;var o=i.create();return a}.apply(null,i))||(e.exports=n)},2223:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(0),r(128),r(1466)],void 0===(n=function(e,t,r,i,n,s,a,o){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"queryFeaturesDehydrated",{get:function(){var e=this,t=this.layer.capabilities,r=t&&t.query;if(r&&r.supportsFormatPBF){var i={type:"dehydrated",applyTransform:!0,useWorker:!0,maxStringAttributeLength:1024};return function(t,r){return o.executeQueryPBF(e.layer.parsedUrl,t,i,r).then(function(e){return e.data})}}return function(t,r){return o.executeQuery(e.layer.parsedUrl,t,r).then(function(e){return a.fromFeatureSetJSON(e.data)})}},enumerable:!0,configurable:!0}),i([s.property({constructOnly:!0})],t.prototype,"layer",void 0),i([s.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],t.prototype,"queryFeaturesDehydrated",null),i([s.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t)}(s.declared(n)),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryFeaturesDehydrated=function(e,t){var r=this;return this.source.queryFeaturesJSON(e).then(a.fromFeatureSetJSON,function(t){if(t&&"query-features-json:unsupported"===t.name)return r.source.queryFeatures(e);throw t})},i([s.property({constructOnly:!0})],t.prototype,"layer",void 0),i([s.aliasOf("layer.source")],t.prototype,"source",void 0),i([s.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],t)}(s.declared(n));t.createFeatureTileQuery3D=function(e){switch(e.source.type){case"feature-layer":return new u({layer:e});case"memory":case"csv":case"geojson":return new l({layer:e});case"stream-layer":throw new Error("Tile based queries unsupported for stream sources")}}}.apply(null,i))||(e.exports=n)},2224:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(79),r(65),r(186),r(223),r(224),r(162),r(226)],void 0===(n=function(e,t,r,i,n,s,a,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],p=function(){function e(e,t,r){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=e,this.view=r,this.tilingScheme=new u(t),this.loadedSymbols=l.map(function(e){return new a(new n({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))}),this.loadingSymbols=[new a(new n({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new a(new n({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new a(new n({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return e.prototype.destroy=function(){this.enabled=!1},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))},e.prototype.showDataExtent=function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=i.fromExtent(e);this.dataExtentGraphic=new r({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}},e.prototype.synchronizeMaps=function(e,t){var i=this,n=[];e.forEach(function(e,r){var s=i.tileFetcher.getFeatureTileById(r);s&&t.filter(s)||(i.view.graphics.removeMany(e),n.push(r))}),n.forEach(function(t){return e.delete(t)}),this.tileFetcher.forEachFeatureTile(function(n){if(t.filter(n)&&!e.has(n.id)){var a=n.descriptor.lij,u=a[0],l=a[1],p=a[2];i.tilingScheme.ensureMaxLod(u);var c=i.tilingScheme.getExtentGeometry(u,l,p),h=[new r({geometry:c,symbol:t.symbols[u%t.symbols.length]}),new r({geometry:c.center,symbol:new s({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new o({text:u+"/"+l+"/"+p,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(n.id,h),i.view.graphics.addMany(h)}})},e}();t.FeatureTileFetcher3DDebugger=p,t.default=p}.apply(null,i))||(e.exports=n)},2225:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isRefreshable=function(e){return e&&e.refresh}}.apply(null,i))||(e.exports=n)},2226:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(154),r(170),r(138)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._set=new n.default,t}return r(t,e),t.prototype.clear=function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("change",{added:[],removed:e})}},Object.defineProperty(t.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0}),t.prototype.addMany=function(e){if(0!==e.length){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._set.add(i)}this.emit("change",{added:e,removed:[]})}},t.prototype.removeMany=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this._set.delete(n)&&t.push(n)}t.length>0&&this.emit("change",{added:[],removed:t})},t.prototype.toArray=function(){return i.from(this._set)},t.prototype.find=function(e){for(var t=this._set.entries(),r=t.next();!r.done;r=t.next())if(e(r.value[0]))return r.value[0]},t.prototype.forEach=function(e){this._set.forEach(function(t){return e(t)})},t}(s.Evented);t.EventedSet=a}.apply(null,i))||(e.exports=n)}}]);