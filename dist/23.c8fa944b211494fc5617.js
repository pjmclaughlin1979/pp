(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/webgl-engine/lib/HighlightSet":1551,"esri/core/libs/rbush/PooledRBush":1558,"esri/views/3d/layers/graphics/constants":1575,"esri/views/3d/layers/graphics/Graphics3DCore":1576,"esri/renderers/support/rendererConversion":1577,"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":1578,"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":1579,"esri/views/3d/layers/graphics/Graphics3DPointSymbol":1580,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":1581,"esri/views/3d/layers/graphics/Graphics3DHighlights":1582,"esri/views/3d/layers/graphics/Graphics3DHighlightSet":1583,"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":1584,"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":1585,"esri/core/libs/quickselect/quickselect":1603,"esri/views/3d/layers/graphics/Graphics3DGraphicLikeLayerView":1749})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{1551:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,i){this.items.push({type:"renderGeometry",highlightId:t,renderGeometry:e,owner:i})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];i.highlightId===e&&(this.removeHighlight(i),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];"object"===i.type&&i.object===e&&(this.removeHighlight(i),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];"renderGeometry"===i.type&&i.renderGeometry===e&&(this.removeHighlight(i),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.owner.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,r))||(e.exports=n)},1558:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(88),i(1603)],void 0===(n=function(e,t,i,r){function n(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function a(e,t){s(e,0,e.children.length,t,e)}function s(e,t,i,r,n){n||(n=f(null,!0)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a=t,s=void 0;a<i;a++)s=e.children[a],o(n,e.leaf?r(s):s);return n}function o(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function c(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function u(e,t){var i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,a-r)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e,t){return{children:e,height:1,leaf:t,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,t,i,n,a){for(var s=[t,i];s.length;)if(!((i=s.pop())-(t=s.pop())<=n)){var o=t+Math.ceil((i-t)/n/2)*n;r(e,o,t,i,a),s.push(t,o,o,i)}}Object.defineProperty(t,"__esModule",{value:!0});var b=function(){function e(e,t){void 0===e&&(e=9),this.compareMinX=l,this.compareMinY=h,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}return e.prototype.destroy=function(){this.clear(),v.prune(),x.prune(),S.prune(),w.prune()},e.prototype.all=function(e){this._all(this.data,e)},e.prototype.search=function(e,t){var i=this.data,r=this.toBBox;if(g(e,i))for(v.clear();i;){for(var n=0,a=i.children.length;n<a;n++){var s=i.children[n],o=i.leaf?r(s):s;g(e,o)&&(i.leaf?t(s):y(e,o)?this._all(s,t):v.push(s))}i=v.pop()}},e.prototype.collides=function(e){var t=this.data,i=this.toBBox;if(!g(e,t))return!1;for(v.clear();t;){for(var r=0,n=t.children.length;r<n;r++){var a=t.children[r],s=t.leaf?i(a):a;if(g(e,s)){if(t.leaf||y(e,s))return!0;v.push(a)}}t=v.pop()}return!1},e.prototype.load=function(e,t){if(void 0===t&&(t=e.length),!t)return this;if(t<this._minEntries){for(var i=0,r=t;i<r;i++)this.insert(e[i]);return this}var n=this._build(e.slice(0,t),0,t-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var a=this.data;this.data=n,n=a}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data=f([],!0),this},e.prototype.remove=function(e,t){if(!e)return this;var i,r,a,s,o=this.data,l=this.toBBox(e);for(S.clear(),w.clear();o||S.length;){if(o||(o=S.pop(),i=S.data[S.length-1],r=w.pop(),a=!0),o.leaf&&-1!==(s=n(e,o.children,t)))return o.children.splice(s,1),S.push(o),this._condense(S),this;a||o.leaf||!y(o,l)?i?(r++,o=i.children[r],a=!1):o=null:(S.push(o),w.push(r),r=0,i=o,o=o.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return this.data=e,this},e.prototype._all=function(e,t){for(x.clear();e;){if(!0===e.leaf)for(var i=0,r=e.children;i<r.length;i++){t(r[i])}else x.pushArray(e.children);e=x.pop()}},e.prototype._build=function(e,t,i,r){var n,s=i-t+1,o=this._maxEntries;if(s<=o)return a(n=f(e.slice(t,i+1),!0),this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),(n=f([],!1)).height=r;var l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));m(e,t,i,h,this.compareMinX);for(var p=t;p<=i;p+=h){var c=Math.min(p+h-1,i);m(e,p,c,l,this.compareMinY);for(var d=p;d<=c;d+=l){var u=Math.min(d+l-1,c);n.children.push(this._build(e,d,u,r-1))}}return a(n,this.toBBox),n},e.prototype._chooseSubtree=function(e,t,i,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==i;){for(var n=1/0,a=1/0,s=void 0,o=0,l=t.children.length;o<l;o++){var h=t.children[o],c=p(h),u=d(e,h)-c;u<a?(a=u,n=c<n?c:n,s=h):u===a&&c<n&&(n=c,s=h)}t=s||t.children[0]}return t},e.prototype._insert=function(e,t,i){var r=this.toBBox,n=i?e:r(e);S.clear();var a=this._chooseSubtree(n,this.data,t,S);for(a.children.push(e),o(a,n);t>=0&&S.data[t].children.length>this._maxEntries;)this._split(S,t),t--;this._adjustParentBBoxes(n,S,t)},e.prototype._split=function(e,t){var i=e.data[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var s=this._chooseSplitIndex(i,n,r),o=f(i.children.splice(s,i.children.length-s),i.leaf);o.height=i.height,a(i,this.toBBox),a(o,this.toBBox),t?e.data[t-1].children.push(o):this._splitRoot(i,o)},e.prototype._splitRoot=function(e,t){this.data=f([e,t],!1),this.data.height=e.height+1,a(this.data,this.toBBox)},e.prototype._chooseSplitIndex=function(e,t,i){var r,n,a;r=n=1/0;for(var o=t;o<=i-t;o++){var l=s(e,0,o,this.toBBox),h=s(e,o,i,this.toBBox),c=u(l,h),d=p(l)+p(h);c<r?(r=c,a=o,n=d<n?d:n):c===r&&d<n&&(n=d,a=o)}return a},e.prototype._chooseSplitAxis=function(e,t,i){var r=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:h;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},e.prototype._allDistMargin=function(e,t,i,r){e.children.sort(r);for(var n=this.toBBox,a=s(e,0,t,n),l=s(e,i-t,i,n),h=c(a)+c(l),p=t;p<i-t;p++){var d=e.children[p];o(a,e.leaf?n(d):d),h+=c(a)}for(p=i-t-1;p>=t;p--){d=e.children[p];o(l,e.leaf?n(d):d),h+=c(l)}return h},e.prototype._adjustParentBBoxes=function(e,t,i){for(var r=i;r>=0;r--)o(t.data[r],e)},e.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e.data[t].children.length?t>0?(i=e.data[t-1].children).splice(i.indexOf(e.data[t]),1):this.clear():a(e.data[t],this.toBBox)},e.prototype._initFormat=function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")},e}();t.PooledRBush=b;var v=new i,x=new i,S=new i,w=new i({deallocator:null});t.default=b}.apply(null,r))||(e.exports=n)},1575:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2}.apply(null,r))||(e.exports=n)},1576:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(22),i(25),i(43),i(359),i(62),i(6),i(52),i(23),i(13),i(17),i(179),i(10),i(92),i(32),i(132),i(80),i(88),i(9),i(21),i(0),i(3),i(45),i(37),i(126),i(128),i(555),i(1577),i(81),i(560),i(573),i(178),i(570),i(1578),i(1579),i(571),i(72),i(181),i(51),i(137),i(85),i(375),i(368)],void 0===(n=function(e,t,i,r,n,a,s,o,l,h,p,c,d,u,y,g,f,m,b,v,x,S,w,C,G,D,E,_,V,R,I,O,P,U,M,A,L,j,F,B,T,H,z,q,X,Y){var k=new s.Point,W=G.vec3f64.create(),N=D.create(),Q=g.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),J=function(e){function t(t){var i=e.call(this)||this;return i.propertiesPool=new z.PropertiesPool({computedExtent:s.Extent},i),i.computedExtent=null,i.currentRenderer=null,i.rendererHasGeometryOperations=!1,i.symbolCreationContext=new L.Graphics3DSymbolCreationContext,i.graphics=new Map,i.stageLayer=null,i.stage=null,i.graphicsDrapedUids=new Set,i.graphicsBySymbol=new Map,i.symbolConversionCache=new Map,i.symbols=new Map,i.graphicsWithoutSymbol={},i.graphicsWaitingForSymbol=new Set,i.lastFastUpdate=null,i.handles=new u,i.viewSR=null,i.elevationAlignment=null,i.scaleVisibility=null,i.filterVisibility=null,i.spatialIndex=null,i.deconfliction=null,i.labeling=null,i.highlights=null,i.viewElevationProvider=null,i.sharedSymbolResourcesOwnerHandle=null,i.whenGraphics3DGraphicRequests={},i.pendingUpdates=new Map,i.pendingAdds=0,i.pendingRemoves=0,i.pendingUpdatesPool=new x({allocator:function(e){return e||{add:null,remove:null}},deallocator:function(e){return e.add=null,e.remove=null,e}}),i.symbolWarningLogged=!1,i.geometryWarningLogged=!1,i.objectIdInvisibleSet=new Set,i._whenSymbolRemoved=new x,i.asyncUpdates=!1,i.elevationFeatureExpressionEnabled=!0,i.owner=null,i.layer=null,i.hasDraped=!1,i.graphicSymbolSupported=!0,i._usedMemory=0,i.numberOfGraphics=0,i._visible=void 0,i._startCreateGraphics=!1,i.maxPendingUpdates=0,i}var h;return i(t,e),h=t,Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsWaitingForSymbol.size>0||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayFeatureLimit",{get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfPrimitives:0,n=this.maxSymbolComplexity,a=Math.max(t,Math.min(i,Math.ceil(r/Math.max(1,n?n.primitivesPerFeature:1)))),s=this._get("displayFeatureLimit");return s&&s.minimumTotalNumberOfFeatures===t&&s.maximumTotalNumberOfFeatures===i&&s.maximumTotalNumberOfPrimitives===r&&s.maximumSymbolComplexity===n&&s.maximumNumberOfFeatures===a?s:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:i,maximumTotalNumberOfPrimitives:r,maximumSymbolComplexity:n,maximumNumberOfFeatures:a}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSymbolComplexity",{get:function(){for(var e=null,t=0,i=this.getSymbolComplexities();t<i.length;t++){var r=i[t];e?0===e.primitivesPerCoordinate&&r.primitivesPerFeature>e.primitivesPerFeature?e=r:0!==e.primitivesPerCoordinate&&r.primitivesPerCoordinate>e.primitivesPerCoordinate&&(e=r):e=r}var n=this._get("maxSymbolComplexity");return!e||n&&n.primitivesPerFeature===e.primitivesPerFeature&&n.primitivesPerCoordinate===e.primitivesPerCoordinate?n:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0}),t.prototype.getSymbolComplexities=function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},t.prototype.getConvertedSymbol=function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var i=P.to3D(e,!0,!1,this.hasLabelingContext(e)),r=i.symbol||null;return r||i.error&&Q.error(i.error.message),this.symbolConversionCache.set(e.id,r),r},t.prototype.getSymbolComplexitiesUsedOrRenderer=function(e){var t=e.getSymbols();if(!t||!t.length)return[];for(var i=[],r=0,n=t;r<n.length;r++){var a=n[r],s=this.symbols.get(a.id);if(s)i.push(s.complexity);else{var o=this.getConvertedSymbol(a);o&&i.push(T.defaultSymbolComplexity(o))}}return i},t.prototype.getSymbolComplexitiesUsed=function(){var e=[];return this.symbols.forEach(function(t){t&&e.push(t.complexity)}),e},t.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference},t.prototype.setup=function(e){var t=this;this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("filterVisibility",e.filterVisibility),this._set("spatialIndex",e.spatialIndex),this._set("deconfliction",e.deconfliction),this._set("labeling",e.labeling),this._set("highlights",e.highlights);var i=this.owner.view;this.viewElevationProvider=new U.ViewElevationProvider(this.viewSR,i),this.initializeStage(i,this.layer.uid),this.symbolCreationContext.sharedResources=i.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=i.sharedSymbolResources.addGraphicsOwner(this.owner),this.symbolCreationContext.renderer=this.currentRenderer,this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataSupplier=i.sharedSymbolResources.streamDataSupplier,this.symbolCreationContext.renderSpatialReference=i.renderSpatialReference,this.symbolCreationContext.renderCoordsHelper=i.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.layerOrder=0,this.symbolCreationContext.localOriginFactory=new X,this.symbolCreationContext.elevationProvider=i.elevationProvider,this.symbolCreationContext.isAsync=this.asyncUpdates;var r=M.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=M.createContext(r,this.viewSR,Q),this.symbolCreationContext.screenSizePerspectiveEnabled=i.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.handles.add(this.owner.watch("suspended",function(){return t.updateLayerVisibility()}));var n="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this.handles.add([this.owner.watch(n,function(){var e=i.screenSizePerspectiveEnabled&&t.layer.screenSizePerspectiveEnabled;e!==t.symbolCreationContext.screenSizePerspectiveEnabled&&(t.symbolCreationContext.screenSizePerspectiveEnabled=e,t.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",function(e){return t.slicePlaneEnabledChange(!!e)}),this.owner.view.watch("pixelRatio",function(e){return t.pixelRatioChange(e)}),w.when(i.basemapTerrain,"tilingScheme",function(e){e.spatialReference.equals(t.symbolCreationContext.overlaySR)||(t.symbolCreationContext.overlaySR=i.basemapTerrain.spatialReference),t.handles.has("loaded-graphics")?t.recreateAllGraphics():t.handles.add(w.on(t.owner,"loadedGraphics","change",function(e){return t.graphicsCollectionChanged(e)},function(){return t.recreateAllGraphics()}),"loaded-graphics")}),i.resourceController.scheduler.registerTask(3,function(e){return t.update(e)},function(){return t.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return t.deconfliction.featureReductionChange()})),this.rendererChange(this.layer.renderer),this.notifyChange("maxSymbolComplexity")},t.prototype.destroy=function(){for(var e in this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this.clear(),this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(q.ModelContentType.LAYER,this.stageLayer.id),this.stageLayer=null,this.stage=null),this.handles.destroy(),this.handles=null,this.viewSR=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new d("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear()},t.prototype.clear=function(){this.graphics.forEach(function(e){return e.destroy()}),this.spatialIndex&&this.spatialIndex.clear(),this.graphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach(function(e){e&&e.destroy()}),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol={},this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this.pendingAdds=0,this.pendingRemoves=0,this._set("hasDraped",!1),this.notifyChange("updating"),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.initializeStage=function(e,t){this.stage=e._stage,this.stageLayer=new Y(t,{isPickable:!this.owner.suspended},t),this.stage.add(q.ModelContentType.LAYER,this.stageLayer),this.stage.addToViewContent([this.stageLayer.id])},t.prototype.setDrawingOrder=function(e){this.symbolCreationContext.layerOrder=e;var t=new Set;this.symbols.forEach(function(i){i&&i.setDrawOrder(e,t)}),t.size>0&&this.stage.getDrapedRenderer().updateRenderOrder(t)},t.prototype.updateLayerVisibility=function(){var e=!!this.owner.suspended,t=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*ee,i=!e&&!t;i!==this._visible&&(this._visible=i,i?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())},t.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0}),t.prototype.getGraphics3DGraphicById=function(e){return this.graphics.get(e)},t.prototype._getGraphicObjectID=function(e,t){return void 0===t&&(t=this.owner.layer&&this.owner.layer.objectIdField),null!=e.objectId?e.objectId:t&&e.attributes[t]},Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){var e=this,t=this.owner.layer&&this.owner.layer.objectIdField;if(!t)return null;var i=new Map;return this.graphics.forEach(function(r){if(r){var n=r.graphic,a=e._getGraphicObjectID(n,t);m.isSome(a)&&i.set(a,r)}}),i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0}),t.prototype.updateLabelingInfo=function(e){var t=this.deconfliction&&this.deconfliction.labelingInfoChange(e),i=this.labeling&&this.labeling.labelingInfoChange(e);return S.all([t,i]).then()},t.prototype.updateVisibilityInfo=function(){this.deconfliction&&this.deconfliction.labelingInfoChange(),this.labeling&&this.labeling.visibilityInfoChange()},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,i=0;return y.everyMap(this.symbols,function(r,n){if(r){var a=r.getFastUpdateStatus();if(a.loading>0)return!1;e.graphicsBySymbol.has(n)&&(i+=a.fast,t+=a.slow)}})?i>=0&&0===t?"fast":t>=0&&0===i?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.pendingUpdates.size>0||!!this.lastFastUpdate&&b()-this.lastFastUpdate>500},t.prototype.update=function(e){var t=this.needsUpdate();this._applyPendingUpdates(e),!e.done&&this.lastFastUpdate&&(this.lastFastUpdate=null),t!==this.needsUpdate()&&this.notifyChange("updating")},t.prototype.setObjectIdVisibility=function(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);var i=this._findGraphics3DGraphicByObjectId(e);m.isSome(i)&&this._updateUserVisibility(i)},t.prototype._findGraphics3DGraphicByObjectId=function(e){var t,i=this;return y.everyMap(this.graphics,function(r){return i._getGraphicObjectID(r.graphic)!==e||(t=r,!1)}),t},t.prototype._updateUserVisibility=function(e){if(m.isNone(e))return!1;var t=e.graphic,i=this._getGraphicObjectID(t),r=t.visible&&!this.owner.suspended&&(m.isNone(i)||!this.objectIdInvisibleSet.has(i));return e.setVisibilityFlag(0,r,0)},t.prototype.whenGraphics3DGraphic=function(e){var t=this.graphics.get(e.uid);if(t)return S.resolve(t);var i=this.whenGraphics3DGraphicRequests[e.uid];if(i)return i.promise;var r=S.createDeferred();return this.whenGraphics3DGraphicRequests[e.uid]=r,r.promise},t.prototype.boundsForGraphics3DGraphic=function(e,t){return a(this,void 0,void 0,function(){var i,r,a,s,o,l,h,p,c,d;return n(this,function(n){switch(n.label){case 0:return i=this.owner.view.spatialReference,r=this.owner.view.renderSpatialReference,a=this.owner.view.basemapTerrain.spatialReference,s=function(e,t,n){return H.bufferToBuffer(e,r,t,e,i,t,n)},o=function(e,t,r){return H.bufferToBuffer(e,a,t,e,i,t,r)},l=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:t&&t.useViewElevation,minDemResolution:t&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,e.getProjectedBoundingBox(s,o,l)];case 1:return(h=n.sent())?(p=h.boundingBox,h.requiresDrapedElevation&&(c=this.symbolCreationContext.elevationProvider)&&(D.center(p,W),k.x=W[0],k.y=W[1],k.z=void 0,k.spatialReference=i,d=c.getElevation(k)||0,p[2]=Math.min(p[2],d),p[5]=Math.max(p[5],d)),[2,{boundingBox:p,screenSpaceObjects:h.screenSpaceObjects}]):[2,null]}})})},t.prototype.whenGraphicBounds=function(e,t){var i=this;return w.whenOnce(this.owner,"loadedGraphics").then(function(){var t=i.owner.layer&&i.owner.layer.objectIdField,r=i.owner.loadedGraphics.find(function(i){return i===e||t&&i.attributes&&e.attributes&&i.attributes[t]===e.attributes[t]});if(r)return i.whenGraphics3DGraphic(r);throw new d("internal:graphic-not-part-of-view","Graphic is not part of this view")}).then(function(e){return i.boundsForGraphics3DGraphic(e,t)})},t.prototype.whenSymbolLayerSize=function(e,t){return a(this,void 0,void 0,function(){var i,r,a;return n(this,function(n){if(null==(i=this.symbols.get(e.id)))throw new d("internal:symbol-not-part-of-view","Symbol is not part of this view");if(-1===(r=e.symbolLayers.indexOf(t)))throw new d("internal:missing-symbol-layer","Symbol layer is not in symbol");return a=S.createResolver(),i.getSymbolLayerSize(r,function(e){null==e?a.reject(new d("internal:missing-size","Symbol layer has no valid size")):a(e)}),[2,a.promise]})})},t.prototype.graphicsCollectionChanged=function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))},t.prototype.graphicUpdateHandler=function(e){var t=e.graphic.uid,i=this.graphics.get(t),r=this.graphicsWithoutSymbol[t];if(i||r)switch(e.property){case"visible":this.graphicUpdateVisibleHandler(i,e);break;case"geometry":this.graphicUpdateGeometryHandler(i,e);break;case"symbol":this.graphicUpdateSymbolHandler(i,e);break;case"attributes":break;default:c.neverReached(e)}},t.prototype.graphicUpdateGeometryHandler=function(e,t){var i=t.graphic.geometry;if(i)if(m.isNone(e)){var r=t.graphic.symbol&&t.graphic.symbol.id;if(r){var n=this.symbols.get(r);if(n&&!n.isFulfilled())return}this.recreateGraphic(t.graphic)}else e.graphics3DSymbol.updateGeometry(e,t.newValue)||this.recreateGraphic(e.graphic),this.expandComputedExtent(i);else this.recreateGraphic(t.graphic)},t.prototype.graphicUpdateSymbolHandler=function(e,t){var i=t.graphic,r=m.isSome(e)?e.graphics3DSymbol:t.oldValue&&this.symbols.get(t.oldValue.id);if(r){var n=r.symbol,a=this.getConvertedSymbol(t.newValue);if(a.type===n.type&&"web-style"!==a.type&&"web-style"!==n.type){var s=this.graphicsBySymbol.get(n.id);if(s&&1!==s.size)this.recreateGraphic(i);else{var o=R.diff(n,a);if(m.isNone(o))this.updateSymbolMapping(n.id,a);else{var l={diff:o,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(r.prepareSymbolPatch(l),R.isEmpty(l.diff)){for(var h=0,p=l.symbolStatePatches;h<p.length;h++){(0,p[h])()}var c=this._getRenderingInfo(i);if(m.isSome(e))for(var d=0,u=l.graphics3DGraphicPatches;d<u.length;d++){(0,u[d])(e,c)}this.updateSymbolMapping(n.id,a)}else this.recreateGraphic(i)}}}else this.recreateGraphic(i)}else this.recreateGraphic(i)},t.prototype.graphicUpdateVisibleHandler=function(e,t){var i=this._updateUserVisibility(e);i&&this.labeling&&(this.lastFastUpdate=b(),this.owner.view.labeler.setDirty()),i&&this.owner.view.deconflictor.setDirty()},t.prototype.recreateGraphic=function(e){var t=[e];this.remove(t),this.add(t)},t.prototype._beginGraphicUpdate=function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)},t.prototype._endGraphicUpdate=function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))},t.prototype.expandComputedExtent=function(e){var t=N,i=e.spatialReference;V.computeAABB(e,t);var r=this.viewSR,n=h.tmpVec;if(i.equals(r)||H.xyzToVector(t[0],t[1],0,i,n,r)&&(t[0]=n[0],t[1]=n[1],H.xyzToVector(t[3],t[4],0,i,n,r),t[3]=n[0],t[4]=n[1]),f.isFinite(t[0])&&f.isFinite(t[3])&&f.isFinite(t[1])&&f.isFinite(t[4])){var a=this.computedExtent,s=null,o=f.isFinite(t[2])&&f.isFinite(t[5]),l=o&&(!a||null==a.zmin||t[2]<a.zmin),p=o&&(!a||null==a.zmax||t[5]>a.zmax);a?(t[0]<a.xmin||t[1]<a.ymin||t[3]>a.xmax||t[4]>a.ymax||l||p)&&((s=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],a.xmin),s.ymin=Math.min(t[1],a.ymin),s.xmax=Math.max(t[3],a.xmax),s.ymax=Math.max(t[4],a.ymax),s.spatialReference=r):((s=this.propertiesPool.get("computedExtent")).xmin=t[0],s.ymin=t[1],s.xmax=t[3],s.ymax=t[4],s.spatialReference=r),s&&(l&&(s.zmin=t[2]),p&&(s.zmax=t[5]),this._set("computedExtent",s))}},t.prototype.updateHasDraped=function(){var e=this.graphicsDrapedUids.size>0;this._set("hasDraped",e)},t.prototype.elevationInfoChange=function(){var e=this,t=M.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=M.createContext(t,this.viewSR,Q),this.labeling&&this.labeling.elevationInfoChange(),this.forEachGraphics3DSymbol(function(t,i,r){t.globalPropertyChanged("elevationInfo",i)?i.forEach(function(e){for(var t=e.graphic,i=e._labelGraphics,r=0;r<i.length;r++){var n=i[r];n.graphics3DSymbolLayer.updateGraphicElevationContext(t,n)}}):e._recreateSymbol(r)}),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()},t.prototype.clearSymbolsAndGraphics=function(){this.clear(),this.filterVisibility&&this.filterVisibility.clear(),this.labeling&&this.labeling.reset(),this.deconfliction&&this.deconfliction.clear(),this.elevationAlignment&&this.elevationAlignment.clear(),this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()},t.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0,this.recreateAllGraphics()},t.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))},t.prototype._recreateSymbol=function(e){var t=this,i=[];this.graphicsBySymbol.get(e).forEach(function(e,r){var n=e.usedMemory;t._conditionalRemove(e,r),t.spatialIndex&&t.spatialIndex.remove(e),i.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(r,n),t.updateLayerVisibility()}),this.graphicsBySymbol.set(e,new Map);var r=this.symbols.get(e);r&&r.destroy(),this.symbols.delete(e),this.updateHasDraped(),this.add(i)},t.prototype._conditionalRemove=function(e,t){e.isDraped()&&this.graphicsDrapedUids.delete(t),this.highlights&&this.highlights.removeGraphic(e),this.labeling&&this.labeling.removeGraphic(e),this.deconfliction&&this.deconfliction.removeGraphic(e)},t.prototype.add=function(e){if(e&&0!==e.length){if(!this.owner.view.basemapTerrain||!this.owner.view.basemapTerrain.tilingScheme)return void Q.error("#add()","Cannot add graphics before terrain surface has been initialized");this.asyncUpdates?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")}},t.prototype._addImmediate=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,K.clear();for(var i=0,r=e;i<r.length;i++){var n=r[i];this._startAddGraphic(n,K)}K.forEach(function(e){return t._finishAddGraphics(e)}),K.clear(),this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty(),this._cleanupSymbols()},t.prototype._addDelayed=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t],n=r.uid,a=this.pendingUpdates.get(n);if(a)a.add||this.pendingAdds++,a.add=r;else{var s=this.pendingUpdatesPool.pushNew();s.add=r,this.pendingAdds++,this.pendingUpdates.set(n,s)}}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.remove=function(e){this.asyncUpdates?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")},t.prototype._removeImmediate=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this._removeGraphic(r)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype._removeDelayed=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t],n=r.uid,a=this.pendingUpdates.get(n);if(a)a.add&&(a.remove?a.add=null:this.pendingUpdates.delete(n),this.pendingAdds--);else{var s=this.pendingUpdatesPool.pushNew();s.remove=r,this.pendingUpdates.set(n,s),this.pendingRemoves++}}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&Q.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0},t.prototype._applyPendingUpdates=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var i=e.idleFrame?1e3:100,r=0;K.clear(),y.everyMap(this.pendingUpdates,function(n,a){if(n.remove&&(t.pendingRemoves--,t._removeGraphic(n.remove)),n.add&&(t.pendingAdds--,t._startAddGraphic(n.add,K)&&r++),t.pendingUpdates.delete(a),r>i&&(K.forEach(function(e){return t._finishAddGraphics(e)}),K.clear(),r=0),e.madeProgress(),e.done)return!1}),K.forEach(function(e){return t._finishAddGraphics(e)}),K.clear(),0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.updateHasDraped()},t.prototype._startAddGraphic=function(e,t){this.graphicsWithoutSymbol[e.uid]=e;var i=this._getRenderingInfo(e,Q);if(!i)return!1;var r=i.symbol,n=this.getOrCreateGraphics3DSymbol(r,i.renderer);if(!n)return!1;this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var a={graphic:e,renderingInfo:i,layer:this.layer},s=n.symbol.id,o=t.get(s);if(o)o.graphics.push(a);else{var l=$.acquire();l.clear(),l.push(a),t.set(s,{asyncSymbol:n,graphics:l})}return!0},t.prototype._finishAddGraphics=function(e){var t=this,i=!1,r=function(t){t===e.asyncSymbol.symbol.id&&(i=!0)};this._whenSymbolRemoved.push(r),e.asyncSymbol.then(function(){t._whenSymbolRemoved.removeUnordered(r),Z.clear();for(var n=0;n<e.graphics.length;n++){var a=e.graphics.data[n],s=a.graphic;if(!(i||e.asyncSymbol.destroyed||t.graphicSymbolSupported&&s.symbol&&s.symbol.id!==e.asyncSymbol.symbol.id)){if(t.graphicsWaitingForSymbol.has(s.uid)){var o=t.createGraphics3DGraphic(e.asyncSymbol,a);t.spatialIndex&&o&&Z.push(o)}t._endGraphicUpdate(s)}--e.asyncSymbol.referenced}Z.length>0&&(t.spatialIndex.addMany(Z.data,Z.length),Z.clear()),e.graphics.clear(),$.release(e.graphics),t.labeling&&(t.lastFastUpdate=b(),t.owner.view.labeler.setDirty())},function(){if(t._whenSymbolRemoved.removeUnordered(r),!i&&!e.asyncSymbol.destroyed)for(var n=0;n<e.graphics.length;n++)t._endGraphicUpdate(e.graphics.data[n].graphic);e.graphics.clear(),$.release(e.graphics)})},t.prototype._removeGraphic=function(e){var t=e.uid,i=this.graphics.get(t);if(i){var r=i.usedMemory;this._conditionalRemove(i,t),this.spatialIndex&&this.spatialIndex.remove(i);var n=i.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(n).delete(t),delete this.graphicsWithoutSymbol[t],this.removeGraphics3DGraphic(t,r),i.destroy()}else delete this.graphicsWithoutSymbol[t],this.graphicsWaitingForSymbol.delete(t)},t.prototype.hasLabelingContext=function(e){if(e instanceof l.LabelSymbol3D||e instanceof l.TextSymbol){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(function(t){return t.symbol===e})}return!1},t.prototype.hasValidSymbolCreationContext=function(e){return!(e instanceof l.LabelSymbol3D&&!this.hasLabelingContext(e)&&(Q.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),1))},t.prototype._getRenderingInfo=function(e,t){if(!e.geometry)return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&e.symbol)return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;var i=this.rendererHasGeometryOperations?V.hydrateGraphic(e,this.layer):e,r=this.owner.getRenderingInfo(i,this.currentRenderer);return r&&r.symbol?r:(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null)},t.prototype.createGraphics3DSymbol=function(e,t){var i=this;if(!this.hasValidSymbolCreationContext(e))return null;var r,n=this.getConvertedSymbol(e);if(!n)return null;if(t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var a=P.to3D(t.backgroundFillSymbol,!1,!0);a.symbol&&"web-style"!==a.symbol.type&&(r=a.symbol.symbolLayers)}var s=j.make(n,this.symbolCreationContext,r);return s.then(function(){return i.notifyChange("maxSymbolComplexity")}),s},t.prototype.getOrCreateGraphics3DSymbol=function(e,t){var i=this,r=this.symbols.get(e.id);return void 0===r&&(r=e instanceof l.WebStyleSymbol?new F(e,function(e){return i.createGraphics3DSymbol(e,t)}):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,r)),r&&++r.referenced,r},t.prototype.addGraphics3DGraphic=function(e){this._usedMemory+=e.usedMemory,this.graphics.set(e.graphic.uid,e),this.numberOfGraphics++,this.updateLayerVisibility()},t.prototype.removeGraphics3DGraphic=function(e,t){this._usedMemory-=t,this.graphics.delete(e),this.numberOfGraphics--,this.updateLayerVisibility()},t.prototype.createGraphics3DGraphic=function(e,t){var i=t.graphic;if(delete this.graphicsWithoutSymbol[i.uid],this.symbols.has(e.symbol.id)){if(!this.graphics.has(i.uid)){var r=e.createGraphics3DGraphic(t),n=e.symbol.id;this.addGraphics3DGraphic(r),this.graphicsBySymbol.has(n)||this.graphicsBySymbol.set(n,new Map),this.graphicsBySymbol.get(n).set(i.uid,r),r.initialize(this.stageLayer,this.stage),r.isDraped()&&(this.graphicsDrapedUids.add(i.uid),this._set("hasDraped",!0)),r.centroid=null,"point"!==i.geometry.type&&r instanceof A&&(r.centroid=B.computeCentroid(i.geometry,this.viewSR)),this._updateUserVisibility(r),this.deconfliction&&this.deconfliction.addGraphic(r),this.labeling&&this.labeling.addGraphic(r),this.scaleVisibility&&this.scaleVisibility.updateVisibility(r),this.filterVisibility&&this.filterVisibility.updateVisibility(r),this.highlights&&this.highlights.addGraphic(r),this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,r);var a=this.whenGraphics3DGraphicRequests[i.uid];return a&&(delete this.whenGraphics3DGraphicRequests[i.uid],a.resolve(r)),r}}else this.add([i])},t.prototype.rendererChange=function(e){var t=this;e!==this.currentRenderer&&(this.validateRenderer(e),O.hasGeometryOperations(e)?O.enableGeometryOperations().then(function(){t.layer.renderer===e&&t.currentRendererChange(e,!0)}):this.currentRendererChange(e,!1))},t.prototype.currentRendererChange=function(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t;var i=this.symbolCreationContext.renderer;if(e!==i){this.symbolConversionCache.clear();var r=R.diff(i,e);this.updateUnchangedSymbolMappings(r,e,i),this.symbolCreationContext.renderer=e,m.isNone(r)||("complete"===r.type?this.recreateAllGraphics():"partial"===r.type&&(this.applyRendererDiff(r,e,i)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}},t.prototype.diffHasSymbolChange=function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1},t.prototype.applySymbolSetDiff=function(e,t,i,r){var n=this;e=e||[];for(var a=[],s=this,o=0,l=t=t||[];o<l.length;o++){!function(t){var r=s.graphicsBySymbol.get(t.id);r&&r.forEach(function(s,o){var l=s.graphic,h=n.layer instanceof _?n.layer:null;if(t!==i.defaultSymbol||i.getSymbol(V.hydrateGraphic(l,h))!==i.defaultSymbol){var p=s.usedMemory;e.length||i.defaultSymbol?a.push(l):n.graphicsWithoutSymbol[o]=l;var c=n.graphics.get(o);n._conditionalRemove(c,o),s.destroy(),r.delete(o),n.removeGraphics3DGraphic(o,p),n.updateLayerVisibility()}}),s._whenSymbolRemoved.forEach(function(e){return e(t.id)})}(l[o])}if(e.length||a.length){for(var h in this.graphicsWithoutSymbol)a.push(this.graphicsWithoutSymbol[h]);this.graphicsWithoutSymbol={},this.add(a)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype.applyUniqueValueRendererDiff=function(e,t,i){var r=e.diff.defaultSymbol,n=e.diff.uniqueValueInfos;if(r||n){var a=n?n.added.map(function(e){return e.symbol}):[],s=n?n.removed.map(function(e){return e.symbol}):[];if(n)for(var o=0;o<n.changed.length;o++)a.push(n.changed[o].newValue.symbol),s.push(n.changed[o].oldValue.symbol);return r?(i.defaultSymbol&&s.push(i.defaultSymbol),t.defaultSymbol&&a.push(t.defaultSymbol)):i.defaultSymbol&&a.length&&s.push(t.defaultSymbol),this.applySymbolSetDiff(a,s,t,i),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1},t.prototype.calculateUnchangedSymbolMapping=function(e,t,i){if(t instanceof o.UniqueValueRenderer&&i instanceof o.UniqueValueRenderer&&(m.isNone(e)||"partial"===e.type)){var r=e&&e.diff,n=r&&r.defaultSymbol,a=r&&r.uniqueValueInfos,s=void 0;return s=a?a.unchanged.map(function(e){return{oldId:e.oldValue.symbol.id,newId:e.newValue.symbol.id}}):i.uniqueValueInfos.map(function(e,i){return{oldId:e.symbol.id,newId:t.uniqueValueInfos[i].symbol.id}}),!n&&i.defaultSymbol&&s.push({oldId:i.defaultSymbol.id,newId:t.defaultSymbol.id}),s}return[]},t.prototype.updateSymbolMapping=function(e,t){var i="string"==typeof t?t:t.id,r="string"==typeof t?null:t;if(e&&e!==i){var n=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==n&&this.graphicsBySymbol.set(i,n);var a=this.symbols.get(e);this.symbols.delete(e),void 0!==a&&(this.symbols.set(i,a),r?a.symbol=r:a.symbol.id=i)}},t.prototype.updateUnchangedSymbolMappings=function(e,t,i){for(var r=0,n=this.calculateUnchangedSymbolMapping(e,t,i);r<n.length;r++){var a=n[r],s=a.oldId,o=a.newId;this.updateSymbolMapping(s,o)}},t.prototype.applyRendererDiff=function(e,t,i){var r=this;return!this.diffHasSymbolChange(e)&&(!!(t instanceof o.UniqueValueRenderer&&i instanceof o.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(e,t,i)&&0===Object.keys(e.diff).length)||y.everyMap(this.graphicsBySymbol,function(i,n){var a=r.symbols.get(n);if(a&&!a.applyRendererDiff(e,t))return!1}))},t.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(e){return e.globalPropertyChanged("opacity")}),this.updateStageLayerVisibility()},t.prototype.slicePlaneEnabledChange=function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol(function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)}),this.deconfliction&&this.deconfliction.slicePlaneEnabledChange(),this.labeling&&this.labeling.slicePlaneEnabledChange())},t.prototype.pixelRatioChange=function(e){var t=this;this.forEachGraphics3DSymbol(function(e,i,r){e.globalPropertyChanged("pixelRatio",i)||t._recreateSymbol(r)})},t.prototype.setClippingExtent=function(e,t){var i=this.symbolCreationContext.clippingExtent,r=E.create();return H.extentToBoundingRect(e,r,t)?this.symbolCreationContext.clippingExtent=[r[0],r[1],-1/0,r[2],r[3],1/0]:this.symbolCreationContext.clippingExtent=null,!p.equals(this.symbolCreationContext.clippingExtent,i)},t.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype.forEachGraphics3DGraphic=function(e){var t=this;if(this.owner.loadedGraphics){var i=!1;this.owner.loadedGraphics.forEach(function(r){var n=t.getGraphics3DGraphicById(r.uid);n&&e(n,r)&&(i=!0)}),i&&this.notifyVisibilityChanged()}},t.prototype.forEachGraphics3DSymbol=function(e){var t=this;this.graphicsBySymbol.forEach(function(i,r){var n=t.symbols.get(r);n&&e(n,i,r)})},t.prototype.updateAllGraphicsVisibility=function(){var e=this;this.filterVisibility&&(this.filterVisibility.dirty=!0),this.forEachGraphics3DGraphic(function(t){var i=e._updateUserVisibility(t),r=e.scaleVisibility&&e.scaleVisibility.updateVisibility(t);return i||r})},t.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(e){return e.setVisibilityFlag(0,!1,0)})},t.prototype.validateRenderer=function(e){var t=I.validateTo3D(e);if(t){var i="Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView";Q.warn(i,t.message)}},t.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=b(),this.labeling.reset()),this.stageLayer.invalidateSpatialQueryAccelerator(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")},t.prototype._cleanupSymbols=function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0)){var t=!1;this.symbols.forEach(function(i,r){if(i&&!(i.referenced>0)){var n=e.graphicsBySymbol.get(r);n&&0!==n.size||(e.graphicsBySymbol.delete(r),e.symbols.delete(r),i&&i.destroy(),t=!0)}}),t&&this.notifyChange("maxSymbolComplexity")}},t.prototype.snapshotInternals=function(){var e=this;return{graphics:p.keysOfMap(this.graphics).sort(),symbols:p.keysOfMap(this.symbols).sort(),graphicsBySymbol:p.keysOfMap(this.graphicsBySymbol).sort().map(function(t){return{symbolId:t,graphics:p.keysOfMap(e.graphicsBySymbol.get(t)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:p.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}},Object.defineProperty(t.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility}},enumerable:!0,configurable:!0}),t.prototype.getStats=function(){return{coreVisible:this.graphics.size,coreMissing:Object.keys(this.graphicsWithoutSymbol).length,corePending:this.pendingUpdates.size}},t.tmpVec=G.vec3f64.create(),r([C.property({readOnly:!0})],t.prototype,"computedExtent",void 0),r([C.property()],t.prototype,"currentRenderer",void 0),r([C.property()],t.prototype,"rendererHasGeometryOperations",void 0),r([C.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),r([C.property({readOnly:!0})],t.prototype,"scaleVisibility",void 0),r([C.property({readOnly:!0})],t.prototype,"filterVisibility",void 0),r([C.property({readOnly:!0})],t.prototype,"spatialIndex",void 0),r([C.property({readOnly:!0})],t.prototype,"deconfliction",void 0),r([C.property({readOnly:!0})],t.prototype,"labeling",void 0),r([C.property({readOnly:!0})],t.prototype,"highlights",void 0),r([C.property()],t.prototype,"asyncUpdates",void 0),r([C.property({constructOnly:!0})],t.prototype,"elevationFeatureExpressionEnabled",void 0),r([C.property({constructOnly:!0})],t.prototype,"owner",void 0),r([C.property({constructOnly:!0})],t.prototype,"layer",void 0),r([C.property({readOnly:!0})],t.prototype,"hasDraped",void 0),r([C.property({readOnly:!0})],t.prototype,"symbolsUpdating",void 0),r([C.property({constructOnly:!0})],t.prototype,"graphicSymbolSupported",void 0),r([C.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating"]})],t.prototype,"updating",null),r([C.property({readOnly:!0})],t.prototype,"updatingRemaining",null),r([C.property({readOnly:!0})],t.prototype,"updatingTotal",null),r([C.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],t.prototype,"displayFeatureLimit",null),r([C.property({readOnly:!0})],t.prototype,"maxSymbolComplexity",null),h=r([C.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],t)}(C.declared(h)),K=new Map,Z=new x,$=new v(x),ee=10;return J}.apply(null,r))||(e.exports=n)},1577:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(13),i(560)],void 0===(n=function(e,t,i,r){function n(e,t){if(!t)return null;var r;if((r=Array.isArray(t)?t:[t]).length>0){var n=r.map(function(e){return e.details.symbol.type||e.details.symbol.declaredClass}).filter(function(e){return!!e});n.sort();var a=[];return n.forEach(function(e,t){0!==t&&e===n[t-1]||a.push(e)}),new i("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+a.join(", ")+") which are not supported in 3D",{renderer:e,symbolErrors:r})}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.validateTo3D=function(e){return e?function(e){return"simple"===e.type}(e)?function(e){return n(e,r.to3D(e.symbol).error)}(e):function(e){return"unique-value"===e.type}(e)?function(e){var t=e.uniqueValueInfos.map(function(e){return r.to3D(e.symbol).error}).filter(function(e){return!!e}),i=r.to3D(e.defaultSymbol);return i.error&&t.unshift(i.error),n(e,t)}(e):function(e){return"class-breaks"===e.type}(e)?function(e){var t=e.classBreakInfos.map(function(e){return r.to3D(e.symbol).error}).filter(function(e){return!!e}),i=r.to3D(e.defaultSymbol);return i.error&&t.unshift(i.error),n(e,t)}(e):new i("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(e.type||e.declaredClass)+"'",{renderer:e}):null}}.apply(null,r))||(e.exports=n)},1578:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.sharedResources=null,this.streamDataSupplier=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.layerOrder=null,this.layerOrderDelta=null,this.clippingExtent=null,this.renderSpatialReference=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.isAsync=!1}}();t.Graphics3DSymbolCreationContext=i}.apply(null,r))||(e.exports=n)},1579:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1580),i(561)],void 0===(n=function(e,t,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.make=function(e,t,n){var a;switch(e.type){case"point-3d":a=i;break;default:a=r}return new a(e,t,n)}}.apply(null,r))||(e.exports=n)},1580:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(5),i(569),i(561)],void 0===(n=function(e,t,i,r,n){return function(e){function t(t,i,n){var a=e.call(this,t,i,n)||this;return a.calloutSymbolLayer=null,a.symbol.hasVisibleCallout()&&(a.calloutSymbolLayer=r.make(a.symbol,i)),a}return i(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.createGraphics3DGraphic=function(t,i,r){var n=e.prototype.createGraphics3DGraphic.call(this,t,r);if(this.calloutSymbolLayer){var a=this.createCalloutGraphic(t);a&&n.addAuxiliaryGraphic(a)}return n},t.prototype.globalPropertyChanged=function(t,i){var r=this;if(!e.prototype.globalPropertyChanged.call(this,t,i))return!1;if(this.calloutSymbolLayer){return this.calloutSymbolLayer.globalPropertyChanged(t,i,function(e){for(var t=0,i=e._auxiliaryGraphics;t<i.length;t++){var n=i[t];if(n.graphics3DSymbolLayer===r.calloutSymbolLayer)return n}})}return!0},t.prototype.createCalloutGraphic=function(e){var t=e.renderingInfo,i={renderer:t.renderer,symbol:t.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return e.renderingInfo=i,this.calloutSymbolLayer.createGraphics3DGraphic(e)},t}(n)}.apply(null,r))||(e.exports=n)},1581:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(6),i(17),i(88),i(0),i(37)],void 0===(n=function(e,t,i,r,n,a,s,o,l){var h=function(){function e(){this.extents=new s({allocator:function(e){return e||l.create()}}),this.tempExtent=l.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"length",{get:function(){return this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),l.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&(this.mergeTight(),this.dirty=!1),this.extents.pop()},e.prototype.mergeTight=function(){for(var e=this.extents,t=this.tempExtent,i=!1;!i;){i=!0;for(var r=0;r<e.length;++r)if(function(i){for(var r=e.data[i],n=l.area(r),a=!1,s=e.length-1;s>i;--s){var o=e.data[s],h=l.area(o);l.expand(r,o,t);var p=n+h;(l.area(t)-p)/p<.05&&(l.set(r,t),n=l.area(r),e.swapElements(s,e.length-1),e.pop(),a=!0)}return a}(r)){i=!1;break}}},e.prototype.contains=function(e){return this.extents.some(function(t){return l.contains(t,e)})},e.prototype.removeContained=function(e){for(var t=this.extents.length-1;t>=0;--t)l.contains(e,this.extents.data[t])&&this.extents.removeUnorderedIndex(t)},e}();return function(e){function t(){var t=e.call(this)||this;return t.dirtyExtents=new h,t.globalDirty=!1,t.dirtyGraphicsQueue=new s({deallocator:null}),t.handles=new a,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t}return i(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,i,r){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=r;var a=this.layerView.view.resourceController.scheduler;this.handles.add([r.on("elevation-change",function(e){return n.elevationUpdateHandler(e)}),this.layerView.watch("suspended",function(){return n.suspendedChange()}),a.registerTask(12,function(e){return n.update(e)},function(){return n.needsUpdate()})])},t.prototype.destroy=function(){this.dirtyGraphicsQueue=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsQueue.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsQueue.length>0||this.dirtyExtents.length>0||this.globalDirty},t.prototype.update=function(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress());this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this.layerView.view,i=this.graphicsCore.stageLayer.id,r=this.layerView.labeling;this.dirtyGraphicsQueue.length>0&&!e.done;){for(var n=Math.min(this.dirtyGraphicsQueue.length,100);n--&&!e.done;){var a=this.dirtyGraphicsQueue.pop(),s=this.graphicsCore.getGraphics3DGraphicById(a);s&&s.alignWithElevation(this.elevationProvider,t.renderCoordsHelper),e.madeProgress()}t._stage.processDirtyLayer(i),r&&r.processStageDirty()}},t.prototype._updateDirtyExtents=function(e){for(var t=this;this.dirtyExtents.length>0&&this.dirtyGraphicsQueue.length<100&&!e.done;){var i=this.dirtyExtents.pop();this.queryGraphicUIDsInExtent(i,this.spatialReference,function(e){var i=t.graphicsCore.getGraphics3DGraphicById(e);i&&i.needsElevationUpdates()&&t.dirtyGraphicsQueue.push(e)}),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsQueue.clear(),this.graphicsCore.graphics3DGraphics.forEach(function(t,i){return e.dirtyGraphicsQueue.push(i)})},t.prototype.elevationUpdateHandler=function(e){var t=e.extent;if(this.layerView.suspended){if(!this.updateElevation){var i=this.graphicsCore.computedExtent;i&&t[2]>i.xmin&&t[0]<i.xmax&&t[3]>i.ymin&&t[1]<i.ymax&&(this.updateElevation=!0)}}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.spatialReference=e.spatialReference,this.notifyChange("updating")},r([o.property({readOnly:!0})],t.prototype,"updating",null),r([o.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(o.declared(n))}.apply(null,r))||(e.exports=n)},1582:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1583)],void 0===(n=function(e,t,i){return function(){function e(){this.graphicsCore=null,this.highlights=[]}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.setup=function(e){this.graphicsCore=e},e.prototype.acquireSet=function(e,t){var r=this,n=new i(e,t);return this.highlights.push(n),{set:n,handle:{remove:function(){return r.releaseSet(n)},pause:function(){n.highlightSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,r.initializeSet(n)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setUids=function(e,t){for(var i=this.graphicsCore.graphics3DGraphics,r=0,n=t;r<n.length;r++){var a=n[r];e.ids.add(a);var s=i.get(a);s&&s.addHighlight(e.highlightSet,e.options)}},e.prototype.setObjectIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.initializeSet(e)},e.prototype.addGraphic=function(e){this.highlights.forEach(function(t){!t.paused&&t.hasGraphic(e)&&e.addHighlight(t.highlightSet,t.options)})},e.prototype.removeGraphic=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.removeHighlight(t.highlightSet)})},e.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e.prototype.initializeSet=function(e){var t=this.graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(function(t){t&&e.hasGraphic(t)&&t.addHighlight(e.highlightSet,e.options)}):e.ids.forEach(function(i){var r=t.get(i);r&&r.addHighlight(e.highlightSet,e.options)})},e}()}.apply(null,r))||(e.exports=n)},1583:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1551)],void 0===(n=function(e,t,i){return function(){function e(e,t){this.highlightSet=new i,this.ids=new Set,this.paused=!1,this.options=e,this.objectIdField=t}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}()}.apply(null,r))||(e.exports=n)},1584:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(6),i(17),i(0)],void 0===(n=function(e,t,i,r,n,a,s){function o(e,t){return null!==e&&e>0&&e<8e7||t>50}return function(e){function t(){var t=e.call(this)||this;return t._scaleRangeActive=!1,t._layerScaleRangeVisibilityDirty=!0,t.layerScaleRangeVisibilityQuery=!1,t.scaleChangeEventHandle=null,t.handles=new a,t.layerView=null,t.layer=null,t.queryGraphicUIDsInExtent=null,t.extent=null,t.graphicsCore=null,t.basemapTerrain=null,t.suspended=!1,t}return i(t,e),Object.defineProperty(t.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},set:function(e){this._layerScaleRangeVisibilityDirty!==e&&(this._layerScaleRangeVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,i,r,n){var a=this;this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=i,this.graphicsCore=r,this.basemapTerrain=n,this.updateScaleRangeActive();var s=this.layerView.view.resourceController.scheduler;this.handles.add(s.registerTask(6,function(){return a.update()},function(){return a.needsUpdate()}))},t.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),this.handles.destroy(),this.handles=null,this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null},t.prototype.needsUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.layerScaleRangeVisibilityDirty=!0},t.prototype.update=function(){this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1},t.prototype.scaleRangeActive=function(){return this._scaleRangeActive},t.prototype.updateScaleRangeActive=function(){var e=this,t=this.layer,i=o(t.minScale,t.maxScale);t.labelingInfo&&!i&&(i=t.labelingInfo.some(function(e){return e&&o(e.minScale,e.maxScale)}));var r=this._scaleRangeActive!==i;return this._scaleRangeActive=i,i&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(t){return e.scaleUpdateHandler(t)}):!i&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),r},t.prototype.updateSuspendScaleVisibleFinish=function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e)},t.prototype.updateSuspendScaleVisible=function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(t){return e.updateSuspendScaleVisibleFinish(t)})):this.updateSuspendScaleVisibleFinish(!0)},t.prototype.visibleAtScale=function(e,t,i){return null==e||e>i&&(!t||e<t)},t.prototype.visibleAtLayerScale=function(e){return this.visibleAtScale(e,this.layer.minScale,this.layer.maxScale)},t.prototype.visibleAtLabelScale=function(e,t){return this.visibleAtScale(e,t.minScale,t.maxScale)},t.prototype.graphicScale=function(e){var t;return e.centroid?t=e.centroid:"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null},t.prototype.graphicVisible=function(e){var t=this.graphicScale(e);return this.visibleAtLayerScale(t)},t.prototype.updateVisibility=function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t,0)}return!1},t.prototype.updateGraphicLabelScaleVisibility=function(e){if(!this._scaleRangeActive)return!1;if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var t=this.graphicScale(e),i=this.updateLabelScaleVisibility(e,t);return i&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),i},t.prototype.updateLabelScaleVisibility=function(e,t){if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var i=e._labelGraphics[0]._labelClass;if(i&&null!=i.minScale&&null!=i.maxScale){var r=this.visibleAtLabelScale(t,i);if(e.setVisibilityFlag(1,r,1))return!0}return!1},t.prototype.scaleUpdateHandler=function(e){var t=this;if(!this.layerView.suspended){var i=e.extent,r=e.scale,n=this.visibleAtLayerScale(r),a=!1;this.queryGraphicUIDsInExtent(i,e.spatialReference,function(e){var s=t.graphicsCore.getGraphics3DGraphicById(e);if(s){var o=s.centroid;if(o&&(i[0]>o.x||i[1]>o.y||i[2]<o.x||i[3]<o.y))return;var l=!1;s.setVisibilityFlag(1,n,0)&&(l=!0),t.updateLabelScaleVisibility(s,r)&&(l=!0),l&&(a=!0)}}),a&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=!0},t.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(e){return e.clearVisibilityFlag(1)})),this.layerScaleRangeVisibilityDirty=!0},r([s.property({readOnly:!0})],t.prototype,"suspended",void 0),r([s.property({readOnly:!0})],t.prototype,"updating",null),r([s.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],t)}(s.declared(n))}.apply(null,r))||(e.exports=n)},1585:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(6),i(19),i(88),i(0),i(1558)],void 0===(n=function(e,t,i,r,n,a,s,o,l){var h=function(e){function t(t){var i=e.call(this)||this;return i.index=new l.default(9,a("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),i.spatialReference=null,i}return i(t,e),t.prototype.destroy=function(){this.index.destroy(),this.index=null,p.prune()},t.prototype.queryGraphicUIDsInExtent=function(e,t,i){t.equals(this.spatialReference)&&(c.minX=e[0],c.minY=e[1],c.maxX=e[2],c.maxY=e[3],this.index.search(c,function(e){return i(e.graphic.uid)}))},t.prototype.add=function(e){!e.addedToSpatialIndex&&e.computeExtent(this.spatialReference)&&(this.index.insert(e),e.addedToSpatialIndex=!0)},t.prototype.addMany=function(e,t){void 0===t&&(t=e.length),p.clear();for(var i=0;i<t;i++){var r=e[i];!r.addedToSpatialIndex&&r.computeExtent(this.spatialReference)&&(p.push(r),r.addedToSpatialIndex=!0)}this.index.load(p.data,p.length)},t.prototype.remove=function(e){e.addedToSpatialIndex&&(e.addedToSpatialIndex=!1,this.index.remove(e))},t.prototype.clear=function(){this.index.clear()},r([o.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),r([o.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],t)}(o.declared(n)),p=new s,c={minX:0,minY:0,maxX:0,maxY:0};return h}.apply(null,r))||(e.exports=n)},1603:function(e,t,i){var r;void 0===(r=function(){"use strict";function e(i,r,n,a,s){for(;a>n;){if(a-n>600){var o=a-n+1,l=r-n+1,h=Math.log(o),p=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*p*(o-p)/o)*(l-o/2<0?-1:1);e(i,r,Math.max(n,Math.floor(r-l*p/o+c)),Math.min(a,Math.floor(r+(o-l)*p/o+c)),s)}var d=i[r],u=n,y=a;for(t(i,n,r),s(i[a],d)>0&&t(i,n,a);u<y;){for(t(i,u,y),u++,y--;s(i[u],d)<0;)u++;for(;s(i[y],d)>0;)y--}0===s(i[n],d)?t(i,n,y):t(i,++y,a),y<=r&&(n=y+1),r<=y&&(a=y-1)}}function t(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function i(e,t){return e<t?-1:e>t?1:0}return function(t,r,n,a,s){e(t,r,n||0,a||t.length-1,s||i)}}.apply(null,[]))||(e.exports=r)},1749:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(11),i(79),i(6),i(97),i(26),i(17),i(9),i(21),i(0),i(126),i(128),i(353),i(1575),i(1576),i(1581),i(1582),i(1584),i(1585),i(72)],void 0===(n=function(e,t,i,r,n,a,s,o,l,h,p,c,d,u,y,g,f,m,b,v,x,S,w){var C=function(e){function t(t){var i=e.call(this)||this;return i.graphicsCore=null,i.elevationAlignment=new b,i.highlights=new v,i.handles=new h,i.suspendResumeExtent=null,i}return i(t,e),t.prototype.normalizeCtorArgs=function(e){var t=null;e.scaleVisibilityEnabled&&(delete(e=n({},e)).scaleVisibilityEnabled,t=new x);var i=new m({owner:e.owner,layer:e.layer,asyncUpdates:!1,graphicSymbolSupported:!0});return n({},e,{graphicsCore:i,scaleVisibility:t})},t.prototype.initialize=function(){var e=this;this._set("spatialIndex",new S({spatialReference:this.owner.view.spatialReference})),this.scaleVisibility&&"minScale"in this.layer&&this.handles.add(this.layer.watch(["minScale","maxScale"],function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()}))},t.prototype.setup=function(){var e=this;if(this.elevationAlignment.setup(this.owner,function(t,i,r){return e.spatialIndex.queryGraphicUIDsInExtent(t,i,r)},this.graphicsCore,this.view.elevationProvider),this.scaleVisibility&&"minScale"in this.layer){var t=this.owner.view.basemapTerrain;this.scaleVisibility.setup(this.owner,this.layer,function(t,i,r){return e.spatialIndex.queryGraphicUIDsInExtent(t,i,r)},this.graphicsCore,t)}this.highlights&&this.highlights.setup(this.graphicsCore),this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,spatialIndex:this.spatialIndex,scaleVisibility:this.scaleVisibility,highlights:this.highlights}),this.handles.add(this.view.watch("clippingArea",function(){return e.updateClippingExtent()})),this.updateClippingExtent(),this.setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics()},t.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null),this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null)),this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null)),this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null)),this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null)),this.highlights&&(this.highlights.destroy(),this._set("highlights",null))},Object.defineProperty(t.prototype,"suspended",{get:function(){return!(!this.scaleVisibility||!this.scaleVisibility.suspended)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0}),t.prototype.getGraphicFromGraphicUid=function(e){if(this.owner.loadedGraphics){var t=this.owner.loadedGraphics.find(function(t){return t.uid===e});if(t){var i=this.layer instanceof u?this.layer:null;return y.hydrateGraphic(t,i)}}},t.prototype.whenGraphicBounds=function(e,t){return this.spatialIndex&&this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):p.reject()},t.prototype.whenSymbolLayerSize=function(e,t){return this.spatialIndex&&this.graphicsCore?o.safeCast(this.graphicsCore.whenSymbolLayerSize(e,t)):p.reject()},t.prototype.highlight=function(e,t){if(void 0===t&&(t={}),e instanceof g)return G;if("number"==typeof e)return this.highlight([e],t);if(e instanceof a)return this.highlight([e],t);if(e instanceof l&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof a){var i=e.map(function(e){return e.uid}),r=this.highlights.acquireSet(t,null),n=r.set,s=r.handle;return this.highlights.setUids(n,i),s}if("number"==typeof e[0]){var o=e,h=this.highlights.acquireSet(t,null);n=h.set,s=h.handle;return this.highlights.setObjectIds(n,o),s}}return G},t.prototype.updateClippingExtent=function(){var e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()},t.prototype.setupSuspendResumeExtent=function(){var e=this;this.scaleVisibility&&c.init(this.graphicsCore,"computedExtent",function(t){e.suspendResumeExtent=w.enlargeExtent(t,e.suspendResumeExtent,f.SUSPEND_RESUME_EXTENT_OPTIMISM),e.scaleVisibility.setExtent(e.suspendResumeExtent)},!0)},r([d.property({constructOnly:!0})],t.prototype,"owner",void 0),r([d.property({constructOnly:!0})],t.prototype,"layer",void 0),r([d.property({readOnly:!0,aliasOf:"owner.view"})],t.prototype,"view",void 0),r([d.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),r([d.property({readOnly:!0})],t.prototype,"spatialIndex",void 0),r([d.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),r([d.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),r([d.property({readOnly:!0})],t.prototype,"highlights",void 0),r([d.property({readOnly:!0,dependsOn:["scaleVisibility.suspended"]})],t.prototype,"suspended",null),r([d.property({readOnly:!0,dependsOn:["graphicsCore.updating","scaleVisibility.updating"]})],t.prototype,"updating",null),r([d.subclass("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],t)}(d.declared(s)),G={remove:function(){},pause:function(){},resume:function(){}};return C}.apply(null,r))||(e.exports=n)}}]);