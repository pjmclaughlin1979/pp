(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/operations/PBFWorker":1465,"esri/tasks/operations/query":1466,"esri/core/HandleOwner":1503,"esri/views/2d/engine/webgl/enums":1505,"esri/views/2d/engine/webgl/Utils":1511,"esri/views/2d/tiling/TileSpan":1513,"esri/tasks/operations/pbfQueryUtils":1515,"esri/core/pbf":1520,"esri/views/2d/tiling/TileInfoView":1521,"esri/views/2d/engine/webgl/number":1522,"esri/views/2d/tiling/TileStrategy":1524,"esri/views/2d/layers/features/support/Tile":1529,"esri/views/2d/engine/webgl/color":1531,"esri/tasks/operations/pbfFeatureServiceParser":1535,"esri/tasks/operations/pbfDehydratedFeatureSet":1536,"esri/tasks/operations/pbfOptimizedFeatureSet":1537,"esri/tasks/operations/urlUtils":1538,"esri/views/2d/tiling/LODInfo":1539,"esri/views/2d/tiling/TileCoverage":1540,"esri/views/2d/tiling/TileQueue":1541,"esri/layers/graphics/data/QueryEngineCapabilities":1545,"esri/views/support/QueueProcessor":1546,"esri/core/Queue":1556,"esri/views/2d/tiling":1594,"esri/views/2d/engine/webgl/SymbolProperties":1615,"esri/layers/support/FeatureProcessing":1623,"esri/views/2d/layers/features/controllers/BaseController":1639,"esri/layers/graphics/data/FeatureFilter":1640,"esri/views/2d/layers/features/support/TileUpdateQueue":1699,"esri/views/2d/layers/features/controllers/OnDemandController":1790,"esri/views/2d/layers/features/support/DataTile":2228,"esri/views/2d/layers/features/support/DataTileFeaturesIndex":2229,"esri/core/SetPool":2230})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{1465:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(79),r(9),r(356),r(355),r(34),r(1515),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(){}return e.prototype._parseFeatureQuery=function(e){var t,r=u.parsePBFFeatureQuery(e.buffer,e.options);return e.options&&"dehydrated"===e.options.type&&(t=r.spatialReference.toJSON(),r.spatialReference=null),n.resolve({featureSet:r,sr:t})},e}(),p=function(t){function c(){var r=t.call(this)||this;return r._thread=void 0,s.open(o.getAbsMid("./PBFWorker",e,l),{strategy:"dedicated"}).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(c,t),c.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},c.prototype.parseFeatureQuery=function(e,t){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_parseFeatureQuery",{buffer:e,options:t},{transferList:[e]}).then(function(e){var t=e.featureSet;if(e.sr){var r=a.fromJSON(e.sr);t.spatialReference=r}for(var n=t.spatialReference,o=0,s=t.features;o<s.length;o++){var u=s[o];u.uid=i.generateUID(),u.geometry&&(u.geometry.spatialReference=n)}return e.featureSet}):n.resolve(u.parsePBFFeatureQuery(e,t)):n.resolve(null)},c}(c);t.PBFWorker=p,t.default=function(){return new c}}.apply(null,i))||(e.exports=n)},1466:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(50),r(33),r(69),r(1509),r(1515),r(1465),r(1538)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){function c(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=o.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var s=i.timeExtent,a=s.start,u=s.end;null==a&&null==u||(n.time=a===u?a:(null==a?"null":a)+","+(null==u?"null":u)),delete i.timeExtent}return n}function p(e,t,o,a,u){void 0===a&&(a={});var p="string"==typeof e?n.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return a.responseType="pbf"===o?"array-buffer":"json",s.normalizeCentralMeridian(h,null,a).then(function(e){var n=e&&e[0];n&&((t=t.clone()).geometry=n);var s=l.mapParameters(r({},p.query,{f:o},u,c(t,u)));return i(p.path+"/query",r({},a,{query:s}))})}Object.defineProperty(t,"__esModule",{value:!0});var h,f="Layer does not support extent calculation.";t.queryToQueryStringParameters=c,t.executeQuery=function(e,t,r){return p(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,i){return p(e,t,"pbf",i).then(function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?(null==h&&(h=new u.PBFWorker),h).parseFeatureQuery(e.data,r).then(function(e){return t(e)}):t(a.parsePBFFeatureQuery(e.data,r))})},t.executeQueryForIds=function(e,t,r){return p(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return p(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return p(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(f);if(t.hasOwnProperty("count"))throw new Error(f);return e})}}.apply(null,i))||(e.exports=n)},1503:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(17),r(0)],void 0===(n=function(e,t,r,i,n,o,s){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.call(this)||this;return i.handles=new o,i}return r(t,e),t.prototype.destroy=function(){this.handles.destroy()},i([s.property({readOnly:!0})],t.prototype,"handles",void 0),i([s.subclass("esri.core.HandleOwner")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1505:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){var r,i,n,o,s,a,u,l,c,p;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.WGLGeometryType||(t.WGLGeometryType={}))[r.FILL=0]="FILL",r[r.LINE=1]="LINE",r[r.MARKER=2]="MARKER",r[r.TEXT=3]="TEXT",r[r.LABEL=4]="LABEL",(i=t.WGLGeometryTransactionStatus||(t.WGLGeometryTransactionStatus={}))[i.SUCCEEDED=0]="SUCCEEDED",i[i.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY",(n=t.WGLDrawPhase||(t.WGLDrawPhase={}))[n.NONE=0]="NONE",n[n.MAP=1]="MAP",n[n.LABEL=2]="LABEL",n[n.LABEL_ALPHA=4]="LABEL_ALPHA",n[n.HITTEST=8]="HITTEST",n[n.HIGHLIGHT=16]="HIGHLIGHT",n[n.CLIP=32]="CLIP",n[n.DEBUG=64]="DEBUG",n[n.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES",(o=t.VVType||(t.VVType={}))[o.SIZE=0]="SIZE",o[o.COLOR=1]="COLOR",o[o.OPACITY=2]="OPACITY",o[o.ROTATION=3]="ROTATION",(s=t.WGLVVFlag||(t.WGLVVFlag={}))[s.NONE=0]="NONE",s[s.OPACITY=1]="OPACITY",s[s.COLOR=2]="COLOR",s[s.ROTATION=4]="ROTATION",s[s.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",s[s.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",s[s.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",s[s.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE",(a=t.WGLVVTarget||(t.WGLVVTarget={}))[a.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",a[a.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",a[a.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",a[a.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE",(u=t.CapType||(t.CapType={}))[u.UNKNOWN=0]="UNKNOWN",u[u.BUTT=1]="BUTT",u[u.ROUND=2]="ROUND",u[u.SQUARE=3]="SQUARE",(l=t.JoinType||(t.JoinType={}))[l.UNKNOWN=0]="UNKNOWN",l[l.MITER=1]="MITER",l[l.BEVEL=2]="BEVEL",l[l.ROUND=3]="ROUND",(c=t.Alignment||(t.Alignment={}))[c.SCREEN=0]="SCREEN",c[c.MAP=1]="MAP",(p=t.MosaicType||(t.MosaicType={}))[p.SPRITE=0]="SPRITE",p[p.GLYPH=1]="GLYPH"}.apply(null,i))||(e.exports=n)},1511:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(133),r(155),r(13),r(10),r(14),r(558),r(81),r(1531),r(1505),r(1615),r(12),r(53)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,h,f,d){var y;Object.defineProperty(t,"__esModule",{value:!0});var _=s.getLogger("esri.views.2d.engine.webgl.Utils");function g(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=n.strideInBytes}return t}t.C_HITTEST_SEARCH_SIZE=4,t.C_VBO_GEOMETRY="geometry",t.C_VBO_PERINSTANCE="per_instance",t.C_VBO_PERINSTANCE_VV="per_instance_vv",t.C_VBO_VISIBILITY="visibility",t.C_VBO_VISIBILITY_RANGE="visibilityRange",t.C_ICON_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_ICON_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF_DD=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LINE_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LINE_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:44,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_TEXT_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_TEXT_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LABEL_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0},{name:t.C_VBO_VISIBILITY_RANGE,strideInBytes:2,divisor:0}],t.C_ICON_STRIDE_SPEC=g(t.C_ICON_VERTEX_DEF),t.C_ICON_STRIDE_SPEC_VV=g(t.C_ICON_VERTEX_DEF_VV),t.C_FILL_STRIDE_SPEC=g(t.C_FILL_VERTEX_DEF),t.C_FILL_STRIDE_SPEC_VV=g(t.C_FILL_VERTEX_DEF_VV),t.C_FILL_STRIDE_SPEC_DD=g(t.C_FILL_VERTEX_DEF_DD),t.C_LINE_STRIDE_SPEC=g(t.C_LINE_VERTEX_DEF),t.C_LINE_STRIDE_SPEC_VV=g(t.C_LINE_VERTEX_DEF_VV),t.C_TEXT_STRIDE_SPEC=g(t.C_TEXT_VERTEX_DEF),t.C_TEXT_STRIDE_SPEC_VV=g(t.C_TEXT_VERTEX_DEF_VV),t.C_LABEL_STRIDE_SPEC=g(t.C_LABEL_VERTEX_DEF),t.getStrides=function(e,r,i){switch(e){case p.WGLGeometryType.MARKER:return r?t.C_ICON_STRIDE_SPEC_VV:t.C_ICON_STRIDE_SPEC;case p.WGLGeometryType.FILL:return i?t.C_FILL_STRIDE_SPEC_DD:r?t.C_FILL_STRIDE_SPEC_VV:t.C_FILL_STRIDE_SPEC;case p.WGLGeometryType.LINE:return r?t.C_LINE_STRIDE_SPEC_VV:t.C_LINE_STRIDE_SPEC;case p.WGLGeometryType.TEXT:return r?t.C_TEXT_STRIDE_SPEC_VV:t.C_TEXT_STRIDE_SPEC;case p.WGLGeometryType.LABEL:return t.C_LABEL_STRIDE_SPEC}return null};var v=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],m=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],T=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],I=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],E=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY,t.C_VBO_VISIBILITY_RANGE];function b(e){switch(e){case p.WGLGeometryType.MARKER:return v;case p.WGLGeometryType.FILL:return m;case p.WGLGeometryType.LINE:return T;case p.WGLGeometryType.TEXT:return I;case p.WGLGeometryType.LABEL:return E}return null}function w(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function S(e){switch(e){case"esriSMS":return"simple-marker";case"esriPMS":return"picture-marker";case"esriSLS":return"simple-line";case"esriPLS":return"picture-line";case"esriSFS":return"simple-fill";case"esriPFS":return"picture-fill";case"esriTS":return"text"}return e}function F(e){return"string"==typeof e}t.getNamedBuffers=b,t.strideToPackingFactor=w,t.allocateTypedArrayBuffer=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}},t.allocateTypedArrayBufferwithData=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}},t.normalizeSymbolType=S,t.isMarkerSymbol=function(e){var t=S(e.type);if(t){switch(t){case"simple-marker":case"picture-marker":case"CIMPointSymbol":return!0}return!1}},t.isFillSymbol=function(e){var t=S(e.type);if(t){switch(t){case"simple-fill":case"picture-fill":case"CIMPolygonSymbol":return!0}return!1}},t.isLineSymbol=function(e){var t=S(e.type);if(t){switch(t){case"simple-line":case"picture-line":case"CIMLineSymbol":return!0}return!1}},t.isPictureSymbol=function(e){var t=S(e.type);if(t){switch(t){case"picture-marker":case"picture-line":case"picture-fill":return!0}return!1}return!1},t.isTextSymbol=function(e){var t=S(e.type);if(t){switch(t){case"text":case"CIMTextSymbol":return!0}return!1}},t.getTextProperties=function(e){return h.TextProperties.pool.acquire(e.color?c.copyAndPremultiply(e.color):[255,255,255,255],e.haloColor?c.copyAndPremultiply(e.haloColor):[255,255,255,255],a.pt2px(e.haloSize),a.pt2px(e.font.size),e.angle*Math.PI/180,e.xoffset/e.font.size,e.yoffset/e.font.size,"left"===e.horizontalAlignment?0:"right"===e.horizontalAlignment?1:.5,"top"===e.verticalAlignment?0:"bottom"===e.verticalAlignment?1:.5)},t.isDefined=function(e){return null!=e},t.isNumber=function(e){return"number"==typeof e},t.isString=F,t.isStringOrNull=function(e){return null==e||F(e)},t.lerp=function(e,t,r){return e+(t-e)*r};var C=function(){function e(){this._arr=[],this._push=this._push.bind(this)}return e.prototype._push=function(e,t){this._arr.push(t)},e.prototype.getKeys=function(e){return this._arr.length=0,e&&e.forEach(this._push),this._arr},e}();t.KeysGetter=C;var O=function(){function e(){this._arr=[],this._push=this._push.bind(this)}return e.prototype._push=function(e,t){this._arr.push(e)},e.prototype.getValues=function(e){return this._arr.length=0,e&&e.forEach(this._push),this._arr},e}();function x(e){var t={};switch(e){case"esriGeometryPoint":return function(e,r,i,n){return u.hydratePoint(r,t,e,i,n)};case"esriGeometryPolygon":return function(e,r,i,n){return u.hydratePolygon(r,t,e,i,n)};case"esriGeometryPolyline":return function(e,r,i,n){return u.hydratePolyline(r,t,e,i,n)};case"esriGeometryMultipoint":return function(e,r,i,n){return u.hydrateMultipoint(r,t,e,i,n)};default:return _.error(new o("mapview-arcade","Unable to handle geometryType: "+e)),function(e,t,r,i){return e}}}t.ValuesGetter=O,t.getCapType=function(e,t){switch(e){case"butt":return p.CapType.BUTT;case"round":return t?p.CapType.SQUARE:p.CapType.ROUND;case"square":return p.CapType.SQUARE;default:return _.error(new o("mapview-invalid-type","Cap type "+e+" is not a valid option. Defaulting to round")),p.CapType.ROUND}},t.getJoinType=function(e){switch(e){case"miter":return p.JoinType.MITER;case"bevel":return p.JoinType.BEVEL;case"round":return p.JoinType.ROUND;default:return _.error(new o("mapview-invalid-type","Join type "+e+" is not a valid option. Defaulting to round")),p.JoinType.ROUND}},t.getVVType=function(e){switch(e){case"opacity":return p.VVType.OPACITY;case"color":return p.VVType.COLOR;case"rotation":return p.VVType.ROTATION;case"size":return p.VVType.SIZE;default:return _.error("Cannot interpret unknown vv: "+e),null}},t.createHydrateFactory=x,t.getTransformParams=function(e){return{transform:e.transform,hasZ:e.hasZ,hasM:e.hasM}},t.createArcadeFunction=function(e,t,r){var o=t.fields,s=t.spatialReference,a=t.hasGeometryExpr,u=t.geometryType,c=l.createFunction(e),p=new n,h=new i({viewingMode:null,scale:null}),f={},d={vars:{$feature:p,$view:null},spatialReference:s},y={fields:o},_=x(u);return function(e,t,i){if(a){var n=t.transform,o=t.hasZ,u=t.hasM,g=_(e.geometry,n,o,u);g.spatialReference=s,p.repurposeFromGraphicLikeObject(g,e.attributes,y)}else p.repurposeFromGraphicLikeObject(e.geometry,e.attributes,y);i?((d.vars.$view=h).attributes.viewingMode=i.viewingMode,h.attributes.scale=i.scale):d.vars.$view=f;var v=l.executeFunction(c,d);return r?r(v):v}},t.copyMeshData=function(e,t,r,i,n,o,s){for(var a in o)for(var u=o[a].stride,l=w(u),c=o[a].data,p=r[a].data,h=u*n.vertexCount/l,f=u*e/l,d=u*n.vertexFrom/l,y=0;y<h;++y)p[y+f]=c[y+d];var _=n.indexCount;for(y=0;y<_;++y)i[y+t]=s[y+n.indexFrom]-n.vertexFrom+e},t.C_VBO_INFO=((y={})[t.C_VBO_GEOMETRY]=35044,y[t.C_VBO_VISIBILITY]=35044,y[t.C_VBO_VISIBILITY_RANGE]=35048,y),t.createGeometryData=function(e,t){for(var r=[],i=0;i<5;++i){for(var n={},o=0,s=b(i);o<s.length;o++){var a=s[o];n[a]={data:t(i,a)}}r.push({data:e(i),buffers:n})}return r},t.resampleHermite=function(e,t,r,i,n,o,s){void 0===s&&(s=!0);for(var a=t/n,u=r/o,l=Math.ceil(a/2),c=Math.ceil(u/2),p=0;p<o;p++)for(var h=0;h<n;h++){for(var f=4*(h+(s?o-p-1:p)*n),d=0,y=0,_=0,g=0,v=0,m=0,T=0,I=(p+.5)*u,E=Math.floor(p*u);E<(p+1)*u;E++)for(var b=Math.abs(I-(E+.5))/c,w=(h+.5)*a,S=b*b,F=Math.floor(h*a);F<(h+1)*a;F++){var C=Math.abs(w-(F+.5))/l,O=Math.sqrt(S+C*C);-1<=O&&O<=1&&0<(d=2*O*O*O-3*O*O+1)&&(T+=d*e[3+(C=4*(F+E*t))],_+=d,e[C+3]<255&&(d=d*e[C+3]/250),g+=d*e[C],v+=d*e[C+1],m+=d*e[C+2],y+=d)}i[f]=g/y,i[f+1]=v/y,i[f+2]=m/y,i[f+3]=T/_}},t.createTextureFromTexelData=function(e,t){var r,i;return i=f.isPowerOfTwo(t.width)&&f.isPowerOfTwo(t.height)?(r=!0,9987):(r=!1,9729),new d(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:r,samplingMode:i,wrapMode:33071,flipped:!0},t)},t.geometryToMappedGeometry=function(e){return{vertexFrom:void 0,vertexTo:void 0,geometry:e}};var P=new Map;t.createProgramDescriptor=function(e,t){if(!P.has(e)){var i=function(e){var t={},i=function(i){var n=e[i],o=0;t[i]=n.map(function(e){var t=r({},e,{normalized:e.normalized||!1,divisor:e.divisor||0,offset:o,stride:0});return o+=e.count*function(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}(e.type),t}),t[i].forEach(function(e){return e.stride=o})};for(var n in e)i(n);return t}(t),n={strides:function(e){var t={};for(var r in e){var i=e[r];t[r]=i.length?i[0].stride:0}return t}(i),bufferLayouts:i,attributes:function(e){var t={};for(var r in e)for(var i=0,n=e[r];i<n.length;i++){var o=n[i];t[o.name]=o.location}return t}(t)};P.set(e,n)}return P.get(e)}}.apply(null,i))||(e.exports=n)},1513:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(80)],void 0===(n=function(e,t,r){return function(){function e(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}return e.pool=new r(e,!0),e}()}.apply(null,i))||(e.exports=n)},1515:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1535)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var i=r.parseFeatureQuery(e,t).queryResult.featureResult;if(i&&i.features&&i.features.length&&i.objectIdFieldName)for(var n=i.objectIdFieldName,o=0,s=i.features;o<s.length;o++){var a=s[o];a.attributes&&(a.objectId=a.attributes[n])}return i}}.apply(null,i))||(e.exports=n)},1520:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t,r,i){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=i||e.byteLength}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,i=new e(this._data,this._dataView,r,r+t);return this._skip(t),i},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){var i="",n="";r=Math.min(this._end,r);for(var o=t;o<r;++o){var s=e[o];128&s?n+="%"+s.toString(16):(i+=decodeURIComponent(n)+String.fromCharCode(s),n="")}return n.length&&(i+=decodeURIComponent(n)),i},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,i))||(e.exports=n)},1521:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(96),r(1539),r(1540),r(352),r(1513)],void 0===(n=function(e,t,r,i,n,o,s){var a=new o("0/0/0/0"),u=function(){function e(e,t,r,i,n,o,s,a){this.x=e,this.ymin=t,this.ymax=r,this.invM=i,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=s,this.rightBound=a}return e.create=function(t,r){var i;t[1]>r[1]&&(t=(i=[r,t])[0],r=i[1]);var n=t[0],o=t[1],s=r[0],a=r[1],u=s-n,l=a-o,c=0!==l?u/l:0,p=(Math.ceil(o)-o)*c,h=(Math.floor(o)-o)*c;return new e(n,Math.floor(o),Math.ceil(a),c,u<0?p:h,u<0?h:p,u<0?s:n,u<0?n:s)},e.prototype.incrRow=function(){this.x+=this.invM},e.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)},e.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)},e}(),l=[[0,0],[0,0],[0,0],[0,0]];return function(){function e(e,t){var r=this;this.tileInfo=e,this.fullExtent=t,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};var n=e.lods.slice();n.sort(function(e,t){return t.scale-e.scale});var o=this._lodInfos=n.map(function(r){return i.create(e,r,t)});n.forEach(function(e,t){r._infoByLevel[e.level]=o[t],r._infoByScale[e.scale]=o[t],r.scales[t]=e.scale},this),this._wrap=e.isWrappable}return Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this.tileInfo.spatialReference},enumerable:!0,configurable:!0}),e.prototype.getLODInfoAt=function(e){return this._infoByLevel["number"==typeof e?e:e.level]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),a.set(t);var i=this._infoByLevel[a.level];return i?i.getTileBounds(e,a,r):e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),a.set(t);var i=this._infoByLevel[a.level];return i?i.getTileCoords(e,a,r):e},e.prototype.getTileCoverage=function(e,t,r){void 0===t&&(t=192),void 0===r&&(r="closest");var i,o,a,c="closest"===r?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),p=n.pool.acquire(c),h=this._wrap,f=1/0,d=-1/0,y=p.spans;l[0][0]=l[0][1]=l[1][1]=l[3][0]=-t,l[1][0]=l[2][0]=e.size[0]+t,l[2][1]=l[3][1]=e.size[1]+t;for(var _=0,g=l;_<g.length;_++){var v=g[_];e.toMap(v,v),v[0]=c.getColumnForX(v[0]),v[1]=c.getRowForY(v[1])}for(var m=[],T=3,I=0;I<4;I++)if(l[I][1]!==l[T][1]){var E=u.create(l[I],l[T]);f=Math.min(E.ymin,f),d=Math.max(E.ymax,d),void 0===m[E.ymin]&&(m[E.ymin]=[]),m[E.ymin].push(E),T=I}else T=I;if(null==f||null==d||d-f>100)return null;var b=[];for(i=f;i<d;){null!=m[i]&&(b=b.concat(m[i])),o=1/0,a=-1/0;for(I=b.length-1;I>=0;I--){E=b[I];o=Math.min(o,E.getLeftCol()),a=Math.max(a,E.getRightCol())}if(o=Math.floor(o),a=Math.floor(a),i>=c.first[1]&&i<=c.last[1])if(h)if(c.size[0]<c.worldSize[0]){var w=Math.floor(a/c.worldSize[0]);for(I=Math.floor(o/c.worldSize[0]);I<=w;I++)y.push(new s(i,Math.max(c.getFirstColumnForWorld(I),o),Math.min(c.getLastColumnForWorld(I),a)))}else y.push(new s(i,o,a));else o>c.last[0]||a<c.first[0]||(o=Math.max(o,c.first[0]),a=Math.min(a,c.last[0]),y.push(new s(i,o,a)));i+=1;for(I=b.length-1;I>=0;I--){(E=b[I]).ymax>=i?E.incrRow():b.splice(I,1)}}return p},e.prototype.getTileParentId=function(e){a.set(e);var t=this._infoByLevel[a.level],r=this._lodInfos.indexOf(t)-1;return r<0?null:(this._getTileIdAtLOD(a,this._lodInfos[r],a),a.id)},e.prototype.getTileResolution=function(e){var t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1},e.prototype.getTileScale=function(e){var t=this._infoByLevel[e.level];return t?t.scale:-1},e.prototype.intersects=function(e,t){a.set(t);var r=this._infoByLevel[a.level],i=e.lodInfo;if(i.resolution>r.resolution){this._getTileIdAtLOD(a,i,a);for(var n=i.denormalizeCol(a.col,a.world),o=0,s=e.spans;o<s.length;o++){var u=s[o];if(u.row===a.row&&u.colFrom<=n&&u.colTo>=n)return!0}}if(i.resolution<r.resolution){var l=e.spans.reduce(function(e,t){return e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e},[1/0,-1/0,1/0,-1/0]),c=l[0],p=l[1],h=l[2],f=l[3],d=r.denormalizeCol(a.col,a.world),y=i.getColumnForX(r.getXForColumn(d)),_=i.getRowForY(r.getYForRow(a.row)),g=i.getColumnForX(r.getXForColumn(d+1))-1,v=i.getRowForY(r.getYForRow(a.row+1))-1;return!(y>f||g<h||_>p||v<c)}var m=i.denormalizeCol(a.col,a.world);return e.spans.some(function(e){return e.row===a.row&&e.colFrom<=m&&e.colTo>=m})},e.prototype.normalizeBounds=function(e,t,i){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){var n=r.getInfo(this.tileInfo.spatialReference),o=-i*(n.valid[1]-n.valid[0]);e[0]+=o,e[2]+=o}return e},e.prototype.getSmallestInfoForScale=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(var r=1;r<t.length-1;r++)if(e>t[r])return this._infoByScale[t[r-1]];return this._infoByScale[t[t.length-1]]},e.prototype.getClosestInfoForScale=function(e){var t=this.scales;return this._infoByScale[e]?this._infoByScale[e]:(e=t.reduce(function(t,r,i,n){return Math.abs(r-e)<Math.abs(t-e)?r:t},t[0]),this._infoByScale[e])},e.prototype.scaleToLevel=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(var r=t.length-1;r>=0;r--)if(e<t[r]){return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1])}return this._infoByScale[t[0]].level},e.prototype.scaleToZoom=function(e){return this.tileInfo.scaleToZoom(e)},e.prototype._getTileIdAtLOD=function(e,t,r){var i=this._infoByLevel[r.level];return e.set(r),t.resolution<i.resolution?null:t.resolution===i.resolution?e:(e.level=t.level,e.col=Math.floor(r.col*i.resolution/t.resolution+.01),e.row=Math.floor(r.row*i.resolution/t.resolution+.01),e)},e}()}.apply(null,i))||(e.exports=n)},1522:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(10)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=new Float32Array(1),n=new Uint32Array(i.buffer),o=r.getLogger("esri.views.2d.engine.webgl.number");function s(e,t,r){var i=Math.max(Math.min(e,r),t);return i!==e&&o.warn("Value of "+e+" exceeded rendering limitations and was clamped to "+i),i}t.i8=function(e){return s(e,-128,127)},t.i16=function(e){return s(e,-32768,32767)},t.i32=function(e){return s(e,-2147483648,2147483647)},t.u8=function(e){return s(e,0,255)},t.u16=function(e){return s(e,0,65535)},t.u32=function(e){return s(e,0,4294967295)},t.nextHighestPowerOfTwo=function(e){var t=e;t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16;var r=++t>>1;return e-r<t-e?r:t},t.toUint32=function(e){return i[0]=e,n[0]},t.toFloat32=function(e){return n[0]=e,i[0]},t.i1616to32=function(e,t){return 65535&e|t<<16},t.i8888to32=function(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24},t.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},t.numTo32=function(e){return 0|e}}.apply(null,i))||(e.exports=n)},1524:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(352)],void 0===(n=function(e,t,r,i){function n(e,t){e.delete(t)}var o=new i(0,0,0,0),s=new Map,a=[],u=[];return function(){function e(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=null==e.resampling||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer)}return e.prototype.destroy=function(){this.tileIndex.clear()},e.prototype.update=function(e){var t=this,r=this.resampling,i=this.tileIndex,l=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(u.length=0,a.length=0,s.clear(),l){var c=this.tileInfoView.tileInfo,p=c.minScale,h=c.maxScale,f=l.spans,d=l.lodInfo,y=d.level,_=e.state.scale,g=!e.stationary&&_>this._previousScale;if(this._previousScale=_,this.tiles.length=0,!r&&(_>p||_<h))return this.tiles.length=0,s.clear(),i.forEach(function(e){t.releaseTile(e)}),i.clear(),u.length=0,a.length=0,s.clear(),!0;i.forEach(function(e){return e.visible=!0});var v=0,m=0;if(f.length>0)for(var T=0,I=f;T<I.length;T++)for(var E=I[T],b=E.row,w=E.colFrom,S=E.colTo,F=w;F<=S;F++){v++;var C=o.set(y,b,d.normalizeCol(F),d.getWorldForColumn(F)).id;if(i.has(C)){(O=i.get(C)).isReady?(s.set(C,O),m++):g||this._addParentTile(C,s)}else{var O=this.acquireTile(o);this.tileIndex.set(C,O),g||this._addParentTile(C,s)}}var x=m===v;i.forEach(function(e,r){if(o.set(r),!s.has(r)){var i=t.tileInfoView.intersects(l,o);if(!i||!g&&x)if("purge"===t.cachePolicy){!(o.level!==y)&&i||a.push(r)}else(o.level>y||!i)&&a.push(r);else e.isReady?u.push(r):o.level>y&&a.push(r)}});for(var P=0,R=u;P<R.length;P++){C=R[P];(O=i.get(C))&&O.isReady&&s.set(C,O)}for(var B=0,V=a;B<V.length;B++){C=V[B],O=i.get(C);this.releaseTile(O),n(i,C)}return s.forEach(function(e){return t.tiles.push(e)}),i.forEach(function(e){s.has(e.key.id)||(e.visible=!1)}),x}},e.prototype.clear=function(){var e=this,t=this.tileIndex;t.forEach(function(t){e.releaseTile(t)}),t.clear()},e.prototype._addParentTile=function(e,t){for(var r=e,i=null;r=this.tileInfoView.getTileParentId(r);)if(this.tileIndex.has(r)&&(i=this.tileIndex.get(r))&&i.isReady){t.has(i.key.id)||t.set(i.key.id,i);break}},e}()}.apply(null,i))||(e.exports=n)},1529:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(170),r(213),r(37),r(557),r(352)],void 0===(n=function(e,t,r,i,n,o,s){function a(e,t){var r=e.bounds,i=t.bounds;return e.key.id!==t.key.id&&e.key.world===t.key.world&&r[0]<=i[0]&&r[1]<=i[1]&&r[2]>=i[2]&&r[3]>=i[3]}Object.defineProperty(t,"__esModule",{value:!0}),t.isParentOf=a,t.isChildOf=function(e,t){return a(t,e)};var u=function(){function e(e,t){this.bounds=n.create(),this.key=new s(0,0,0,0),this.objectIds=new r.default,this.key.set(t);var i=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=i.resolution,this.scale=i.scale,this.level=i.level,this.needsClear=!0}return Object.defineProperty(e.prototype,"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.tileInfoView,this.id)},e.prototype.createChildTiles=function(){for(var t=this.key.getChildKeys(),r=i.acquire(),n=0;n<t.length;n++)r[n]=new e(this.tileInfoView,t[n]);return r},e.prototype.getQuantizationParameters=function(){return o.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})},e}();t.Tile=u,t.default=u}.apply(null,i))||(e.exports=n)},1531:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1522)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.white=[255,255,255,1];var i=[0,0,0,0];function n(e,t){return Array.isArray(t)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a),e}function o(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!1);var i=e[t+3];return e[t+0]*=i,e[t+1]*=i,e[t+2]*=i,r||(e[t+3]*=255),e}t.premultiplyAlpha=o,t.copyAndPremultiply=function(e){return o(n([],e))},t.premultiplyAlphaUint32=function(e){return o(n(i,e)),r.i8888to32(i[0],i[1],i[2],i[3])},t.premultiplyAlphaRGBA=function(e){var t=e.r,i=e.g,n=e.b,o=e.a,s=t*o,a=i*o,u=n*o,l=255*o;return r.i8888to32(s,a,u,l)}}.apply(null,i))||(e.exports=n)},1535:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(13),r(10),r(1520),r(1536),r(1537)],void 0===(n=function(e,t,r,i,n,o,s){function a(e){return e>=S.length?null:S[e]}function u(e){return e>=F.length?null:F[e]}function l(e){return e>=C.length?null:C[e]}function c(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){for(var i=e.createPointGeometry(t);r.next();)switch(r.tag()){case 3:for(var n=r.getUInt32(),o=r.pos()+n,s=0;r.pos()<o;)e.addCoordinatePoint(i,r.getSInt64(),0,s++);break;case 1:case 2:default:r.skip()}return i}function h(e,t,r){for(var i=e.createGeometry(t),n=2+(t.hasZ?1:0)+(t.hasM?1:0);r.next();)switch(r.tag()){case 2:for(var o=r.getUInt32(),s=r.pos()+o,a=0;r.pos()<s;)e.addLength(i,r.getUInt32(),a++);break;case 3:for(var u=r.getUInt32(),l=(s=r.pos()+u,0),c=0;r.pos()<s;)e.addCoordinate(i,r.getSInt64(),c,l),++l===n&&(c++,l=0);break;case 1:default:r.skip()}return i}function f(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function d(e){for(var t={type:a(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=a(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=u(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function y(e,t,r,i){for(var n=e.createFeature(t),o=0;r.next();)switch(r.tag()){case 1:var s=i[o++].name;n.attributes[s]=f(r.getMessage());break;case 2:n.geometry=h(e,t,r.getMessage());break;case 4:n.centroid=p(e,t,r.getMessage());break;default:r.skip()}return n}function _(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function g(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function v(e){for(var t={originPosition:l(0)};e.next();)switch(e.tag()){case 1:t.originPosition=l(e.getEnum());break;case 2:t.scale=_(e.getMessage());break;case 3:t.translate=g(e.getMessage());break;default:e.skip()}return t}function m(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function T(e,t){for(var r=e.createSpatialReference();t.next();)switch(t.tag()){case 1:r.wkid=t.getUInt32();break;case 5:r.wkt=t.getString();break;case 2:case 3:case 4:default:t.skip()}return r}function I(e,t){var r=e.createFeatureResult();r.geometryType=c(e,0);for(var i=!1;t.next();)switch(t.tag()){case 1:r.objectIdFieldName=t.getString();break;case 3:r.globalIdFieldName=t.getString();break;case 4:r.geohashFieldName=t.getString();break;case 5:r.geometryProperties=m(t.getMessage());break;case 7:r.geometryType=c(e,t.getEnum());break;case 8:r.spatialReference=T(e,t.getMessage());break;case 10:r.hasZ=t.getBool();break;case 11:r.hasM=t.getBool();break;case 12:r.transform=v(t.getMessage());break;case 9:var n=t.getBool();r.exceededTransferLimit=n;break;case 13:e.addField(r,d(t.getMessage()));break;case 15:i||(e.prepareFeatures(r),i=!0),e.addFeature(r,y(e,r,t.getMessage(),r.fields));break;case 2:case 6:default:t.skip()}return e.finishFeatureResult(r),r}function E(e,t){for(var r={};t.next();)switch(t.tag()){case 1:r.featureResult=I(e,t.getMessage());break;default:t.skip()}return r}function b(e){return e&&"dehydrated"===e.type?new o.Context(e):new s.Context(e)}Object.defineProperty(t,"__esModule",{value:!0});var w=i.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),S=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],F=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],C=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e,t){var i=b(t);try{for(var o=new n(new Uint8Array(e),new DataView(e)),s={};o.next();)switch(o.tag()){case 2:s.queryResult=E(i,o.getMessage());break;default:o.skip()}return s}catch(e){var a=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return w.error(a),{queryResult:{featureResult:i.createFeatureResult()}}}}}.apply(null,i))||(e.exports=n)},1536:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(79),r(23),r(34),r(354)],void 0===(n=function(e,t,r,i,n,o){function s(e,t,r,i){return t}function a(e,t,r,i){switch(r){case 0:return p(e,t+i,0);case 1:return h(e,t+i,1)}}function u(e,t,r,i){switch(r){case 0:return p(e,t+i,0);case 1:return h(e,t+i,1);case 2:return p(e,t,2)}}function l(e,t,r,i){switch(r){case 0:return p(e,t+i,0);case 1:return h(e,t+i,1);case 2:return p(e,t,3)}}function c(e,t,r,i){switch(r){case 0:return p(e,t+i,0);case 1:return h(e,t+i,1);case 2:case 3:return p(e,t,3)}}function p(e,t,r){var i=e.translate,n=e.scale;return i[r]+t*n[r]}function h(e,t,r){var i=e.translate,n=e.scale;return i[r]-t*n[r]}Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=s,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0}return e.prototype.createFeatureResult=function(){return{exceededTransferLimit:!1,features:[],fields:[],hasM:!1,hasZ:!1,geometryType:null,objectIdFieldName:null,globalIdFieldName:null,geometryProperties:null,geohashFieldName:null,spatialReference:null,transform:null}},e.prototype.finishFeatureResult=function(e){this.options.applyTransform&&(e.transform=null)},e.prototype.createSpatialReference=function(){return new n},e.prototype.addField=function(e,t){e.fields.push(o.fromJSON(t))},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var i in t.attributes){var n=t.attributes[i];"string"==typeof n&&n.length>r&&delete t.attributes[i]}e.features.push(t)},e.prototype.prepareFeatures=function(e){switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=this.addCoordinatePoint.bind(this),this.createGeometry=this.createPointGeometry.bind(this);break;case"polygon":this.addCoordinate=this.addCoordinatePolygon.bind(this),this.createGeometry=this.createPolygonGeometry.bind(this);break;case"polyline":this.addCoordinate=this.addCoordinatePolyline.bind(this),this.createGeometry=this.createPolylineGeometry.bind(this);break;case"multipoint":this.addCoordinate=this.addCoordinateMultipoint.bind(this),this.createGeometry=this.createMultipointGeometry.bind(this);break;default:i.neverReached(e.geometryType)}},e.prototype.createFeature=function(e){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{uid:r.generateUID(),objectId:null,attributes:{},geometry:null,visible:!0}},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.paths,t,r,i)},e.prototype.addCoordinatePolygon=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.rings,t,r,i)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r,i){if(null===this.coordinateBuffer){var n=this.lengths.reduce(function(e,t){return e+t},0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var o=this.transformPathLikeValue(t,i),s=e[e.length-1];0===i&&s.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=o},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?c:t?u:r?l:a},e}();t.Context=f}.apply(null,i))||(e.exports=n)},1537:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(550),r(564),r(553)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new i.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(){},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new r.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new n.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new n.default},e}();t.Context=o}.apply(null,i))||(e.exports=n)},1538:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var o=0;o<n.length;o++)r[i][o]=e(n[o])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},1539:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(96),r(352)],void 0===(n=function(e,t,r,i){function n(e,t){return[e,t]}function o(e,t,r){return e[0]=t,e[1]=r,e}var s=new i("0/0/0/0");return function(){function e(e,t,r,i,n,o,s,a,u,l,c,p){this.level=e,this.resolution=t,this.scale=r,this.origin=i,this.first=n,this.last=o,this.size=s,this.norm=a,this.worldStart=u,this.worldEnd=l,this.worldSize=c,this.wrap=p}return e.create=function(t,i,s){var a,u,l,c,p=r.getInfo(t.spatialReference),h=n(t.origin.x,t.origin.y),f=n(t.size[0]*i.resolution,t.size[1]*i.resolution),d=n(-1/0,-1/0),y=n(1/0,1/0),_=n(1/0,1/0);return s&&(o(d,Math.max(0,Math.floor((s.xmin-h[0])/f[0])),Math.max(0,Math.floor((h[1]-s.ymax)/f[1]))),o(y,Math.max(0,Math.floor((s.xmax-h[0])/f[0])),Math.max(0,Math.floor((h[1]-s.ymin)/f[1]))),o(_,y[0]-d[0]+1,y[1]-d[1]+1)),t.isWrappable?(a=n(Math.ceil(Math.round(2*p.origin[1]/i.resolution)/t.size[0]),_[1]),u=n(Math.floor((p.origin[0]-h[0])/f[0]),d[1]),l=n(a[0]+u[0]-1,y[1]),c=!0):(u=d,l=y,a=_,c=!1),new e(i.level,i.resolution,i.scale,h,d,y,_,f,u,l,a,c)},e.prototype.normalizeCol=function(e){if(!this.wrap)return e;var t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t},e.prototype.denormalizeCol=function(e,t){return this.wrap?this.worldSize[0]*t+e:e},e.prototype.getWorldForColumn=function(e){return this.wrap?Math.floor(e/this.worldSize[0]):0},e.prototype.getFirstColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]},e.prototype.getLastColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1},e.prototype.getColumnForX=function(e){return(e-this.origin[0])/this.norm[0]},e.prototype.getXForColumn=function(e){return this.origin[0]+e*this.norm[0]},e.prototype.getRowForY=function(e){return(this.origin[1]-e)/this.norm[1]},e.prototype.getYForRow=function(e){return this.origin[1]-e*this.norm[1]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),s.set(t);var i=r?s.col:this.denormalizeCol(s.col,s.world),n=s.row;return function(e,t,r,i,n){e[0]=t,e[1]=r,e[2]=i,e[3]=n}(e,this.getXForColumn(i),this.getYForRow(n+1),this.getXForColumn(i+1),this.getYForRow(n)),e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),s.set(t);var i=r?s.col:this.denormalizeCol(s.col,s.world);return Array.isArray(e)?o(e,this.getXForColumn(i),this.getYForRow(s.row)):(e.x=this.getXForColumn(i),e.y=this.getYForRow(s.row)),e},e}()}.apply(null,i))||(e.exports=n)},1540:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(213),r(80),r(1513)],void 0===(n=function(e,t,r,i,n){return function(){function e(e){this.lodInfo=e,this.spans=r.acquire()}return e.prototype.release=function(){for(var e=0,t=this.spans;e<t.length;e++){var i=t[e];n.pool.release(i)}r.release(this.spans)},e.prototype.forEach=function(e,t){var r=this.spans,i=this.lodInfo,n=i.level;if(0!==r.length)for(var o=0,s=r;o<s.length;o++)for(var a=s[o],u=a.row,l=a.colFrom,c=a.colTo,p=l;p<=c;p++)e.call(t,n,u,i.normalizeCol(p),i.getWorldForColumn(p))},e.pool=new i(e,!0),e}()}.apply(null,i))||(e.exports=n)},1541:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(0),r(40),r(1546)],void 0===(n=function(e,t,r,i,n,o,s,a){var u=new Set,l=[],c=new Map,p=[0,0];return function(e){function t(t){var r=e.call(this,t)||this;return r._keysToRequests=new Map,r.concurrency=6,r.process=null,r.strategy="scale-first",r.tileInfoView=null,r.tileServers=null,r}return r(t,e),t.prototype.initialize=function(){var e=this,t="scale-first"===this.strategy?this._peekByScaleFirst.bind(this):this._peekByCenterFirst.bind(this),r=this,i=r.tileServers,n=r.concurrency,o=r.process;i&&i.length>0?this._queues=i.map(function(r){return new a({concurrency:n,process:function(t){var i=e._keysToRequests.get(t);return o(i,r)},peeker:t})}):this._queues=[new a({concurrency:n,process:function(t){var r=e._keysToRequests.get(t);return o(r)},peeker:t})]},t.prototype.destroy=function(){this.clear();for(var e=0,t=this._queues;e<t.length;e++)t[e].destroy();this._queues=null},Object.defineProperty(t.prototype,"length",{get:function(){return this._queues.reduce(function(e,t){return e+t.length},0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onGoingCount",{get:function(){return this._keysToRequests.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.length>0||this.onGoingCount>0},enumerable:!0,configurable:!0}),t.prototype.clear=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].clear();this._keysToRequests.clear(),this.notifyChange("updating")},t.prototype.find=function(e,t){for(var r=this,i=0,n=this._queues;i<n.length;i++){var o=n[i].find(function(t){return e(r._keysToRequests.get(t).key)});if(o)return o}},t.prototype.getPromise=function(e){for(var t="string"==typeof e?e:e.id,r=0,i=this._queues;r<i.length;r++){var n=i[r].get(t);if(n)return n}},t.prototype.getRequest=function(e){var t="string"==typeof e?e:e.id;return this._keysToRequests.get(t)},t.prototype.has=function(e){return"string"==typeof e?this._keysToRequests.has(e):this._keysToRequests.has(e.id)},t.prototype.isOngoing=function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queues.some(function(e){return e.isOngoing(t)})},t.prototype.pause=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].pause()},t.prototype.push=function(e){var t=this,r=e.key.id;if(this.has(r))return this.getPromise(r);var i=this._queues[e.key.row%this._queues.length].push(r),n=function(){t._keysToRequests.delete(r),t.notifyChange("updating")};return this._keysToRequests.set(r,e),i.then(n,n),this.notifyChange("updating"),i},t.prototype.reset=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].reset();this.notifyChange("updating")},t.prototype.resume=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].resume()},t.prototype._peekByScaleFirst=function(e){if(!this.state)return e[0];for(var t=this.tileInfoView,r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=0,o=e;n<o.length;n++){var s=o[n],a=this._keysToRequests.get(s),p=this.tileInfoView.getTileScale(a.key);c.has(p)||(c.set(p,[]),r=Math.max(p,r),i=Math.min(p,i)),c.get(p).push(a.key),u.add(p)}var h=this.state.scale;c.has(h)||(function(e,t){e.length=0,t.forEach(function(t){return e.push(t)})}(l,u),l.sort(),h=l.reduce(function(e,t,r,i){return Math.abs(t-h)<Math.abs(e-h)?t:e},l[0])),h=Math.min(h,r),h=Math.max(h,i);var f=c.get(h),d=t.getClosestInfoForScale(h),y=d.getColumnForX(this.state.center[0]),_=d.getRowForY(this.state.center[1]);return f.sort(function(e,t){var r=d.denormalizeCol(e.col,e.world),i=d.denormalizeCol(t.col,t.world);return Math.sqrt((y-r)*(y-r)+(_-e.row)*(_-e.row))-Math.sqrt((y-i)*(y-i)+(_-t.row)*(_-t.row))}),u.clear(),c.clear(),f[0].id},t.prototype._peekByCenterFirst=function(e){if(!this.state)return e[0];for(var t=this.tileInfoView,r=this.state.center,i=Number.POSITIVE_INFINITY,n=null,o=0,a=e;o<a.length;o++){var u=a[o],l=this._keysToRequests.get(u);t.getTileCoords(p,l.key);var c=s.vec2.distance(p,r);c<i&&(i=c,n=l.key)}return n.id},i([o.property({constructOnly:!0})],t.prototype,"concurrency",void 0),i([o.property({constructOnly:!0})],t.prototype,"process",void 0),i([o.property()],t.prototype,"state",void 0),i([o.property({constructOnly:!0})],t.prototype,"strategy",void 0),i([o.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),i([o.property({constructOnly:!0})],t.prototype,"tileServers",void 0),i([o.property({readOnly:!0})],t.prototype,"updating",null),i([o.subclass()],t)}(o.declared(n))}.apply(null,i))||(e.exports=n)},1545:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1546:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(32),r(9),r(1556),r(57)],void 0===(n=function(e,t,r,i,n,o){return function(){function e(e){var t=this;this._apiPromises=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this._pendingProcessing=0,this.concurrency=1,this.ordered=!1,e.concurrency&&(this.concurrency=e.concurrency),e.ordered&&(this.ordered=!0,this._itemsToProcess=[]),this._queue=new n({peeker:e.peeker}),this.process=e.process;var r=e.scheduler;e.priority&&r&&(this._task=r.registerTask(e.priority,function(e){return t.update(e)},function(){return t.needsUpdate()}))}return e.prototype.destroy=function(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)},Object.defineProperty(e.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length+this._pendingProcessing},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._queue.clear();var e=[];this._processingItems.forEach(function(t){return e.push(t.resultPromise)}),this._processingItems.clear(),e.forEach(function(e){return e.cancel()}),e.length=0,this._apiPromises.forEach(function(t){return e.push(t)}),this._apiPromises.clear(),e.forEach(function(e){return e.cancel()}),this._cancelNext()},e.prototype.find=function(e,t){var r=this,i=void 0;return this._apiPromises.forEach(function(n,o){e.call(t,o)&&(i=r._apiPromises.get(o).promise)}),i},e.prototype.get=function(e){var t=this._apiPromises.get(e);return t&&t.promise||void 0},e.prototype.isOngoing=function(e){return this._processingItems.has(e)},e.prototype.has=function(e){return this._apiPromises.has(e)},e.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},e.prototype.push=function(e){var t=this;if(this._apiPromises.has(e))return this._apiPromises.get(e).promise;var r=i.createDeferred(function(r){var i=t._processingItems.get(e);i?i.resultPromise.cancel(r):(t._remove(e),t._scheduleNext())});return this._add(e,r),this._scheduleNext(),r.promise},e.prototype.reset=function(){var e=[];this._processingItems.forEach(function(t){return e.push(t)}),this._processingItems.clear();for(var t=0,r=e;t<r.length;t++){var i=r[t];i.resultPromise.isFulfilled()?this._processReset(i):(i.isReset=!0,i.resultPromise.cancel())}},e.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())},e.prototype.needsUpdate=function(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency},e.prototype.update=function(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()},e.prototype._scheduleNext=function(){var e=this;this._task||this._isPaused||this._schedule||(this._schedule=o.schedule(function(){e._schedule=null,e._next()}))},e.prototype._next=function(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())},e.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)},e.prototype._processResult=function(e,t){this._remove(e.item),this._scheduleNext(),e.dfd.resolve(t)},e.prototype._processError=function(e,t){e.isReset?this._processReset(e):(this._remove(e.item),this._scheduleNext(),e.dfd.reject(t))},e.prototype._processReset=function(e){this._remove(e.item),this._add(e.item,e.dfd),this._scheduleNext()},e.prototype._processOrdered=function(e,t){var r=this;if(e.isReset)this._processReset(e);else{e.result=t;var i=!1;this._processingItems.forEach(function(e){i||(e.result?r._itemsToProcess.push(e):i=!0)});for(var n=0,o=this._itemsToProcess;n<o.length;n++){var s=o[n];!1===s.result.ok?this._processError(s,s.result.error):this._processResult(s,s.result.value)}this._itemsToProcess.length=0}},e.prototype._process=function(e){var t=this;if(!r.isNone(e)){var i=this._apiPromises.get(e);this._pendingProcessing++;var n=this.process(e);if(this._pendingProcessing--,function(e){return e&&"function"==typeof e.then}(n)){var o={item:e,resultPromise:n,result:null,dfd:i,isReset:!1};this._processingItems.set(e,o),this.ordered?n.then(function(e){return t._processOrdered(o,{ok:!0,value:e})},function(e){return t._processOrdered(o,{ok:!1,error:e})}):n.then(function(e){return t._processResult(o,e)},function(e){return t._processError(o,e)})}else i.resolve(n),this._remove(e)}},e.prototype._add=function(e,t){this._apiPromises.set(e,t),this._queue.push(e)},e.prototype._remove=function(e){this._queue.remove(e),this._apiPromises.delete(e),this._processingItems.delete(e)},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{update:function(t){return e.update(t)}}},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},1556:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e){this._items=[],this._itemSet=new Set,this._peeker=function(e){return e[0]},this._length=0,e&&e.peeker&&(this._peeker=e.peeker)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._itemSet.clear(),this._items.length=0,this._length=0},e.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)},e.prototype.push=function(e){this.contains(e)||this._add(e)},e.prototype.contains=function(e){return this._length>0&&this._itemSet.has(e)},e.prototype.pop=function(){if(0!==this._length){var e=this.peek();return this._remove(e),e}},e.prototype.remove=function(e){this.contains(e)&&this._remove(e)},e.prototype._add=function(e){this._items.push(e),this._itemSet.add(e),this._length++},e.prototype._remove=function(e){this._itemSet.delete(e),this._items.splice(this._items.indexOf(e),1),this._length--},e}()}.apply(null,i))||(e.exports=n)},1594:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1521),r(352),r(1541),r(1524)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0}),t.TileInfoView=r,t.TileKey=i,t.TileQueue=n,t.TileStrategy=o}.apply(null,i))||(e.exports=n)},1615:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(80)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}return e.prototype.acquire=function(e,t,r,i,n,o,s,a,u){this.color=e,this.haloColor=t,this.haloSize=r,this.size=i,this.angle=n,this.offsetX=o,this.offsetY=s,this.hAnchor=a,this.vAnchor=u},e.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0},e.pool=new r(e),e}();t.TextProperties=i}.apply(null,i))||(e.exports=n)},1623:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(7),r(0),r(354),r(127)],void 0===(n=function(e,t,r,i,n,o,s,a,u){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r(t,e),n=t,t.fromWorker=function(e){if(!e)return null;var t=JSON.parse(e),r=new n;return r.fields=t.fields&&t.fields.map(function(e){return a.fromJSON(e)}),r.options=t.options,r.process=new(Function.bind.apply(Function,[void 0].concat(t.process.args,[t.process.body]))),r},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n(o.clone({fields:this.fields,options:this.options,process:this.process}))},t.prototype.getField=function(e){return u.getField(this.fields,e)},t.prototype.refresh=function(){this.notifyChange("version")},t.prototype.toWorker=function(){var e=this.process.toString();return JSON.stringify({fields:this.fields,options:this.options,process:{body:e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),args:e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/([^\s,]+)/g)}})},i([s.property({type:[a]})],t.prototype,"fields",void 0),i([s.property()],t.prototype,"options",void 0),i([s.property()],t.prototype,"process",void 0),i([s.property({readOnly:!0,dependsOn:["process","options","fields"]})],t.prototype,"version",null),n=i([s.subclass("esri.layers.support.FeatureProcessing")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1639:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(22),r(25),r(2),r(6),r(13),r(1503),r(10),r(32),r(0),r(1640),r(1562),r(1506)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,h,f,d){Object.defineProperty(t,"__esModule",{value:!0});var y=l.getLogger("esri.views.2d.layers.features.controllers.BaseController"),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.configuration=null,t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t.filters=new Array(d.MAX_FILTERS),t}return o(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),t.prototype.setFilterBase=function(e,t){return n(this,void 0,void 0,function(){var r,n,o,s;return i(this,function(i){switch(i.label){case 0:return[4,this._getFilter(e)];case 1:return r=i.sent(),[4,f.normalizeFilter(t,null,this.spatialReference)];case 2:return n=i.sent(),this.configuration.filter=n,n?[4,r.update(n)]:[2,r.clear()];case 3:i.sent(),i.label=4;case 4:return i.trys.push([4,6,,7]),[4,this.queryObjectIds(r.createQuery().toJSON())];case 5:return o=i.sent(),[2,r.setTrue(o)];case 6:return s=i.sent(),y.error(new a("featurelayer-controller:query-filter-error","An error occurred while executing the query",{error:s})),[2,{show:[],hide:[]}];case 7:return[2]}})})},t.prototype.enableEvent=function(e){},t.prototype._getFilter=function(e){return n(this,void 0,void 0,function(){var t,r,n;return i(this,function(i){switch(i.label){case 0:return t=this.filters[e],c.isSome(t)?[2,t]:(r=new h.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1,timeInfo:this.service.timeInfo}),this.filters[e]=r,[4,this.queryObjectIds({})]);case 1:return n=i.sent(),r.setKnownIds(n),[2,r]}})})},t.prototype._getFilterFlags=function(e){for(var t=0,r=0;r<this.filters.length;r++){var i=this.filters[r];t|=(c.isNone(i)||i.check(e)?1:0)<<r}return t},t.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return c.isSome(e)&&!!e.geometry})},r([p.property()],t.prototype,"configuration",void 0),r([p.property()],t.prototype,"processor",void 0),r([p.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([p.property({constructOnly:!0})],t.prototype,"service",void 0),r([p.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([p.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([p.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([p.property()],t.prototype,"filters",void 0),r([p.subclass()],t)}(p.declared(s,u));t.default=_}.apply(null,i))||(e.exports=n)},1640:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(25),r(11),r(22),r(170),r(13),r(10),r(32),r(9),r(37),r(549),r(1554),r(1607),r(1590),r(353)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,h,f,d,y){Object.defineProperty(t,"__esModule",{value:!0});var _=a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),g=1,v=2,m=function(){function e(e){var t=this;this._geometryBounds=c.create(),this._idToVisibility=new Map,this.check=function(e){var r=e.objectId,i=t._idToVisibility,n=t._applyFilter(e);return i.set(r,n?g|v:v),!!(i.get(r)&g)},this._serviceInfo=e}return e.prototype.clear=function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}},e.prototype.invalidate=function(){var e=this;this._idToVisibility.forEach(function(t,r){e._idToVisibility.set(r,0)})},e.prototype.setKnownIds=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._idToVisibility.set(i,g)}},e.prototype.setTrue=function(e){var t=this,r=[],i=[],n=new o.default(e);return this._idToVisibility.forEach(function(e,o){var s=!!(t._idToVisibility.get(o)&g),a=n.has(o);!s&&a?r.push(o):s&&!a&&i.push(o),t._idToVisibility.set(o,a?g|v:0)}),{show:r,hide:i}},e.prototype.createQuery=function(){var e=this,t=e.geometry,r=e.spatialRel,i=e.where,n=e.distance,o=e.units,s=e.timeExtent,a=e.objectIds;return y.fromJSON({geometry:t,spatialRel:r,where:i,distance:n,units:o,timeExtent:s,objectIds:a})},e.prototype.update=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return[4,l.all([this._setGeometryFilter(e),this._setIdFilter(e),this._setAttributeFilter(e),this._setTimeFilter(e)])];case 1:return t.sent(),[2]}})})},e.prototype._setAttributeFilter=function(e){if(!e||!e.where)return this._clause=null,void(this.where=null);var t=h.getWhereClause(e.where);if(t.isStandardized())this._clause=t;else{var r=new s("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",t);_.error(r)}this.where=e.where},e.prototype._setIdFilter=function(e){this._idsToShow=e&&e.objectIds&&new o.default(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new o.default(e.hiddenIds),this.objectIds=e&&e.objectIds},e.prototype._setGeometryFilter=function(e){return r(this,void 0,void 0,function(){var t,r,i;return n(this,function(n){switch(n.label){case 0:return e&&e.geometry?(t=e.geometry,r=e.spatialRel||"esriSpatialRelIntersects",[4,f.getSpatialQueryOperator(r,t,this._serviceInfo)]):(this._spatialQueryOperator=null,this.geometry=null,this.spatialRel=null,[2]);case 1:return i=n.sent(),p.getBoundsXY(this._geometryBounds,t),this._spatialQueryOperator=i,this.geometry=t,this.spatialRel=r,[2]}})})},e.prototype._setTimeFilter=function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent){if(!this._serviceInfo.timeInfo){var t=new s("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);return void _.error(t)}this.timeExtent=e.timeExtent,this._timeOperator=d.getTimeOperator(this._serviceInfo.timeInfo,e.timeExtent)}},e.prototype._applyFilter=function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)},e.prototype._filterByExpression=function(e){return!this.where||this._clause.testFeature(e.attributes)},e.prototype._filterById=function(e){return(!this._idsToHide||!this._idsToHide.has(e.objectId))&&(!this._idsToShow||this._idsToShow.has(e.objectId))},e.prototype._filterByGeometry=function(e){return!this.geometry||!!this._earlyGeometryReject(e)&&this._spatialQueryOperator(e.geometry)},e.prototype._filterByTime=function(e){return!u.isSome(this._timeOperator)||this._timeOperator(e)},e.prototype._earlyGeometryReject=function(e){return!(!e.geometry||!e.geometry.coords.length)&&(!e.centroid||"esriSpatialRelContains"!==this.spatialRel||c.containsPoint(this._geometryBounds,e.centroid.coords))},e.prototype._resetAllHiddenIds=function(){var e=this,t=[];return this._idToVisibility.forEach(function(r,i){r&g||(e._idToVisibility.set(i,g),t.push(i))}),t},e}();t.default=m}.apply(null,i))||(e.exports=n)},1699:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(57),r(0),r(40),r(1594)],void 0===(n=function(e,t,r,i,n,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[0,0],c=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._onGoingTile=null,r._onGoingPromise=null,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingPromise},enumerable:!0,configurable:!0}),t.prototype.cancel=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingPromise.cancel(),this._onGoingTile=this._onGoingPromise=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingPromise&&(this._onGoingPromise.cancel(),this._onGoingTile=this._onGoingPromise=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){this._queue.has(e)||(this._queue.set(e,{tileId:e,key:u.TileKey.pool.acquire(e),timestamp:t||this._timestamp}),this._scheduleNext(),this.notifyChange("updating"))},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this._onGoingPromise=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=o.schedule(this._next))},t.prototype._next=function(){if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var e=this._peek(),t=e.tileId,r=e.key;u.TileKey.pool.release(r),this._queue.delete(t),this._onGoingTile=e,this._onGoingPromise=this.process(t,this._timestamp),function(e){return e&&"function"==typeof e.then}(this._onGoingPromise)?this._onGoingPromise.then(this._finalize,this._finalize):this._finalize(),this.notifyChange("updating")}},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=null;return this._queue.forEach(function(s,u){t.getTileCoords(l,s.key);var c=e._timestamp-s.timestamp;if(isNaN(c))(p=a.vec2.distance(l,r))<n&&(n=p,o=s);else if(c===i){var p;(p=a.vec2.distance(l,r))<n&&(n=p,o=s)}else c>i&&(i=c,n=Number.POSITIVE_INFINITY,o=s)}),o},i([s.property({readOnly:!0})],t.prototype,"length",null),i([s.property({constructOnly:!0})],t.prototype,"process",void 0),i([s.property()],t.prototype,"state",void 0),i([s.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),i([s.property({readOnly:!0})],t.prototype,"updating",null),i([s.subclass()],t)}(s.declared(n));t.default=c}.apply(null,i))||(e.exports=n)},1790:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(22),r(25),r(170),r(43),r(13),r(19),r(10),r(9),r(0),r(547),r(1544),r(1553),r(1623),r(1466),r(557),r(353),r(1511),r(1639),r(2228),r(2229),r(1529),r(1699),r(1541),r(1546)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,h,f,d,y,_,g,v,m,T,I,E,b,w,S,F,C,O){Object.defineProperty(t,"__esModule",{value:!0});var x=p.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),P=c("esri-featurelayer-webgl"),R=c("esri-mobile"),B={maxDrillLevel:P&&"object"==typeof P&&null!=P.maxDrillLevel?P.maxDrillLevel:R?1:4,maxRecordCountFactor:P&&"object"==typeof P&&null!=P.maxRecordCountFactor?P.maxRecordCountFactor:R?1:3,enablePBFQuery:!P||"object"!=typeof P||null==P.enablePBFQuery||P.enablePBFQuery},V=new a.default,M=[],L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="on-demand",t._queryInfoHash=null,t._processingInMainThread=!1,t._dataTileIndex=new w.default,t._editsQueue=new O({concurrency:1,ordered:!0,process:function(e){return t._processEditsEvent(e)}}),t}return r(t,e),t.prototype.initialize=function(){var e=this;this._fetchQueue=new C({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t){return e._fetchTile(t)}}),this._updateQueue=new F.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._updateTile(t,r)}}),this.handles.add(this.watch("processor",this._switchProcessor.bind(this)))},t.prototype.destroy=function(){this._fetchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine&&(this.queryEngine.destroy(),this._set("queryEngine",null))},Object.defineProperty(t.prototype,"processing",{get:function(){return g.fromWorker(this.configuration.processing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._fetchQueue.updating||this._updateQueue.updating},enumerable:!0,configurable:!0}),t.prototype.onEdits=function(e){var t=this;this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then(function(){0===t._editsQueue.length&&t._fetchQueue.resume()})},t.prototype.queryFeatures=function(e){return this.queryEngine?this.queryEngine.executeQuery(e):h.resolve({features:[],fields:[]})},t.prototype.queryFeatureCount=function(e){return this.queryEngine?this.queryEngine.executeQueryForCount(e):h.resolve(0)},t.prototype.queryObjectIds=function(e){return this.queryEngine?this.queryEngine.executeQueryForIds(e):h.resolve([])},t.prototype.queryExtent=function(e){return this.queryEngine?this.queryEngine.executeQueryForExtent(e):h.reject({count:0,extent:null})},t.prototype.redraw=function(){this._updateQueue.pause(),this._manageTiles(this.tileStore.tiles),this._updateQueue.resume()},t.prototype.refresh=function(){if(this.queryEngine&&this.queryEngine.destroy(),this.featureStore&&this.featureStore.clear(),this._dataTileIndex.featureStore=null,this._dataTileIndex.clear(),this._editsQueue.pause(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.reset(),this._updateQueue.clear(),this.processor){var e=this.processor.queryInfo,t=e.definitionExpression,r=e.gdbVersion,i=e.historicMoment;this._set("featureStore",new y.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1})),this._set("queryEngine",new _.default({definitionExpression:t,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,gdbVersion:r,historicMoment:null!=i&&new Date(i),featureStore:this.featureStore})),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.clear(),this._fetchQueue.resume(),this._editsQueue.resume(),this._updateQueue.resume(),this._manageTiles(this.tileStore.tiles)}},t.prototype.setFilter=function(e){var t=e.index,r=e.filter;return s(this,void 0,void 0,function(){var e;return o(this,function(i){switch(i.label){case 0:return this.processor?(this._updateQueue.pause(),[4,this.setFilterBase(t,r)]):(this.setFilterBase(t,r),[2,{show:[],hide:[]}]);case 1:return e=i.sent(),this.processor.supportsTileUpdates||(this._updateQueue.clear(),this._manageTiles(this.tileStore.tiles)),this._updateQueue.resume(),[2,e]}})})},t.prototype.setViewState=function(e){this._fetchQueue.state=e,this._updateQueue.state=e},t.prototype.onTileUpdate=function(e){this.queryEngine&&this._manageTiles(e.added,e.removed)},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,i=this._fetchQueue,n=this._updateQueue,o="esriGeometryPoint"===this.service.geometryType,s=this,a=0,u=e;a<u.length;a++){!function(e){var t=r.get(e.id);t?(t.displayTile=e,o?r.forEach(function(r){S.isChildOf(r,t)&&(r.displayTile=e)}):t.done=!1):((t=new b.default).tile=e.clone(),t.displayTile=e,r.add(t)),s._processDataTile(t)}(p=u[a])}if(t)for(var l=0,c=t;l<c.length;l++){var p=c[l];V.add(p),n.cancel(p.id)}r.forEach(function(e){V.has(e.displayTile)&&M.push(e)});for(var h=0,f=M;h<f.length;h++){var d=f[h];i.has(d.id)&&i.getPromise(d.id).cancel(),r.delete(d)}M.length=0,V.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,i=e.key,n=this._dataTileIndex,o=this._fetchQueue,s=i.id,a=this._queryInfoHash,u=i.level-r.key.level>=B.maxDrillLevel;if(n.add(e),e.done||o.has(s)){if(e.queryInfoHash!==a||e.returnExceeded!==u)if(e.done)e.done=!1;else{if(!o.isOngoing(s))return e.queryInfoHash=a,void(e.returnExceeded=u);o.getPromise(s).cancel()}}else e.queryInfoHash=a,e.returnExceeded=u;e.done?this._invalidateTile(e.displayTile):o.has(s)||o.push(e).then(function(r){return t._handleResponse(e,r)}).catch(function(t){"cancel"!==t.dojoType&&x.error(new l("featurelayer-controller:tile-error","Encountered an error when handling tile response",t)),e.done=!0})},t.prototype._handleResponse=function(e,t){if(e.done=!0,d.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else for(var r=0,i=e.tile.createChildTiles();r<i.length;r++){var n=i[r],o=new b.default;o.tile=n,o.displayTile=e.displayTile,this._processDataTile(o)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile)},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach(function(t){S.isChildOf(t,e)&&M.push(t)});for(var t=0,r=M;t<r.length;t++){var i=r[t];this._fetchQueue.has(i.id)&&this._fetchQueue.getPromise(i.id).cancel(),this._dataTileIndex.delete(i)}M.length=0},t.prototype._fetchTile=function(e){var t=this,r=this._createQuery(e.displayTile,e.tile,e.returnExceeded),i=this.service.source;return B.enablePBFQuery&&this.service.capabilities.query.supportsFormatPBF?v.executeQueryPBF(i,r,{type:"optimized"}).then(function(e){return e.data}):v.executeQuery(i,r).then(function(e){return d.convertFromFeatureSet(e.data,t.service.objectIdField)})},t.prototype._invalidateTile=function(e){for(var t=this._updateQueue,r=0,i=this.tileStore.intersections(e,this.processor.queryInfo.pixelBuffer);r<i.length;r++){var n=i[r].tile;t.push(n.id,n.updateTimestamp)}},t.prototype._updateTile=function(e,t){var r=this,i=this.tileStore.get(e),n=this.processor.queryInfo,o=n.returnCentroid,s=n.returnGeometry,a={pixelBuffer:n.pixelBuffer,returnGeometry:s,returnCentroid:o},u=this._getFilterFlags.bind(this),l=this.queryEngine.executeTileQuery(i,a,u),c=l.features,p=l.objectIds,h={geometryType:this.service.geometryType,features:c,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:{originPosition:"upperLeft",scale:[i.resolution,i.resolution],translate:[i.bounds[0],i.bounds[3]]}};return this._applyProcessing(h).catch(function(e){return e&&"cancel"!==e.dojoType&&x.error("update-tile",e),h}).then(function(e){var n=[],o=!0;return r._dataTileIndex.forEach(function(e){i.id!==e.id&&S.isChildOf(e,i)&&o&&!e.done&&(o=!1)}),o&&i&&i.objectIds.forEach(function(e){p.has(e)||n.push(e)}),p.forEach(function(e){i.objectIds.add(e)}),i.updateTimestamp=t,r.processor.onTileData(i,{addOrUpdate:e.features,remove:n,transformParams:I.getTransformParams(e)}).catch(function(e){e&&"cancel"!==e.dojoType&&x.error("update-tile",e)})})},t.prototype._processEditsEvent=function(e){var t=this;return h.create(function(r,i){var n=function(e){return e.objectId},o=e.deletedFeatures.map(n),s=t._dataTileIndex.deleteFeaturesById(o),a=e.addedFeatures.concat(e.updatedFeatures).map(n);if(a.length){var u=t.service.source,l=t._createObjectIdsQuery(a);v.executeQuery(u,l).then(function(e){var r=e.data;if(r&&r.features&&r.features.length){var i=d.convertFromFeatureSet(r,t.service.objectIdField).features;s.push.apply(s,t._dataTileIndex.addOrUpdateFeatures(i));for(var n=0,o=s;n<o.length;n++){var a=o[n];t._invalidateTile(a.tile)}}}).then(r,r)}else{for(var c=0,p=s;c<p.length;c++){var h=p[c];t._invalidateTile(h.tile)}r()}})},t.prototype._switchProcessor=function(e,t){var r=e.queryInfo,i=r.definitionExpression,n=r.gdbVersion,o=r.historicMoment,s=this._createQueryInfoHash(e);this._queryInfoHash!==s&&(this._queryInfoHash=s,this.queryEngine&&this.queryEngine.destroy(),this.featureStore&&this.featureStore.clear(),this._set("featureStore",new y.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1})),this._set("queryEngine",new _.default({definitionExpression:i,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,gdbVersion:n,historicMoment:null!=o&&new Date(o),featureStore:this.featureStore,timeInfo:this.service.timeInfo})),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach(function(e){e.done=!1})),this._editsQueue.pause(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.reset(),this._updateQueue.clear(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),this._editsQueue.resume(),this._updateQueue.resume()},t.prototype._createQuery=function(e,t,r){void 0===r&&(r=!0);var i=this.service.geometryType,n=this._createDefaultQuery(),o="esriGeometryPoint"===this.service.geometryType?t:e;return n.maxRecordCountFactor=B.maxRecordCountFactor,n.resultType="tile",n.returnExceededLimitFeatures=r,n.geometry=new u.Extent({xmin:t.bounds[0],ymin:t.bounds[1],xmax:t.bounds[2],ymax:t.bounds[3],spatialReference:this.spatialReference}),this.service.capabilities.query.supportsQuantization?(n.quantizationParameters=new m.default({mode:"view",originPosition:"upper-left",tolerance:o.resolution,extent:new u.Extent({xmin:o.bounds[0],ymin:o.bounds[1],xmax:o.bounds[2],ymax:o.bounds[3],spatialReference:this.spatialReference})}),"esriGeometryPolyline"===i&&(n.maxAllowableOffset=o.resolution)):"esriGeometryPolyline"!==i&&"esriGeometryPolygon"!==i||(n.maxAllowableOffset=o.resolution),n},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery();return t.objectIds=e,t},t.prototype._createDefaultQuery=function(){var e=this,t=this.processor.queryInfo,r=new T;r.outSpatialReference=this.spatialReference;var i=t.outFields,n=t.orderByFields;return this.processing&&(i=i&&i.filter(function(t){return!e.processing.getField(t)}),n=n&&n.filter(function(t){return!e.processing.getField(t)})),i=i.length/this.service.fields.length>=.75?["*"]:i,r.gdbVersion=t.gdbVersion,r.historicMoment=null!=t.historicMoment?new Date(t.historicMoment):null,r.outFields=i,r.where=t.definitionExpression||"1=1",r.returnGeometry=!0,r.returnCentroid=t.returnCentroid,r.orderByFields=n,r},t.prototype._applyProcessing=function(e){var t=this.processing;if(!t)return h.resolve(e);if(this._processingInMainThread)return this.remoteClient.invoke("executeProcessing",{featureSet:e});try{var r=t.process(e,t.options);return r?"then"in r?r:h.resolve(r):h.reject(new l("FeatureLayer","invalid processing.process() method, returns nothing"))}catch(t){return this._processingInMainThread=!0,this.remoteClient.invoke("executeProcessing",{featureSet:e})}},t.prototype._createQueryInfoHash=function(e){var t=this,r=e.queryInfo,i=r.orderByFields,n=r.outFields,o=e.queryInfo,s=o.definitionExpression,a=o.gdbVersion,u=o.historicMoment;return this.processing&&(n=n&&n.filter(function(e){return!t.processing.getField(e)}),i=i&&i.filter(function(e){return!t.processing.getField(e)})),n&&n.sort(),i&&i.sort(),JSON.stringify({definitionExpression:s,outFields:n.length/this.service.fields.length>=.75?["*"]:n,orderByFields:i,gdbVersion:a,historicMoment:u})},i([f.property()],t.prototype,"_fetchQueue",void 0),i([f.property()],t.prototype,"_updateQueue",void 0),i([f.property({readOnly:!0,dependsOn:["configuration"]})],t.prototype,"processing",null),i([f.property({readOnly:!0})],t.prototype,"queryEngine",void 0),i([f.property({readOnly:!0})],t.prototype,"featureStore",void 0),i([f.property({dependsOn:["_fetchQueue.updating","_updateQueue.updating"]})],t.prototype,"updating",null),i([f.subclass()],t)}(f.declared(E.default));t.default=L}.apply(null,i))||(e.exports=n)},2228:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=r}.apply(null,i))||(e.exports=n)},2229:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(546),r(170),r(2230),r(1544),r(1529)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=[],u=new i.default,l=function(){function e(){this._tileById=new r.default,this._tilesToFeatures=new r.default,this._featureToTiles=new r.default}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var r=e;this._tileById.set(r.id,r),this._tilesToFeatures.set(r,n.default.acquire()),this._tilesToFeatures.forEach(function(e,i){r!==i&&(s.isParentOf(r,i)?e.forEach(function(e){t._link(r,e)}):s.isChildOf(r,i)&&t.featureStore.forEachInBounds(r.bounds,function(i){e.has(i.objectId)&&t._link(r,i.objectId)}))})}},e.prototype.clear=function(){this._tilesToFeatures.forEach(function(e){return n.default.release(e)}),this._tilesToFeatures.clear(),this._featureToTiles.forEach(function(e){return n.default.release(e)}),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);a.length=0,this._tilesToFeatures.get(r).forEach(function(e){var i=t._featureToTiles.get(e);i.has(r)&&1===i.size?a.push(e):t._unlink(r,e)});for(var i=0,n=a;i<n.length;i++){var o=n[i];this._unlink(r,o)}this.featureStore.removeManyById(a),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),a.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var r=this,i=this.get(e.id);this._tilesToFeatures.has(i)||(this._tileById.set(i.id,i),this._tilesToFeatures.set(i,n.default.acquire()));for(var o=0,s=t;o<s.length;o++){var l=s[o];u.add(l.objectId)}a.length=0,this._tilesToFeatures.get(i).forEach(function(e){if(!u.has(e)){var t=r._featureToTiles.get(e);t.has(i)&&1===t.size?a.push(e):r._unlink(i,e)}});for(var c=0,p=a;c<p.length;c++){var h=p[c];this._unlink(i,h)}this.featureStore.removeManyById(a),this.featureStore.addMany(t),u.forEach(function(e){r._link(i,e)}),u.clear(),a.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new i.default,n=new o.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ}),s=0,a=this.deleteFeaturesById(e.map(function(e){return e.objectId}));s<a.length;s++){var u=a[s];r.add(u)}n.addMany(e),this._tileById.forEach(function(e){n.forEachInBounds(e.bounds,function(i){t._link(e,i.objectId),r.add(e)})}),this.featureStore.addMany(e);var l=[];return r.forEach(function(e){return l.push(e)}),l},e.prototype.deleteFeaturesById=function(e){for(var t=this,r=new i.default,o=this,s=0,a=e;s<a.length;s++){!function(e){var i=o._featureToTiles.get(e);i&&(i.forEach(function(i){r.add(i),t._tilesToFeatures.get(i).delete(e)}),n.default.release(i),o._featureToTiles.delete(e))}(a[s])}this.featureStore.removeManyById(e);var u=[];return r.forEach(function(e){return u.push(e)}),u},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,n.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(n.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=l}.apply(null,i))||(e.exports=n)},2230:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(170)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._pool=[],this._set=new r.default}return e.prototype.acquire=function(){if(0===this._pool.length)return new r.default;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}();t.default=i;var n=new i}.apply(null,i))||(e.exports=n)}}]);